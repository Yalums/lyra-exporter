"use strict";(self.webpackChunklyra_exporter=self.webpackChunklyra_exporter||[]).push([[843],{843:(t,e,n)=>{n.d(e,{exportData:()=>c});var i=n(555),a=n(224);const o={includeThinking:!0,includeTools:!0,includeArtifacts:!0,includeCitations:!0,includeTimestamps:!1,exportObsidianMetadata:!1,exportMarkedOnly:!1,excludeDeleted:!0,includeCompleted:!1,includeImportant:!1,obsidianProperties:[],obsidianTags:[]};class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=(0,i.A)((0,i.A)({},o),t)}generate(t){return[this.generateMetadata(t),this.generateHeader(t),this.generateMessages(t),this.generateFooter(t)].filter(Boolean).join("\n")}generateMetadata(t){var e,n,i;if(!this.config.exportObsidianMetadata)return"";const o=["---","title: ".concat((null===(e=t.meta_info)||void 0===e?void 0:e.title)||"\u5bf9\u8bdd\u8bb0\u5f55"),"date: ".concat(a.Nq.getCurrentDate()),"export_time: ".concat(a.Nq.formatDateTime(new Date))];return(null===(n=this.config.obsidianProperties)||void 0===n?void 0:n.length)>0&&this.config.obsidianProperties.forEach(t=>{if(t.value.includes(",")){const e=t.value.split(",").map(t=>t.trim());o.push("".concat(t.name,":")),e.forEach(t=>o.push("  - ".concat(t)))}else o.push("".concat(t.name,": ").concat(t.value))}),(null===(i=this.config.obsidianTags)||void 0===i?void 0:i.length)>0&&(o.push("tags:"),this.config.obsidianTags.forEach(t=>o.push("  - ".concat(t)))),o.push("---",""),o.join("\n")}generateHeader(t){const{meta_info:e={}}=t,n=["# ".concat(e.title||"\u5bf9\u8bdd\u8bb0\u5f55"),"*\u521b\u5efa\u65f6\u95f4: ".concat(e.created_at||"\u672a\u77e5","*"),"*\u5bfc\u51fa\u65f6\u95f4: ".concat(a.Nq.formatDateTime(new Date),"*")];if(this.config.excludeDeleted||this.config.includeCompleted||this.config.includeImportant){const t=this.getFilterDescription();t&&n.push("*\u7b5b\u9009\u6761\u4ef6: ".concat(t,"*"))}return n.push("","---",""),n.join("\n")}generateMessages(t){const{chat_history:e=[]}=t,n=this.filterMessages(e);return 0===n.length?"*\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6d88\u606f*\n":n.map((t,e)=>this.formatMessage(t,e+1)).join("\n---\n\n")}generateFooter(t){const{chat_history:e=[]}=t,n=this.filterMessages(e),i=e.length;return n.length<i?"\n*\u6839\u636e\u7b5b\u9009\u6761\u4ef6\uff0c\u4ece ".concat(i," \u6761\u6d88\u606f\u4e2d\u5bfc\u51fa\u4e86 ").concat(n.length," \u6761\u6d88\u606f*"):""}filterMessages(t){let e=[...t];const n=this.config.marks||{completed:new Set,important:new Set,deleted:new Set};return this.config.excludeDeleted&&(e=e.filter(t=>!n.deleted.has(t.index))),this.config.includeCompleted&&!this.config.includeImportant&&(e=e.filter(t=>n.completed.has(t.index))),this.config.includeImportant&&!this.config.includeCompleted&&(e=e.filter(t=>n.important.has(t.index))),this.config.includeCompleted&&this.config.includeImportant&&(e=e.filter(t=>n.completed.has(t.index)&&n.important.has(t.index))),e}formatMessage(t,e){var n,i,a;const o=[],s=this.getBranchMarker(t),r=this.formatMessageTitle(t,e,s);return o.push(r),this.config.includeTimestamps&&t.timestamp&&o.push("*".concat(t.timestamp,"*")),o.push(""),t.display_text&&o.push(t.display_text,""),t.thinking&&this.config.includeThinking&&o.push(this.formatThinking(t.thinking)),(null===(n=t.artifacts)||void 0===n?void 0:n.length)>0&&this.config.includeArtifacts&&t.artifacts.forEach(t=>{o.push(this.formatArtifact(t))}),(null===(i=t.tools)||void 0===i?void 0:i.length)>0&&this.config.includeTools&&t.tools.forEach(t=>{o.push(this.formatTool(t))}),(null===(a=t.citations)||void 0===a?void 0:a.length)>0&&this.config.includeCitations&&o.push(this.formatCitations(t.citations)),o.join("\n")}formatThinking(t){return["<details>","<summary>\ud83d\udcad \u601d\u8003\u8fc7\u7a0b</summary>","","```",t,"```","</details>",""].join("\n")}formatArtifact(t){const e=["<details>","<summary>\ud83d\udd27 Artifact: ".concat(t.title||"\u65e0\u6807\u9898","</summary>"),"","**\u7c7b\u578b**: `".concat(t.type||"\u672a\u77e5","`"),""];return"create"===t.command&&t.content&&(t.language&&e.push("**\u8bed\u8a00**: `".concat(t.language,"`")),e.push("","**\u5185\u5bb9**:"),e.push("```".concat(t.language||"")),e.push(t.content),e.push("```")),e.push("</details>",""),e.join("\n")}formatTool(t){var e;const n=["<details>","<summary>\ud83d\udd0d \u5de5\u5177: ".concat(t.name,"</summary>"),""];return t.query&&n.push("**\u641c\u7d22\u67e5\u8be2**: `".concat(t.query,"`"),""),null!==(e=t.result)&&void 0!==e&&e.content&&"web_search"===t.name&&(n.push("**\u641c\u7d22\u7ed3\u679c**:",""),t.result.content.slice(0,5).forEach((t,e)=>{n.push("".concat(e+1,". [").concat(t.title||"\u65e0\u6807\u9898","](").concat(t.url||"#",")"))})),n.push("</details>",""),n.join("\n")}formatCitations(t){const e=["<details>","<summary>\ud83d\udcce \u5f15\u7528\u6765\u6e90</summary>","","| \u6807\u9898 | \u6765\u6e90 |","| --- | --- |"];return t.forEach(t=>{const n=t.title||"\u672a\u77e5\u6765\u6e90",i=t.url||"#",a=i.includes("/")?i.split("/")[2]:"\u672a\u77e5\u7f51\u7ad9";e.push("| [".concat(n,"](").concat(i,") | ").concat(a," |"))}),e.push("</details>",""),e.join("\n")}getBranchMarker(t){return t.is_branch_point?" \ud83d\udd00":t.branch_level>0?" \u21b3".concat(t.branch_level):""}formatMessageTitle(t,e,n){let i="";if(this.config.includeHeaderPrefix&&(i+="#".repeat(this.config.headerLevel||2)+" "),this.config.includeNumbering){const t=this.config.numberingFormat||"numeric";"numeric"===t?i+="".concat(e,". "):"letter"===t?i+="".concat(this.toExcelColumn(e),". "):"roman"===t&&(i+="".concat(this.toRoman(e),". "))}return i+=this.getSenderLabel(t)+n,i}getSenderLabel(t){const e="human"===t.sender||"\u4eba\u7c7b"===t.sender_label||"Human"===t.sender_label;return this.config.humanLabel&&this.config.assistantLabel?e?this.config.humanLabel:this.config.assistantLabel:t.sender_label||(e?"\u4eba\u7c7b":"Claude")}toExcelColumn(t){let e="";for(;t>0;)t--,e=String.fromCharCode(65+t%26)+e,t=Math.floor(t/26);return e}toRoman(t){if(t<=0||t>=4e3)return t.toString();const e=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],n=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"];let i="";for(let a=0;a<e.length;a++)for(;t>=e[a];)i+=n[a],t-=e[a];return i}getFilterDescription(){const t=[];return this.config.excludeDeleted&&t.push("\u6392\u9664\u5df2\u5220\u9664"),this.config.includeCompleted&&this.config.includeImportant?t.push("\u4ec5\u5df2\u5b8c\u6210\u4e14\u91cd\u8981\u7684\u6d88\u606f"):this.config.includeCompleted?t.push("\u4ec5\u5df2\u5b8c\u6210\u7684\u6d88\u606f"):this.config.includeImportant&&t.push("\u4ec5\u91cd\u8981\u7684\u6d88\u606f"),t.join("\uff0c")}}class r{static saveTextFile(t,e){try{const n=new Blob([t],{type:"text/markdown;charset=utf-8"}),i=URL.createObjectURL(n),a=document.createElement("a");return a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),!0}catch(n){return console.error("\u4fdd\u5b58\u6587\u4ef6\u5931\u8d25:",n),alert("\u4fdd\u5b58\u6587\u4ef6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"),!1}}static async exportSingleFile(t){const e=new s(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).generate(t),n=this.generateFileName(t,"single");return this.saveTextFile(e,n)}static async exportMultipleFiles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.map((t,n)=>{const a=(0,i.A)((0,i.A)({},e),{},{marks:{completed:new Set,important:new Set,deleted:new Set}});return new s(a).generate(t)}).join("\n\n---\n---\n\n"),a=this.generateFileName(null,"multiple");return this.saveTextFile(n,a)}static generateFileName(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single";const i=a.Nq.getCurrentDate();if("single"===n&&null!==t&&void 0!==t&&null!==(e=t.meta_info)&&void 0!==e&&e.title){const e=t.meta_info.title.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"_");return"".concat(e,"_").concat(i,".md")}return"export_".concat(i,".md")}}async function c(t){const{scope:e="current",data:n=null,dataList:i=[],config:a={}}=t;try{switch(e){case"current":if(!n)throw new Error("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u6570\u636e");return r.exportSingleFile(n,a);case"multiple":if(0===i.length)throw new Error("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u6570\u636e");return r.exportMultipleFiles(i,a);default:throw new Error("\u672a\u77e5\u7684\u5bfc\u51fa\u8303\u56f4: ".concat(e))}}catch(o){return console.error("\u5bfc\u51fa\u5931\u8d25:",o),alert("\u5bfc\u51fa\u5931\u8d25: ".concat(o.message)),!1}}}}]);
//# sourceMappingURL=843.c3431e18.chunk.js.map