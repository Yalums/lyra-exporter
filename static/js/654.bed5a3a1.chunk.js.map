{"version":3,"file":"static/js/654.bed5a3a1.chunk.js","mappings":"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","sources":["utils/export/pdfFontHelper.js","utils/export/pdfTextHelpers.js","utils/export/pdfLatexRenderer.js","utils/export/pdfContentRenderers.js","utils/export/pdfExportManager.js"],"sourcesContent":["// utils/export/pdfFontHelper.js\n// PDF -  ARUDJingxihei () \n//\n// \n// -  public/fonts/ARUDJingxihei-Regular.ttf ()\n// -  public/fonts/ARUDJingxihei-Bold.ttf ()\n// -  public/fonts/ARUDJingxihei-Light.ttf ()\n// - \n// - Content-TypeTTFcmap\n\n/**\n *  Unicode cmap\n * @param {ArrayBuffer} arrayBuffer - \n * @returns {boolean} -  cmap\n */\nfunction hasUnicodeCmap(arrayBuffer) {\n  try {\n    const dataView = new DataView(arrayBuffer);\n    \n    // TTF \n    const version = dataView.getUint32(0, false);\n    // 0x00010000  'true'  'typ1'  'OTTO'\n    if (version !== 0x00010000 && version !== 0x74727565) {\n      console.warn('[PDF] TTF');\n    }\n    \n    // :  'cmap' \n    const buffer = new Uint8Array(arrayBuffer);\n    const cmapSignature = [0x63, 0x6d, 0x61, 0x70]; // 'cmap'\n    \n    for (let i = 0; i < Math.min(buffer.length - 4, 1000); i++) {\n      if (buffer[i] === cmapSignature[0] &&\n          buffer[i+1] === cmapSignature[1] &&\n          buffer[i+2] === cmapSignature[2] &&\n          buffer[i+3] === cmapSignature[3]) {\n        console.log('[PDF]  cmap ');\n        return true;\n      }\n    }\n    \n    console.warn('[PDF]  cmap ');\n    return false;\n  } catch (error) {\n    console.error('[PDF] cmap :', error);\n    return false;\n  }\n}\n\n/**\n * PDF\n * @param {jsPDF} pdf - jsPDF\n * @param {string} fontPath -  (public)\n * @param {string} fontName - \n * @param {string} fontStyle -  (normal, bold, light )\n * @returns {Promise<boolean>} - \n */\nasync function loadFontFromProject(pdf, fontPath, fontName = 'CustomFont', fontStyle = 'normal') {\n  try {\n    console.log(`[PDF] : ${fontPath}`);\n\n    // \n    const { arrayBuffer, base64 } = await loadFontData(fontPath);\n\n    //  cmap \n    if (!FontCache.has(fontPath)) {\n      const hasCmap = hasUnicodeCmap(arrayBuffer);\n      if (!hasCmap) {\n        console.warn(`[PDF] :  Unicode cmap `);\n      }\n    }\n\n    // jsPDF\n    const fileName = fontPath.split('/').pop();\n\n    try {\n      pdf.addFileToVFS(fileName, base64);\n      pdf.addFont(fileName, fontName, fontStyle);\n      console.log(`[PDF]  : ${fontName}-${fontStyle}`);\n      return true;\n    } catch (addFontError) {\n      console.error(`[PDF] addFont :`, addFontError.message);\n      console.error(`[PDF]  jsPDF`);\n      return false;\n    }\n  } catch (error) {\n    console.error('[PDF] :', error);\n    return false;\n  }\n}\n\n/**\n * PDF\n *  RegularLightBold \n *\n * @param {jsPDF} pdf - jsPDF\n * @returns {Promise<{success: boolean, fontName: string, availableWeights: string[]}>} - \n */\nexport async function addChineseFontSupport(pdf) {\n  console.log('[PDF]  ARUDJingxihei ...');\n\n  //  - \n  const fontConfigs = [\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Regular.ttf',\n      name: 'ARUDJingxihei',\n      style: 'normal',\n      weight: 400,\n      description: 'Regular ()'\n    },\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Bold.ttf',\n      name: 'ARUDJingxihei',\n      style: 'bold',\n      weight: 700,\n      description: 'Bold ()'\n    },\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Light.ttf',\n      name: 'ARUDJingxihei',\n      style: 'light',\n      weight: 300,\n      description: 'Light ()'\n    },\n  ];\n\n  let loadedCount = 0;\n  let fontName = 'helvetica';\n  const availableWeights = [];\n\n  for (const config of fontConfigs) {\n    try {\n      const success = await loadFontFromProject(\n        pdf,\n        config.path,\n        config.name,\n        config.style  // \n      );\n      if (success) {\n        loadedCount++;\n        fontName = config.name;\n        availableWeights.push(config.style);\n        console.log(`[PDF]  : ${config.name}-${config.style} (${config.description})`);\n      }\n    } catch (error) {\n      console.warn(`[PDF]  : ${config.path} - ${error.message}`);\n    }\n  }\n\n  if (loadedCount === 0) {\n    console.warn('[PDF]   ARUDJingxihei ');\n    console.warn('[PDF]  helvetica  ()');\n    pdf.setFont('helvetica');\n    return { success: false, fontName: 'helvetica', availableWeights: [] };\n  }\n\n  console.log(`[PDF]   ${loadedCount} : ${availableWeights.join(', ')}`);\n\n  //  normal\n  try {\n    pdf.setFont(fontName, 'normal');\n  } catch (error) {\n    console.warn('[PDF]  ');\n    pdf.setFont(fontName, availableWeights[0] || 'normal');\n  }\n\n  return { success: true, fontName, availableWeights };\n}\n\n// ====================  ====================\n\n/**\n * \n */\nconst FontLoadingState = {\n  isLoading: false,\n  isLoaded: false,\n  error: null\n};\n\n/**\n * \n * { [fontPath]: { arrayBuffer, base64, timestamp } }\n */\nconst FontCache = new Map();\n\n/**\n * \n * @param {string} fontPath - \n * @returns {Promise<{arrayBuffer: ArrayBuffer, base64: string}>} - \n */\nasync function loadFontData(fontPath) {\n  // 1. \n  if (FontCache.has(fontPath)) {\n    const cached = FontCache.get(fontPath);\n    console.log(`[PDF]  : ${fontPath}`);\n    return { arrayBuffer: cached.arrayBuffer, base64: cached.base64 };\n  }\n\n  // 2.  IndexedDB \n  try {\n    const dbCache = await loadFromIndexedDB(fontPath);\n    if (dbCache) {\n      console.log(`[PDF]   IndexedDB : ${fontPath}`);\n      // \n      FontCache.set(fontPath, {\n        arrayBuffer: dbCache.arrayBuffer,\n        base64: dbCache.base64,\n        timestamp: Date.now()\n      });\n      return dbCache;\n    }\n  } catch (error) {\n    console.warn(`[PDF] IndexedDB : ${error.message}`);\n  }\n\n  // 3. \n  console.log(`[PDF] : ${fontPath}`);\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 10000); // 10\n\n  try {\n    //  cacheBuster\n    const response = await fetch(fontPath, {\n      signal: controller.signal,\n      cache: 'force-cache', // \n    });\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const contentType = response.headers.get('content-type');\n    if (contentType && contentType.includes('text/html')) {\n      throw new Error('HTML');\n    }\n\n    const arrayBuffer = await response.arrayBuffer();\n    const fileSizeMB = (arrayBuffer.byteLength / 1024 / 1024).toFixed(2);\n    console.log(`[PDF] : ${fileSizeMB} MB`);\n\n    // TTF\n    const dataView = new DataView(arrayBuffer);\n    const magic = dataView.getUint32(0, false);\n    if (magic !== 0x00010000 && magic !== 0x74727565) {\n      throw new Error(`TTF: 0x${magic.toString(16)}`);\n    }\n\n    // \n    if (arrayBuffer.byteLength < 500 * 1024) {\n      throw new Error(` (${fileSizeMB} MB)`);\n    }\n\n    //  base64\n    const bytes = new Uint8Array(arrayBuffer);\n    let binary = '';\n    const chunkSize = 8192;\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      const chunk = bytes.subarray(i, Math.min(i + chunkSize, bytes.length));\n      binary += String.fromCharCode.apply(null, chunk);\n    }\n    const base64 = btoa(binary);\n\n    const fontData = { arrayBuffer, base64 };\n\n    // 4. \n    FontCache.set(fontPath, {\n      arrayBuffer,\n      base64,\n      timestamp: Date.now()\n    });\n\n    // 5.  IndexedDB\n    saveToIndexedDB(fontPath, fontData).catch(err => {\n      console.warn(`[PDF] IndexedDB : ${err.message}`);\n    });\n\n    return fontData;\n  } catch (fetchError) {\n    clearTimeout(timeoutId);\n    if (fetchError.name === 'AbortError') {\n      throw new Error('');\n    }\n    throw fetchError;\n  }\n}\n\n/**\n *  IndexedDB \n * @param {string} fontPath - \n * @returns {Promise<{arrayBuffer: ArrayBuffer, base64: string} | null>}\n */\nasync function loadFromIndexedDB(fontPath) {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open('LyraFontCache', 1);\n\n    request.onerror = () => reject(request.error);\n\n    request.onupgradeneeded = (event) => {\n      const db = event.target.result;\n      if (!db.objectStoreNames.contains('fonts')) {\n        db.createObjectStore('fonts', { keyPath: 'path' });\n      }\n    };\n\n    request.onsuccess = () => {\n      const db = request.result;\n      try {\n        const transaction = db.transaction(['fonts'], 'readonly');\n        const store = transaction.objectStore('fonts');\n        const getRequest = store.get(fontPath);\n\n        getRequest.onsuccess = () => {\n          const data = getRequest.result;\n          if (data && data.arrayBuffer && data.base64) {\n            resolve({ arrayBuffer: data.arrayBuffer, base64: data.base64 });\n          } else {\n            resolve(null);\n          }\n        };\n\n        getRequest.onerror = () => resolve(null);\n      } catch (error) {\n        resolve(null);\n      } finally {\n        db.close();\n      }\n    };\n  });\n}\n\n/**\n *  IndexedDB\n * @param {string} fontPath - \n * @param {{arrayBuffer: ArrayBuffer, base64: string}} fontData - \n * @returns {Promise<void>}\n */\nasync function saveToIndexedDB(fontPath, fontData) {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open('LyraFontCache', 1);\n\n    request.onerror = () => reject(request.error);\n\n    request.onupgradeneeded = (event) => {\n      const db = event.target.result;\n      if (!db.objectStoreNames.contains('fonts')) {\n        db.createObjectStore('fonts', { keyPath: 'path' });\n      }\n    };\n\n    request.onsuccess = () => {\n      const db = request.result;\n      try {\n        const transaction = db.transaction(['fonts'], 'readwrite');\n        const store = transaction.objectStore('fonts');\n\n        store.put({\n          path: fontPath,\n          arrayBuffer: fontData.arrayBuffer,\n          base64: fontData.base64,\n          timestamp: Date.now()\n        });\n\n        transaction.oncomplete = () => {\n          console.log(`[PDF]   IndexedDB: ${fontPath}`);\n          resolve();\n        };\n\n        transaction.onerror = () => reject(transaction.error);\n      } catch (error) {\n        reject(error);\n      } finally {\n        db.close();\n      }\n    };\n  });\n}\n\n/**\n *  IndexedDB \n * @param {string[]} fontPaths - \n * @returns {Promise<boolean>} - \n */\nasync function checkCacheExists(fontPaths) {\n  try {\n    const checkPromises = fontPaths.map(async (path) => {\n      const cached = await loadFromIndexedDB(path);\n      return cached !== null;\n    });\n\n    const results = await Promise.all(checkPromises);\n    return results.every(r => r); //  true\n  } catch (error) {\n    console.warn('[PDF] :', error.message);\n    return false;\n  }\n}\n\n/**\n *  + IndexedDB\n * @param {boolean} silent -  isLoading \n * @returns {Promise<boolean>} - \n */\nexport async function preloadFont(silent = false) {\n  if (FontLoadingState.isLoading || FontLoadingState.isLoaded) {\n    return FontLoadingState.isLoaded;\n  }\n\n  const fontPaths = [\n    '/lyra-exporter/fonts/ARUDJingxihei-Regular.ttf',\n    '/lyra-exporter/fonts/ARUDJingxihei-Bold.ttf',\n    '/lyra-exporter/fonts/ARUDJingxihei-Light.ttf'\n  ];\n\n  // \n  const cacheExists = await checkCacheExists(fontPaths);\n\n  if (cacheExists) {\n    console.log('[PDF]  ...');\n    // \n    try {\n      const loadPromises = fontPaths.map(path => loadFontData(path));\n      await Promise.all(loadPromises);\n      FontLoadingState.isLoaded = true;\n      console.log('[PDF]  ');\n      return true;\n    } catch (error) {\n      console.warn('[PDF] :', error.message);\n      // \n    }\n  }\n\n  // \n  if (!silent) {\n    FontLoadingState.isLoading = true;\n  }\n  FontLoadingState.error = null;\n\n  try {\n    console.log('[PDF] ...');\n\n    const loadPromises = fontPaths.map(async (path) => {\n      try {\n        await loadFontData(path);\n        return true;\n      } catch (error) {\n        console.warn(`[PDF] : ${path}`, error.message);\n        return false;\n      }\n    });\n\n    const results = await Promise.all(loadPromises);\n    const successCount = results.filter(r => r).length;\n    FontLoadingState.isLoaded = successCount > 0;\n    FontLoadingState.isLoading = false;\n\n    console.log(`[PDF]  ${successCount}/${fontPaths.length} `);\n\n    return FontLoadingState.isLoaded;\n  } catch (error) {\n    console.error('[PDF] :', error);\n    FontLoadingState.error = error.message;\n    FontLoadingState.isLoading = false;\n    FontLoadingState.isLoaded = false;\n    return false;\n  }\n}\n\n/**\n * \n * @returns {object} - \n */\nexport function getFontStatus() {\n  return {\n    isLoading: FontLoadingState.isLoading,\n    isLoaded: FontLoadingState.isLoaded,\n    error: FontLoadingState.error\n  };\n}\n","// utils/export/pdfTextHelpers.js\n// PDF - \n\n/**\n * \n * @param {string} text - \n * @returns {string} - \n */\nexport function cleanText(text) {\n  if (!text || typeof text !== 'string') {\n    return '';\n  }\n\n  try {\n    // 1. Unicode NFC \n    let cleaned = text.normalize('NFC');\n\n    // 2. \n    cleaned = cleaned.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F]/g, '');\n\n    // 3. Latinligatures\n    const ligatureMap = {\n      '\\uFB00': 'ff',    // \n      '\\uFB01': 'fi',    // \n      '\\uFB02': 'fl',    // \n      '\\uFB03': 'ffi',   // \n      '\\uFB04': 'ffl',   // \n      '\\uFB05': 'st',    // \n      '\\uFB06': 'st',    // \n      '\\u00C6': 'AE',    // \n      '\\u00E6': 'ae',    // \n      '\\u0152': 'OE',    // \n      '\\u0153': 'oe',    // \n      '\\u00DF': 'ss',    // \n      '\\u1E9E': 'SS',    // \n    };\n\n    // \n    for (const [ligature, replacement] of Object.entries(ligatureMap)) {\n      cleaned = cleaned.replace(new RegExp(ligature, 'g'), replacement);\n    }\n\n    // 4. UnicodejsPDF\n    // \n    cleaned = cleaned.replace(/[\\u200B-\\u200F\\u2060\\uFEFF]/g, '');\n\n    // 6. \n    // ASCII\n    const quoteMap = {\n      // \n      '\\u201C': '\"',  // \" () -> \"\n      '\\u201D': '\"',  // \" () -> \"\n      '\\u2018': \"'\",  // ' () -> '\n      '\\u2019': \"'\",  // ' () -> '\n      '\\u2033': '\"',  //  () -> \"\n      '\\u2032': \"'\",  //  () -> '\n\n      // \n      '\\u2014': '--', //  (em dash) -> --\n      '\\u2013': '-',  //  (en dash) -> -\n      '\\u2026': '...', //  () -> ...\n      '\\u2022': '',  //  () -> \n      '\\u00B7': '',  //  ()\n\n      // \n      '\\u2217': '*',  //  () -> *\n      '\\u2731': '*',  //  () -> *\n      '\\u2732': '*',  //  () -> *\n      '\\u2605': '*',  //  () -> *\n      '\\u2606': '*',  //  () -> *\n\n      // \n      '\\u2795': '+',  //  () -> +\n      '\\uFF0B': '+',  //  () -> +\n    };\n\n    // \n    for (const [from, to] of Object.entries(quoteMap)) {\n      cleaned = cleaned.replace(new RegExp(from, 'g'), to);\n    }\n\n    // 7. \n    // \n    cleaned = cleaned.replace(/[\\uFF10-\\uFF19]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF21-\\uFF3A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF41-\\uFF5A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n\n    // \n    cleaned = cleaned.replace(/\\u3000/g, ' ');\n\n    return cleaned;\n  } catch (error) {\n    console.error('[PDF] :', error);\n    // \n    return text.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\n  }\n}\n\n/**\n * LaTeX\n */\nexport function parseTextWithCodeBlocksAndLatex(text) {\n  const parts = [];\n  const elements = [];\n\n  // \n  const codeBlockRegex = /```([^\\n]*?)\\s*\\n([\\s\\S]*?)```/g;\n  let match;\n  let lastIndex = 0;\n\n  while ((match = codeBlockRegex.exec(text)) !== null) {\n    const language = (match[1] || '').trim().toLowerCase(); // \n    const content = match[2];\n\n    // LaTeX\n    if (language === 'latex' || language === 'math') {\n      console.log('[] LaTeX:', language);\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'latex-display',\n        content: content.trim()\n      });\n    } else {\n      // \n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'code',\n        language: language,\n        content: content\n      });\n    }\n  }\n\n  // LaTeX display math ($$...$$)\n  const latexDisplayRegex = /\\$\\$\\n?([\\s\\S]*?)\\n?\\$\\$/g;\n  while ((match = latexDisplayRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // LaTeX display math (\\[...\\])\n  const latexBracketRegex = /\\\\\\[([\\s\\S]*?)\\\\\\]/g;\n  while ((match = latexBracketRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // \n  elements.sort((a, b) => a.start - b.start);\n\n  // \n  const filteredElements = [];\n  elements.forEach(element => {\n    const overlaps = filteredElements.some(existing =>\n      (element.start >= existing.start && element.start < existing.end) ||\n      (element.end > existing.start && element.end <= existing.end) ||\n      (element.start <= existing.start && element.end >= existing.end)\n    );\n    if (!overlaps) {\n      filteredElements.push(element);\n    }\n  });\n\n  // parts\n  lastIndex = 0;\n  filteredElements.forEach(element => {\n    // \n    if (element.start > lastIndex) {\n      const plainText = text.substring(lastIndex, element.start);\n      if (plainText.trim()) {\n        parts.push({ type: 'text', content: plainText });\n      }\n    }\n\n    // \n    parts.push(element);\n    lastIndex = element.end;\n  });\n\n  // \n  if (lastIndex < text.length) {\n    const plainText = text.substring(lastIndex);\n    if (plainText.trim()) {\n      parts.push({ type: 'text', content: plainText });\n    }\n  }\n\n  // ,\n  if (parts.length === 0) {\n    parts.push({ type: 'text', content: text });\n  }\n\n  return parts;\n}\n\n/**\n * markdownLaTeX\n * \n *  **$...$** LaTeX\n */\nexport function parseInlineMarkdown(text) {\n  const segments = [];\n\n  // \n  // /\n  const patterns = [\n    { type: 'bold-italic', regex: /\\*\\*\\*(.+?)\\*\\*\\*/g, recursive: true },\n    { type: 'bold-italic', regex: /___(.+?)___/g, recursive: true },\n    { type: 'bold', regex: /\\*\\*(.+?)\\*\\*/g, recursive: true },\n    { type: 'bold', regex: /__(.+?)__/g, recursive: true },\n    { type: 'italic', regex: /\\*([^*]+?)\\*/g, recursive: true },\n    { type: 'italic', regex: /_([^_]+?)_/g, recursive: true },\n    { type: 'latex-inline', regex: /\\$([^\\$\\n]+?)\\$/g, recursive: false },\n    { type: 'latex-inline', regex: /\\\\\\(([^)]*?)\\\\\\)/g, recursive: false },\n    { type: 'code', regex: /`([^`]+)`/g, recursive: false },\n    { type: 'link', regex: /\\[([^\\]]+)\\]\\(([^)]+)\\)/g, recursive: false }\n  ];\n\n  // \n  const matches = [];\n  patterns.forEach(pattern => {\n    let match;\n    const regex = new RegExp(pattern.regex.source, 'g');\n    while ((match = regex.exec(text)) !== null) {\n      matches.push({\n        type: pattern.type,\n        start: match.index,\n        end: regex.lastIndex,\n        text: match[1],\n        url: match[2],\n        recursive: pattern.recursive\n      });\n    }\n  });\n\n  // \n  matches.sort((a, b) => a.start - b.start);\n\n  // \n  const filteredMatches = [];\n  matches.forEach(match => {\n    const overlaps = filteredMatches.some(existing =>\n      (match.start >= existing.start && match.start < existing.end) ||\n      (match.end > existing.start && match.end <= existing.end)\n    );\n    if (!overlaps) {\n      filteredMatches.push(match);\n    }\n  });\n\n  // segments\n  let lastEnd = 0;\n  filteredMatches.forEach(match => {\n    // \n    if (match.start > lastEnd) {\n      segments.push({\n        type: 'normal',\n        text: cleanText(text.substring(lastEnd, match.start))\n      });\n    }\n\n    // \n    if (match.recursive && match.type !== 'latex-inline') {\n      // /LaTeX\n      const innerSegments = parseInlineMarkdown(match.text);\n      segments.push({\n        type: match.type,\n        children: innerSegments\n      });\n    } else {\n      // LaTeX\n      segments.push({\n        type: match.type,\n        text: match.type === 'latex-inline' ? match.text : cleanText(match.text),\n        url: match.url\n      });\n    }\n\n    lastEnd = match.end;\n  });\n\n  // \n  if (lastEnd < text.length) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text.substring(lastEnd))\n    });\n  }\n\n  // \n  if (segments.length === 0) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text)\n    });\n  }\n\n  return segments;\n}\n\n/**\n * \n * @param {string[]} lines - \n * @returns {string[]} - \n */\nexport function applyCJKPunctuationRules(lines) {\n  if (!lines || lines.length <= 1) return lines;\n\n  // \n  const noLineStart = /^[\"',.;:!?)}\\]]/;\n  // \n  const noLineEnd = /[\"'(\\[{]$/;\n\n  const result = [];\n  let prevLine = lines[0];\n\n  for (let i = 1; i < lines.length; i++) {\n    const currentLine = lines[i];\n\n    // \n    if (noLineStart.test(currentLine)) {\n      // \n      const punct = currentLine[0];\n      prevLine = prevLine + punct;\n      lines[i] = currentLine.substring(1);\n      continue;\n    }\n\n    // \n    if (noLineEnd.test(prevLine)) {\n      // \n      const punct = prevLine[prevLine.length - 1];\n      prevLine = prevLine.substring(0, prevLine.length - 1);\n      lines[i] = punct + currentLine;\n    }\n\n    result.push(prevLine);\n    prevLine = lines[i];\n  }\n\n  result.push(prevLine);\n  return result;\n}\n\n/**\n * \n *  [{text: string, bold: boolean, heading: number}]\n */\nexport function parseCodeLineBold(line) {\n  const segments = [];\n\n  // ### \n  const headingMatch = line.match(/^(#{1,6})\\s+(.+)$/);\n  if (headingMatch) {\n    const level = headingMatch[1].length; // 1-6\n    const headingText = headingMatch[2];\n\n    // \n    const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n    let lastEnd = 0;\n    let match;\n\n    while ((match = boldRegex.exec(headingText)) !== null) {\n      if (match.index > lastEnd) {\n        segments.push({\n          text: headingText.substring(lastEnd, match.index),\n          bold: false,\n          heading: level\n        });\n      }\n      segments.push({\n        text: match[1],\n        bold: true,\n        heading: level\n      });\n      lastEnd = boldRegex.lastIndex;\n    }\n\n    if (lastEnd < headingText.length) {\n      segments.push({\n        text: headingText.substring(lastEnd),\n        bold: false,\n        heading: level\n      });\n    }\n\n    if (segments.length === 0) {\n      segments.push({\n        text: headingText,\n        bold: false,\n        heading: level\n      });\n    }\n\n    return segments;\n  }\n\n  // \n  const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n  let lastEnd = 0;\n  let match;\n\n  while ((match = boldRegex.exec(line)) !== null) {\n    // \n    if (match.index > lastEnd) {\n      segments.push({\n        text: line.substring(lastEnd, match.index),\n        bold: false\n      });\n    }\n\n    // \n    segments.push({\n      text: match[1],\n      bold: true\n    });\n\n    lastEnd = boldRegex.lastIndex;\n  }\n\n  // \n  if (lastEnd < line.length) {\n    segments.push({\n      text: line.substring(lastEnd),\n      bold: false\n    });\n  }\n\n  // \n  if (segments.length === 0) {\n    segments.push({\n      text: line,\n      bold: false\n    });\n  }\n\n  return segments;\n}\n\n/**\n * \n * @param {Object} pdf - jsPDF\n * @param {string} fontName - \n * @param {string} fontStyle - \n * @param {Array} availableFontWeights - \n * @returns {boolean} - \n */\nexport function safeSetFont(pdf, fontName, fontStyle = 'normal', availableFontWeights = []) {\n  try {\n    // \n    if (availableFontWeights.includes(fontStyle)) {\n      pdf.setFont(fontName, fontStyle);\n      return true;\n    }\n\n    // \n    console.warn(`[PDF]  ${fontStyle} ...`);\n\n    // \n    if (fontStyle === 'bold' || fontStyle === 'bolditalic') {\n      //  normal\n      if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF]   normal `);\n        return false; //  false \n      }\n    }\n\n    if (fontStyle === 'italic' || fontStyle === 'bolditalic') {\n      //  light  normal\n      if (availableFontWeights.includes('light')) {\n        pdf.setFont(fontName, 'light');\n        console.log(`[PDF]   light `);\n        return false;\n      } else if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF]   normal `);\n        return false;\n      }\n    }\n\n    // \n    if (availableFontWeights.length > 0) {\n      const fallbackStyle = availableFontWeights[0];\n      pdf.setFont(fontName, fallbackStyle);\n      console.log(`[PDF]   ${fallbackStyle} `);\n      return false;\n    }\n\n    //  normal\n    pdf.setFont(fontName, 'normal');\n    console.log(`[PDF]   normal `);\n    return false;\n  } catch (error) {\n    console.error(`[PDF] :`, error);\n    // \n    pdf.setFont(fontName || 'helvetica');\n    return false;\n  }\n}\n\n/**\n * \n * @param {Object} pdf - jsPDF\n * @param {string} text - \n * @param {string} chineseFontName - \n * @returns {number} - \n */\nexport function safeGetTextWidth(pdf, text, chineseFontName = 'helvetica') {\n  if (!text || typeof text !== 'string') {\n    return 0;\n  }\n\n  try {\n    //  Unicode \n    const font = pdf.getFont();\n    if (!font.metadata || !font.metadata.Unicode) {\n      const currentStyle = font.fontStyle || 'normal';\n      console.warn(`[PDF]  (${currentStyle})  Unicode `);\n\n      // normal\n      if (currentStyle !== 'normal') {\n        console.log('[PDF]  normal ');\n        safeSetFont(pdf, chineseFontName, 'normal');\n        // \n        return pdf.getTextWidth(text);\n      } else {\n        // normal\n        console.warn('[PDF] normal ');\n        const fontSize = pdf.getFontSize();\n        return text.length * fontSize * 0.5;\n      }\n    }\n\n    return pdf.getTextWidth(text);\n  } catch (error) {\n    console.error('[PDF] getTextWidth :', error);\n    //  *  * 0.5\n    const fontSize = pdf.getFontSize();\n    return text.length * fontSize * 0.5;\n  }\n}\n\n/**\n * \n * @param {Object} pdf - jsPDF\n * @param {string} text - \n * @param {number} x - X \n * @param {number} y - Y \n * @param {number} maxWidth - \n */\nexport function safeRenderText(pdf, text, x, y, maxWidth = null) {\n  if (!text || typeof text !== 'string') {\n    return;\n  }\n\n  const cleanedText = cleanText(text);\n  if (!cleanedText) {\n    return;\n  }\n\n  //  maxWidth\n  if (maxWidth) {\n    const textWidth = safeGetTextWidth(pdf, cleanedText);\n    if (textWidth > maxWidth) {\n      // \n      console.warn('[PDF] :', cleanedText.substring(0, 50));\n      //  splitTextToSize \n      try {\n        const lines = pdf.splitTextToSize(cleanedText, maxWidth);\n        if (lines.length > 0) {\n          pdf.text(lines[0], x, y);\n        }\n      } catch (error) {\n        // \n        let truncated = cleanedText;\n        while (safeGetTextWidth(pdf, truncated + '...') > maxWidth && truncated.length > 0) {\n          truncated = truncated.substring(0, truncated.length - 1);\n        }\n        pdf.text(truncated + '...', x, y);\n      }\n      return;\n    }\n  }\n\n  // \n  pdf.text(cleanedText, x, y);\n}","// utils/export/pdfLatexRenderer.js\n// LaTeX - UnicodeSVG\n// LaTeX\n\nimport { cleanText } from './pdfTextHelpers';\n\n/**\n * LaTeXUnicode\n */\nconst LATEX_UNICODE_MAP = {\n  // \n  'alpha': '', 'beta': '', 'gamma': '', 'delta': '',\n  'epsilon': '', 'varepsilon': '', 'zeta': '', 'eta': '',\n  'theta': '', 'vartheta': '', 'iota': '', 'kappa': '',\n  'lambda': '', 'mu': '', 'nu': '', 'xi': '',\n  'pi': '', 'varpi': '', 'rho': '', 'varrho': '',\n  'sigma': '', 'varsigma': '', 'tau': '', 'upsilon': '',\n  'phi': '', 'varphi': '', 'chi': '', 'psi': '', 'omega': '',\n  \n  // \n  'Alpha': '', 'Beta': '', 'Gamma': '', 'Delta': '',\n  'Epsilon': '', 'Zeta': '', 'Eta': '', 'Theta': '',\n  'Iota': '', 'Kappa': '', 'Lambda': '', 'Mu': '',\n  'Nu': '', 'Xi': '', 'Pi': '', 'Rho': '',\n  'Sigma': '', 'Tau': '', 'Upsilon': '', 'Phi': '',\n  'Chi': '', 'Psi': '', 'Omega': '',\n  \n  // \n  'pm': '', 'mp': '', 'times': '', 'div': '',\n  'cdot': '', 'ast': '', 'star': '', 'circ': '',\n  'bullet': '', 'oplus': '', 'ominus': '', 'otimes': '',\n  'oslash': '', 'odot': '', 'dagger': '', 'ddagger': '',\n  \n  // \n  'leq': '', 'le': '', 'geq': '', 'ge': '',\n  'neq': '', 'ne': '', 'approx': '', 'equiv': '',\n  'sim': '', 'simeq': '', 'propto': '', 'perp': '',\n  'parallel': '', 'subset': '', 'supset': '',\n  'subseteq': '', 'supseteq': '', 'in': '', 'notin': '',\n  \n  // \n  'leftarrow': '', 'rightarrow': '', 'uparrow': '', 'downarrow': '',\n  'leftrightarrow': '', 'updownarrow': '', 'Leftarrow': '', 'Rightarrow': '',\n  'Uparrow': '', 'Downarrow': '', 'Leftrightarrow': '', 'Updownarrow': '',\n  'mapsto': '', 'to': '', 'gets': '',\n  \n  // \n  'infty': '', 'partial': '', 'nabla': '', 'forall': '',\n  'exists': '', 'nexists': '', 'emptyset': '', 'varnothing': '',\n  'complement': '', 'neg': '', 'wedge': '', 'vee': '',\n  'cap': '', 'cup': '', 'int': '', 'iint': '', 'iiint': '',\n  'oint': '', 'sum': '', 'prod': '', 'coprod': '',\n  'bigcap': '', 'bigcup': '', 'bigvee': '', 'bigwedge': '',\n  'bigoplus': '', 'bigotimes': '', 'bigodot': '', 'biguplus': '',\n  \n  // \n  'langle': '', 'rangle': '', 'lfloor': '', 'rfloor': '',\n  'lceil': '', 'rceil': '', 'vert': '|', 'Vert': '',\n  \n  // \n  'dots': '', 'cdots': '', 'vdots': '', 'ddots': '',\n  'ldots': '', 'therefore': '', 'because': '',\n  'angle': '', 'measuredangle': '', 'sphericalangle': '',\n  \n  // \n  'prime': '', 'backprime': '', 'degree': '',\n\n  // \n  'sin': 'sin', 'cos': 'cos', 'tan': 'tan',\n  'cot': 'cot', 'sec': 'sec', 'csc': 'csc',\n  'arcsin': 'arcsin', 'arccos': 'arccos', 'arctan': 'arctan',\n  'sinh': 'sinh', 'cosh': 'cosh', 'tanh': 'tanh',\n  'log': 'log', 'ln': 'ln', 'exp': 'exp',\n  'lim': 'lim', 'max': 'max', 'min': 'min',\n  'sup': 'sup', 'inf': 'inf', 'det': 'det', 'dim': 'dim'\n};\n\n// \\mathcal{X}\nconst MATHCAL_MAP = {\n  'A': '', 'B': '', 'C': '', 'D': '', 'E': '', 'F': '',\n  'G': '', 'H': '', 'I': '', 'J': '', 'K': '', 'L': '',\n  'M': '', 'N': '', 'O': '', 'P': '', 'Q': '', 'R': '',\n  'S': '', 'T': '', 'U': '', 'V': '', 'W': '', 'X': '',\n  'Y': '', 'Z': ''\n};\n\n// \\mathbb{X}\nconst MATHBB_MAP = {\n  'A': '', 'B': '', 'C': '', 'D': '', 'E': '', 'F': '',\n  'G': '', 'H': '', 'I': '', 'J': '', 'K': '', 'L': '',\n  'M': '', 'N': '', 'O': '', 'P': '', 'Q': '', 'R': '',\n  'S': '', 'T': '', 'U': '', 'V': '', 'W': '', 'X': '',\n  'Y': '', 'Z': ''\n};\n\n// \n//  (U+00B9, U+00B2, U+00B3) \n// - (U+2070, U+2074-U+2079) \nconst SUPERSCRIPT_MAP = {\n  '0': '', '1': '', '2': '', '3': '', '4': '',\n  '5': '', '6': '', '7': '', '8': '', '9': '',\n  '+': '', '-': '', '=': '', '(': '', ')': '',\n  'n': '', 'i': ''\n};\n\n// ASCIIUnicode\nconst SUPERSCRIPT_SAFE = {\n  '0': '^0', '1': '', '2': '', '3': '', '4': '^4',\n  '5': '^5', '6': '^6', '7': '^7', '8': '^8', '9': '^9',\n  '+': '^+', '-': '^-', '=': '^=', '(': '^(', ')': '^)',\n  'n': '^n', 'i': '^i', 'T': '^T', 'H': '^H', '*': '^*'\n};\n\n// \nconst SUBSCRIPT_MAP = {\n  '0': '', '1': '', '2': '', '3': '', '4': '',\n  '5': '', '6': '', '7': '', '8': '', '9': '',\n  '+': '', '-': '', '=': '', '(': '', ')': '',\n  'a': '', 'e': '', 'h': '', 'i': '', 'j': '',\n  'k': '', 'l': '', 'm': '', 'n': '', 'o': '',\n  'p': '', 'r': '', 's': '', 't': '', 'u': '',\n  'v': '', 'x': ''\n};\n\n/**\n * \n * @param {string} str -  { \n * @returns {string|null} -  null\n */\nfunction extractBracedContent(str) {\n  if (!str || !str.startsWith('{')) return null;\n\n  let depth = 0;\n  let i = 0;\n\n  for (; i < str.length; i++) {\n    // \n    if (str[i] === '\\\\' && i + 1 < str.length) {\n      i++;\n      continue;\n    }\n    \n    if (str[i] === '{') {\n      depth++;\n    } else if (str[i] === '}') {\n      depth--;\n      if (depth === 0) {\n        return str.substring(1, i);\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * LaTeX\n */\nexport class LaTeXRenderer {\n  constructor(pdf, config = {}) {\n    this.pdf = pdf;\n    this.config = {\n      fontSize: config.fontSize || 10,\n      color: config.color || [0, 0, 0],\n      fontName: config.fontName || 'helvetica',\n      useUnicode: config.useUnicode !== false,\n      ...config\n    };\n\n    //  - \n    this.widthCache = new Map();\n  }\n\n  /**\n   * \n   */\n  setRenderFont(fontSize = null) {\n    if (this.config.fontName) {\n      try {\n        this.pdf.setFont(this.config.fontName, 'normal');\n      } catch (e) {\n        // \n      }\n    }\n    if (fontSize !== null) {\n      this.pdf.setFontSize(fontSize);\n    }\n  }\n\n  /**\n   * \n   */\n  getCachedTextWidth(text, fontSize) {\n    const cacheKey = `${text}|${fontSize}|${this.config.fontName}`;\n\n    if (this.widthCache.has(cacheKey)) {\n      return this.widthCache.get(cacheKey);\n    }\n\n    this.setRenderFont(fontSize);\n    const width = this.pdf.getTextWidth(text);\n    this.widthCache.set(cacheKey, width);\n\n    return width;\n  }\n\n  /**\n   * \n   */\n  clearWidthCache() {\n    this.widthCache.clear();\n  }\n\n  /**\n   * LaTeX\n   * @param {string} latex - LaTeX$\n   * @param {number} x - X\n   * @param {number} y - Y\n   * @param {number} maxWidth - \n   * @returns {number} - \n   */\n  renderInlineLaTeX(latex, x, y, maxWidth) {\n    // Unicode\n    const simplified = this.simplifyLaTeX(latex);\n    \n    // \n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, x, y, maxWidth, true);\n    }\n    \n    // Unicode\n    this.pdf.setFontSize(this.config.fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // \n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'italic');\n    } catch (e) {\n      // \n    }\n    \n    this.pdf.text(simplified, x, y);\n    const width = this.pdf.getTextWidth(simplified);\n    \n    // \n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'normal');\n    } catch (e) {\n      // \n    }\n    \n    return width;\n  }\n\n  /**\n   * LaTeX\n   * @param {string} latex - LaTeX\n   * @param {number} x - X\n   * @param {number} y - Y\n   * @param {number} maxWidth - \n   * @returns {Object} - {width, height} \n   */\n  renderDisplayLaTeX(latex, x, y, maxWidth) {\n    // \n    const centerX = x + maxWidth / 2;\n    \n    // \n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, centerX, y, maxWidth, false);\n    }\n    \n    // \n    const simplified = this.simplifyLaTeX(latex);\n    const fontSize = this.config.fontSize * 1.2; // \n    \n    this.pdf.setFontSize(fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // \n    const textWidth = this.pdf.getTextWidth(simplified);\n    const startX = centerX - textWidth / 2;\n    \n    // \n    const padding = 5;\n    this.pdf.setFillColor(250, 250, 250);\n    this.pdf.rect(startX - padding, y - fontSize * 0.8, textWidth + padding * 2, fontSize * 1.5, 'F');\n    \n    // \n    this.pdf.text(simplified, startX, y);\n    \n    return {\n      width: textWidth + padding * 2,\n      height: fontSize * 1.5\n    };\n  }\n\n  /**\n   * LaTeXUnicode\n   * @param {string} latex - LaTeX\n   * @returns {string} - Unicode\n   */\n  simplifyLaTeX(latex) {\n    if (!latex) return '';\n    \n    let result = latex;\n\n    // \n    result = result.replace(/\\s+/g, ' ').trim();\n    \n    //  \\left  \\right \n    result = result.replace(/\\\\left\\(/g, '(');\n    result = result.replace(/\\\\right\\)/g, ')');\n    result = result.replace(/\\\\left\\[/g, '[');\n    result = result.replace(/\\\\right\\]/g, ']');\n    result = result.replace(/\\\\left\\\\\\{/g, '{');\n    result = result.replace(/\\\\right\\\\\\}/g, '}');\n    result = result.replace(/\\\\left\\{/g, '{');\n    result = result.replace(/\\\\right\\}/g, '}');\n    result = result.replace(/\\\\left\\|/g, '|');\n    result = result.replace(/\\\\right\\|/g, '|');\n    result = result.replace(/\\\\left\\./g, '');\n    result = result.replace(/\\\\right\\./g, '');\n\n    //  \\mathbb{X}  - \n    result = result.replace(/\\\\mathbb\\{([A-Z])\\}/g, (_, letter) => {\n      return MATHBB_MAP[letter] || letter;\n    });\n\n    //  \\mathcal{X}  - \n    result = result.replace(/\\\\mathcal\\{([A-Z])\\}/g, (_, letter) => {\n      return MATHCAL_MAP[letter] || letter;\n    });\n\n    //  \\text{}  - \n    result = result.replace(/\\\\text\\{([^}]*)\\}/g, '$1');\n\n    //  \\xleftrightarrow{}, \\xrightarrow{}, \\xleftarrow{}\n    // \n    result = result.replace(/\\\\xleftrightarrow\\{([^}]*)\\}/g, (match, inner) => {\n      const simplifiedInner = inner ? this.simplifyLaTeX(inner) : '';\n      return `[${simplifiedInner}]`;\n    });\n    result = result.replace(/\\\\xrightarrow\\{([^}]*)\\}/g, (match, inner) => {\n      const simplifiedInner = inner ? this.simplifyLaTeX(inner) : '';\n      return `[${simplifiedInner}]`;\n    });\n    result = result.replace(/\\\\xleftarrow\\{([^}]*)\\}/g, (match, inner) => {\n      const simplifiedInner = inner ? this.simplifyLaTeX(inner) : '';\n      return `[${simplifiedInner}]`;\n    });\n\n    //  \\frac{a}{b} -  a/b \n    result = this.simplifyFractions(result);\n\n    //  \\sqrt{x}  \\sqrt[n]{x}\n    result = result.replace(/\\\\sqrt\\[([^\\]]+)\\]\\{([^}]+)\\}/g, '($2)^(1/$1)');\n    result = result.replace(/\\\\sqrt\\{([^}]+)\\}/g, '($1)');\n\n    // \n    result = this.processSupSubScripts(result);\n    \n    // LaTeXUnicode\n    const sortedCommands = Object.keys(LATEX_UNICODE_MAP).sort((a, b) => b.length - a.length);\n    sortedCommands.forEach(command => {\n      const pattern = new RegExp(`\\\\\\\\${command}(?![a-zA-Z])`, 'g');\n      result = result.replace(pattern, LATEX_UNICODE_MAP[command]);\n    });\n    \n    // \n    result = result.replace(/\\\\([a-zA-Z]+)/g, '$1');\n    result = result.replace(/\\\\(.)/g, '$1');\n    \n    // \n    result = result.replace(/[{}]/g, '');\n    \n    return result;\n  }\n\n  /**\n   * \n   */\n  simplifyFractions(text) {\n    let result = text;\n    let lastResult = '';\n    \n    // \n    while (result !== lastResult) {\n      lastResult = result;\n      \n      const fracMatch = result.match(/\\\\frac/);\n      if (!fracMatch) break;\n      \n      const startIdx = fracMatch.index;\n      const afterFrac = result.substring(startIdx + 5); //  \\frac\n      \n      // \n      const numerator = extractBracedContent(afterFrac);\n      if (numerator === null) break;\n      \n      // \n      const afterNum = afterFrac.substring(numerator.length + 2);\n      const denominator = extractBracedContent(afterNum);\n      if (denominator === null) break;\n      \n      // \n      const fullMatch = result.substring(startIdx, startIdx + 5 + numerator.length + 2 + denominator.length + 2);\n      const simplified = `(${numerator})/(${denominator})`;\n      \n      result = result.replace(fullMatch, simplified);\n    }\n    \n    return result;\n  }\n\n  /**\n   * \n   */\n  processSupSubScripts(text) {\n    let result = text;\n    \n    //  ^{...}\n    let lastResult = '';\n    while (result !== lastResult) {\n      lastResult = result;\n      const supMatch = result.match(/\\^(\\{[^{}]*(?:\\{[^{}]*\\}[^{}]*)*\\}|\\w)/);\n      if (supMatch) {\n        let content = supMatch[1];\n        if (content.startsWith('{') && content.endsWith('}')) {\n          content = content.slice(1, -1);\n        }\n        const converted = this.convertToSuperscript(content);\n        result = result.replace(supMatch[0], converted);\n      }\n    }\n    \n    //  _{...}\n    lastResult = '';\n    while (result !== lastResult) {\n      lastResult = result;\n      const subMatch = result.match(/_(\\{[^{}]*(?:\\{[^{}]*\\}[^{}]*)*\\}|\\w)/);\n      if (subMatch) {\n        let content = subMatch[1];\n        if (content.startsWith('{') && content.endsWith('}')) {\n          content = content.slice(1, -1);\n        }\n        const converted = this.convertToSubscript(content);\n        result = result.replace(subMatch[0], converted);\n      }\n    }\n    \n    return result;\n  }\n\n  /**\n   * Unicode\n   */\n  convertToSuperscript(text) {\n    // LaTeX\n    const simplified = this.simplifyLaTeX(text);\n    // ^x\n    return simplified.split('').map(char => {\n      if (SUPERSCRIPT_SAFE[char]) return SUPERSCRIPT_SAFE[char];\n      if (SUPERSCRIPT_MAP[char]) return SUPERSCRIPT_MAP[char];\n      return '^' + char;  // ^x\n    }).join('');\n  }\n\n  /**\n   * Unicode\n   */\n  convertToSubscript(text) {\n    // LaTeX\n    const simplified = this.simplifyLaTeX(text);\n    // \n    return simplified.split('').map(char => {\n      if (SUBSCRIPT_MAP[char]) return SUBSCRIPT_MAP[char];\n      return '_' + char;  // _x\n    }).join('');\n  }\n\n  /**\n   * LaTeX\n   */\n  hasComplexStructure(latex) {\n    const complexPatterns = [\n      /\\\\frac\\{/,           // \n      /\\\\sqrt[\\[\\{]/,       // \n      /\\\\begin\\{/,          // cases\n      /\\\\xleftrightarrow/,  // \n      /\\\\xrightarrow/,      // \n      /\\\\xleftarrow/,       // \n      /\\\\boxed\\{/,          // \n      /\\\\underbrace\\{/,     // \n      /\\\\overbrace\\{/       // \n    ];\n\n    return complexPatterns.some(pattern => pattern.test(latex));\n  }\n\n  /**\n   * LaTeX\n   */\n  renderComplexLaTeX(latex, x, y, maxWidth, isInline) {\n    const fontSize = isInline ? this.config.fontSize : this.config.fontSize * 1.2;\n    const elements = this.parseComplexLaTeX(latex);\n\n    // \n    let totalWidth = 0;\n    this.pdf.setFontSize(fontSize);\n\n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          totalWidth += this.pdf.getTextWidth(element.content);\n          break;\n\n        case 'fraction':\n          // \n          const fracFontSize = fontSize * 0.75;\n          this.pdf.setFontSize(fracFontSize);\n          const numWidth = this.pdf.getTextWidth(element.numerator);\n          const denWidth = this.pdf.getTextWidth(element.denominator);\n          totalWidth += Math.max(numWidth, denWidth) + 4;\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        case 'sqrt':\n          totalWidth += this.pdf.getTextWidth(element.content) + 8;\n          break;\n\n        case 'superscript':\n        case 'subscript':\n          totalWidth += this.pdf.getTextWidth(element.base || '');\n          const subSupFontSize = fontSize * 0.7;\n          this.pdf.setFontSize(subSupFontSize);\n          totalWidth += this.pdf.getTextWidth(element.exponent || element.subscript || '');\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        default:\n          totalWidth += this.pdf.getTextWidth(element.raw || '');\n      }\n    });\n\n    // display math\n    let currentX = isInline ? x : (x - totalWidth / 2);\n    let maxHeight = fontSize;\n    let hasFraction = false;  // \n\n    // \n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(element.content, currentX, y);\n          const textWidth = this.pdf.getTextWidth(element.content);\n          currentX += textWidth;\n          break;\n\n        case 'fraction':\n          const fracWidth = this.renderFraction(\n            element.numerator,\n            element.denominator,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += fracWidth;\n          hasFraction = true;\n          break;\n\n        case 'sqrt':\n          const sqrtWidth = this.renderSquareRoot(\n            element.content,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += sqrtWidth;\n          break;\n\n        case 'superscript':\n          const supWidth = this.renderSuperscript(\n            element.base,\n            element.exponent,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += supWidth;\n          break;\n\n        case 'subscript':\n          const subWidth = this.renderSubscript(\n            element.base,\n            element.subscript,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += subWidth;\n          break;\n\n        default:\n          // \n          const fallbackText = element.raw || '';\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(fallbackText, currentX, y);\n          const fallbackWidth = this.pdf.getTextWidth(fallbackText);\n          currentX += fallbackWidth;\n      }\n    });\n\n    // \n    if (hasFraction) {\n      maxHeight = fontSize * 1.2;  // \n    } else {\n      maxHeight = fontSize;  // \n    }\n\n    return isInline ? totalWidth : { width: totalWidth, height: maxHeight };\n  }\n\n  /**\n   * LaTeX\n   */\n  parseComplexLaTeX(latex) {\n    const elements = [];\n    let remaining = latex;\n    \n    // \n    const fracRegex = /\\\\frac\\{([^}]*)\\}\\{([^}]*)\\}/;\n    \n    while (remaining.length > 0) {\n      const fracMatch = remaining.match(fracRegex);\n      \n      if (fracMatch) {\n        // \n        if (fracMatch.index > 0) {\n          const beforeText = remaining.substring(0, fracMatch.index);\n          const simplified = this.simplifyLaTeX(beforeText);\n          if (simplified) {\n            elements.push({ type: 'text', content: simplified });\n          }\n        }\n        \n        // \n        elements.push({\n          type: 'fraction',\n          numerator: this.simplifyLaTeX(fracMatch[1]),\n          denominator: this.simplifyLaTeX(fracMatch[2]),\n          raw: fracMatch[0]\n        });\n        \n        remaining = remaining.substring(fracMatch.index + fracMatch[0].length);\n      } else {\n        // \n        const simplified = this.simplifyLaTeX(remaining);\n        if (simplified) {\n          elements.push({ type: 'text', content: simplified });\n        }\n        break;\n      }\n    }\n    \n    return elements;\n  }\n\n  /**\n   * \n   */\n  renderFraction(numerator, denominator, x, y, fontSize) {\n    // \n    const fracFontSize = fontSize * 0.75;\n    this.pdf.setFontSize(fracFontSize);\n\n    const numWidth = this.pdf.getTextWidth(numerator);\n    const denWidth = this.pdf.getTextWidth(denominator);\n    const fracWidth = Math.max(numWidth, denWidth) + 4;\n\n    // \n    const numOffset = fracFontSize * 0.17;  // \n    const denOffset = fracFontSize * 0.5;  // \n\n    // \n    const numX = x + (fracWidth - numWidth) / 2;\n    this.pdf.text(numerator, numX, y - numOffset);\n\n    // \n    this.pdf.setLineWidth(0.3);\n    this.pdf.setDrawColor(0, 0, 0);\n    this.pdf.line(x, y, x + fracWidth, y);\n\n    // \n    const denX = x + (fracWidth - denWidth) / 2;\n    this.pdf.text(denominator, denX, y + denOffset);\n\n    // \n    this.pdf.setFontSize(fontSize);\n\n    return fracWidth;\n  }\n\n  /**\n   * \n   */\n  renderSquareRoot(content, x, y, fontSize) {\n    const contentWidth = this.pdf.getTextWidth(content);\n    const sqrtWidth = contentWidth + 8;\n    const sqrtHeight = fontSize * 1.2;\n    \n    // \n    this.pdf.setLineWidth(0.3);\n    // \n    this.pdf.line(x, y - sqrtHeight / 3, x + 2, y);\n    // \n    this.pdf.line(x + 2, y, x + 4, y - sqrtHeight);\n    // \n    this.pdf.line(x + 4, y - sqrtHeight, x + sqrtWidth, y - sqrtHeight);\n    \n    // \n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(content, x + 6, y);\n    \n    return sqrtWidth;\n  }\n\n  /**\n   * \n   */\n  renderSuperscript(base, exponent, x, y, fontSize) {\n    // \n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // \n    const supFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(supFontSize);\n    const supText = this.simplifyLaTeX(exponent);\n    this.pdf.text(supText, x + baseWidth, y - fontSize * 0.3);\n    const supWidth = this.pdf.getTextWidth(supText);\n    \n    // \n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + supWidth;\n  }\n\n  /**\n   * \n   */\n  renderSubscript(base, subscript, x, y, fontSize) {\n    // \n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // \n    const subFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(subFontSize);\n    const subText = this.simplifyLaTeX(subscript);\n    this.pdf.text(subText, x + baseWidth, y + fontSize * 0.3);\n    const subWidth = this.pdf.getTextWidth(subText);\n    \n    // \n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + subWidth;\n  }\n}\n\n// \nexport function createLaTeXRenderer(pdf, config) {\n  return new LaTeXRenderer(pdf, config);\n}\n","// PDF - \n\nimport { cleanText, parseInlineMarkdown, parseCodeLineBold, applyCJKPunctuationRules } from './pdfTextHelpers'\nimport { LaTeXRenderer } from './pdfLatexRenderer'\n\n//  (: mm)\nexport const PAGE_FORMATS = {\n  a3: { width: 297, height: 420, name: 'A3' },\n  a4: { width: 210, height: 297, name: 'A4' },\n  letter: { width: 215.9, height: 279.4, name: 'Letter' },\n  supernote: { width: 163, height: 217, name: 'Supernote (10.7\")' }\n};\n\nexport const PDF_STYLES = {\n  // \n  FONT_SIZE_TITLE: 20,\n  FONT_SIZE_H1: 16,\n  FONT_SIZE_H2: 14,\n  FONT_SIZE_SENDER: 12,\n  FONT_SIZE_BODY: 10,\n  FONT_SIZE_CODE: 9,\n  FONT_SIZE_TIMESTAMP: 8,\n  FONT_SIZE_HEADER: 8,\n  FONT_SIZE_FOOTER: 8,\n\n  //  (RGB)\n  COLOR_SENDER_HUMAN: [0, 102, 204],      // \n  COLOR_SENDER_ASSISTANT: [102, 102, 102], // \n  COLOR_TIMESTAMP: [150, 150, 150],        // \n  COLOR_CODE_BG: [245, 245, 245],          // \n  COLOR_SECTION_BG: [250, 250, 250],       // \n  COLOR_TEXT: [0, 0, 0],                   // \n  COLOR_HEADER: [100, 100, 100],           // \n  COLOR_FOOTER: [150, 150, 150],           // \n  COLOR_BORDER: [200, 200, 200],           // \n\n  // \n  MARGIN_LEFT: 15,\n  MARGIN_RIGHT: 15,\n  MARGIN_TOP: 15,    // \n  MARGIN_BOTTOM: 25, // \n  LINE_HEIGHT: 5,\n  SECTION_SPACING: 8,\n  MESSAGE_SPACING: 10,\n  FOOTER_HEIGHT: 15, // \n\n  //  ( A4)\n  PAGE_WIDTH: 210,\n  PAGE_HEIGHT: 297,\n};\n\n/**\n *  PDF_STYLES \n * @param {string} format -  ('a3', 'a4', 'letter', 'supernote')\n */\nexport function updatePageFormat(format = 'a4') {\n  const pageFormat = PAGE_FORMATS[format] || PAGE_FORMATS.a4;\n  PDF_STYLES.PAGE_WIDTH = pageFormat.width;\n  PDF_STYLES.PAGE_HEIGHT = pageFormat.height;\n  return pageFormat;\n}\n\n/**\n * \n */\nexport class ContentRenderer {\n  constructor(manager) {\n    this.manager = manager;\n    this.latexRenderer = null; // \n  }\n\n  /**\n   * PDF\n   */\n  get pdf() {\n    return this.manager.pdf;\n  }\n\n  /**\n   * Y\n   */\n  get currentY() {\n    return this.manager.currentY;\n  }\n\n  set currentY(value) {\n    this.manager.currentY = value;\n  }\n\n  /**\n   * \n   */\n  get config() {\n    return this.manager.config;\n  }\n\n  /**\n   * \n   */\n  get chineseFontName() {\n    return this.manager.chineseFontName;\n  }\n\n  get availableFontWeights() {\n    return this.manager.availableFontWeights;\n  }\n\n  /**\n   * manager\n   */\n  safeSetFont(fontName, fontStyle) {\n    return this.manager.safeSetFont(fontName, fontStyle);\n  }\n\n  safeGetTextWidth(text) {\n    return this.manager.safeGetTextWidth(text);\n  }\n\n  safeRenderText(text, x, y, maxWidth) {\n    return this.manager.safeRenderText(text, x, y, maxWidth);\n  }\n\n  checkPageBreak(requiredSpace) {\n    return this.manager.checkPageBreak(requiredSpace);\n  }\n\n\n  /**\n   * \n   */\n  renderTitle(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TITLE);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const rawTitle = meta.name || 'Conversation';\n    const title = cleanText(rawTitle); // \n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // ,\n    let titleLines;\n    try {\n      titleLines = this.pdf.splitTextToSize(title, maxWidth);\n    } catch (error) {\n      console.error('[PDF] ,:', error);\n      titleLines = [title];\n    }\n    \n    titleLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TITLE);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * \n   */\n  renderMetadata(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n\n    const lines = [];\n\n    if (meta.platform) {\n      lines.push(`Platform: ${meta.platform}`);\n    }\n\n    if (meta.created_at) {\n      lines.push(`Created: ${meta.created_at}`);\n    }\n\n    if (meta.updated_at) {\n      lines.push(`Updated: ${meta.updated_at}`);\n    }\n\n    lines.push(`Exported: ${this.manager.exportDate}`);\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * LaTeX\n   */\n  renderMessage(message, index) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_SENDER + PDF_STYLES.MESSAGE_SPACING);\n\n    // \n    const currentPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    const currentY = this.currentY;\n    this.manager.messageAnchors.push({\n      index,\n      page: currentPage,\n      y: currentY,\n      sender: message.sender,\n      title: message.display_text ? message.display_text.substring(0, 50) : ''\n    });\n\n    // \n    this.renderSender(message, index);\n\n    // \n    if (this.config.includeTimestamps && message.timestamp) {\n      this.renderTimestamp(message.timestamp);\n    }\n\n    // thinking()\n    if (message.thinking && this.config.includeThinking && message.sender !== 'human') {\n      this.renderThinking(message.thinking);\n    }\n\n    // LaTeX\n    if (message.display_text) {\n      this.renderBody(message.display_text);\n    }\n\n    // \n    if (message.attachments?.length > 0 && message.sender === 'human') {\n      this.renderAttachments(message.attachments);\n    }\n\n    // Artifacts\n    if (message.artifacts?.length > 0 && this.config.includeArtifacts && message.sender !== 'human') {\n      message.artifacts.forEach(artifact => {\n        this.renderArtifact(artifact);\n      });\n    }\n\n    // \n    if (message.tools?.length > 0 && this.config.includeTools) {\n      message.tools.forEach(tool => {\n        this.renderTool(tool);\n      });\n    }\n\n    // \n    if (message.citations?.length > 0 && this.config.includeCitations) {\n      this.renderCitations(message.citations);\n    }\n\n    // \n    this.currentY += PDF_STYLES.MESSAGE_SPACING;\n  }\n\n  /**\n   * \n   */\n  renderSender(message, index) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_SENDER);\n\n    // \n    const color = message.sender === 'human'\n      ? PDF_STYLES.COLOR_SENDER_HUMAN\n      : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n\n    this.pdf.setTextColor(...color);\n\n    // \n    const senderLabel = message.sender === 'human' ? 'Human' : 'Assistant';\n    const label = `${index}. ${senderLabel}`;\n\n    // \n    let finalLabel = label;\n    if (message.branchInfo?.isBranchPoint) {\n      const branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      finalLabel = label + branchMarker;\n    }\n\n    // \n    const cleanLabel = cleanText(finalLabel);\n    if (cleanLabel && cleanLabel.trim().length > 0) {\n      this.pdf.text(cleanLabel, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    }\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n  }\n\n  /**\n   * \n   */\n  renderTimestamp(timestamp) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n    this.pdf.text(timestamp, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n  }\n\n  /**\n   * LaTeX\n   */\n  renderBody(text) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // LaTeX\n    const parts = this.manager.parseTextWithCodeBlocksAndLatex(text);\n\n    // \n    for (const part of parts) {\n      if (part.type === 'code') {\n        this.renderCodeBlock(part.content, part.language);\n      } else if (part.type === 'latex-display') {\n        this.renderLatexDisplay(part);\n      } else {\n        // markdowninline LaTeX\n        this.renderMarkdownText(part.content, maxWidth);\n      }\n    }\n\n    // \n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.3;\n  }\n\n\n  /**\n   * LaTeX\n   */\n  getLatexRenderer() {\n    if (!this.latexRenderer) {\n      this.latexRenderer = new LaTeXRenderer(this.pdf, {\n        fontSize: PDF_STYLES.FONT_SIZE_BODY,\n        color: PDF_STYLES.COLOR_TEXT,\n        fontName: this.chineseFontName  // Unicode\n      });\n    }\n    return this.latexRenderer;\n  }\n\n  /**\n   * LaTeX\n   */\n  containsLatex(text) {\n    const latexPatterns = [\n      /\\$[^$]+\\$/,           //  $...$\n      /\\\\\\([^)]+\\\\\\)/,       //  \\(...\\)\n      /\\\\\\[[^\\]]+\\\\\\]/,      //  \\[...\\]\n      /\\\\(mathcal|mathbb|frac|sqrt|sum|int|lim|alpha|beta|gamma|delta|theta|lambda|mu|omega)/  // LaTeX\n    ];\n    return latexPatterns.some(pattern => pattern.test(text));\n  }\n\n  /**\n   * LaTeX display math- \n   */\n  renderLatexDisplay(part) {\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY + 30);\n\n    try {\n      // LaTeX\n      const renderer = this.getLatexRenderer();\n      const result = renderer.renderDisplayLaTeX(\n        part.content,\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY + PDF_STYLES.FONT_SIZE_BODY,\n        maxWidth\n      );\n\n      // Y - \n      this.currentY += result.height + PDF_STYLES.LINE_HEIGHT * 0.05;  // \n    } catch (error) {\n      console.warn('[PDF] LaTeX:', error);\n\n      // LaTeX\n      this.renderLatexDisplayAsSource(part, maxWidth);\n    }\n  }\n\n  /**\n   * LaTeX display math\n   */\n  renderLatexDisplayAsSource(part, maxWidth) {\n    // LaTeX\n    this.pdf.setFillColor(240, 248, 255);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      'F'\n    );\n\n    // \n    this.pdf.setDrawColor(100, 150, 200);\n    this.pdf.setLineWidth(0.5);\n    this.pdf.roundedRect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      1.5,\n      1.5,\n      'S'\n    );\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(70, 130, 180);\n    this.pdf.text('[LaTeX]', PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // LaTeX\n    this.pdf.setFont('courier', 'normal');\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setTextColor(50, 50, 50);\n\n    const sourceLines = this.pdf.splitTextToSize(part.content, maxWidth - 4);\n    sourceLines.forEach(line => {\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // \n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * ()\n   */\n  renderPlainText(text, maxWidth) {\n    // \n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // \n    const cleanedText = cleanText(text);\n    \n    if (!cleanedText || cleanedText.trim().length === 0) {\n      console.warn('[PDF] ');\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    //  splitTextToSize ,Unicode\n    let lines;\n    try {\n      lines = this.pdf.splitTextToSize(cleanedText, maxWidth);\n    } catch (error) {\n      console.error('[PDF] splitTextToSize:', error);\n      // splitTextToSize,\n      lines = cleanedText.split('\\n');\n    }\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      \n      // splitTextToSize\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * - \n   */\n  renderCodeBlock(code, language = '') {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_CODE + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    const lineNumberWidth = 8;\n    const codeWidth = maxWidth - lineNumberWidth - 8;\n    const padding = 3;\n\n    const cleanCode = cleanText(code);\n    const cleanLanguage = cleanText(language);\n\n    // \n    if (cleanLanguage) {\n      this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.setTextColor(100, 100, 100);\n      const labelText = cleanLanguage.toUpperCase();\n      const labelWidth = this.safeGetTextWidth(labelText) + 4;\n      this.pdf.setFillColor(220, 220, 220);\n      this.pdf.roundedRect(\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY - 3,\n        labelWidth,\n        5,\n        1,\n        1,\n        'F'\n      );\n      this.pdf.text(labelText, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setFont(this.chineseFontName);\n    const codeLines = cleanCode.split('\\n');\n    const wrappedLines = [];\n\n    codeLines.forEach(line => {\n      if (!line) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n      const cleanLine = cleanText(line);\n      if (!cleanLine) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n\n      try {\n        const wrapped = this.pdf.splitTextToSize(cleanLine, codeWidth);\n        wrapped.forEach((wLine, idx) => {\n          wrappedLines.push({\n            text: wLine,\n            lineNumber: idx === 0 ? wrappedLines.length + 1 : null\n          });\n        });\n      } catch (error) {\n        wrappedLines.push({ text: cleanLine, lineNumber: wrappedLines.length + 1 });\n      }\n    });\n\n    // \n    const blockStartY = this.currentY;\n    const blockStartPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    // \n    const firstPageHeight = Math.min(\n      wrappedLines.length * PDF_STYLES.LINE_HEIGHT + padding * 2,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n    );\n    this.pdf.setFillColor(248, 248, 248);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      blockStartY - padding,\n      maxWidth,\n      firstPageHeight,\n      'F'\n    );\n\n    this.currentY = blockStartY;\n\n    wrappedLines.forEach(({ text, lineNumber }, index) => {\n      // \n      if (this.currentY + PDF_STYLES.FONT_SIZE_CODE > PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM) {\n        // \n        this.pdf.setDrawColor(200, 200, 200);\n        this.pdf.setLineWidth(0.3);\n        const currentPageBottom = this.currentY;\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT,\n          currentPageBottom\n        );\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          currentPageBottom\n        );\n\n        // \n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n        \n        // \n        const remainingLines = wrappedLines.length - index;\n        const newPageHeight = Math.min(\n          remainingLines * PDF_STYLES.LINE_HEIGHT + padding,\n          PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n        );\n        this.pdf.setFillColor(248, 248, 248);\n        this.pdf.rect(\n          PDF_STYLES.MARGIN_LEFT,\n          this.currentY - padding,\n          maxWidth,\n          newPageHeight,\n          'F'\n        );\n      }\n\n      // \n      if (lineNumber !== null) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE - 1);\n        this.pdf.setTextColor(150, 150, 150);\n        const lineNumStr = String(lineNumber).padStart(3, ' ');\n        this.pdf.text(lineNumStr, PDF_STYLES.MARGIN_LEFT + 1, this.currentY);\n      }\n\n      //  ****  ### \n      const safeLine = cleanText(text);\n      if (safeLine !== null && safeLine !== undefined) {\n        // \n        const segments = parseCodeLineBold(safeLine);\n        const isHeading = segments.some(s => s.heading);\n\n        // \n        if (isHeading) {\n          const level = segments[0].heading;\n          const headingSizes = [14, 13, 12, 11, 10, 10]; // H1-H6 \n          this.pdf.setFontSize(headingSizes[level - 1] || PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(20, 20, 20); // \n        } else {\n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(50, 50, 50);\n        }\n\n        let currentX = PDF_STYLES.MARGIN_LEFT + lineNumberWidth + 2;\n\n        segments.forEach(segment => {\n          // bold\n          if ((segment.heading || segment.bold) && this.availableFontWeights.includes('bold')) {\n            this.pdf.setFont(this.chineseFontName, 'bold');\n          } else {\n            // \n            this.pdf.setFont(this.chineseFontName, 'normal');\n          }\n\n          this.pdf.text(segment.text, currentX, this.currentY);\n          currentX += this.safeGetTextWidth(segment.text);\n        });\n\n        // \n        this.pdf.setFont(this.chineseFontName, 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(50, 50, 50);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // \n    const endPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    \n    // \n    for (let page = blockStartPage; page <= endPage; page++) {\n      this.pdf.setPage(page);\n      const isFirst = (page === blockStartPage);\n      const isLast = (page === endPage);\n      \n      let boxStartY, boxEndY;\n      if (isFirst && isLast) {\n        // \n        boxStartY = blockStartY - padding;\n        boxEndY = this.currentY + padding;\n      } else if (isFirst) {\n        // \n        boxStartY = blockStartY - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      } else if (isLast) {\n        // \n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = this.currentY + padding;\n      } else {\n        // \n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      }\n      \n      // \n      this.pdf.setDrawColor(200, 200, 200);\n      this.pdf.setLineWidth(0.3);\n      if (isFirst && isLast) {\n        this.pdf.roundedRect(PDF_STYLES.MARGIN_LEFT, boxStartY, maxWidth, boxEndY - boxStartY, 1.5, 1.5, 'S');\n      } else {\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT, boxEndY);\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        if (isFirst) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY);\n        }\n        if (isLast) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxEndY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        }\n      }\n      \n      // \n      this.pdf.setDrawColor(220, 220, 220);\n      this.pdf.setLineWidth(0.2);\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxStartY,\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxEndY\n      );\n    }\n\n    // \n    this.pdf.setPage(endPage);\n    \n    // \n    this.pdf.setFont(this.chineseFontName);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * markdownLaTeX\n   */\n  renderMarkdownText(text, maxWidth) {\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    const cleanedText = cleanText(text);\n    if (!cleanedText || cleanedText.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // \n    const lines = cleanedText.split('\\n');\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n      // \n      if (line.trim() === '') {\n        // \n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      } else if (line.match(/^#{1,6}\\s/)) {\n        // \n        this.renderMarkdownHeading(line, maxWidth);\n      } else if (line.match(/^(---|___|\\*\\*\\*)$/)) {\n        // ---, ___,  ***\n        this.renderHorizontalRule(maxWidth);\n      } else if (line.match(/^>\\s/)) {\n        // \n        this.renderMarkdownQuote(line, maxWidth);\n      } else if (line.match(/^\\|.*\\|/)) {\n        //  - \n        const tableLines = [line];\n        while (i + 1 < lines.length && lines[i + 1].match(/^\\|.*\\|/)) {\n          i++;\n          tableLines.push(lines[i]);\n        }\n        this.renderTable(tableLines);\n      } else if ((line.match(/^[-*+]\\s/) || line.match(/^\\d+\\.\\s/)) && this.containsLatex(line)) {\n        // LaTeX\n        this.renderLatexListItem(line, maxWidth);\n      } else if (line.match(/^[-*+]\\s/) || line.match(/^\\d+\\.\\s/)) {\n        // \n        this.renderMarkdownList(line, maxWidth);\n      } else {\n        // LaTeX\n        this.renderMarkdownInlineFormats(line, maxWidth);\n      }\n    }\n  }\n\n  /**\n   * LaTeX\n   */\n  renderLatexListItem(line, maxWidth) {\n    // \n    const cleanedLine = line.replace(/^[-*+]\\s+/, '').replace(/^\\d+\\.\\s+/, '');\n    const indentX = PDF_STYLES.MARGIN_LEFT + 8;\n\n    // margin\n    const tempMargin = PDF_STYLES.MARGIN_LEFT;\n    PDF_STYLES.MARGIN_LEFT = indentX;\n\n    // LaTeX\n    this.renderMarkdownInlineFormats(cleanedLine, maxWidth - 8);\n\n    // margin\n    PDF_STYLES.MARGIN_LEFT = tempMargin;\n  }\n\n  /**\n   * \n   */\n  renderHorizontalRule(maxWidth) {\n    // \n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.8;\n\n    const lineY = this.currentY;\n\n    //  - \n    this.pdf.setDrawColor(230, 230, 230);  // \n    this.pdf.setLineWidth(0.2);  // \n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      lineY,\n      PDF_STYLES.MARGIN_LEFT + maxWidth,\n      lineY\n    );\n\n    // <hr/> \n    this.currentY += PDF_STYLES.LINE_HEIGHT * 4;\n  }\n\n  /**\n   * markdown\n   */\n  renderMarkdownHeading(line, maxWidth) {\n    const match = line.match(/^(#{1,6})\\s+(.+)$/);\n    if (!match) {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const level = match[1].length;\n    const text = match[2];\n\n    // \n    const fontSize = PDF_STYLES.FONT_SIZE_BODY + (7 - level) * 2;\n    const oldFontSize = this.pdf.internal.getFontSize();\n\n    this.pdf.setFontSize(fontSize);\n    // \n    this.safeSetFont(this.chineseFontName, 'bold');\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, maxWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(fontSize);\n        const cleanLine = cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n      });\n    } catch (error) {\n      console.error('[PDF] :', error);\n      this.pdf.text(text, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // \n    this.pdf.setFontSize(oldFontSize);\n    this.safeSetFont(this.chineseFontName, 'normal');\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.5; // \n  }\n\n  /**\n   * markdown\n   */\n  renderMarkdownQuote(line, maxWidth) {\n    const text = line.replace(/^>\\s*/, '');\n    const quoteWidth = maxWidth - 8;\n    const quoteX = PDF_STYLES.MARGIN_LEFT + 6;\n\n    // \n    this.pdf.setDrawColor(150, 150, 150);\n    this.pdf.setLineWidth(0.5);\n\n    const startY = this.currentY - 2;\n\n    // LaTeX\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(100, 100, 100);\n\n    const tempMargin = PDF_STYLES.MARGIN_LEFT;\n    PDF_STYLES.MARGIN_LEFT = quoteX;\n    this.renderMarkdownInlineFormats(text, quoteWidth);\n    PDF_STYLES.MARGIN_LEFT = tempMargin;\n\n    // \n    this.pdf.line(\n      tempMargin + 2,\n      startY,\n      tempMargin + 2,\n      this.currentY - 2\n    );\n\n    // \n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * Markdown\n   */\n  renderTable(tableLines) {\n    if (!tableLines || tableLines.length < 2) return;\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // \n    const rows = [];\n    let isHeader = true;\n\n    tableLines.forEach((line, idx) => {\n      //  - -:\n      const checkCells = line.split('|').filter((c, i, arr) => i > 0 && i < arr.length - 1);\n      const isSeparator = checkCells.length > 0 && checkCells.every(cell => /^[\\s\\-:]+$/.test(cell));\n      if (isSeparator) {\n        return;\n      }\n\n      const cells = line\n        .split('|')\n        .map(cell => cell.trim())\n        .filter((cell, i, arr) => i > 0 && i < arr.length - 1);\n\n      if (cells.length > 0) {\n        rows.push({ cells, isHeader: isHeader && idx === 0 });\n        if (idx === 0) isHeader = false;\n      }\n    });\n\n    if (rows.length === 0) return;\n\n    const colCount = Math.max(...rows.map(r => r.cells.length));\n    const cellWidth = maxWidth / colCount;\n    const cellPadding = 3;\n    const rowHeight = PDF_STYLES.LINE_HEIGHT * 1.8;  // \n\n    this.pdf.setDrawColor(200, 200, 200);\n    this.pdf.setLineWidth(0.3);\n\n    rows.forEach((row, rowIdx) => {\n      this.checkPageBreak(rowHeight * 2);\n      const rowStartY = this.currentY;\n\n      row.cells.forEach((cell, colIdx) => {\n        const cellX = PDF_STYLES.MARGIN_LEFT + colIdx * cellWidth;\n\n        // \n        if (row.isHeader) {\n          this.pdf.setFillColor(245, 245, 245);\n          this.pdf.rect(cellX, rowStartY, cellWidth, rowHeight, 'F');\n        }\n\n        // \n        this.pdf.rect(cellX, rowStartY, cellWidth, rowHeight, 'S');\n\n        // LaTeXMarkdown\n        const processedText = this.processCellContent(cell);\n\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n        if (row.isHeader) {\n          this.safeSetFont(this.chineseFontName, 'bold');\n          this.pdf.setTextColor(0, 0, 0);\n        } else {\n          this.safeSetFont(this.chineseFontName, 'normal');\n          this.pdf.setTextColor(50, 50, 50);\n        }\n\n        // \n        const maxTextWidth = cellWidth - cellPadding * 2;\n        const truncatedText = this.truncateText(processedText, maxTextWidth);\n\n        //  + \n        const textY = rowStartY + rowHeight / 2 + PDF_STYLES.FONT_SIZE_BODY * 0.15;\n        this.pdf.text(truncatedText, cellX + cellPadding, textY);\n      });\n\n      this.currentY = rowStartY + rowHeight;\n    });\n\n    this.safeSetFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * \n   */\n  processCellContent(cellText) {\n    if (!cellText) return '';\n\n    let result = cellText;\n\n    // LaTeX\n    result = result.replace(/\\$([^$]+)\\$/g, (match, latex) => {\n      try {\n        const renderer = this.getLatexRenderer();\n        return renderer.simplifyLaTeX(latex);\n      } catch (e) {\n        return latex;\n      }\n    });\n\n    // \n    result = result.replace(/\\*\\*([^*]+)\\*\\*/g, '$1');\n    result = result.replace(/__([^_]+)__/g, '$1');\n\n    // \n    result = result.replace(/\\*([^*]+)\\*/g, '$1');\n    result = result.replace(/_([^_]+)_/g, '$1');\n\n    // \n    result = result.replace(/`([^`]+)`/g, '$1');\n\n    return cleanText(result);\n  }\n\n  /**\n   * \n   */\n  truncateText(text, maxWidth) {\n    if (!text) return '';\n    const textWidth = this.safeGetTextWidth(text);\n    if (textWidth <= maxWidth) return text;\n\n    let truncated = text;\n    while (truncated.length > 0 && this.safeGetTextWidth(truncated + '...') > maxWidth) {\n      truncated = truncated.slice(0, -1);\n    }\n    return truncated + '...';\n  }\n\n  /**\n   * markdownLaTeX\n   */\n  renderMarkdownList(line, maxWidth) {\n    let bullet = '';\n    let text = '';\n\n    // \n    const unorderedMatch = line.match(/^([-*+])\\s+(.+)$/);\n    const orderedMatch = line.match(/^(\\d+)\\.\\s+(.+)$/);\n\n    if (unorderedMatch) {\n      bullet = ''; // \n      text = unorderedMatch[2];\n    } else if (orderedMatch) {\n      bullet = orderedMatch[1] + '.';\n      text = orderedMatch[2];\n    } else {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const bulletWidth = this.safeGetTextWidth(bullet + '  ');\n    const textWidth = maxWidth - bulletWidth;\n    const textX = PDF_STYLES.MARGIN_LEFT + bulletWidth;\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.text(bullet, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n\n    // \n    try {\n      // markdownLaTeX\n      const segments = parseInlineMarkdown(text);\n\n      // renderInlineSegments\n      const originalMarginLeft = PDF_STYLES.MARGIN_LEFT;\n      PDF_STYLES.MARGIN_LEFT = textX; // \n\n      this.renderInlineSegments(segments, textWidth);\n\n      PDF_STYLES.MARGIN_LEFT = originalMarginLeft; // \n    } catch (error) {\n      console.error('[PDF] :', error);\n      this.pdf.text(text, textX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n  }\n\n  /**\n   * markdownLaTeX\n   */\n  renderMarkdownInlineFormats(line, maxWidth) {\n    if (!line || line.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // LaTeX\n    const segments = parseInlineMarkdown(line);\n\n    // segmentsLaTeX\n    this.renderInlineSegments(segments, maxWidth);\n  }\n\n  /**\n   * segments\n   */\n  flattenSegments(segments, parentType = null) {\n    const result = [];\n\n    segments.forEach(segment => {\n      if (segment.children) {\n        // \n        const childSegments = this.flattenSegments(segment.children, segment.type);\n        result.push(...childSegments);\n      } else {\n        // \n        if (parentType) {\n          result.push({\n            ...segment,\n            type: this.mergeSegmentTypes(parentType, segment.type)\n          });\n        } else {\n          result.push(segment);\n        }\n      }\n    });\n\n    return result;\n  }\n\n  /**\n   * \n   */\n  mergeSegmentTypes(parentType, childType) {\n    if (childType === 'normal') {\n      return parentType;\n    }\n\n    if ((parentType === 'bold' && childType === 'italic') ||\n        (parentType === 'italic' && childType === 'bold')) {\n      return 'bold-italic';\n    }\n\n    return childType;\n  }\n\n  /**\n   * LaTeX\n   */\n  renderInlineSegments(segments, maxWidth) {\n    // \n    const flatSegments = this.flattenSegments(segments);\n    \n    let currentX = PDF_STYLES.MARGIN_LEFT;\n    let currentLineSegments = [];\n\n    flatSegments.forEach((segment, idx) => {\n      // LaTeXUnicode\n      let text;\n      let textWidth;\n\n      if (segment.type === 'latex-inline') {\n        // LaTeXsimplifyLaTeXUnicode\n        const renderer = this.getLatexRenderer();\n        text = renderer.simplifyLaTeX(segment.text);\n        // Unicode\n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      } else {\n        text = cleanText(segment.text || '');\n        if (!text) return;\n        // \n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      }\n\n      const availableWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - currentX;\n\n      //  segment \n      if (textWidth > availableWidth && currentLineSegments.length === 0) {\n        // LaTeX\n        if (segment.type === 'latex-inline') {\n          console.warn('[PDF] LaTeX:', segment.text);\n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n          return;\n        }\n\n        //  segment\n        //  splitTextToSize \n        try {\n          const maxSegmentWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n          let splitLines = this.pdf.splitTextToSize(text, maxSegmentWidth);\n          // \n          splitLines = applyCJKPunctuationRules(splitLines);\n\n          // \n          for (let i = 0; i < splitLines.length - 1; i++) {\n            this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: splitLines[i]\n            }];\n            this.renderSegmentLine(currentLineSegments);\n            this.currentY += PDF_STYLES.LINE_HEIGHT;\n          }\n\n          //  segment \n          const lastLine = splitLines[splitLines.length - 1];\n          const lastLineWidth = this.safeGetTextWidth(lastLine);\n          currentLineSegments = [{\n            ...segment,\n            x: PDF_STYLES.MARGIN_LEFT,\n            text: lastLine\n          }];\n          currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n        } catch (error) {\n          console.warn('[PDF] :', error);\n          // \n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          if (segment.type !== 'latex-inline') {\n            segmentData.text = text;\n          }\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n        }\n        return;\n      }\n\n      // \n      if (currentX + textWidth > PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT && currentLineSegments.length > 0) {\n        // \n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n        // \n        this.renderSegmentLine(currentLineSegments);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n        // \n        currentX = PDF_STYLES.MARGIN_LEFT;\n        currentLineSegments = [];\n\n        //  segment \n        if (textWidth > maxWidth) {\n          // LaTeX\n          if (segment.type === 'latex-inline') {\n            console.warn('[PDF] LaTeX:', segment.text);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + textWidth;\n            return;\n          }\n\n          // segment \n          try {\n            let splitLines = this.pdf.splitTextToSize(text, maxWidth);\n            // \n            splitLines = applyCJKPunctuationRules(splitLines);\n            for (let i = 0; i < splitLines.length - 1; i++) {\n              this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n              const tempSegments = [{\n                ...segment,\n                x: PDF_STYLES.MARGIN_LEFT,\n                text: splitLines[i]\n              }];\n              this.renderSegmentLine(tempSegments);\n              this.currentY += PDF_STYLES.LINE_HEIGHT;\n            }\n            // \n            const lastLine = splitLines[splitLines.length - 1];\n            const lastLineWidth = this.safeGetTextWidth(lastLine);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: lastLine\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n          } catch (error) {\n            console.warn('[PDF] :', error);\n            const segmentData = {\n              ...segment,\n              x: currentX\n            };\n            if (segment.type !== 'latex-inline') {\n              segmentData.text = text;\n            }\n            currentLineSegments.push(segmentData);\n            currentX += textWidth;\n          }\n          return;\n        }\n      }\n\n      // \n      // latex-inlinesegment.text$\n      // text\n      const segmentData = {\n        ...segment,\n        x: currentX\n      };\n      // LaTeXtext\n      if (segment.type !== 'latex-inline') {\n        segmentData.text = text;\n      }\n      currentLineSegments.push(segmentData);\n      currentX += textWidth;\n    });\n\n    // \n    if (currentLineSegments.length > 0) {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      this.renderSegmentLine(currentLineSegments);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // \n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   *  segment LaTeX\n   */\n  renderSegmentLine(segments) {\n    segments.forEach(segment => {\n      this.applySegmentStyle(segment.type);\n\n      if (segment.type === 'latex-inline') {\n        try {\n          const renderer = this.getLatexRenderer();\n          renderer.renderInlineLaTeX(\n            segment.text,\n            segment.x,\n            this.currentY,\n            PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - segment.x\n          );\n        } catch (error) {\n          console.warn('[PDF] LaTeX:', error);\n          this.pdf.text(segment.text, segment.x, this.currentY);\n        }\n      } else if (segment.type === 'link') {\n        this.pdf.textWithLink(segment.text, segment.x, this.currentY, {\n          url: segment.url || '#'\n        });\n        const textWidth = this.safeGetTextWidth(segment.text);\n        this.pdf.line(segment.x, this.currentY + 0.5, segment.x + textWidth, this.currentY + 0.5);\n      } else if (segment.type === 'code') {\n        const textWidth = this.safeGetTextWidth(segment.text);\n        const padding = 1;\n        this.pdf.setFillColor(245, 245, 245);\n        this.pdf.rect(segment.x - padding, this.currentY - 3, textWidth + padding * 2, 4, 'F');\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      } else {\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      }\n    });\n  }\n\n  /**\n   * segmentLaTeX\n   */\n  applySegmentStyle(type) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    switch (type) {\n      case 'latex-inline':\n        // LaTeX\n        try {\n          this.pdf.setFont(this.chineseFontName, 'italic');\n        } catch (e) {\n          this.pdf.setFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n        this.pdf.setTextColor(50, 50, 50); // \n        break;\n      case 'latex-display':\n        // Display LaTeX (handled separately in renderLatexDisplay)\n        break;\n      case 'bold':\n        console.log('[PDF] , :', this.chineseFontName, ':', this.availableFontWeights);\n        // \n        const boldSuccess = this.safeSetFont(this.chineseFontName, 'bold');\n        console.log('[PDF] safeSetFont :', boldSuccess);\n        if (!boldSuccess) {\n          // \n          console.warn('[PDF] :  RGB(20,20,150) + ', PDF_STYLES.FONT_SIZE_BODY + 1);\n          //  + \n          this.pdf.setTextColor(20, 20, 150); // \n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 1); // 1pt\n        } else {\n          console.log('[PDF] ');\n        }\n        break;\n      case 'italic':\n        //  light \n        const lightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!lightSuccess) {\n          //  light\n          this.pdf.setTextColor(70, 130, 180); // \n        }\n        break;\n      case 'bold-italic':\n        //  bold normal + \n        const boldItalicSuccess = this.safeSetFont(this.chineseFontName, 'bolditalic');\n        if (!boldItalicSuccess) {\n          //  bold\n          const boldOnlySuccess = this.safeSetFont(this.chineseFontName, 'bold');\n          if (!boldOnlySuccess) {\n            // bold \n            this.pdf.setTextColor(30, 60, 120); // +\n            this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 0.5);\n          } else {\n            // bold \n            this.pdf.setTextColor(70, 130, 180); // \n          }\n        }\n        break;\n      case 'code':\n        this.pdf.setFont('courier', 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(220, 50, 50);\n        break;\n      case 'link':\n        //  light \n        const linkLightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!linkLightSuccess) {\n          this.safeSetFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setTextColor(0, 102, 204); // \n        break;\n      default:\n        this.safeSetFont(this.chineseFontName, 'normal');\n    }\n  }\n\n  /**\n   * thinking\n   */\n  renderThinking(thinking) {\n    this.renderSection(' Thinking', thinking, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * Artifact\n   */\n  renderArtifact(artifact) {\n    const title = ` Artifact: ${artifact.title || 'Untitled'}`;\n    const content = artifact.content || '';\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * \n   */\n  renderTool(tool) {\n    const title = ` Tool: ${tool.name || 'Unknown'}`;\n    const content = `Input: ${JSON.stringify(tool.input, null, 2)}\\n\\nOutput: ${tool.output || 'N/A'}`;\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * \n   */\n  renderCitations(citations) {\n    const title = ' Citations';\n    const content = citations.map((cit, i) =>\n      `[${i + 1}] ${cit.title || cit.url || 'Unknown'}`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * \n   */\n  renderAttachments(attachments) {\n    const title = ' Attachments';\n    const content = attachments.map((att, i) =>\n      `[${i + 1}] ${att.file_name || att.name || 'file'} (${att.file_type || att.type || 'unknown'})`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * ()\n   */\n  renderSection(title, content, bgColor) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_H2 + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    \n    // \n    const cleanTitle = cleanText(title);\n    const cleanContent = cleanText(content);\n    \n    // ,\n    let contentLines;\n    try {\n      contentLines = this.pdf.splitTextToSize(cleanContent, maxWidth - 4);\n    } catch (error) {\n      console.error('[PDF] :', error);\n      contentLines = cleanContent.split('\\n');\n    }\n    \n    const bgHeight = PDF_STYLES.LINE_HEIGHT * (contentLines.length + 2);\n\n    // \n    this.pdf.setFillColor(...bgColor);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      bgHeight,\n      'F'\n    );\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H2);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    if (cleanTitle && cleanTitle.trim().length > 0) {\n      this.pdf.text(cleanTitle, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    }\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    contentLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * Table of Contents\n   */\n  renderTOCWithLinks(tocPage, messages) {\n    // \n    this.pdf.setPage(tocPage);\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H1);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.pdf.text('Table of Contents', PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 2;\n\n    // \n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.3);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      this.currentY\n    );\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.manager.messageAnchors.forEach((anchor, idx) => {\n      const message = messages[idx];\n      if (!message) return;\n\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY * 2);\n\n      const messageNumber = `${anchor.index}.`;\n      const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n\n      // 50\n      let preview = anchor.title || '';\n      preview = cleanText(preview);\n      preview = preview.replace(/\\n/g, ' ').substring(0, 50);\n      if (preview.length >= 50) {\n        preview += '...';\n      }\n\n      // \n      let branchMarker = '';\n      if (message.branchInfo?.isBranchPoint) {\n        branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      }\n\n      // \n      const entry = `${messageNumber} ${sender}${branchMarker}`;\n      const pageNum = `p.${anchor.page}`;\n\n      // \n      const color = anchor.sender === 'human'\n        ? PDF_STYLES.COLOR_SENDER_HUMAN\n        : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n      this.pdf.setTextColor(...color);\n\n      // \n      const pageNumWidth = this.safeGetTextWidth(pageNum);\n      const pageNumX = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageNumWidth;\n\n      // \n      const entryY = this.currentY;\n      this.pdf.textWithLink(entry, PDF_STYLES.MARGIN_LEFT + 5, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // \n      this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n      this.pdf.textWithLink(pageNum, pageNumX, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // \n      if (preview) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.text(preview, PDF_STYLES.MARGIN_LEFT + 10, this.currentY);\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n      }\n\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n  }\n\n  /**\n   * \n   */\n  renderFooter(pageNumber, totalPages) {\n    const originalY = this.currentY;\n    const originalFontSize = this.pdf.internal.getFontSize();\n\n    // \n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_FOOTER);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_FOOTER);\n\n    const footerY = PDF_STYLES.PAGE_HEIGHT - 10;\n\n    // \n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.1);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT\n    );\n\n    // \n    const exportText = `Exported: ${this.manager.exportDate}`;\n    this.pdf.text(exportText, PDF_STYLES.MARGIN_LEFT, footerY);\n\n    // \n    const pageText = `${pageNumber} / ${totalPages}`;\n    const pageTextWidth = this.safeGetTextWidth(pageText);\n    this.pdf.text(pageText, PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageTextWidth, footerY);\n\n    // \n    this.pdf.setFontSize(originalFontSize);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY = originalY;\n  }\n}\n","// utils/export/pdfExportManager_new.js\n// PDF - jsPDFPDF\n//\n//  ARUDJingxihei RegularBoldLight \n//  Markdown \n//  LaTeX \nimport { jsPDF } from 'jspdf';\nimport { DateTimeUtils } from '../fileParser';\nimport { addChineseFontSupport } from './pdfFontHelper';\nimport { ContentRenderer, PDF_STYLES } from './pdfContentRenderers';\nimport * as textHelpers from './pdfTextHelpers';\n\n/**\n * PDF\n */\nexport class PDFExportManager {\n  constructor() {\n    this.pdf = null;\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n    this.config = {};\n    this.useChineseFont = false; // \n    this.chineseFontName = 'helvetica'; // \n    this.availableFontWeights = []; //  (normal, bold, light )\n    this.isSystemFont = false; // \n    this.meta = null; // \n    this.exportDate = null; // \n    this.messageAnchors = []; // \n    this.contentRenderer = null; // \n    \n    // \n    this.cleanText = textHelpers.cleanText;\n    this.parseTextWithCodeBlocksAndLatex = textHelpers.parseTextWithCodeBlocksAndLatex;\n    this.parseInlineMarkdown = textHelpers.parseInlineMarkdown;\n    this.applyCJKPunctuationRules = textHelpers.applyCJKPunctuationRules;\n    this.parseCodeLineBold = textHelpers.parseCodeLineBold;\n  }\n\n  /**\n   * \n   * @param {string} fontName - \n   * @param {string} fontStyle -  (normal, bold, light, italic, bolditalic)\n   * @returns {boolean} - \n   */\n  safeSetFont(fontName, fontStyle = 'normal') {\n    return textHelpers.safeSetFont(this.pdf, fontName, fontStyle, this.availableFontWeights);\n  }\n\n  /**\n   * \n   * @param {string} text - \n   * @returns {number} - \n   */\n  safeGetTextWidth(text) {\n    return textHelpers.safeGetTextWidth(this.pdf, text, this.chineseFontName);\n  }\n\n  /**\n   * \n   * @param {string} text - \n   * @param {number} x - X \n   * @param {number} y - Y \n   * @param {number} maxWidth - \n   */\n  safeRenderText(text, x, y, maxWidth = null) {\n    return textHelpers.safeRenderText(this.pdf, text, x, y, maxWidth);\n  }\n\n  /**\n   * \n   * @param {Array} messages - \n   * @param {Object} meta - (title, platform, created_at, updated_at)\n   * @param {Object} config - \n   */\n  async exportToPDF(messages, meta, config = {}) {\n    console.log('[PDF] ', {\n      messageCount: messages.length,\n      config\n    });\n\n    // \n    this.meta = meta;\n    this.exportDate = DateTimeUtils.formatDateTime(new Date());\n    this.messageAnchors = []; // \n\n    this.config = {\n      includeThinking: config.includeThinking ?? true,\n      includeArtifacts: config.includeArtifacts ?? true,\n      includeTimestamps: config.includeTimestamps ?? false,\n      includeTools: config.includeTools ?? true,\n      includeCitations: config.includeCitations ?? true,\n      highQuality: config.highQuality ?? false,\n      ...config\n    };\n\n    // PDF\n    this.pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4',\n      compress: true\n    });\n\n    // \n    try {\n      console.log('[PDF] ...');\n      console.log('[PDF]  addChineseFontSupport(this.pdf)...');\n      const fontLoadResult = await addChineseFontSupport(this.pdf);\n      console.log('[PDF] addChineseFontSupport :', fontLoadResult);\n\n      this.useChineseFont = fontLoadResult.success;\n      this.chineseFontName = fontLoadResult.fontName;\n      this.availableFontWeights = fontLoadResult.availableWeights || [];\n      this.isSystemFont = fontLoadResult.isSystemFont || false;\n\n      if (!this.useChineseFont) {\n        console.warn('[PDF]  ');\n        console.warn('[PDF] fontLoadResult:', JSON.stringify(fontLoadResult, null, 2));\n        if (fontLoadResult.systemFontAvailable) {\n          console.warn('[PDF] ');\n          console.warn('[PDF]  public/fonts/ ');\n        }\n      } else {\n        const fontType = this.isSystemFont ? '' : '';\n        console.log(`[PDF]  : ${this.chineseFontName} (${fontType})`);\n        console.log(`[PDF] : ${this.availableFontWeights.join(', ')}`);\n        if (fontLoadResult.systemFontInfo) {\n          console.log(`[PDF] : ${fontLoadResult.systemFontInfo.fontName}`);\n        }\n      }\n    } catch (error) {\n      console.error('[PDF]  :', error);\n      console.error('[PDF] :', error.stack);\n      this.useChineseFont = false;\n      this.chineseFontName = 'helvetica';\n      this.availableFontWeights = [];\n      this.isSystemFont = false;\n    }\n\n    // \n    this.pdf.setFont(this.chineseFontName);\n\n    // \n    this.contentRenderer = new ContentRenderer(this);\n\n    // \n    this.contentRenderer.renderTitle(meta);\n    this.contentRenderer.renderMetadata(meta);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n\n    // LaTeX\n    for (let i = 0; i < messages.length; i++) {\n      const message = messages[i];\n\n      // +AI\n      // \n      if (i > 0 && message.sender === 'human') {\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n      }\n\n      this.contentRenderer.renderMessage(message, i + 1);\n    }\n\n    // \n    const hasTOC = messages.length > 1;\n    if (hasTOC) {\n      console.log('[PDF] ...');\n      this.pdf.addPage();\n      const tocPageNumber = this.pdf.internal.getCurrentPageInfo().pageNumber;\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n      this.contentRenderer.renderTOCWithLinks(tocPageNumber, messages);\n    }\n\n    // PDF\n    console.log('[PDF] PDF...');\n    this.addBookmarks();\n\n    // \n    console.log('[PDF] ...');\n    this.addFooters();\n\n    // \n    const fileName = this.generateFileName(meta);\n    this.pdf.save(fileName);\n\n    console.log('[PDF] :', fileName);\n    return true;\n  }\n\n  /**\n   * PDFoutline\n   */\n  addBookmarks() {\n    if (this.messageAnchors.length === 0) return;\n\n    // jsPDFoutline\n    // \n    try {\n      this.messageAnchors.forEach((anchor) => {\n        const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n        const title = `${anchor.index}. ${sender}`;\n\n        // jsPDFoutline API\n        // jsPDFoutline\n        if (this.pdf.outline) {\n          this.pdf.outline.add(null, title, { pageNumber: anchor.page });\n        }\n      });\n    } catch (error) {\n      console.warn('[PDF] :', error);\n    }\n  }\n\n  /**\n   * \n   */\n  addFooters() {\n    const totalPages = this.pdf.internal.getNumberOfPages();\n\n    for (let i = 1; i <= totalPages; i++) {\n      this.pdf.setPage(i);\n      this.contentRenderer.renderFooter(i, totalPages);\n    }\n  }\n\n  /**\n   * \n   */\n  checkPageBreak(requiredSpace = 20) {\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    if (this.currentY + requiredSpace > bottomLimit) {\n      this.pdf.addPage();\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n    }\n  }\n\n  /**\n   * \n   * @param {Array} wrappedLines - \n   * @returns {Array} -  [{page, startY, lines: [...]}]\n   */\n  groupCodeLinesByPage(wrappedLines) {\n    const groups = [];\n    let currentGroup = null;\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    let simulatedY = this.currentY;\n    let simulatedPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    wrappedLines.forEach((line) => {\n      // \n      if (simulatedY + PDF_STYLES.FONT_SIZE_CODE > bottomLimit) {\n        simulatedPage++;\n        simulatedY = PDF_STYLES.MARGIN_TOP;\n        currentGroup = null; // \n      }\n\n      // \n      if (!currentGroup || currentGroup.page !== simulatedPage) {\n        currentGroup = {\n          page: simulatedPage,\n          startY: simulatedY,\n          lines: []\n        };\n        groups.push(currentGroup);\n      }\n\n      // \n      currentGroup.lines.push(line);\n      simulatedY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    return groups;\n  }\n\n  /**\n   * \n   */\n  generateFileName(meta) {\n    const date = DateTimeUtils.getCurrentDate();\n    const cleanTitle = (meta.name || 'conversation').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n    return `${cleanTitle}_${date}.pdf`;\n  }\n\n  /**\n   * \n   */\n  getPlatformPrefix(platform) {\n    const platformLower = (platform || '').toLowerCase();\n\n    if (platformLower.includes('chatgpt')) return 'chatgpt';\n    if (platformLower.includes('gemini')) return 'gemini';\n    if (platformLower.includes('notebooklm')) return 'notebooklm';\n    if (platformLower.includes('aistudio')) return 'aistudio';\n    if (platformLower.includes('sillytavern')) return 'sillytavern';\n\n    return 'claude';\n  }\n}\n\n// \nexport const pdfExportManager = new PDFExportManager();"],"names":["async","loadFontFromProject","pdf","fontPath","fontName","arguments","length","undefined","fontStyle","console","log","concat","arrayBuffer","base64","loadFontData","FontCache","has","hasCmap","version","DataView","getUint32","warn","buffer","Uint8Array","cmapSignature","i","Math","min","error","hasUnicodeCmap","fileName","split","pop","addFileToVFS","addFont","addFontError","message","Map","cached","get","dbCache","loadFromIndexedDB","set","timestamp","Date","now","controller","AbortController","timeoutId","setTimeout","abort","response","fetch","signal","cache","clearTimeout","ok","Error","status","contentType","headers","includes","fileSizeMB","byteLength","toFixed","magic","toString","bytes","binary","chunkSize","chunk","subarray","String","fromCharCode","apply","btoa","fontData","Promise","resolve","reject","request","indexedDB","open","onerror","onupgradeneeded","event","db","target","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","transaction","objectStore","put","path","oncomplete","close","saveToIndexedDB","catch","err","fetchError","name","getRequest","data","cleanText","text","cleaned","normalize","replace","ligatureMap","ligature","replacement","Object","entries","RegExp","quoteMap","from","to","ch","charCodeAt","parseTextWithCodeBlocksAndLatex","parts","elements","codeBlockRegex","match","lastIndex","exec","language","trim","toLowerCase","content","push","start","index","end","type","latexDisplayRegex","latexBracketRegex","sort","a","b","filteredElements","forEach","element","some","existing","plainText","substring","parseInlineMarkdown","segments","matches","regex","recursive","pattern","source","url","filteredMatches","lastEnd","innerSegments","children","applyCJKPunctuationRules","lines","noLineStart","noLineEnd","prevLine","currentLine","test","punct","parseCodeLineBold","line","headingMatch","level","headingText","boldRegex","bold","heading","safeSetFont","availableFontWeights","setFont","fallbackStyle","safeGetTextWidth","chineseFontName","font","getFont","metadata","Unicode","currentStyle","getTextWidth","fontSize","getFontSize","LATEX_UNICODE_MAP","MATHCAL_MAP","MATHBB_MAP","SUPERSCRIPT_MAP","SUPERSCRIPT_SAFE","SUBSCRIPT_MAP","extractBracedContent","str","startsWith","depth","LaTeXRenderer","constructor","config","this","_objectSpread","color","useUnicode","widthCache","setRenderFont","e","setFontSize","getCachedTextWidth","cacheKey","width","clearWidthCache","clear","renderInlineLaTeX","latex","x","y","maxWidth","simplified","simplifyLaTeX","hasComplexStructure","renderComplexLaTeX","setTextColor","renderDisplayLaTeX","centerX","textWidth","startX","setFillColor","rect","padding","height","_","letter","inner","simplifiedInner","simplifyFractions","processSupSubScripts","keys","command","lastResult","fracMatch","startIdx","afterFrac","numerator","denominator","fullMatch","supMatch","endsWith","slice","converted","convertToSuperscript","subMatch","convertToSubscript","map","char","join","isInline","parseComplexLaTeX","totalWidth","fracFontSize","numWidth","denWidth","max","base","subSupFontSize","exponent","subscript","raw","currentX","maxHeight","hasFraction","fracWidth","renderFraction","sqrtWidth","renderSquareRoot","supWidth","renderSuperscript","subWidth","renderSubscript","fallbackText","fallbackWidth","remaining","fracRegex","beforeText","numOffset","denOffset","numX","setLineWidth","setDrawColor","denX","sqrtHeight","baseWidth","supFontSize","supText","subFontSize","subText","PDF_STYLES","FONT_SIZE_TITLE","FONT_SIZE_H1","FONT_SIZE_H2","FONT_SIZE_SENDER","FONT_SIZE_BODY","FONT_SIZE_CODE","FONT_SIZE_TIMESTAMP","FONT_SIZE_HEADER","FONT_SIZE_FOOTER","COLOR_SENDER_HUMAN","COLOR_SENDER_ASSISTANT","COLOR_TIMESTAMP","COLOR_CODE_BG","COLOR_SECTION_BG","COLOR_TEXT","COLOR_HEADER","COLOR_FOOTER","COLOR_BORDER","MARGIN_LEFT","MARGIN_RIGHT","MARGIN_TOP","MARGIN_BOTTOM","LINE_HEIGHT","SECTION_SPACING","MESSAGE_SPACING","FOOTER_HEIGHT","PAGE_WIDTH","PAGE_HEIGHT","ContentRenderer","manager","latexRenderer","currentY","value","safeRenderText","checkPageBreak","requiredSpace","renderTitle","meta","title","titleLines","splitTextToSize","cleanLine","renderMetadata","platform","created_at","updated_at","exportDate","renderMessage","_message$attachments","_message$artifacts","_message$tools","_message$citations","currentPage","internal","getCurrentPageInfo","pageNumber","messageAnchors","page","sender","display_text","renderSender","includeTimestamps","renderTimestamp","thinking","includeThinking","renderThinking","renderBody","attachments","renderAttachments","artifacts","includeArtifacts","artifact","renderArtifact","tools","includeTools","tool","renderTool","citations","includeCitations","renderCitations","_message$branchInfo","senderLabel","label","finalLabel","branchInfo","isBranchPoint","childCount","cleanLabel","part","renderCodeBlock","renderLatexDisplay","renderMarkdownText","getLatexRenderer","containsLatex","renderLatexDisplayAsSource","roundedRect","renderPlainText","cleanedText","code","codeWidth","cleanCode","cleanLanguage","labelText","toUpperCase","labelWidth","codeLines","wrappedLines","lineNumber","wLine","idx","blockStartY","blockStartPage","firstPageHeight","_ref","currentPageBottom","addPage","remainingLines","newPageHeight","lineNumStr","padStart","safeLine","s","headingSizes","segment","endPage","setPage","isFirst","isLast","boxStartY","boxEndY","renderMarkdownHeading","renderHorizontalRule","renderMarkdownQuote","tableLines","renderTable","renderLatexListItem","renderMarkdownList","renderMarkdownInlineFormats","cleanedLine","indentX","tempMargin","lineY","oldFontSize","l","quoteWidth","quoteX","startY","rows","isHeader","checkCells","filter","c","arr","every","cell","cells","cellWidth","r","rowHeight","row","rowIdx","rowStartY","colIdx","cellX","processedText","processCellContent","maxTextWidth","cellPadding","truncatedText","truncateText","textY","cellText","truncated","bullet","unorderedMatch","orderedMatch","bulletWidth","textX","originalMarginLeft","renderInlineSegments","flattenSegments","parentType","childSegments","mergeSegmentTypes","childType","flatSegments","currentLineSegments","applySegmentStyle","segmentData","maxSegmentWidth","splitLines","renderSegmentLine","lastLine","lastLineWidth","tempSegments","textWithLink","boldSuccess","renderSection","JSON","stringify","input","output","cit","att","file_name","file_type","bgColor","cleanTitle","cleanContent","contentLines","bgHeight","renderTOCWithLinks","tocPage","messages","anchor","_message$branchInfo2","messageNumber","preview","branchMarker","entry","pageNum","pageNumWidth","pageNumX","entryY","renderFooter","totalPages","originalY","originalFontSize","footerY","exportText","pageText","pageTextWidth","PDFExportManager","useChineseFont","isSystemFont","contentRenderer","textHelpers","exportToPDF","_config$includeThinki","_config$includeArtifa","_config$includeTimest","_config$includeTools","_config$includeCitati","_config$highQuality","messageCount","DateTimeUtils","formatDateTime","highQuality","jsPDF","orientation","unit","format","compress","fontLoadResult","fontConfigs","style","weight","description","loadedCount","availableWeights","success","addChineseFontSupport","fontType","systemFontInfo","systemFontAvailable","stack","tocPageNumber","addBookmarks","addFooters","generateFileName","save","outline","add","getNumberOfPages","bottomLimit","groupCodeLinesByPage","groups","currentGroup","simulatedY","simulatedPage","date","getCurrentDate","getPlatformPrefix","platformLower"],"sourceRoot":""}