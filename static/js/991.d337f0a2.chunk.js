"use strict";(self.webpackChunklyra_exporter=self.webpackChunklyra_exporter||[]).push([[991],{3991:(t,e,n)=>{n.d(e,{PDFExportManager:()=>a});var s=n(9379),i=n(221),r=n(4529);async function o(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CustomFont",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal";try{console.log("[PDF\u5b57\u4f53] \u6b63\u5728\u52a0\u8f7d\u5b57\u4f53: ".concat(e));const o=new AbortController,h=setTimeout(()=>o.abort(),5e3);try{const r="?v=".concat(Date.now()),a=await fetch(e+r,{signal:o.signal,cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(clearTimeout(h),!a.ok)throw new Error("\u52a0\u8f7d\u5b57\u4f53\u5931\u8d25: ".concat(a.status));const c=a.headers.get("content-type");if(console.log("[PDF\u5b57\u4f53] Content-Type: ".concat(c)),c&&c.includes("text/html"))return console.error("[PDF\u5b57\u4f53] \u8fd4\u56de\u4e86HTML\u9875\u9762\u800c\u4e0d\u662f\u5b57\u4f53\u6587\u4ef6\uff01"),!1;const l=await a.arrayBuffer(),d=(l.byteLength/1024).toFixed(2),T=(l.byteLength/1024/1024).toFixed(2);console.log("[PDF\u5b57\u4f53] \u5b57\u4f53\u6587\u4ef6\u5927\u5c0f: ".concat(T," MB (").concat(d," KB)"));const p=new DataView(l).getUint32(0,!1);if(65536!==p&&1953658213!==p)return console.error("[PDF\u5b57\u4f53] \u6587\u4ef6\u4e0d\u662f\u6709\u6548\u7684TTF\u5b57\u4f53\uff01\u9b54\u6570: 0x".concat(p.toString(16))),console.error("[PDF\u5b57\u4f53] \u8fd9\u53ef\u80fd\u662f\u4e00\u4e2aHTML\u9519\u8bef\u9875\u9762\u6216\u5176\u4ed6\u975e\u5b57\u4f53\u6587\u4ef6"),!1;if(l.byteLength<512e3)return console.error("[PDF\u5b57\u4f53] \u5b57\u4f53\u6587\u4ef6\u5f02\u5e38\u5c0f (\u4ec5 ".concat(d," KB)\uff01")),console.error("[PDF\u5b57\u4f53] \u6b63\u5e38\u7684\u4e2d\u6587\u5b57\u4f53\u5e94\u8be5\u81f3\u5c11 3MB"),!1;const E=function(t){try{const e=new DataView(t).getUint32(0,!1);65536!==e&&1953658213!==e&&console.warn("[PDF\u5b57\u4f53] \u53ef\u80fd\u4e0d\u662f\u6807\u51c6TTF\u683c\u5f0f");const n=new Uint8Array(t),s=[99,109,97,112];for(let t=0;t<Math.min(n.length-4,1e3);t++)if(n[t]===s[0]&&n[t+1]===s[1]&&n[t+2]===s[2]&&n[t+3]===s[3])return console.log("[PDF\u5b57\u4f53] \u627e\u5230 cmap \u8868"),!0;return console.warn("[PDF\u5b57\u4f53] \u672a\u627e\u5230 cmap \u8868\u7279\u5f81"),!1}catch(e){return console.error("[PDF\u5b57\u4f53] cmap \u68c0\u67e5\u5931\u8d25:",e),!1}}(l);E||(console.warn("[PDF\u5b57\u4f53] \u8b66\u544a: \u5b57\u4f53\u53ef\u80fd\u7f3a\u5c11 Unicode cmap \u8868"),console.warn("[PDF\u5b57\u4f53] \u5efa\u8bae\u66f4\u6362\u4e3a Noto Sans SC \u6216 Source Han Sans CN"));const _=new Uint8Array(l);let u="";const f=_.byteLength,I=8192;for(let t=0;t<f;t+=I){const e=_.subarray(t,Math.min(t+I,f));u+=String.fromCharCode.apply(null,e)}const g=btoa(u),F=e.split("/").pop();try{return t.addFileToVFS(F,g),t.addFont(F,n,s),console.log("[PDF\u5b57\u4f53] \u5b57\u4f53\u52a0\u8f7d\u6210\u529f: ".concat(n,"-").concat(s)),!0}catch(i){return console.error("[PDF\u5b57\u4f53] addFont \u5931\u8d25:",i.message),console.error("[PDF\u5b57\u4f53] \u8fd9\u901a\u5e38\u610f\u5473\u7740\u5b57\u4f53\u4e0d\u517c\u5bb9 jsPDF"),console.error("[PDF\u5b57\u4f53] \u9519\u8bef\u8be6\u60c5:",i),!1}}catch(r){return clearTimeout(h),"AbortError"===r.name?console.warn("[PDF\u5b57\u4f53] \u5b57\u4f53\u52a0\u8f7d\u8d85\u65f6: ".concat(e)):console.warn("[PDF\u5b57\u4f53] \u83b7\u53d6\u5b57\u4f53\u6587\u4ef6\u5931\u8d25: ".concat(r.message)),!1}}catch(o){return console.error("[PDF\u5b57\u4f53] \u5b57\u4f53\u52a0\u8f7d\u5931\u8d25:",o),!1}}const h={FONT_SIZE_TITLE:20,FONT_SIZE_H1:16,FONT_SIZE_H2:14,FONT_SIZE_SENDER:12,FONT_SIZE_BODY:10,FONT_SIZE_CODE:9,FONT_SIZE_TIMESTAMP:8,FONT_SIZE_HEADER:8,FONT_SIZE_FOOTER:8,COLOR_SENDER_HUMAN:[0,102,204],COLOR_SENDER_ASSISTANT:[102,102,102],COLOR_TIMESTAMP:[150,150,150],COLOR_CODE_BG:[245,245,245],COLOR_SECTION_BG:[250,250,250],COLOR_TEXT:[0,0,0],COLOR_HEADER:[100,100,100],COLOR_FOOTER:[150,150,150],COLOR_BORDER:[200,200,200],MARGIN_LEFT:15,MARGIN_RIGHT:15,MARGIN_TOP:15,MARGIN_BOTTOM:25,LINE_HEIGHT:5,SECTION_SPACING:8,MESSAGE_SPACING:10,FOOTER_HEIGHT:15,PAGE_WIDTH:210,PAGE_HEIGHT:297};class a{constructor(){this.pdf=null,this.currentY=h.MARGIN_TOP,this.config={},this.useChineseFont=!1,this.chineseFontName="helvetica",this.availableFontWeights=[],this.meta=null,this.exportDate=null,this.messageAnchors=[]}safeSetFont(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";try{if(this.availableFontWeights.includes(e))return this.pdf.setFont(t,e),!0;if(console.warn("[PDF\u5bfc\u51fa] \u5b57\u4f53\u53d8\u4f53 ".concat(e," \u4e0d\u53ef\u7528\uff0c\u5c1d\u8bd5\u56de\u9000...")),("bold"===e||"bolditalic"===e)&&this.availableFontWeights.includes("normal"))return this.pdf.setFont(t,"normal"),console.log("[PDF\u5bfc\u51fa] \u2713 \u56de\u9000\u5230 normal \u5b57\u4f53"),!1;if("italic"===e||"bolditalic"===e){if(this.availableFontWeights.includes("light"))return this.pdf.setFont(t,"light"),console.log("[PDF\u5bfc\u51fa] \u2713 \u659c\u4f53\u56de\u9000\u5230 light \u5b57\u4f53"),!1;if(this.availableFontWeights.includes("normal"))return this.pdf.setFont(t,"normal"),console.log("[PDF\u5bfc\u51fa] \u2713 \u659c\u4f53\u56de\u9000\u5230 normal \u5b57\u4f53"),!1}if(this.availableFontWeights.length>0){const e=this.availableFontWeights[0];return this.pdf.setFont(t,e),console.log("[PDF\u5bfc\u51fa] \u2713 \u56de\u9000\u5230 ".concat(e," \u5b57\u4f53")),!1}return this.pdf.setFont(t,"normal"),console.log("[PDF\u5bfc\u51fa] \u2713 \u56de\u9000\u5230 normal \u5b57\u4f53"),!1}catch(n){return console.error("[PDF\u5bfc\u51fa] \u8bbe\u7f6e\u5b57\u4f53\u5931\u8d25:",n),this.pdf.setFont(t||this.chineseFontName),!1}}cleanText(t){if(!t||"string"!==typeof t)return"";try{let e=t.normalize("NFC");return e=e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/g,""),e=e.replace(/[\u200B-\u200F\u2060\uFEFF]/g,""),e=e.replace(/[\uE000-\uF8FF]/g,""),e}catch(e){return console.error("[PDF\u5bfc\u51fa] \u6587\u672c\u6e05\u7406\u5931\u8d25:",e),t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")}}async exportToPDF(t,e){var n,a,c,l,d,T;let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};console.log("[PDF\u5bfc\u51fa] \u5f00\u59cb\u5bfc\u51fa",{messageCount:t.length,config:p}),this.meta=e,this.exportDate=r.Nq.formatDateTime(new Date),this.messageAnchors=[],this.config=(0,s.A)({includeThinking:null===(n=p.includeThinking)||void 0===n||n,includeArtifacts:null===(a=p.includeArtifacts)||void 0===a||a,includeTimestamps:null!==(c=p.includeTimestamps)&&void 0!==c&&c,includeTools:null===(l=p.includeTools)||void 0===l||l,includeCitations:null===(d=p.includeCitations)||void 0===d||d,highQuality:null!==(T=p.highQuality)&&void 0!==T&&T},p),this.pdf=new i.uE({orientation:"portrait",unit:"mm",format:"a4",compress:!0});try{console.log("[PDF\u5bfc\u51fa] \u5f00\u59cb\u52a0\u8f7d\u4e2d\u6587\u5b57\u4f53...");const t=await async function(t){console.log("[PDF\u5b57\u4f53] \u5f00\u59cb\u52a0\u8f7d ARUDJingxihei \u5b57\u4f53\u5bb6\u65cf...");const e=[{path:"/fonts/ARUDJingxihei-Regular.ttf",name:"ARUDJingxihei",style:"normal",weight:400,description:"Regular (\u6b63\u5e38)"},{path:"/fonts/ARUDJingxihei-Bold.ttf",name:"ARUDJingxihei",style:"bold",weight:700,description:"Bold (\u7c97\u4f53)"},{path:"/fonts/ARUDJingxihei-Light.ttf",name:"ARUDJingxihei",style:"light",weight:300,description:"Light (\u7ec6\u4f53)"}];let n=0,s="helvetica";const i=[];for(const h of e)try{await o(t,h.path,h.name,h.style)&&(n++,s=h.name,i.push(h.style),console.log("[PDF\u5b57\u4f53] \u2713 \u52a0\u8f7d\u6210\u529f: ".concat(h.name,"-").concat(h.style," (").concat(h.description,")")))}catch(r){console.warn("[PDF\u5b57\u4f53] \u2717 \u8df3\u8fc7: ".concat(h.path," - ").concat(r.message))}if(0===n)return console.warn("[PDF\u5b57\u4f53] \u2717 \u672a\u80fd\u52a0\u8f7d\u4efb\u4f55 ARUDJingxihei \u5b57\u4f53"),console.warn("[PDF\u5b57\u4f53] \u5c06\u4f7f\u7528 helvetica \u9ed8\u8ba4\u5b57\u4f53 (\u4e2d\u6587\u53ef\u80fd\u663e\u793a\u4e3a\u65b9\u5757)"),t.setFont("helvetica"),{success:!1,fontName:"helvetica",availableWeights:[]};console.log("[PDF\u5b57\u4f53] \u2713 \u6210\u529f\u52a0\u8f7d ".concat(n," \u4e2a\u5b57\u4f53\u53d8\u4f53: ").concat(i.join(", ")));try{t.setFont(s,"normal")}catch(r){console.warn("[PDF\u5b57\u4f53] \u26a0 \u8bbe\u7f6e\u9ed8\u8ba4\u5b57\u4f53\u5931\u8d25\uff0c\u4f7f\u7528\u7b2c\u4e00\u4e2a\u53ef\u7528\u5b57\u91cd"),t.setFont(s,i[0]||"normal")}return{success:!0,fontName:s,availableWeights:i}}(this.pdf);this.useChineseFont=t.success,this.chineseFontName=t.fontName,this.availableFontWeights=t.availableWeights||[],this.useChineseFont?(console.log("[PDF\u5bfc\u51fa] \u4e2d\u6587\u5b57\u4f53\u52a0\u8f7d\u6210\u529f: ".concat(this.chineseFontName)),console.log("[PDF\u5bfc\u51fa] \u53ef\u7528\u5b57\u4f53\u53d8\u4f53: ".concat(this.availableFontWeights.join(", ")))):console.warn("[PDF\u5bfc\u51fa] \u4e2d\u6587\u5b57\u4f53\u52a0\u8f7d\u5931\u8d25\uff0c\u5c06\u4f7f\u7528\u9ed8\u8ba4\u5b57\u4f53\uff08\u4e2d\u6587\u53ef\u80fd\u663e\u793a\u4e3a\u65b9\u6846\uff09")}catch(f){console.error("[PDF\u5bfc\u51fa] \u5b57\u4f53\u52a0\u8f7d\u5f02\u5e38:",f),this.useChineseFont=!1,this.chineseFontName="helvetica",this.availableFontWeights=[]}this.pdf.setFont(this.chineseFontName),this.renderTitle(e),this.renderMetadata(e),this.currentY+=h.SECTION_SPACING;const E=t.length>1;let _=0;E&&(this.pdf.addPage(),_=this.pdf.internal.getCurrentPageInfo().pageNumber,this.currentY=h.MARGIN_TOP);for(let s=0;s<t.length;s++)E&&0===s&&(this.pdf.addPage(),this.currentY=h.MARGIN_TOP),this.renderMessage(t[s],s+1);E&&(console.log("[PDF\u5bfc\u51fa] \u751f\u6210\u76ee\u5f55..."),this.renderTOCWithLinks(_,t)),console.log("[PDF\u5bfc\u51fa] \u6dfb\u52a0PDF\u4e66\u7b7e..."),this.addBookmarks(),console.log("[PDF\u5bfc\u51fa] \u6dfb\u52a0\u9875\u811a..."),this.addFooters();const u=this.generateFileName(e);return this.pdf.save(u),console.log("[PDF\u5bfc\u51fa] \u5bfc\u51fa\u5b8c\u6210:",u),!0}renderTitle(t){this.pdf.setFontSize(h.FONT_SIZE_TITLE),this.pdf.setTextColor(...h.COLOR_TEXT);const e=t.name||"Conversation",n=this.cleanText(e),s=h.PAGE_WIDTH-h.MARGIN_LEFT-h.MARGIN_RIGHT;let i;try{i=this.pdf.splitTextToSize(n,s)}catch(r){console.error("[PDF\u5bfc\u51fa] \u6807\u9898\u5206\u5272\u5931\u8d25,\u4f7f\u7528\u539f\u59cb\u6807\u9898:",r),i=[n]}i.forEach(t=>{this.checkPageBreak(h.FONT_SIZE_TITLE);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,h.MARGIN_LEFT,this.currentY),this.currentY+=1.5*h.LINE_HEIGHT}),this.currentY+=h.SECTION_SPACING}renderMetadata(t){this.pdf.setFontSize(h.FONT_SIZE_TIMESTAMP),this.pdf.setTextColor(...h.COLOR_TIMESTAMP);const e=[];t.platform&&e.push("Platform: ".concat(t.platform)),t.created_at&&e.push("Created: ".concat(t.created_at)),t.updated_at&&e.push("Updated: ".concat(t.updated_at)),e.push("Exported: ".concat(r.Nq.formatDateTime(new Date))),e.forEach(t=>{this.checkPageBreak(h.FONT_SIZE_TIMESTAMP),this.pdf.text(t,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT})}renderTOCWithLinks(t,e){this.pdf.setPage(t),this.currentY=h.MARGIN_TOP,this.pdf.setFontSize(h.FONT_SIZE_H1),this.pdf.setTextColor(...h.COLOR_TEXT),this.pdf.text("Table of Contents",h.MARGIN_LEFT,this.currentY),this.currentY+=2*h.LINE_HEIGHT,this.pdf.setDrawColor(...h.COLOR_BORDER),this.pdf.setLineWidth(.3),this.pdf.line(h.MARGIN_LEFT,this.currentY,h.PAGE_WIDTH-h.MARGIN_RIGHT,this.currentY),this.currentY+=h.LINE_HEIGHT,this.pdf.setFontSize(h.FONT_SIZE_BODY);this.messageAnchors.forEach((t,n)=>{var s;const i=e[n];if(!i)return;this.checkPageBreak(2*h.FONT_SIZE_BODY);const r="".concat(t.index,"."),o="human"===t.sender?"Human":"Assistant";let a=t.title||"";a=this.cleanText(a),a=a.replace(/\n/g," ").substring(0,50),a.length>=50&&(a+="...");let c="";null!==(s=i.branchInfo)&&void 0!==s&&s.isBranchPoint&&(c=" [Branch ".concat(i.branchInfo.childCount,"]"));const l="".concat(r," ").concat(o).concat(c),d="p.".concat(t.page),T="human"===t.sender?h.COLOR_SENDER_HUMAN:h.COLOR_SENDER_ASSISTANT;this.pdf.setTextColor(...T);const p=this.pdf.getTextWidth(d),E=h.PAGE_WIDTH-h.MARGIN_RIGHT-p,_=this.currentY;this.pdf.textWithLink(l,h.MARGIN_LEFT+5,_,{pageNumber:t.page}),this.pdf.setTextColor(...h.COLOR_TIMESTAMP),this.pdf.textWithLink(d,E,_,{pageNumber:t.page}),a&&(this.pdf.setFontSize(h.FONT_SIZE_TIMESTAMP),this.pdf.setTextColor(...h.COLOR_TIMESTAMP),this.currentY+=h.LINE_HEIGHT,this.checkPageBreak(h.FONT_SIZE_TIMESTAMP),this.pdf.text(a,h.MARGIN_LEFT+10,this.currentY),this.pdf.setFontSize(h.FONT_SIZE_BODY)),this.currentY+=1.5*h.LINE_HEIGHT})}renderMessage(t,e){var n,s,i,r;this.checkPageBreak(h.FONT_SIZE_SENDER+h.MESSAGE_SPACING);const o=this.pdf.internal.getCurrentPageInfo().pageNumber,a=this.currentY;this.messageAnchors.push({index:e,page:o,y:a,sender:t.sender,title:t.display_text?t.display_text.substring(0,50):""}),this.renderSender(t,e),this.config.includeTimestamps&&t.timestamp&&this.renderTimestamp(t.timestamp),t.thinking&&this.config.includeThinking&&"human"!==t.sender&&this.renderThinking(t.thinking),t.display_text&&this.renderBody(t.display_text),(null===(n=t.attachments)||void 0===n?void 0:n.length)>0&&"human"===t.sender&&this.renderAttachments(t.attachments),(null===(s=t.artifacts)||void 0===s?void 0:s.length)>0&&this.config.includeArtifacts&&"human"!==t.sender&&t.artifacts.forEach(t=>{this.renderArtifact(t)}),(null===(i=t.tools)||void 0===i?void 0:i.length)>0&&this.config.includeTools&&t.tools.forEach(t=>{this.renderTool(t)}),(null===(r=t.citations)||void 0===r?void 0:r.length)>0&&this.config.includeCitations&&this.renderCitations(t.citations),this.currentY+=h.MESSAGE_SPACING}renderSender(t,e){var n;this.pdf.setFontSize(h.FONT_SIZE_SENDER);const s="human"===t.sender?h.COLOR_SENDER_HUMAN:h.COLOR_SENDER_ASSISTANT;this.pdf.setTextColor(...s);const i="human"===t.sender?"Human":"Assistant",r="".concat(e,". ").concat(i);let o=r;if(null!==(n=t.branchInfo)&&void 0!==n&&n.isBranchPoint){o=r+" [Branch ".concat(t.branchInfo.childCount,"]")}const a=this.cleanText(o);a&&a.trim().length>0&&this.pdf.text(a,h.MARGIN_LEFT,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT}renderTimestamp(t){this.pdf.setFontSize(h.FONT_SIZE_TIMESTAMP),this.pdf.setTextColor(...h.COLOR_TIMESTAMP),this.pdf.text(t,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT}renderBody(t){this.pdf.setFontSize(h.FONT_SIZE_BODY),this.pdf.setTextColor(...h.COLOR_TEXT);const e=h.PAGE_WIDTH-h.MARGIN_LEFT-h.MARGIN_RIGHT;this.parseTextWithCodeBlocksAndLatex(t).forEach(t=>{"code"===t.type?this.renderCodeBlock(t.content,t.language):"latex-block"===t.type?this.renderLatexBlock(t.content):"latex-inline"===t.type?this.renderLatexInline(t.content,e):this.renderMarkdownText(t.content,e)}),this.currentY+=h.LINE_HEIGHT}renderPlainText(t,e){if(!t||0===t.trim().length)return void(this.currentY+=h.LINE_HEIGHT);const n=this.cleanText(t);if(!n||0===n.trim().length)return console.warn("[PDF\u5bfc\u51fa] \u6587\u672c\u6e05\u7406\u540e\u4e3a\u7a7a\uff0c\u8df3\u8fc7"),void(this.currentY+=h.LINE_HEIGHT);let s;try{s=this.pdf.splitTextToSize(n,e)}catch(i){console.error("[PDF\u5bfc\u51fa] splitTextToSize\u5931\u8d25\uff0c\u4f7f\u7528\u7b80\u5355\u6362\u884c:",i),s=n.split("\n")}s.forEach(t=>{this.checkPageBreak(h.FONT_SIZE_BODY);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT})}renderCodeBlock(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.checkPageBreak(h.FONT_SIZE_CODE+2*h.SECTION_SPACING);const n=h.PAGE_WIDTH-h.MARGIN_LEFT-h.MARGIN_RIGHT,s=n-8-8,i=this.cleanText(t),r=this.cleanText(e);if(r){this.pdf.setFontSize(h.FONT_SIZE_TIMESTAMP),this.pdf.setTextColor(100,100,100);const t=r.toUpperCase(),e=this.pdf.getTextWidth(t)+4;this.pdf.setFillColor(220,220,220),this.pdf.roundedRect(h.MARGIN_LEFT,this.currentY-3,e,5,1,1,"F"),this.pdf.text(t,h.MARGIN_LEFT+2,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT}this.pdf.setFontSize(h.FONT_SIZE_CODE),this.pdf.setFont(this.chineseFontName);const o=i.split("\n"),a=[];o.forEach(t=>{if(!t)return void a.push({text:"",lineNumber:a.length+1});const e=this.cleanText(t);if(e)try{this.pdf.splitTextToSize(e,s).forEach((t,e)=>{a.push({text:t,lineNumber:0===e?a.length+1:null})})}catch(n){a.push({text:e,lineNumber:a.length+1})}else a.push({text:"",lineNumber:a.length+1})});const c=this.currentY,l=this.pdf.internal.getCurrentPageInfo().pageNumber;let d=!0;const T=Math.min(a.length*h.LINE_HEIGHT+6,h.PAGE_HEIGHT-h.MARGIN_BOTTOM-this.currentY);this.pdf.setFillColor(248,248,248),this.pdf.rect(h.MARGIN_LEFT,c-3,n,T,"F"),this.currentY=c,a.forEach((t,e)=>{let{text:s,lineNumber:i}=t;if(this.currentY+h.FONT_SIZE_CODE>h.PAGE_HEIGHT-h.MARGIN_BOTTOM){this.pdf.setDrawColor(200,200,200),this.pdf.setLineWidth(.3);const t=this.currentY;this.pdf.line(h.MARGIN_LEFT,c-3,h.MARGIN_LEFT,t),this.pdf.line(h.MARGIN_LEFT+n,c-3,h.MARGIN_LEFT+n,t),this.pdf.addPage(),this.currentY=h.MARGIN_TOP;const s=a.length-e,i=Math.min(s*h.LINE_HEIGHT+3,h.PAGE_HEIGHT-h.MARGIN_BOTTOM-this.currentY);this.pdf.setFillColor(248,248,248),this.pdf.rect(h.MARGIN_LEFT,this.currentY-3,n,i,"F"),d=!1}if(null!==i){this.pdf.setFontSize(h.FONT_SIZE_CODE-1),this.pdf.setTextColor(150,150,150);const t=String(i).padStart(3," ");this.pdf.text(t,h.MARGIN_LEFT+1,this.currentY)}this.pdf.setFontSize(h.FONT_SIZE_CODE),this.pdf.setTextColor(50,50,50);const r=this.cleanText(s);null!==r&&void 0!==r&&this.pdf.text(r,h.MARGIN_LEFT+8+2,this.currentY),this.currentY+=h.LINE_HEIGHT});const p=this.pdf.internal.getCurrentPageInfo().pageNumber;for(let E=l;E<=p;E++){this.pdf.setPage(E);const t=E===l,e=E===p;let s,i;t&&e?(s=c-3,i=this.currentY+3):t?(s=c-3,i=h.PAGE_HEIGHT-h.MARGIN_BOTTOM):e?(s=h.MARGIN_TOP-3,i=this.currentY+3):(s=h.MARGIN_TOP-3,i=h.PAGE_HEIGHT-h.MARGIN_BOTTOM),this.pdf.setDrawColor(200,200,200),this.pdf.setLineWidth(.3),t&&e?this.pdf.roundedRect(h.MARGIN_LEFT,s,n,i-s,1.5,1.5,"S"):(this.pdf.line(h.MARGIN_LEFT,s,h.MARGIN_LEFT,i),this.pdf.line(h.MARGIN_LEFT+n,s,h.MARGIN_LEFT+n,i),t&&this.pdf.line(h.MARGIN_LEFT,s,h.MARGIN_LEFT+n,s),e&&this.pdf.line(h.MARGIN_LEFT,i,h.MARGIN_LEFT+n,i)),this.pdf.setDrawColor(220,220,220),this.pdf.setLineWidth(.2),this.pdf.line(h.MARGIN_LEFT+8,s,h.MARGIN_LEFT+8,i)}this.pdf.setPage(p),this.pdf.setFont(this.chineseFontName),this.pdf.setTextColor(...h.COLOR_TEXT),this.currentY+=h.SECTION_SPACING}groupCodeLinesByPage(t){const e=[];let n=null;const s=h.PAGE_HEIGHT-h.MARGIN_BOTTOM;let i=this.currentY,r=this.pdf.internal.getCurrentPageInfo().pageNumber;return t.forEach(t=>{i+h.FONT_SIZE_CODE>s&&(r++,i=h.MARGIN_TOP,n=null),n&&n.page===r||(n={page:r,startY:i,lines:[]},e.push(n)),n.lines.push(t),i+=h.LINE_HEIGHT}),e}renderLatexBlock(t){this.checkPageBreak(h.FONT_SIZE_BODY+2*h.SECTION_SPACING);const e=h.PAGE_WIDTH-h.MARGIN_LEFT-h.MARGIN_RIGHT,n=this.cleanText(t),s=this.convertLatexToUnicode(n);this.pdf.setFontSize(h.FONT_SIZE_TIMESTAMP),this.pdf.setTextColor(70,130,180);const i="MATH",r=this.pdf.getTextWidth(i)+4;let o;this.pdf.setFillColor(230,240,250),this.pdf.roundedRect(h.MARGIN_LEFT,this.currentY-3,r,5,1,1,"F"),this.pdf.text(i,h.MARGIN_LEFT+2,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT,this.pdf.setFontSize(h.FONT_SIZE_BODY),this.pdf.setFont(this.chineseFontName);try{o=this.pdf.splitTextToSize(s,e-8)}catch(T){o=s.split("\n")}const a=this.currentY,c=this.pdf.internal.getCurrentPageInfo().pageNumber,l=Math.min(o.length*h.LINE_HEIGHT+6,h.PAGE_HEIGHT-h.MARGIN_BOTTOM-this.currentY);this.pdf.setFillColor(245,250,255),this.pdf.rect(h.MARGIN_LEFT,a-3,e,l,"F"),this.currentY=a,o.forEach((t,n)=>{if(this.currentY+h.FONT_SIZE_BODY>h.PAGE_HEIGHT-h.MARGIN_BOTTOM){this.pdf.addPage(),this.currentY=h.MARGIN_TOP;const t=o.length-n,s=Math.min(t*h.LINE_HEIGHT+3,h.PAGE_HEIGHT-h.MARGIN_BOTTOM-this.currentY);this.pdf.setFillColor(245,250,255),this.pdf.rect(h.MARGIN_LEFT,this.currentY-3,e,s,"F")}this.pdf.setTextColor(30,60,120);const s=this.cleanText(t);s&&s.trim().length>0&&this.pdf.text(s,h.MARGIN_LEFT+4,this.currentY),this.currentY+=h.LINE_HEIGHT});const d=this.pdf.internal.getCurrentPageInfo().pageNumber;for(let p=c;p<=d;p++){this.pdf.setPage(p);const t=p===c,n=p===d;let s,i;t&&n?(s=a-3,i=this.currentY+3):t?(s=a-3,i=h.PAGE_HEIGHT-h.MARGIN_BOTTOM):n?(s=h.MARGIN_TOP-3,i=this.currentY+3):(s=h.MARGIN_TOP-3,i=h.PAGE_HEIGHT-h.MARGIN_BOTTOM),this.pdf.setDrawColor(180,210,240),this.pdf.setLineWidth(.4),t&&n?this.pdf.roundedRect(h.MARGIN_LEFT,s,e,i-s,1.5,1.5,"S"):(this.pdf.line(h.MARGIN_LEFT,s,h.MARGIN_LEFT,i),this.pdf.line(h.MARGIN_LEFT+e,s,h.MARGIN_LEFT+e,i),t&&this.pdf.line(h.MARGIN_LEFT,s,h.MARGIN_LEFT+e,s),n&&this.pdf.line(h.MARGIN_LEFT,i,h.MARGIN_LEFT+e,i))}this.pdf.setPage(d),this.pdf.setTextColor(...h.COLOR_TEXT),this.currentY+=h.SECTION_SPACING}groupLatexLinesByPage(t){const e=[];let n=null;const s=h.PAGE_HEIGHT-h.MARGIN_BOTTOM;let i=this.currentY,r=this.pdf.internal.getCurrentPageInfo().pageNumber;return t.forEach(t=>{i+h.FONT_SIZE_BODY>s&&(r++,i=h.MARGIN_TOP,n=null),n&&n.page===r||(n={page:r,startY:i,lines:[]},e.push(n)),n.lines.push(t),i+=h.LINE_HEIGHT}),e}renderLatexInline(t,e){const n=this.cleanText(t),s=this.convertLatexToUnicode(n);this.pdf.setFontSize(h.FONT_SIZE_BODY);const i="\u27e8".concat(s,"\u27e9");this.pdf.setTextColor(70,130,180);try{this.pdf.splitTextToSize(i,e).forEach(t=>{this.checkPageBreak(h.FONT_SIZE_BODY);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT})}catch(r){this.pdf.text(i,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT}this.pdf.setTextColor(...h.COLOR_TEXT)}renderThinking(t){this.renderSection("\ud83d\udcad Thinking",t,h.COLOR_SECTION_BG)}renderArtifact(t){const e="\ud83d\udcc4 Artifact: ".concat(t.title||"Untitled"),n=t.content||"";this.renderSection(e,n,h.COLOR_SECTION_BG)}renderTool(t){const e="\ud83d\udd27 Tool: ".concat(t.name||"Unknown"),n="Input: ".concat(JSON.stringify(t.input,null,2),"\n\nOutput: ").concat(t.output||"N/A");this.renderSection(e,n,h.COLOR_SECTION_BG)}renderCitations(t){const e=t.map((t,e)=>"[".concat(e+1,"] ").concat(t.title||t.url||"Unknown")).join("\n");this.renderSection("\ud83d\udcda Citations",e,h.COLOR_SECTION_BG)}renderAttachments(t){const e=t.map((t,e)=>"[".concat(e+1,"] ").concat(t.file_name||t.name||"file"," (").concat(t.file_type||t.type||"unknown",")")).join("\n");this.renderSection("\ud83d\udcce Attachments",e,h.COLOR_SECTION_BG)}renderSection(t,e,n){this.checkPageBreak(h.FONT_SIZE_H2+2*h.SECTION_SPACING);const s=h.PAGE_WIDTH-h.MARGIN_LEFT-h.MARGIN_RIGHT,i=this.cleanText(t),r=this.cleanText(e);let o;try{o=this.pdf.splitTextToSize(r,s-4)}catch(c){console.error("[PDF\u5bfc\u51fa] \u533a\u5757\u5185\u5bb9\u5206\u5272\u5931\u8d25:",c),o=r.split("\n")}const a=h.LINE_HEIGHT*(o.length+2);this.pdf.setFillColor(...n),this.pdf.rect(h.MARGIN_LEFT,this.currentY-3,s,a,"F"),this.pdf.setFontSize(h.FONT_SIZE_H2),this.pdf.setTextColor(...h.COLOR_TEXT),i&&i.trim().length>0&&this.pdf.text(i,h.MARGIN_LEFT+2,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT,this.pdf.setFontSize(h.FONT_SIZE_BODY),o.forEach(t=>{this.checkPageBreak(h.FONT_SIZE_BODY);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,h.MARGIN_LEFT+2,this.currentY),this.currentY+=h.LINE_HEIGHT}),this.currentY+=h.SECTION_SPACING}renderFooter(t,e){const n=this.currentY,s=this.pdf.internal.getFontSize();this.pdf.setFontSize(h.FONT_SIZE_FOOTER),this.pdf.setTextColor(...h.COLOR_FOOTER);const i=h.PAGE_HEIGHT-10;this.pdf.setDrawColor(...h.COLOR_BORDER),this.pdf.setLineWidth(.1),this.pdf.line(h.MARGIN_LEFT,h.PAGE_HEIGHT-h.FOOTER_HEIGHT,h.PAGE_WIDTH-h.MARGIN_RIGHT,h.PAGE_HEIGHT-h.FOOTER_HEIGHT);const r="Exported: ".concat(this.exportDate);this.pdf.text(r,h.MARGIN_LEFT,i);const o="".concat(t," / ").concat(e),a=this.pdf.getTextWidth(o);this.pdf.text(o,h.PAGE_WIDTH-h.MARGIN_RIGHT-a,i),this.pdf.setFontSize(s),this.pdf.setTextColor(...h.COLOR_TEXT),this.currentY=n}addBookmarks(){if(0!==this.messageAnchors.length)try{this.messageAnchors.forEach(t=>{const e="human"===t.sender?"Human":"Assistant",n="".concat(t.index,". ").concat(e);this.pdf.outline&&this.pdf.outline.add(null,n,{pageNumber:t.page})})}catch(t){console.warn("[PDF\u5bfc\u51fa] \u4e66\u7b7e\u6dfb\u52a0\u5931\u8d25\uff08\u53ef\u80fd\u4e0d\u652f\u6301\uff09:",t)}}addFooters(){const t=this.pdf.internal.getNumberOfPages();for(let e=1;e<=t;e++)this.pdf.setPage(e),this.renderFooter(e,t)}checkPageBreak(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;const e=h.PAGE_HEIGHT-h.MARGIN_BOTTOM;this.currentY+t>e&&(this.pdf.addPage(),this.currentY=h.MARGIN_TOP)}parseTextWithCodeBlocksAndLatex(t){const e=[],n=[],s=/```(\w*)\n([\s\S]*?)```/g;let i,r=0;for(;null!==(i=s.exec(t));)n.push({start:i.index,end:i.index+i[0].length,type:"code",language:i[1]||"",content:i[2]});const o=/\$\$([\s\S]*?)\$\$/g;for(;null!==(i=o.exec(t));){n.some(t=>i.index>=t.start&&i.index<t.end||i.index+i[0].length>t.start&&i.index+i[0].length<=t.end)||n.push({start:i.index,end:i.index+i[0].length,type:"latex-block",content:i[1].trim()})}const h=/(?<!\$)\$(?!\$)((?:\\.|[^$\\])+?)\$(?!\$)/g;for(;null!==(i=h.exec(t));){n.some(t=>i.index>=t.start&&i.index<t.end||i.index+i[0].length>t.start&&i.index+i[0].length<=t.end)||n.push({start:i.index,end:i.index+i[0].length,type:"latex-inline",content:i[1].trim()})}if(n.sort((t,e)=>t.start-e.start),r=0,n.forEach(n=>{if(n.start>r){const s=t.substring(r,n.start);s.trim()&&e.push({type:"text",content:s})}e.push(n),r=n.end}),r<t.length){const n=t.substring(r);n.trim()&&e.push({type:"text",content:n})}return 0===e.length&&e.push({type:"text",content:t}),e}parseTextWithCodeBlocks(t){return this.parseTextWithCodeBlocksAndLatex(t)}renderMarkdownText(t,e){if(!t||0===t.trim().length)return void(this.currentY+=h.LINE_HEIGHT);const n=this.cleanText(t);if(!n||0===n.trim().length)return void(this.currentY+=h.LINE_HEIGHT);n.split("\n").forEach(t=>{this.checkPageBreak(h.FONT_SIZE_BODY),""===t.trim()?this.currentY+=h.LINE_HEIGHT:t.match(/^#{1,6}\s/)?this.renderMarkdownHeading(t,e):t.match(/^>\s/)?this.renderMarkdownQuote(t,e):t.match(/^[-*+]\s/)||t.match(/^\d+\.\s/)?this.renderMarkdownList(t,e):this.renderMarkdownInlineFormats(t,e)})}renderMarkdownHeading(t,e){const n=t.match(/^(#{1,6})\s+(.+)$/);if(!n)return void this.renderPlainText(t,e);const s=n[1].length,i=n[2],r=h.FONT_SIZE_BODY+2*(7-s),o=this.pdf.internal.getFontSize();this.pdf.setFontSize(r),this.safeSetFont(this.chineseFontName,"bold");try{this.pdf.splitTextToSize(i,e).forEach(t=>{this.checkPageBreak(r);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,h.MARGIN_LEFT,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT})}catch(a){console.error("[PDF\u5bfc\u51fa] \u6807\u9898\u6e32\u67d3\u5931\u8d25:",a),this.pdf.text(i,h.MARGIN_LEFT,this.currentY),this.currentY+=1.2*h.LINE_HEIGHT}this.pdf.setFontSize(o),this.safeSetFont(this.chineseFontName,"normal"),this.currentY+=.5*h.LINE_HEIGHT}renderMarkdownQuote(t,e){const n=t.replace(/^>\s*/,""),s=e-8,i=h.MARGIN_LEFT+6;this.pdf.setDrawColor(150,150,150),this.pdf.setLineWidth(.5);const r=this.currentY-2;this.pdf.setFontSize(h.FONT_SIZE_BODY),this.pdf.setTextColor(100,100,100);try{this.pdf.splitTextToSize(n,s).forEach(t=>{this.checkPageBreak(h.FONT_SIZE_BODY);const e=this.cleanText(t);e&&e.trim().length>0&&this.pdf.text(e,i,this.currentY),this.currentY+=h.LINE_HEIGHT}),this.pdf.line(h.MARGIN_LEFT+2,r,h.MARGIN_LEFT+2,this.currentY-2)}catch(o){console.error("[PDF\u5bfc\u51fa] \u5f15\u7528\u6e32\u67d3\u5931\u8d25:",o),this.pdf.text(n,i,this.currentY),this.currentY+=h.LINE_HEIGHT}this.pdf.setTextColor(...h.COLOR_TEXT)}renderMarkdownList(t,e){let n="",s="";const i=t.match(/^([-*+])\s+(.+)$/),r=t.match(/^(\d+)\.\s+(.+)$/);if(i)n="\u2022",s=i[2];else{if(!r)return void this.renderPlainText(t,e);n=r[1]+".",s=r[2]}const o=this.pdf.getTextWidth(n+"  "),a=e-o,c=h.MARGIN_LEFT+o;this.pdf.setFontSize(h.FONT_SIZE_BODY),this.pdf.text(n,h.MARGIN_LEFT+2,this.currentY);try{this.pdf.splitTextToSize(s,a).forEach((t,e)=>{e>0&&this.checkPageBreak(h.FONT_SIZE_BODY);const n=this.cleanText(t);n&&n.trim().length>0&&this.pdf.text(n,c,this.currentY),this.currentY+=h.LINE_HEIGHT})}catch(l){console.error("[PDF\u5bfc\u51fa] \u5217\u8868\u6e32\u67d3\u5931\u8d25:",l),this.pdf.text(s,c,this.currentY),this.currentY+=h.LINE_HEIGHT}}renderMarkdownInlineFormats(t,e){if(!t||0===t.trim().length)return void(this.currentY+=h.LINE_HEIGHT);const n=this.parseInlineMarkdown(t);this.renderInlineSegments(n,e)}parseInlineMarkdown(t){const e=[],n=[];[{type:"code",regex:/`([^`]+)`/g},{type:"bold-italic",regex:/\*\*\*([^*]+?)\*\*\*/g},{type:"bold-italic",regex:/___([^_]+?)___/g},{type:"bold",regex:/\*\*([^*]+?)\*\*/g},{type:"bold",regex:/__([^_]+?)__/g},{type:"italic",regex:/\*([^*]+?)\*/g},{type:"italic",regex:/_([^_]+?)_/g},{type:"link",regex:/\[([^\]]+)\]\(([^)]+)\)/g}].forEach(e=>{let s;const i=new RegExp(e.regex.source,"g");for(;null!==(s=i.exec(t));)n.push({type:e.type,start:s.index,end:i.lastIndex,text:s[1],url:s[2],fullMatch:s[0]})}),n.sort((t,e)=>t.start!==e.start?t.start-e.start:e.end-e.start-(t.end-t.start));const s=[];n.forEach(t=>{s.some(e=>t.start>=e.start&&t.start<e.end||t.end>e.start&&t.end<=e.end||t.start<=e.start&&t.end>=e.end)||s.push(t)});let i=0;if(s.forEach(n=>{if(n.start>i){const s=t.substring(i,n.start);s&&e.push({type:"normal",text:s})}e.push({type:n.type,text:n.text,url:n.url}),i=n.end}),i<t.length){const n=t.substring(i);n&&e.push({type:"normal",text:n})}return 0===e.length&&e.push({type:"normal",text:t}),e}renderInlineSegments(t,e){let n=h.MARGIN_LEFT,i=[];const r=h.PAGE_WIDTH-h.MARGIN_RIGHT;t.forEach((t,e)=>{const o=this.cleanText(t.text||"");if(!o)return;this.applySegmentStyle(t.type);const a=this.pdf.getTextWidth(o);if(a>r-n){i.length>0&&(this.renderSegmentLine(i),this.currentY+=h.LINE_HEIGHT,this.checkPageBreak(h.FONT_SIZE_BODY),n=h.MARGIN_LEFT,i=[]);const e=r-h.MARGIN_LEFT;if(a>e)try{return this.pdf.splitTextToSize(o,e).forEach((e,n)=>{const s=this.cleanText(e);if(s){if(this.checkPageBreak(h.FONT_SIZE_BODY),this.applySegmentStyle(t.type),"code"===t.type){const t=this.pdf.getTextWidth(s),e=1;this.pdf.setFillColor(245,245,245),this.pdf.rect(h.MARGIN_LEFT-e,this.currentY-3,t+2*e,4,"F"),this.pdf.setTextColor(220,50,50)}this.pdf.text(s,h.MARGIN_LEFT,this.currentY),this.currentY+=h.LINE_HEIGHT}}),void(n=h.MARGIN_LEFT)}catch(c){console.error("[PDF\u5bfc\u51fa] \u6587\u672c\u62c6\u5206\u5931\u8d25:",c)}}n+a>r&&i.length>0&&(this.renderSegmentLine(i),this.currentY+=h.LINE_HEIGHT,this.checkPageBreak(h.FONT_SIZE_BODY),n=h.MARGIN_LEFT,i=[]),i.push((0,s.A)((0,s.A)({},t),{},{x:n,text:o})),n+=a}),i.length>0&&(this.renderSegmentLine(i),this.currentY+=h.LINE_HEIGHT),this.pdf.setFont(this.chineseFontName,"normal"),this.pdf.setTextColor(...h.COLOR_TEXT)}renderSegmentLine(t){t.forEach(t=>{if(this.applySegmentStyle(t.type),"link"===t.type){this.pdf.textWithLink(t.text,t.x,this.currentY,{url:t.url||"#"});const e=this.pdf.getTextWidth(t.text);this.pdf.line(t.x,this.currentY+.5,t.x+e,this.currentY+.5)}else if("code"===t.type){const e=this.pdf.getTextWidth(t.text),n=1;this.pdf.setFillColor(245,245,245),this.pdf.rect(t.x-n,this.currentY-3,e+2*n,4,"F"),this.pdf.setTextColor(220,50,50),this.pdf.text(t.text,t.x,this.currentY)}else this.pdf.text(t.text,t.x,this.currentY)})}applySegmentStyle(t){switch(this.pdf.setFontSize(h.FONT_SIZE_BODY),this.pdf.setTextColor(...h.COLOR_TEXT),t){case"bold":this.safeSetFont(this.chineseFontName,"bold");break;case"italic":this.safeSetFont(this.chineseFontName,"italic")||this.pdf.setTextColor(70,130,180);break;case"bold-italic":this.safeSetFont(this.chineseFontName,"bolditalic")||(this.safeSetFont(this.chineseFontName,"bold"),this.pdf.setTextColor(70,130,180));break;case"code":this.pdf.setFont("courier","normal"),this.pdf.setFontSize(h.FONT_SIZE_CODE),this.pdf.setTextColor(220,50,50);break;case"link":this.safeSetFont(this.chineseFontName,"normal"),this.pdf.setTextColor(0,102,204);break;default:this.safeSetFont(this.chineseFontName,"normal")}}convertLatexToUnicode(t){if(!t)return"";let e=t;const n={"\\alpha":"\u03b1","\\Alpha":"\u0391","\\beta":"\u03b2","\\Beta":"\u0392","\\gamma":"\u03b3","\\Gamma":"\u0393","\\delta":"\u03b4","\\Delta":"\u0394","\\epsilon":"\u03b5","\\Epsilon":"\u0395","\\varepsilon":"\u03b5","\\zeta":"\u03b6","\\Zeta":"\u0396","\\eta":"\u03b7","\\Eta":"\u0397","\\theta":"\u03b8","\\Theta":"\u0398","\\vartheta":"\u03d1","\\iota":"\u03b9","\\Iota":"\u0399","\\kappa":"\u03ba","\\Kappa":"\u039a","\\lambda":"\u03bb","\\Lambda":"\u039b","\\mu":"\u03bc","\\Mu":"\u039c","\\nu":"\u03bd","\\Nu":"\u039d","\\xi":"\u03be","\\Xi":"\u039e","\\omicron":"\u03bf","\\Omicron":"\u039f","\\pi":"\u03c0","\\Pi":"\u03a0","\\rho":"\u03c1","\\Rho":"\u03a1","\\sigma":"\u03c3","\\Sigma":"\u03a3","\\tau":"\u03c4","\\Tau":"\u03a4","\\upsilon":"\u03c5","\\Upsilon":"\u03a5","\\phi":"\u03c6","\\Phi":"\u03a6","\\varphi":"\u03d5","\\chi":"\u03c7","\\Chi":"\u03a7","\\psi":"\u03c8","\\Psi":"\u03a8","\\omega":"\u03c9","\\Omega":"\u03a9"},s={"\\leq":"\u2264","\\le":"\u2264","\\geq":"\u2265","\\ge":"\u2265","\\neq":"\u2260","\\ne":"\u2260","\\approx":"\u2248","\\equiv":"\u2261","\\sim":"\u223c","\\simeq":"\u2243","\\cong":"\u2245","\\propto":"\u221d","\\ll":"\u226a","\\gg":"\u226b","\\subset":"\u2282","\\supset":"\u2283","\\subseteq":"\u2286","\\supseteq":"\u2287","\\in":"\u2208","\\notin":"\u2209","\\ni":"\u220b","\\emptyset":"\u2205","\\rightarrow":"\u2192","\\to":"\u2192","\\leftarrow":"\u2190","\\leftrightarrow":"\u2194","\\Rightarrow":"\u21d2","\\Leftarrow":"\u21d0","\\Leftrightarrow":"\u21d4","\\uparrow":"\u2191","\\downarrow":"\u2193","\\mapsto":"\u21a6","\\times":"\xd7","\\div":"\xf7","\\pm":"\xb1","\\mp":"\u2213","\\cdot":"\xb7","\\ast":"\u2217","\\star":"\u22c6","\\circ":"\u2218","\\bullet":"\u2022","\\oplus":"\u2295","\\ominus":"\u2296","\\otimes":"\u2297","\\odot":"\u2299","\\oslash":"\u2298","\\cup":"\u222a","\\cap":"\u2229","\\vee":"\u2228","\\wedge":"\u2227","\\partial":"\u2202","\\nabla":"\u2207","\\infty":"\u221e","\\int":"\u222b","\\iint":"\u222c","\\iiint":"\u222d","\\oint":"\u222e","\\sum":"\u2211","\\prod":"\u220f","\\coprod":"\u2210","\\forall":"\u2200","\\exists":"\u2203","\\nexists":"\u2204","\\neg":"\xac","\\lnot":"\xac","\\land":"\u2227","\\lor":"\u2228","\\implies":"\u21d2","\\iff":"\u21d4","\\angle":"\u2220","\\degree":"\xb0","\\prime":"\u2032","\\dprime":"\u2033","\\infty":"\u221e","\\aleph":"\u2135","\\hbar":"\u210f","\\ell":"\u2113","\\wp":"\u2118","\\Re":"\u211c","\\Im":"\u2111","\\bot":"\u22a5","\\top":"\u22a4","\\perp":"\u22a5","\\parallel":"\u2225","\\triangle":"\u25b3","\\square":"\u25a1","\\checkmark":"\u2713","\\dots":"\u2026","\\ldots":"\u2026","\\cdots":"\u22ef","\\vdots":"\u22ee","\\ddots":"\u22f1","\\langle":"\u27e8","\\rangle":"\u27e9","\\lfloor":"\u230a","\\rfloor":"\u230b","\\lceil":"\u2308","\\rceil":"\u2309"};return e=e.replace(/\^{([^}]+)}/g,"^($1)"),e=e.replace(/_{([^}]+)}/g,"_($1)"),e=e.replace(/\\frac{([^}]+)}{([^}]+)}/g,"($1)/($2)"),e=e.replace(/\\sqrt{([^}]+)}/g,"\u221a($1)"),e=e.replace(/\\sqrt\[(\d+)\]{([^}]+)}/g,"[$1]\u221a($2)"),Object.keys(n).forEach(t=>{const s=new RegExp(t.replace(/\\/g,"\\\\"),"g");e=e.replace(s,n[t])}),Object.keys(s).forEach(t=>{const n=new RegExp(t.replace(/\\/g,"\\\\"),"g");e=e.replace(n,s[t])}),e=e.replace(/\\text{([^}]+)}/g,"$1"),e=e.replace(/\\mathrm{([^}]+)}/g,"$1"),e=e.replace(/\\mathbf{([^}]+)}/g,"$1"),e=e.replace(/\\mathit{([^}]+)}/g,"$1"),e=e.replace(/\\mathcal{([^}]+)}/g,"$1"),e=e.replace(/\\mathbb{([^}]+)}/g,"$1"),e=e.replace(/\\\\(?:\[[^\]]*\])?/g,"\n"),e=e.replace(/&/g," "),e=e.replace(/\\,/g," "),e=e.replace(/\\;/g," "),e=e.replace(/\\quad/g,"  "),e=e.replace(/\\qquad/g,"    "),e=e.replace(/\\ /g," "),e=e.replace(/{([^{}]+)}/g,"$1"),e=e.replace(/\s+/g," ").trim(),e}generateFileName(t){const e=r.Nq.getCurrentDate(),n=(t.name||"conversation").replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"_");return"".concat(n,"_").concat(e,".pdf")}getPlatformPrefix(t){const e=(t||"").toLowerCase();return e.includes("chatgpt")?"chatgpt":e.includes("gemini")?"gemini":e.includes("notebooklm")?"notebooklm":e.includes("aistudio")?"aistudio":e.includes("sillytavern")?"sillytavern":"claude"}}new a}}]);
//# sourceMappingURL=991.d337f0a2.chunk.js.map