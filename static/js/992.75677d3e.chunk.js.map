{"version":3,"file":"static/js/992.75677d3e.chunk.js","mappings":"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","sources":["utils/export/pdfTextHelpers.js","utils/export/pdfLatexRenderer.js","utils/export/pdfContentRenderers.js","utils/export/pdfExportManager.js"],"sourcesContent":["// utils/export/pdfTextHelpers.js\n// PDF文本处理辅助函数 - 纯函数模块，处理文本清理、解析和格式化\n\n/**\n * 清理和标准化文本，防止编码问题\n * @param {string} text - 原始文本\n * @returns {string} - 清理后的文本\n */\nexport function cleanText(text) {\n  if (!text || typeof text !== 'string') {\n    return '';\n  }\n\n  try {\n    // 1. Unicode 标准化（NFC 模式）\n    let cleaned = text.normalize('NFC');\n\n    // 2. 移除控制字符和不可打印字符（保留换行符和制表符）\n    cleaned = cleaned.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F]/g, '');\n\n    // 3. 处理常见的Latin连字（ligatures），将其转换回普通字符组合\n    const ligatureMap = {\n      '\\uFB00': 'ff',    // ﬀ\n      '\\uFB01': 'fi',    // ﬁ\n      '\\uFB02': 'fl',    // ﬂ\n      '\\uFB03': 'ffi',   // ﬃ\n      '\\uFB04': 'ffl',   // ﬄ\n      '\\uFB05': 'st',    // ﬅ\n      '\\uFB06': 'st',    // ﬆ\n      '\\u00C6': 'AE',    // Æ\n      '\\u00E6': 'ae',    // æ\n      '\\u0152': 'OE',    // Œ\n      '\\u0153': 'oe',    // œ\n      '\\u00DF': 'ss',    // ß\n      '\\u1E9E': 'SS',    // ẞ\n    };\n\n    // 批量替换连字\n    for (const [ligature, replacement] of Object.entries(ligatureMap)) {\n      cleaned = cleaned.replace(new RegExp(ligature, 'g'), replacement);\n    }\n\n    // 4. 处理特殊Unicode字符（可能导致jsPDF问题）\n    // 移除零宽字符\n    cleaned = cleaned.replace(/[\\u200B-\\u200F\\u2060\\uFEFF]/g, '');\n\n    // 6. 标准化引号和标点符号（修复乱码问题）\n    // 将各种引号统一为标准ASCII引号或中文引号\n    const quoteMap = {\n      // 英文引号标准化\n      '\\u201C': '\"',  // \" (左双引号) -> \"\n      '\\u201D': '\"',  // \" (右双引号) -> \"\n      '\\u2018': \"'\",  // ' (左单引号) -> '\n      '\\u2019': \"'\",  // ' (右单引号) -> '\n      '\\u2033': '\"',  // ″ (双撇号) -> \"\n      '\\u2032': \"'\",  // ′ (单撇号) -> '\n\n      // 其他标点标准化\n      '\\u2014': '--', // — (em dash) -> --\n      '\\u2013': '-',  // – (en dash) -> -\n      '\\u2026': '...', // … (省略号) -> ...\n      '\\u2022': '·',  // • (项目符号) -> ·\n      '\\u00B7': '·',  // · (中点)\n\n      // 星号标准化\n      '\\u2217': '*',  // ∗ (星号运算符) -> *\n      '\\u2731': '*',  // ✱ (粗星号) -> *\n      '\\u2732': '*',  // ✲ (开放中心星号) -> *\n      '\\u2605': '*',  // ★ (黑色星号) -> *\n      '\\u2606': '*',  // ☆ (白色星号) -> *\n\n      // 加号标准化\n      '\\u2795': '+',  // ➕ (粗加号) -> +\n      '\\uFF0B': '+',  // ＋ (全角加号) -> +\n    };\n\n    // 批量替换\n    for (const [from, to] of Object.entries(quoteMap)) {\n      cleaned = cleaned.replace(new RegExp(from, 'g'), to);\n    }\n\n    // 7. 处理全角字符转半角（可选，根据需要）\n    // 全角数字和字母转半角\n    cleaned = cleaned.replace(/[\\uFF10-\\uFF19]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF21-\\uFF3A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF41-\\uFF5A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n\n    // 全角空格转半角\n    cleaned = cleaned.replace(/\\u3000/g, ' ');\n\n    return cleaned;\n  } catch (error) {\n    console.error('[PDF导出] 文本清理失败:', error);\n    // 如果清理失败，返回简化处理的文本\n    return text.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\n  }\n}\n\n/**\n * 解析文本中的代码块和LaTeX块\n */\nexport function parseTextWithCodeBlocksAndLatex(text) {\n  const parts = [];\n  const elements = [];\n\n  // 提取所有代码块（允许语言标识符后有空格）\n  const codeBlockRegex = /```([^\\n]*?)\\s*\\n([\\s\\S]*?)```/g;\n  let match;\n  let lastIndex = 0;\n\n  while ((match = codeBlockRegex.exec(text)) !== null) {\n    const language = (match[1] || '').trim().toLowerCase(); // 清理并转小写\n    const content = match[2];\n\n    // 检测是否为LaTeX代码块\n    if (language === 'latex' || language === 'math') {\n      console.log('[解析] 检测到LaTeX代码块:', language);\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'latex-display',\n        content: content.trim()\n      });\n    } else {\n      // 普通代码块\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'code',\n        language: language,\n        content: content\n      });\n    }\n  }\n\n  // 提取LaTeX display math块 ($$...$$)\n  const latexDisplayRegex = /\\$\\$\\n?([\\s\\S]*?)\\n?\\$\\$/g;\n  while ((match = latexDisplayRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // 提取LaTeX display math块 (\\[...\\])\n  const latexBracketRegex = /\\\\\\[([\\s\\S]*?)\\\\\\]/g;\n  while ((match = latexBracketRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // 按位置排序所有元素\n  elements.sort((a, b) => a.start - b.start);\n\n  // 移除重叠的元素（保留先出现的）\n  const filteredElements = [];\n  elements.forEach(element => {\n    const overlaps = filteredElements.some(existing =>\n      (element.start >= existing.start && element.start < existing.end) ||\n      (element.end > existing.start && element.end <= existing.end) ||\n      (element.start <= existing.start && element.end >= existing.end)\n    );\n    if (!overlaps) {\n      filteredElements.push(element);\n    }\n  });\n\n  // 构建最终的parts数组\n  lastIndex = 0;\n  filteredElements.forEach(element => {\n    // 添加元素前的文本\n    if (element.start > lastIndex) {\n      const plainText = text.substring(lastIndex, element.start);\n      if (plainText.trim()) {\n        parts.push({ type: 'text', content: plainText });\n      }\n    }\n\n    // 添加元素本身\n    parts.push(element);\n    lastIndex = element.end;\n  });\n\n  // 添加最后的文本\n  if (lastIndex < text.length) {\n    const plainText = text.substring(lastIndex);\n    if (plainText.trim()) {\n      parts.push({ type: 'text', content: plainText });\n    }\n  }\n\n  // 如果没有特殊元素,返回整个文本\n  if (parts.length === 0) {\n    parts.push({ type: 'text', content: text });\n  }\n\n  return parts;\n}\n\n/**\n * 解析行内markdown格式和LaTeX\n * 返回格式化的文本片段数组\n */\nexport function parseInlineMarkdown(text) {\n  const segments = [];\n\n  // 正则表达式模式（按优先级）\n  // CRITICAL: LaTeX patterns MUST come first to protect LaTeX syntax from Markdown parsing\n  const patterns = [\n    { type: 'latex-inline', regex: /\\$([^\\$\\n]+?)\\$/g },  // LaTeX inline math $...$\n    { type: 'latex-inline', regex: /\\\\\\(([^)]*?)\\\\\\)/g }, // LaTeX inline math \\(...\\)\n    { type: 'code', regex: /`([^`]+)`/g },              // 行内代码\n    { type: 'bold-italic', regex: /\\*\\*\\*(.+?)\\*\\*\\*/g }, // 粗斜体\n    { type: 'bold-italic', regex: /___(.+?)___/g },     // 粗斜体\n    { type: 'bold', regex: /\\*\\*([^*]+?)\\*\\*/g },       // 粗体（改进：不匹配*字符）\n    { type: 'bold', regex: /__([^_]+?)__/g },           // 粗体（改进：不匹配_字符）\n    { type: 'italic', regex: /\\*([^*]+?)\\*/g },         // 斜体（改进：不匹配*字符）\n    { type: 'italic', regex: /_([^_]+?)_/g },           // 斜体（改进：不匹配_字符）\n    { type: 'link', regex: /\\[([^\\]]+)\\]\\(([^)]+)\\)/g } // 链接\n  ];\n\n  // 查找所有匹配\n  const matches = [];\n  patterns.forEach(pattern => {\n    let match;\n    const regex = new RegExp(pattern.regex.source, 'g');\n    while ((match = regex.exec(text)) !== null) {\n      // CRITICAL: Do NOT clean LaTeX text - preserve backslashes and special characters\n      const isLatex = pattern.type === 'latex-inline';\n      matches.push({\n        type: pattern.type,\n        start: match.index,\n        end: regex.lastIndex,\n        text: isLatex ? match[1] : cleanText(match[1]),  // 不清理LaTeX文本\n        url: match[2], // 仅用于链接\n        rawText: match[1] // 保留原始文本用于调试\n      });\n      // 调试：记录找到的格式\n      if (pattern.type === 'bold') {\n        console.log(`[PDF导出] 发现粗体文本 [${match.index}-${regex.lastIndex}]:`, match[1]);\n      } else if (pattern.type === 'latex-inline') {\n        console.log(`[PDF导出] 发现LaTeX inline [${match.index}-${regex.lastIndex}]:`, match[1]);\n      }\n    }\n  });\n\n  // 按位置排序\n  matches.sort((a, b) => a.start - b.start);\n\n  // 移除重叠的匹配（保留最外层）\n  const filteredMatches = [];\n  matches.forEach(match => {\n    const overlaps = filteredMatches.some(existing =>\n      (match.start >= existing.start && match.start < existing.end) ||\n      (match.end > existing.start && match.end <= existing.end)\n    );\n    if (!overlaps) {\n      filteredMatches.push(match);\n    } else if (match.type === 'bold') {\n      console.warn(`[PDF导出] ⚠ 粗体文本被过滤（重叠）[${match.start}-${match.end}]:`, match.rawText);\n    }\n  });\n\n  // 构建segments数组\n  let lastEnd = 0;\n  filteredMatches.forEach(match => {\n    // 添加普通文本\n    if (match.start > lastEnd) {\n      segments.push({\n        type: 'normal',\n        text: cleanText(text.substring(lastEnd, match.start))  // 清理普通文本\n      });\n    }\n\n    // 添加格式化文本\n    segments.push({\n      type: match.type,\n      text: match.text,  // 已在上面清理过\n      url: match.url\n    });\n\n    lastEnd = match.end;\n  });\n\n  // 添加剩余文本\n  if (lastEnd < text.length) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text.substring(lastEnd))  // 清理剩余文本\n    });\n  }\n\n  // 如果没有匹配，返回整个文本\n  if (segments.length === 0) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text)  // 清理整个文本\n    });\n  }\n\n  // 清理未闭合的Markdown标记（如单独的 ** 或 * ）\n  segments.forEach(segment => {\n    if (segment.type === 'normal' && segment.text) {\n      // 移除未闭合的粗体标记\n      segment.text = segment.text.replace(/\\*\\*(?!\\*)/g, '');  // 移除单独的 **\n      segment.text = segment.text.replace(/(?<!\\*)\\*\\*/g, '');  // 移除单独的 **\n      // 移除未闭合的斜体标记\n      segment.text = segment.text.replace(/(?<!\\*)\\*(?!\\*)/g, '');  // 移除单独的 *\n      // 移除未闭合的下划线标记\n      segment.text = segment.text.replace(/(?<!_)__(?!_)/g, '');  // 移除单独的 __\n      segment.text = segment.text.replace(/(?<!_)_(?!_)/g, '');  // 移除单独的 _\n    }\n  });\n\n  return segments;\n}\n\n/**\n * 应用中文标点避头尾规则\n * @param {string[]} lines - 换行后的文本行数组\n * @returns {string[]} - 调整后的文本行数组\n */\nexport function applyCJKPunctuationRules(lines) {\n  if (!lines || lines.length <= 1) return lines;\n\n  // 不能出现在行首的标点（避头）\n  const noLineStart = /^[。，、；：！？）》」』】\"',.;:!?)}\\]]/;\n  // 不能出现在行尾的标点（避尾）\n  const noLineEnd = /[（《「『【\"'(\\[{]$/;\n\n  const result = [];\n  let prevLine = lines[0];\n\n  for (let i = 1; i < lines.length; i++) {\n    const currentLine = lines[i];\n\n    // 检查当前行开头是否有不能在行首的标点\n    if (noLineStart.test(currentLine)) {\n      // 将标点移到上一行末尾\n      const punct = currentLine[0];\n      prevLine = prevLine + punct;\n      lines[i] = currentLine.substring(1);\n      continue;\n    }\n\n    // 检查上一行结尾是否有不能在行尾的标点\n    if (noLineEnd.test(prevLine)) {\n      // 将标点移到当前行开头\n      const punct = prevLine[prevLine.length - 1];\n      prevLine = prevLine.substring(0, prevLine.length - 1);\n      lines[i] = punct + currentLine;\n    }\n\n    result.push(prevLine);\n    prevLine = lines[i];\n  }\n\n  result.push(prevLine);\n  return result;\n}\n\n/**\n * 解析代码行中的格式标记（粗体、标题）\n * 返回 [{text: string, bold: boolean, heading: number}]\n */\nexport function parseCodeLineBold(line) {\n  const segments = [];\n\n  // 检查是否是标题行（### 开头）\n  const headingMatch = line.match(/^(#{1,6})\\s+(.+)$/);\n  if (headingMatch) {\n    const level = headingMatch[1].length; // 标题级别（1-6）\n    const headingText = headingMatch[2];\n\n    // 标题文本仍然可以包含粗体\n    const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n    let lastEnd = 0;\n    let match;\n\n    while ((match = boldRegex.exec(headingText)) !== null) {\n      if (match.index > lastEnd) {\n        segments.push({\n          text: headingText.substring(lastEnd, match.index),\n          bold: false,\n          heading: level\n        });\n      }\n      segments.push({\n        text: match[1],\n        bold: true,\n        heading: level\n      });\n      lastEnd = boldRegex.lastIndex;\n    }\n\n    if (lastEnd < headingText.length) {\n      segments.push({\n        text: headingText.substring(lastEnd),\n        bold: false,\n        heading: level\n      });\n    }\n\n    if (segments.length === 0) {\n      segments.push({\n        text: headingText,\n        bold: false,\n        heading: level\n      });\n    }\n\n    return segments;\n  }\n\n  // 不是标题，解析普通粗体\n  const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n  let lastEnd = 0;\n  let match;\n\n  while ((match = boldRegex.exec(line)) !== null) {\n    // 添加普通文本\n    if (match.index > lastEnd) {\n      segments.push({\n        text: line.substring(lastEnd, match.index),\n        bold: false\n      });\n    }\n\n    // 添加粗体文本\n    segments.push({\n      text: match[1],\n      bold: true\n    });\n\n    lastEnd = boldRegex.lastIndex;\n  }\n\n  // 添加剩余文本\n  if (lastEnd < line.length) {\n    segments.push({\n      text: line.substring(lastEnd),\n      bold: false\n    });\n  }\n\n  // 如果没有匹配，返回整行\n  if (segments.length === 0) {\n    segments.push({\n      text: line,\n      bold: false\n    });\n  }\n\n  return segments;\n}\n\n/**\n * 安全地设置字体，如果字体变体不可用则自动回退\n * @param {Object} pdf - jsPDF实例\n * @param {string} fontName - 字体名称\n * @param {string} fontStyle - 字体样式\n * @param {Array} availableFontWeights - 可用字体变体列表\n * @returns {boolean} - 是否成功设置\n */\nexport function safeSetFont(pdf, fontName, fontStyle = 'normal', availableFontWeights = []) {\n  try {\n    // 如果请求的样式可用，直接使用\n    if (availableFontWeights.includes(fontStyle)) {\n      pdf.setFont(fontName, fontStyle);\n      return true;\n    }\n\n    // 字体变体不可用，进行智能回退\n    console.warn(`[PDF导出] 字体变体 ${fontStyle} 不可用，尝试回退...`);\n\n    // 回退策略\n    if (fontStyle === 'bold' || fontStyle === 'bolditalic') {\n      // 粗体：优先尝试 normal，如果没有则用第一个可用的\n      if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n        return false; // 返回 false 表示使用了回退\n      }\n    }\n\n    if (fontStyle === 'italic' || fontStyle === 'bolditalic') {\n      // 斜体：中文字体通常没有斜体，回退到 light 或 normal\n      if (availableFontWeights.includes('light')) {\n        pdf.setFont(fontName, 'light');\n        console.log(`[PDF导出] ✓ 斜体回退到 light 字体`);\n        return false;\n      } else if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF导出] ✓ 斜体回退到 normal 字体`);\n        return false;\n      }\n    }\n\n    // 默认回退：使用第一个可用的字体变体\n    if (availableFontWeights.length > 0) {\n      const fallbackStyle = availableFontWeights[0];\n      pdf.setFont(fontName, fallbackStyle);\n      console.log(`[PDF导出] ✓ 回退到 ${fallbackStyle} 字体`);\n      return false;\n    }\n\n    // 最终回退：使用 normal\n    pdf.setFont(fontName, 'normal');\n    console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n    return false;\n  } catch (error) {\n    console.error(`[PDF导出] 设置字体失败:`, error);\n    // 最后的保险：使用默认字体\n    pdf.setFont(fontName || 'helvetica');\n    return false;\n  }\n}\n\n/**\n * 安全地获取文本宽度，处理字体元数据缺失的情况\n * @param {Object} pdf - jsPDF实例\n * @param {string} text - 要测量的文本\n * @param {string} chineseFontName - 中文字体名称\n * @returns {number} - 文本宽度\n */\nexport function safeGetTextWidth(pdf, text, chineseFontName = 'helvetica') {\n  if (!text || typeof text !== 'string') {\n    return 0;\n  }\n\n  try {\n    // 检查当前字体是否有 Unicode 元数据\n    const font = pdf.getFont();\n    if (!font.metadata || !font.metadata.Unicode) {\n      const currentStyle = font.fontStyle || 'normal';\n      console.warn(`[PDF导出] 当前字体 (${currentStyle}) 缺少 Unicode 元数据`);\n\n      // 只在非normal字体时回退\n      if (currentStyle !== 'normal') {\n        console.log('[PDF导出] 回退到 normal 字体');\n        safeSetFont(pdf, chineseFontName, 'normal');\n        // 重新尝试获取宽度\n        return pdf.getTextWidth(text);\n      } else {\n        // normal字体也有问题，使用近似值\n        console.warn('[PDF导出] normal 字体也缺少元数据，使用近似计算');\n        const fontSize = pdf.getFontSize();\n        return text.length * fontSize * 0.5;\n      }\n    }\n\n    return pdf.getTextWidth(text);\n  } catch (error) {\n    console.error('[PDF导出] getTextWidth 失败:', error);\n    // 如果失败，使用近似值：字符数 * 字体大小 * 0.5\n    const fontSize = pdf.getFontSize();\n    return text.length * fontSize * 0.5;\n  }\n}\n\n/**\n * 安全地渲染文本，自动处理边界\n * @param {Object} pdf - jsPDF实例\n * @param {string} text - 要渲染的文本\n * @param {number} x - X 坐标\n * @param {number} y - Y 坐标\n * @param {number} maxWidth - 最大宽度（可选）\n */\nexport function safeRenderText(pdf, text, x, y, maxWidth = null) {\n  if (!text || typeof text !== 'string') {\n    return;\n  }\n\n  const cleanedText = cleanText(text);\n  if (!cleanedText) {\n    return;\n  }\n\n  // 如果指定了 maxWidth，检查文本宽度\n  if (maxWidth) {\n    const textWidth = safeGetTextWidth(pdf, cleanedText);\n    if (textWidth > maxWidth) {\n      // 文本过长，进行截断并添加省略号\n      console.warn('[PDF导出] 文本过长，将被截断:', cleanedText.substring(0, 50));\n      // 尝试使用 splitTextToSize 拆分（只渲染第一行）\n      try {\n        const lines = pdf.splitTextToSize(cleanedText, maxWidth);\n        if (lines.length > 0) {\n          pdf.text(lines[0], x, y);\n        }\n      } catch (error) {\n        // 如果失败，尝试简单截断\n        let truncated = cleanedText;\n        while (safeGetTextWidth(pdf, truncated + '...') > maxWidth && truncated.length > 0) {\n          truncated = truncated.substring(0, truncated.length - 1);\n        }\n        pdf.text(truncated + '...', x, y);\n      }\n      return;\n    }\n  }\n\n  // 文本长度合适，直接渲染\n  pdf.text(cleanedText, x, y);\n}","// utils/export/pdfLatexRenderer.js\n// LaTeX数学公式渲染器 - 使用Unicode映射和自定义绘图实现非SVG渲染\n\nimport { cleanText } from './pdfTextHelpers';\n\n/**\n * LaTeX到Unicode的映射表\n */\nconst LATEX_UNICODE_MAP = {\n  // 希腊字母小写\n  'alpha': 'α', 'beta': 'β', 'gamma': 'γ', 'delta': 'δ',\n  'epsilon': 'ε', 'varepsilon': 'ε', 'zeta': 'ζ', 'eta': 'η',\n  'theta': 'θ', 'vartheta': 'ϑ', 'iota': 'ι', 'kappa': 'κ',\n  'lambda': 'λ', 'mu': 'μ', 'nu': 'ν', 'xi': 'ξ',\n  'pi': 'π', 'varpi': 'ϖ', 'rho': 'ρ', 'varrho': 'ϱ',\n  'sigma': 'σ', 'varsigma': 'ς', 'tau': 'τ', 'upsilon': 'υ',\n  'phi': 'φ', 'varphi': 'φ', 'chi': 'χ', 'psi': 'ψ', 'omega': 'ω',\n  \n  // 希腊字母大写\n  'Alpha': 'Α', 'Beta': 'Β', 'Gamma': 'Γ', 'Delta': 'Δ',\n  'Epsilon': 'Ε', 'Zeta': 'Ζ', 'Eta': 'Η', 'Theta': 'Θ',\n  'Iota': 'Ι', 'Kappa': 'Κ', 'Lambda': 'Λ', 'Mu': 'Μ',\n  'Nu': 'Ν', 'Xi': 'Ξ', 'Pi': 'Π', 'Rho': 'Ρ',\n  'Sigma': 'Σ', 'Tau': 'Τ', 'Upsilon': 'Υ', 'Phi': 'Φ',\n  'Chi': 'Χ', 'Psi': 'Ψ', 'Omega': 'Ω',\n  \n  // 数学运算符\n  'pm': '±', 'mp': '∓', 'times': '×', 'div': '÷',\n  'cdot': '·', 'ast': '∗', 'star': '⋆', 'circ': '∘',\n  'bullet': '•', 'oplus': '⊕', 'ominus': '⊖', 'otimes': '⊗',\n  'oslash': '⊘', 'odot': '⊙', 'dagger': '†', 'ddagger': '‡',\n  \n  // 关系符号\n  'leq': '≤', 'le': '≤', 'geq': '≥', 'ge': '≥',\n  'neq': '≠', 'ne': '≠', 'approx': '≈', 'equiv': '≡',\n  'sim': '∼', 'simeq': '≃', 'propto': '∝', 'perp': '⊥',\n  'parallel': '∥', 'subset': '⊂', 'supset': '⊃',\n  'subseteq': '⊆', 'supseteq': '⊇', 'in': '∈', 'notin': '∉',\n  \n  // 箭头\n  'leftarrow': '←', 'rightarrow': '→', 'uparrow': '↑', 'downarrow': '↓',\n  'leftrightarrow': '↔', 'updownarrow': '↕', 'Leftarrow': '⇐', 'Rightarrow': '⇒',\n  'Uparrow': '⇑', 'Downarrow': '⇓', 'Leftrightarrow': '⇔', 'Updownarrow': '⇕',\n  'mapsto': '↦', 'to': '→', 'gets': '←',\n  \n  // 其他符号\n  'infty': '∞', 'partial': '∂', 'nabla': '∇', 'forall': '∀',\n  'exists': '∃', 'nexists': '∄', 'emptyset': '∅', 'varnothing': '∅',\n  'complement': '∁', 'neg': '¬', 'wedge': '∧', 'vee': '∨',\n  'cap': '∩', 'cup': '∪', 'int': '∫', 'iint': '∬', 'iiint': '∭',\n  'oint': '∮', 'sum': '∑', 'prod': '∏', 'coprod': '∐',\n  'bigcap': '⋂', 'bigcup': '⋃', 'bigvee': '⋁', 'bigwedge': '⋀',\n  'bigoplus': '⨁', 'bigotimes': '⨂', 'bigodot': '⨀', 'biguplus': '⨄',\n  \n  // 括号和定界符\n  'langle': '⟨', 'rangle': '⟩', 'lfloor': '⌊', 'rfloor': '⌋',\n  'lceil': '⌈', 'rceil': '⌉', 'vert': '|', 'Vert': '‖',\n  \n  // 特殊字符\n  'dots': '…', 'cdots': '⋯', 'vdots': '⋮', 'ddots': '⋱',\n  'ldots': '…', 'therefore': '∴', 'because': '∵',\n  'angle': '∠', 'measuredangle': '∡', 'sphericalangle': '∢',\n  \n  // 其他\n  'prime': '′', 'backprime': '‵', 'degree': '°'\n};\n\n// 上标数字和字母映射\nconst SUPERSCRIPT_MAP = {\n  '0': '⁰', '1': '¹', '2': '²', '3': '³', '4': '⁴',\n  '5': '⁵', '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹',\n  '+': '⁺', '-': '⁻', '=': '⁼', '(': '⁽', ')': '⁾',\n  'n': 'ⁿ', 'i': 'ⁱ', 'a': 'ᵃ', 'b': 'ᵇ', 'c': 'ᶜ',\n  'd': 'ᵈ', 'e': 'ᵉ', 'f': 'ᶠ', 'g': 'ᵍ', 'h': 'ʰ',\n  'j': 'ʲ', 'k': 'ᵏ', 'l': 'ˡ', 'm': 'ᵐ', 'o': 'ᵒ',\n  'p': 'ᵖ', 'r': 'ʳ', 's': 'ˢ', 't': 'ᵗ', 'u': 'ᵘ',\n  'v': 'ᵛ', 'w': 'ʷ', 'x': 'ˣ', 'y': 'ʸ', 'z': 'ᶻ'\n};\n\n// 下标数字和字母映射\nconst SUBSCRIPT_MAP = {\n  '0': '₀', '1': '₁', '2': '₂', '3': '₃', '4': '₄',\n  '5': '₅', '6': '₆', '7': '₇', '8': '₈', '9': '₉',\n  '+': '₊', '-': '₋', '=': '₌', '(': '₍', ')': '₎',\n  'a': 'ₐ', 'e': 'ₑ', 'h': 'ₕ', 'i': 'ᵢ', 'j': 'ⱼ',\n  'k': 'ₖ', 'l': 'ₗ', 'm': 'ₘ', 'n': 'ₙ', 'o': 'ₒ',\n  'p': 'ₚ', 'r': 'ᵣ', 's': 'ₛ', 't': 'ₜ', 'u': 'ᵤ',\n  'v': 'ᵥ', 'x': 'ₓ'\n};\n\n/**\n * LaTeX渲染器类\n */\nexport class LaTeXRenderer {\n  constructor(pdf, config = {}) {\n    this.pdf = pdf;\n    this.config = {\n      fontSize: config.fontSize || 10,\n      color: config.color || [0, 0, 0],\n      useUnicode: config.useUnicode !== false, // 默认使用Unicode\n      ...config\n    };\n  }\n\n  /**\n   * 渲染行内LaTeX数学公式\n   * @param {string} latex - LaTeX源码（不包含$符号）\n   * @param {number} x - 起始X坐标\n   * @param {number} y - 基线Y坐标\n   * @param {number} maxWidth - 最大宽度\n   * @returns {number} - 渲染后的宽度\n   */\n  renderInlineLaTeX(latex, x, y, maxWidth) {\n    // 首先尝试简单的Unicode转换\n    const simplified = this.simplifyLaTeX(latex);\n    \n    // 检查是否包含复杂结构（分数、矩阵等）\n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, x, y, maxWidth, true);\n    }\n    \n    // 简单公式直接渲染为Unicode文本\n    this.pdf.setFontSize(this.config.fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // 设置斜体以区分数学文本\n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'italic');\n    } catch (e) {\n      // 如果没有斜体，保持原样\n    }\n    \n    this.pdf.text(simplified, x, y);\n    const width = this.pdf.getTextWidth(simplified);\n    \n    // 恢复正常字体\n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'normal');\n    } catch (e) {\n      // 忽略字体恢复错误\n    }\n    \n    return width;\n  }\n\n  /**\n   * 渲染块级LaTeX数学公式\n   * @param {string} latex - LaTeX源码\n   * @param {number} x - 起始X坐标\n   * @param {number} y - 起始Y坐标\n   * @param {number} maxWidth - 最大宽度\n   * @returns {Object} - {width, height} 渲染后的尺寸\n   */\n  renderDisplayLaTeX(latex, x, y, maxWidth) {\n    // 块级公式居中显示\n    const centerX = x + maxWidth / 2;\n    \n    // 检查是否包含复杂结构\n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, centerX, y, maxWidth, false);\n    }\n    \n    // 简单公式\n    const simplified = this.simplifyLaTeX(latex);\n    const fontSize = this.config.fontSize * 1.2; // 块级公式稍大\n    \n    this.pdf.setFontSize(fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // 计算文本宽度以居中\n    const textWidth = this.pdf.getTextWidth(simplified);\n    const startX = centerX - textWidth / 2;\n    \n    // 添加背景\n    const padding = 5;\n    this.pdf.setFillColor(250, 250, 250);\n    this.pdf.rect(startX - padding, y - fontSize * 0.8, textWidth + padding * 2, fontSize * 1.5, 'F');\n    \n    // 渲染文本\n    this.pdf.text(simplified, startX, y);\n    \n    return {\n      width: textWidth + padding * 2,\n      height: fontSize * 1.5\n    };\n  }\n\n  /**\n   * 简化LaTeX为Unicode字符\n   * @param {string} latex - LaTeX源码\n   * @returns {string} - 转换后的Unicode文本\n   */\n  simplifyLaTeX(latex) {\n    let result = latex;\n    \n    // 移除多余的空格\n    result = result.replace(/\\s+/g, ' ').trim();\n    \n    // 处理上标（简单情况）\n    result = result.replace(/\\^{([^}]+)}/g, (match, content) => {\n      return this.convertToSuperscript(content);\n    });\n    result = result.replace(/\\^(\\w)/g, (match, char) => {\n      return this.convertToSuperscript(char);\n    });\n    \n    // 处理下标（简单情况）\n    result = result.replace(/_{([^}]+)}/g, (match, content) => {\n      return this.convertToSubscript(content);\n    });\n    result = result.replace(/_(\\w)/g, (match, char) => {\n      return this.convertToSubscript(char);\n    });\n    \n    // 替换LaTeX命令为Unicode\n    Object.keys(LATEX_UNICODE_MAP).forEach(command => {\n      const pattern = new RegExp(`\\\\\\\\${command}(?![a-zA-Z])`, 'g');\n      result = result.replace(pattern, LATEX_UNICODE_MAP[command]);\n    });\n    \n    // 清理剩余的反斜杠\n    result = result.replace(/\\\\([a-zA-Z]+)/g, '$1');\n    result = result.replace(/\\\\(.)/g, '$1');\n    \n    // 清理花括号\n    result = result.replace(/[{}]/g, '');\n    \n    return result;\n  }\n\n  /**\n   * 转换为上标Unicode\n   */\n  convertToSuperscript(text) {\n    return text.split('').map(char => SUPERSCRIPT_MAP[char] || char).join('');\n  }\n\n  /**\n   * 转换为下标Unicode\n   */\n  convertToSubscript(text) {\n    return text.split('').map(char => SUBSCRIPT_MAP[char] || char).join('');\n  }\n\n  /**\n   * 检查是否包含复杂LaTeX结构\n   */\n  hasComplexStructure(latex) {\n    const complexPatterns = [\n      /\\\\frac\\{/,           // 分数\n      /\\\\sqrt[\\[\\{]/,       // 根号\n      /\\\\begin\\{/,          // 环境（如矩阵）\n      /\\\\left/,             // 大括号\n      /\\\\right/,            // 大括号\n      /\\\\sum/,              // 求和（需要特殊布局）\n      /\\\\int/,              // 积分（需要特殊布局）\n      /\\\\prod/,             // 乘积\n      /\\\\lim/,              // 极限\n      /\\\\mathbb/,           // 黑板粗体\n      /\\\\mathcal/,          // 花体\n      /\\\\boldsymbol/,       // 粗体符号\n      /\\\\overline/,         // 上划线\n      /\\\\underline/,        // 下划线\n      /\\\\vec/,              // 向量\n      /\\\\hat/,              // 帽子\n      /\\\\tilde/,            // 波浪号\n      /\\\\dot/,              // 点\n      /\\\\ddot/              // 双点\n    ];\n    \n    return complexPatterns.some(pattern => pattern.test(latex));\n  }\n\n  /**\n   * 渲染复杂LaTeX结构\n   */\n  renderComplexLaTeX(latex, x, y, maxWidth, isInline) {\n    const fontSize = isInline ? this.config.fontSize : this.config.fontSize * 1.2;\n    const elements = this.parseComplexLaTeX(latex);\n\n    // 第一步：计算总宽度\n    let totalWidth = 0;\n    this.pdf.setFontSize(fontSize);\n\n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          totalWidth += this.pdf.getTextWidth(element.content);\n          break;\n\n        case 'fraction':\n          // 估算分数宽度\n          const fracFontSize = fontSize * 0.75;\n          this.pdf.setFontSize(fracFontSize);\n          const numWidth = this.pdf.getTextWidth(element.numerator);\n          const denWidth = this.pdf.getTextWidth(element.denominator);\n          totalWidth += Math.max(numWidth, denWidth) + 4;\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        case 'sqrt':\n          totalWidth += this.pdf.getTextWidth(element.content) + 8;\n          break;\n\n        case 'superscript':\n        case 'subscript':\n          totalWidth += this.pdf.getTextWidth(element.base || '');\n          const subSupFontSize = fontSize * 0.7;\n          this.pdf.setFontSize(subSupFontSize);\n          totalWidth += this.pdf.getTextWidth(element.exponent || element.subscript || '');\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        default:\n          totalWidth += this.pdf.getTextWidth(element.raw || '');\n      }\n    });\n\n    // 第二步：对于display math，从居中位置开始渲染\n    let currentX = isInline ? x : (x - totalWidth / 2);\n    let maxHeight = fontSize;\n    let hasFraction = false;  // 标记是否包含分数\n\n    // 第三步：渲染所有元素\n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(element.content, currentX, y);\n          const textWidth = this.pdf.getTextWidth(element.content);\n          currentX += textWidth;\n          break;\n\n        case 'fraction':\n          const fracWidth = this.renderFraction(\n            element.numerator,\n            element.denominator,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += fracWidth;\n          hasFraction = true;\n          break;\n\n        case 'sqrt':\n          const sqrtWidth = this.renderSquareRoot(\n            element.content,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += sqrtWidth;\n          break;\n\n        case 'superscript':\n          const supWidth = this.renderSuperscript(\n            element.base,\n            element.exponent,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += supWidth;\n          break;\n\n        case 'subscript':\n          const subWidth = this.renderSubscript(\n            element.base,\n            element.subscript,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += subWidth;\n          break;\n\n        default:\n          // 未识别的类型，渲染为普通文本\n          const fallbackText = element.raw || '';\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(fallbackText, currentX, y);\n          const fallbackWidth = this.pdf.getTextWidth(fallbackText);\n          currentX += fallbackWidth;\n      }\n    });\n\n    // 根据是否包含分数计算实际高度\n    if (hasFraction) {\n      maxHeight = fontSize * 1.2;  // 分数需要更多垂直空间\n    } else {\n      maxHeight = fontSize;  // 普通公式紧凑间距\n    }\n\n    return isInline ? totalWidth : { width: totalWidth, height: maxHeight };\n  }\n\n  /**\n   * 解析复杂LaTeX为可渲染的元素\n   */\n  parseComplexLaTeX(latex) {\n    const elements = [];\n    let remaining = latex;\n    \n    // 简化解析：主要处理分数\n    const fracRegex = /\\\\frac\\{([^}]*)\\}\\{([^}]*)\\}/;\n    \n    while (remaining.length > 0) {\n      const fracMatch = remaining.match(fracRegex);\n      \n      if (fracMatch) {\n        // 添加分数前的文本\n        if (fracMatch.index > 0) {\n          const beforeText = remaining.substring(0, fracMatch.index);\n          const simplified = this.simplifyLaTeX(beforeText);\n          if (simplified) {\n            elements.push({ type: 'text', content: simplified });\n          }\n        }\n        \n        // 添加分数\n        elements.push({\n          type: 'fraction',\n          numerator: this.simplifyLaTeX(fracMatch[1]),\n          denominator: this.simplifyLaTeX(fracMatch[2]),\n          raw: fracMatch[0]\n        });\n        \n        remaining = remaining.substring(fracMatch.index + fracMatch[0].length);\n      } else {\n        // 没有更多分数，处理剩余文本\n        const simplified = this.simplifyLaTeX(remaining);\n        if (simplified) {\n          elements.push({ type: 'text', content: simplified });\n        }\n        break;\n      }\n    }\n    \n    return elements;\n  }\n\n  /**\n   * 渲染分数\n   */\n  renderFraction(numerator, denominator, x, y, fontSize) {\n    // 设置较小的字体用于分数\n    const fracFontSize = fontSize * 0.75;\n    this.pdf.setFontSize(fracFontSize);\n\n    const numWidth = this.pdf.getTextWidth(numerator);\n    const denWidth = this.pdf.getTextWidth(denominator);\n    const fracWidth = Math.max(numWidth, denWidth) + 4;\n\n    // 进一步减小间距：分子和分母紧贴分数线\n    const numOffset = fracFontSize * 0.17;  // 分子上移（距离分数线）\n    const denOffset = fracFontSize * 0.5;  // 分母下移（距离分数线）\n\n    // 渲染分子（在分数线上方，居中对齐）\n    const numX = x + (fracWidth - numWidth) / 2;\n    this.pdf.text(numerator, numX, y - numOffset);\n\n    // 绘制分数线\n    this.pdf.setLineWidth(0.3);\n    this.pdf.setDrawColor(0, 0, 0);\n    this.pdf.line(x, y, x + fracWidth, y);\n\n    // 渲染分母（在分数线下方，居中对齐）\n    const denX = x + (fracWidth - denWidth) / 2;\n    this.pdf.text(denominator, denX, y + denOffset);\n\n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n\n    return fracWidth;\n  }\n\n  /**\n   * 渲染平方根\n   */\n  renderSquareRoot(content, x, y, fontSize) {\n    const contentWidth = this.pdf.getTextWidth(content);\n    const sqrtWidth = contentWidth + 8;\n    const sqrtHeight = fontSize * 1.2;\n    \n    // 绘制根号符号\n    this.pdf.setLineWidth(0.3);\n    // 左侧勾\n    this.pdf.line(x, y - sqrtHeight / 3, x + 2, y);\n    // 斜线\n    this.pdf.line(x + 2, y, x + 4, y - sqrtHeight);\n    // 顶线\n    this.pdf.line(x + 4, y - sqrtHeight, x + sqrtWidth, y - sqrtHeight);\n    \n    // 渲染根号内的内容\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(content, x + 6, y);\n    \n    return sqrtWidth;\n  }\n\n  /**\n   * 渲染上标\n   */\n  renderSuperscript(base, exponent, x, y, fontSize) {\n    // 渲染基数\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // 渲染上标（使用更小的字体和向上偏移）\n    const supFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(supFontSize);\n    const supText = this.simplifyLaTeX(exponent);\n    this.pdf.text(supText, x + baseWidth, y - fontSize * 0.3);\n    const supWidth = this.pdf.getTextWidth(supText);\n    \n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + supWidth;\n  }\n\n  /**\n   * 渲染下标\n   */\n  renderSubscript(base, subscript, x, y, fontSize) {\n    // 渲染基数\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // 渲染下标（使用更小的字体和向下偏移）\n    const subFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(subFontSize);\n    const subText = this.simplifyLaTeX(subscript);\n    this.pdf.text(subText, x + baseWidth, y + fontSize * 0.3);\n    const subWidth = this.pdf.getTextWidth(subText);\n    \n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + subWidth;\n  }\n}\n\n// 导出默认实例化函数\nexport function createLaTeXRenderer(pdf, config) {\n  return new LaTeXRenderer(pdf, config);\n}\n","// PDF内容渲染器 - 负责所有内容的渲染工作\n\nimport { cleanText, parseInlineMarkdown, parseCodeLineBold, applyCJKPunctuationRules } from './pdfTextHelpers'\nimport { LaTeXRenderer } from './pdfLatexRenderer'\nexport const PDF_STYLES = {\n  // 字体大小\n  FONT_SIZE_TITLE: 20,\n  FONT_SIZE_H1: 16,\n  FONT_SIZE_H2: 14,\n  FONT_SIZE_SENDER: 12,\n  FONT_SIZE_BODY: 10,\n  FONT_SIZE_CODE: 9,\n  FONT_SIZE_TIMESTAMP: 8,\n  FONT_SIZE_HEADER: 8,\n  FONT_SIZE_FOOTER: 8,\n\n  // 颜色 (RGB)\n  COLOR_SENDER_HUMAN: [0, 102, 204],      // 蓝色\n  COLOR_SENDER_ASSISTANT: [102, 102, 102], // 灰色\n  COLOR_TIMESTAMP: [150, 150, 150],        // 浅灰\n  COLOR_CODE_BG: [245, 245, 245],          // 代码背景\n  COLOR_SECTION_BG: [250, 250, 250],       // 区块背景\n  COLOR_TEXT: [0, 0, 0],                   // 黑色文本\n  COLOR_HEADER: [100, 100, 100],           // 页眉颜色\n  COLOR_FOOTER: [150, 150, 150],           // 页脚颜色\n  COLOR_BORDER: [200, 200, 200],           // 边框颜色\n\n  // 间距\n  MARGIN_LEFT: 15,\n  MARGIN_RIGHT: 15,\n  MARGIN_TOP: 15,    // 顶部边距（移除页眉，增加空间利用率）\n  MARGIN_BOTTOM: 25, // 底部边距为页脚留空间\n  LINE_HEIGHT: 5,\n  SECTION_SPACING: 8,\n  MESSAGE_SPACING: 10,\n  FOOTER_HEIGHT: 15, // 页脚高度\n\n  // 页面\n  PAGE_WIDTH: 210, // A4 宽度(mm)\n  PAGE_HEIGHT: 297, // A4 高度(mm)\n};\n\n/**\n * 内容渲染器类\n */\nexport class ContentRenderer {\n  constructor(manager) {\n    this.manager = manager;\n    this.latexRenderer = null; // 延迟初始化\n  }\n\n  /**\n   * 获取PDF实例\n   */\n  get pdf() {\n    return this.manager.pdf;\n  }\n\n  /**\n   * 获取和设置当前Y位置\n   */\n  get currentY() {\n    return this.manager.currentY;\n  }\n\n  set currentY(value) {\n    this.manager.currentY = value;\n  }\n\n  /**\n   * 获取配置\n   */\n  get config() {\n    return this.manager.config;\n  }\n\n  /**\n   * 获取字体相关属性\n   */\n  get chineseFontName() {\n    return this.manager.chineseFontName;\n  }\n\n  get availableFontWeights() {\n    return this.manager.availableFontWeights;\n  }\n\n  /**\n   * 委托给manager的辅助方法\n   */\n  safeSetFont(fontName, fontStyle) {\n    return this.manager.safeSetFont(fontName, fontStyle);\n  }\n\n  safeGetTextWidth(text) {\n    return this.manager.safeGetTextWidth(text);\n  }\n\n  safeRenderText(text, x, y, maxWidth) {\n    return this.manager.safeRenderText(text, x, y, maxWidth);\n  }\n\n  checkPageBreak(requiredSpace) {\n    return this.manager.checkPageBreak(requiredSpace);\n  }\n\n\n  /**\n   * 渲染标题页\n   */\n  renderTitle(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TITLE);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const rawTitle = meta.name || 'Conversation';\n    const title = cleanText(rawTitle); // 清理标题文本\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 标题可能很长,需要自动换行\n    let titleLines;\n    try {\n      titleLines = this.pdf.splitTextToSize(title, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] 标题分割失败,使用原始标题:', error);\n      titleLines = [title];\n    }\n    \n    titleLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TITLE);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染元数据\n   */\n  renderMetadata(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n\n    const lines = [];\n\n    if (meta.platform) {\n      lines.push(`Platform: ${meta.platform}`);\n    }\n\n    if (meta.created_at) {\n      lines.push(`Created: ${meta.created_at}`);\n    }\n\n    if (meta.updated_at) {\n      lines.push(`Updated: ${meta.updated_at}`);\n    }\n\n    lines.push(`Exported: ${this.manager.exportDate}`);\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染单条消息（LaTeX显示为源码）\n   */\n  renderMessage(message, index) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_SENDER + PDF_STYLES.MESSAGE_SPACING);\n\n    // 记录消息位置用于目录链接和书签\n    const currentPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    const currentY = this.currentY;\n    this.manager.messageAnchors.push({\n      index,\n      page: currentPage,\n      y: currentY,\n      sender: message.sender,\n      title: message.display_text ? message.display_text.substring(0, 50) : ''\n    });\n\n    // 渲染发送者标签\n    this.renderSender(message, index);\n\n    // 渲染时间戳\n    if (this.config.includeTimestamps && message.timestamp) {\n      this.renderTimestamp(message.timestamp);\n    }\n\n    // 渲染thinking(前置)\n    if (message.thinking && this.config.includeThinking && message.sender !== 'human') {\n      this.renderThinking(message.thinking);\n    }\n\n    // 渲染正文（LaTeX显示为源码）\n    if (message.display_text) {\n      this.renderBody(message.display_text);\n    }\n\n    // 渲染附件\n    if (message.attachments?.length > 0 && message.sender === 'human') {\n      this.renderAttachments(message.attachments);\n    }\n\n    // 渲染Artifacts\n    if (message.artifacts?.length > 0 && this.config.includeArtifacts && message.sender !== 'human') {\n      message.artifacts.forEach(artifact => {\n        this.renderArtifact(artifact);\n      });\n    }\n\n    // 渲染工具调用\n    if (message.tools?.length > 0 && this.config.includeTools) {\n      message.tools.forEach(tool => {\n        this.renderTool(tool);\n      });\n    }\n\n    // 渲染引用\n    if (message.citations?.length > 0 && this.config.includeCitations) {\n      this.renderCitations(message.citations);\n    }\n\n    // 消息间距\n    this.currentY += PDF_STYLES.MESSAGE_SPACING;\n  }\n\n  /**\n   * 渲染发送者标签\n   */\n  renderSender(message, index) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_SENDER);\n\n    // 根据发送者设置颜色\n    const color = message.sender === 'human'\n      ? PDF_STYLES.COLOR_SENDER_HUMAN\n      : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n\n    this.pdf.setTextColor(...color);\n\n    // 构建发送者标签\n    const senderLabel = message.sender === 'human' ? 'Human' : 'Assistant';\n    const label = `${index}. ${senderLabel}`;\n\n    // 添加分支标记\n    let finalLabel = label;\n    if (message.branchInfo?.isBranchPoint) {\n      const branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      finalLabel = label + branchMarker;\n    }\n\n    // 清理并输出标签\n    const cleanLabel = cleanText(finalLabel);\n    if (cleanLabel && cleanLabel.trim().length > 0) {\n      this.pdf.text(cleanLabel, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    }\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n  }\n\n  /**\n   * 渲染时间戳\n   */\n  renderTimestamp(timestamp) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n    this.pdf.text(timestamp, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n  }\n\n  /**\n   * 渲染正文（LaTeX显示为源码）\n   */\n  renderBody(text) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 处理代码块和LaTeX块\n    const parts = this.manager.parseTextWithCodeBlocksAndLatex(text);\n\n    // 渲染所有部分\n    for (const part of parts) {\n      if (part.type === 'code') {\n        this.renderCodeBlock(part.content, part.language);\n      } else if (part.type === 'latex-display') {\n        this.renderLatexDisplay(part);\n      } else {\n        // 渲染普通文本，支持markdown格式（可能包含inline LaTeX源码）\n        this.renderMarkdownText(part.content, maxWidth);\n      }\n    }\n\n    // 减小正文结束后的间距\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.3;\n  }\n\n\n  /**\n   * 获取或创建LaTeX渲染器\n   */\n  getLatexRenderer() {\n    if (!this.latexRenderer) {\n      this.latexRenderer = new LaTeXRenderer(this.pdf, {\n        fontSize: PDF_STYLES.FONT_SIZE_BODY,\n        color: PDF_STYLES.COLOR_TEXT\n      });\n    }\n    return this.latexRenderer;\n  }\n\n  /**\n   * 渲染LaTeX display math（块级数学公式）- 使用新的渲染器\n   */\n  renderLatexDisplay(part) {\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY + 30);\n\n    try {\n      // 尝试使用LaTeX渲染器\n      const renderer = this.getLatexRenderer();\n      const result = renderer.renderDisplayLaTeX(\n        part.content,\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY + PDF_STYLES.FONT_SIZE_BODY,\n        maxWidth\n      );\n\n      // 更新Y位置 - 减小公式间距\n      this.currentY += result.height + PDF_STYLES.LINE_HEIGHT * 0.05;  // 大幅缩短间距\n    } catch (error) {\n      console.warn('[PDF导出] LaTeX渲染失败，回退到源码显示:', error);\n\n      // 回退：显示LaTeX源码\n      this.renderLatexDisplayAsSource(part, maxWidth);\n    }\n  }\n\n  /**\n   * 渲染LaTeX display math作为源码（备用方案）\n   */\n  renderLatexDisplayAsSource(part, maxWidth) {\n    // 绘制背景（浅蓝色调表示LaTeX）\n    this.pdf.setFillColor(240, 248, 255);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      'F'\n    );\n\n    // 绘制边框（蓝色）\n    this.pdf.setDrawColor(100, 150, 200);\n    this.pdf.setLineWidth(0.5);\n    this.pdf.roundedRect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      1.5,\n      1.5,\n      'S'\n    );\n\n    // 显示标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(70, 130, 180);\n    this.pdf.text('[LaTeX]', PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // 显示LaTeX源码\n    this.pdf.setFont('courier', 'normal');\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setTextColor(50, 50, 50);\n\n    const sourceLines = this.pdf.splitTextToSize(part.content, maxWidth - 4);\n    sourceLines.forEach(line => {\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 恢复样式\n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染纯文本(带自动换行)\n   */\n  renderPlainText(text, maxWidth) {\n    // 处理空文本\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 清理文本，防止编码问题\n    const cleanedText = cleanText(text);\n    \n    if (!cleanedText || cleanedText.trim().length === 0) {\n      console.warn('[PDF导出] 文本清理后为空，跳过');\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 使用 splitTextToSize 自动处理换行,支持Unicode字符\n    let lines;\n    try {\n      lines = this.pdf.splitTextToSize(cleanedText, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] splitTextToSize失败，使用简单换行:', error);\n      // 如果splitTextToSize失败,使用简单的换行逻辑\n      lines = cleanedText.split('\\n');\n    }\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      \n      // 再次清理单行文本（防止splitTextToSize引入问题）\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染代码块（支持跨页）- 简化版，逐行渲染\n   */\n  renderCodeBlock(code, language = '') {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_CODE + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    const lineNumberWidth = 8;\n    const codeWidth = maxWidth - lineNumberWidth - 8;\n    const padding = 3;\n\n    const cleanCode = cleanText(code);\n    const cleanLanguage = cleanText(language);\n\n    // 渲染语言标签\n    if (cleanLanguage) {\n      this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.setTextColor(100, 100, 100);\n      const labelText = cleanLanguage.toUpperCase();\n      const labelWidth = this.safeGetTextWidth(labelText) + 4;\n      this.pdf.setFillColor(220, 220, 220);\n      this.pdf.roundedRect(\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY - 3,\n        labelWidth,\n        5,\n        1,\n        1,\n        'F'\n      );\n      this.pdf.text(labelText, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 处理代码行\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setFont(this.chineseFontName);\n    const codeLines = cleanCode.split('\\n');\n    const wrappedLines = [];\n\n    codeLines.forEach(line => {\n      if (!line) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n      const cleanLine = cleanText(line);\n      if (!cleanLine) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n\n      try {\n        const wrapped = this.pdf.splitTextToSize(cleanLine, codeWidth);\n        wrapped.forEach((wLine, idx) => {\n          wrappedLines.push({\n            text: wLine,\n            lineNumber: idx === 0 ? wrappedLines.length + 1 : null\n          });\n        });\n      } catch (error) {\n        wrappedLines.push({ text: cleanLine, lineNumber: wrappedLines.length + 1 });\n      }\n    });\n\n    // 逐行渲染，遇到需要换页时自动换页\n    const blockStartY = this.currentY;\n    const blockStartPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    // 先绘制第一页的背景和边框起始部分\n    const firstPageHeight = Math.min(\n      wrappedLines.length * PDF_STYLES.LINE_HEIGHT + padding * 2,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n    );\n    this.pdf.setFillColor(248, 248, 248);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      blockStartY - padding,\n      maxWidth,\n      firstPageHeight,\n      'F'\n    );\n\n    this.currentY = blockStartY;\n\n    wrappedLines.forEach(({ text, lineNumber }, index) => {\n      // 检查是否需要换页\n      if (this.currentY + PDF_STYLES.FONT_SIZE_CODE > PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM) {\n        // 先绘制当前页的代码块底部边框\n        this.pdf.setDrawColor(200, 200, 200);\n        this.pdf.setLineWidth(0.3);\n        const currentPageBottom = this.currentY;\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT,\n          currentPageBottom\n        );\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          currentPageBottom\n        );\n\n        // 换页\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n        \n        // 在新页绘制代码块背景（连续样式）\n        const remainingLines = wrappedLines.length - index;\n        const newPageHeight = Math.min(\n          remainingLines * PDF_STYLES.LINE_HEIGHT + padding,\n          PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n        );\n        this.pdf.setFillColor(248, 248, 248);\n        this.pdf.rect(\n          PDF_STYLES.MARGIN_LEFT,\n          this.currentY - padding,\n          maxWidth,\n          newPageHeight,\n          'F'\n        );\n      }\n\n      // 渲染行号\n      if (lineNumber !== null) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE - 1);\n        this.pdf.setTextColor(150, 150, 150);\n        const lineNumStr = String(lineNumber).padStart(3, ' ');\n        this.pdf.text(lineNumStr, PDF_STYLES.MARGIN_LEFT + 1, this.currentY);\n      }\n\n      // 渲染代码文本（支持 **粗体** 和 ### 标题）\n      const safeLine = cleanText(text);\n      if (safeLine !== null && safeLine !== undefined) {\n        // 解析粗体和标题标记\n        const segments = parseCodeLineBold(safeLine);\n        const isHeading = segments.some(s => s.heading);\n\n        // 根据标题级别设置字号和颜色\n        if (isHeading) {\n          const level = segments[0].heading;\n          const headingSizes = [14, 13, 12, 11, 10, 10]; // H1-H6 字号\n          this.pdf.setFontSize(headingSizes[level - 1] || PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(20, 20, 20); // 深色\n        } else {\n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(50, 50, 50);\n        }\n\n        let currentX = PDF_STYLES.MARGIN_LEFT + lineNumberWidth + 2;\n\n        segments.forEach(segment => {\n          // 标题或粗体使用bold字体\n          if ((segment.heading || segment.bold) && this.availableFontWeights.includes('bold')) {\n            this.pdf.setFont(this.chineseFontName, 'bold');\n          } else {\n            // 使用普通字体（保持中文支持）\n            this.pdf.setFont(this.chineseFontName, 'normal');\n          }\n\n          this.pdf.text(segment.text, currentX, this.currentY);\n          currentX += this.safeGetTextWidth(segment.text);\n        });\n\n        // 恢复默认字体和字号\n        this.pdf.setFont(this.chineseFontName, 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(50, 50, 50);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 绘制最后的边框和行号分隔线\n    const endPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    \n    // 如果跨页，需要在每一页绘制边框\n    for (let page = blockStartPage; page <= endPage; page++) {\n      this.pdf.setPage(page);\n      const isFirst = (page === blockStartPage);\n      const isLast = (page === endPage);\n      \n      let boxStartY, boxEndY;\n      if (isFirst && isLast) {\n        // 单页代码块\n        boxStartY = blockStartY - padding;\n        boxEndY = this.currentY + padding;\n      } else if (isFirst) {\n        // 第一页\n        boxStartY = blockStartY - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      } else if (isLast) {\n        // 最后一页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = this.currentY + padding;\n      } else {\n        // 中间页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      }\n      \n      // 绘制边框\n      this.pdf.setDrawColor(200, 200, 200);\n      this.pdf.setLineWidth(0.3);\n      if (isFirst && isLast) {\n        this.pdf.roundedRect(PDF_STYLES.MARGIN_LEFT, boxStartY, maxWidth, boxEndY - boxStartY, 1.5, 1.5, 'S');\n      } else {\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT, boxEndY);\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        if (isFirst) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY);\n        }\n        if (isLast) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxEndY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        }\n      }\n      \n      // 绘制行号分隔线\n      this.pdf.setDrawColor(220, 220, 220);\n      this.pdf.setLineWidth(0.2);\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxStartY,\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxEndY\n      );\n    }\n\n    // 确保回到最后一页\n    this.pdf.setPage(endPage);\n    \n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 解析markdown格式的文本并渲染（包括LaTeX源码）\n   */\n  renderMarkdownText(text, maxWidth) {\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    const cleanedText = cleanText(text);\n    if (!cleanedText || cleanedText.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 按行处理文本\n    const lines = cleanedText.split('\\n');\n\n    for (const line of lines) {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n      // 处理不同类型的行\n      if (line.trim() === '') {\n        // 空行\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      } else if (line.match(/^#{1,6}\\s/)) {\n        // 标题\n        this.renderMarkdownHeading(line, maxWidth);\n      } else if (line.match(/^(---|___|\\*\\*\\*)$/)) {\n        // 水平分隔线（---, ___, 或 ***）\n        this.renderHorizontalRule(maxWidth);\n      } else if (line.match(/^>\\s/)) {\n        // 引用\n        this.renderMarkdownQuote(line, maxWidth);\n      } else if (line.match(/^[-*+]\\s/) || line.match(/^\\d+\\.\\s/)) {\n        // 列表\n        this.renderMarkdownList(line, maxWidth);\n      } else {\n        // 普通文本（可能包含行内格式和LaTeX）\n        this.renderMarkdownInlineFormats(line, maxWidth);\n      }\n    }\n  }\n\n  /**\n   * 渲染水平分隔线\n   */\n  renderHorizontalRule(maxWidth) {\n    // 上方留白\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.8;\n\n    const lineY = this.currentY;\n\n    // 绘制水平线 - 使用更淡的颜色和更细的线条\n    this.pdf.setDrawColor(230, 230, 230);  // 浅灰色，不突兀\n    this.pdf.setLineWidth(0.2);  // 细线\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      lineY,\n      PDF_STYLES.MARGIN_LEFT + maxWidth,\n      lineY\n    );\n\n    // <hr/> 下方留白（给下面内容足够间隔）\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 4;\n  }\n\n  /**\n   * 渲染markdown标题\n   */\n  renderMarkdownHeading(line, maxWidth) {\n    const match = line.match(/^(#{1,6})\\s+(.+)$/);\n    if (!match) {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const level = match[1].length;\n    const text = match[2];\n\n    // 根据标题级别设置字体大小\n    const fontSize = PDF_STYLES.FONT_SIZE_BODY + (7 - level) * 2;\n    const oldFontSize = this.pdf.internal.getFontSize();\n\n    this.pdf.setFontSize(fontSize);\n    // 使用粗体字体（如果可用）\n    this.safeSetFont(this.chineseFontName, 'bold');\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, maxWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(fontSize);\n        const cleanLine = cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n      });\n    } catch (error) {\n      console.error('[PDF导出] 标题渲染失败:', error);\n      this.pdf.text(text, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 恢复字体\n    this.pdf.setFontSize(oldFontSize);\n    this.safeSetFont(this.chineseFontName, 'normal');\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.5; // 标题后额外间距\n  }\n\n  /**\n   * 渲染markdown引用\n   */\n  renderMarkdownQuote(line, maxWidth) {\n    const text = line.replace(/^>\\s*/, '');\n    const quoteWidth = maxWidth - 8;\n    const quoteX = PDF_STYLES.MARGIN_LEFT + 6;\n\n    // 绘制左侧竖线\n    this.pdf.setDrawColor(150, 150, 150);\n    this.pdf.setLineWidth(0.5);\n\n    const startY = this.currentY - 2;\n\n    // 渲染文本\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(100, 100, 100);\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, quoteWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n        const cleanLine = cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, quoteX, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      });\n\n      // 绘制引用线\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + 2,\n        startY,\n        PDF_STYLES.MARGIN_LEFT + 2,\n        this.currentY - 2\n      );\n    } catch (error) {\n      console.error('[PDF导出] 引用渲染失败:', error);\n      this.pdf.text(text, quoteX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复颜色\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染markdown列表（包括LaTeX源码）\n   */\n  renderMarkdownList(line, maxWidth) {\n    let bullet = '';\n    let text = '';\n\n    // 检测列表类型\n    const unorderedMatch = line.match(/^([-*+])\\s+(.+)$/);\n    const orderedMatch = line.match(/^(\\d+)\\.\\s+(.+)$/);\n\n    if (unorderedMatch) {\n      bullet = '•'; // 使用圆点作为项目符号\n      text = unorderedMatch[2];\n    } else if (orderedMatch) {\n      bullet = orderedMatch[1] + '.';\n      text = orderedMatch[2];\n    } else {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const bulletWidth = this.safeGetTextWidth(bullet + '  ');\n    const textWidth = maxWidth - bulletWidth;\n    const textX = PDF_STYLES.MARGIN_LEFT + bulletWidth;\n\n    // 渲染项目符号\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.text(bullet, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n\n    // 解析并渲染带格式的文本\n    try {\n      // 解析行内markdown格式（粗体、斜体、LaTeX等）\n      const segments = parseInlineMarkdown(text);\n\n      // 使用renderInlineSegments渲染，但需要调整左边距\n      const originalMarginLeft = PDF_STYLES.MARGIN_LEFT;\n      PDF_STYLES.MARGIN_LEFT = textX; // 临时调整左边距以对齐列表文本\n\n      this.renderInlineSegments(segments, textWidth);\n\n      PDF_STYLES.MARGIN_LEFT = originalMarginLeft; // 恢复原始边距\n    } catch (error) {\n      console.error('[PDF导出] 列表渲染失败:', error);\n      this.pdf.text(text, textX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n  }\n\n  /**\n   * 渲染包含行内格式的markdown文本（包括LaTeX源码）\n   */\n  renderMarkdownInlineFormats(line, maxWidth) {\n    if (!line || line.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 解析行内格式（包括LaTeX）\n    const segments = parseInlineMarkdown(line);\n\n    // 按行渲染segments（包括LaTeX）\n    this.renderInlineSegments(segments, maxWidth);\n  }\n\n  /**\n   * 渲染行内格式的文本片段（包括LaTeX源码）\n   */\n  renderInlineSegments(segments, maxWidth) {\n    let currentX = PDF_STYLES.MARGIN_LEFT;\n    let currentLineText = '';\n    let currentLineSegments = [];\n\n    segments.forEach((segment, idx) => {\n      // 对于LaTeX，需要先转换为Unicode来计算实际渲染宽度\n      let text;\n      let textWidth;\n\n      if (segment.type === 'latex-inline') {\n        // 使用LaTeX渲染器的simplifyLaTeX方法转换为Unicode\n        const renderer = this.getLatexRenderer();\n        text = renderer.simplifyLaTeX(segment.text);\n        // 计算转换后Unicode文本的宽度\n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      } else {\n        text = cleanText(segment.text || '');\n        if (!text) return;\n        // 设置样式并测量宽度\n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      }\n\n      const availableWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - currentX;\n\n      // 如果单个 segment 本身就超过可用宽度，需要拆分\n      if (textWidth > availableWidth && currentLineSegments.length === 0) {\n        // LaTeX公式不应被分割，直接渲染（即使超出边界）\n        if (segment.type === 'latex-inline') {\n          console.warn('[PDF导出] LaTeX公式过长，保持完整渲染:', segment.text);\n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n          return;\n        }\n\n        // 这是新行的第一个 segment，但它太长了\n        // 尝试使用 splitTextToSize 拆分\n        try {\n          const maxSegmentWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n          let splitLines = this.pdf.splitTextToSize(text, maxSegmentWidth);\n          // 应用中文标点避头尾规则\n          splitLines = applyCJKPunctuationRules(splitLines);\n\n          // 渲染除最后一行外的所有行\n          for (let i = 0; i < splitLines.length - 1; i++) {\n            this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: splitLines[i]\n            }];\n            this.renderSegmentLine(currentLineSegments);\n            this.currentY += PDF_STYLES.LINE_HEIGHT;\n          }\n\n          // 最后一行准备与后续 segment 合并\n          const lastLine = splitLines[splitLines.length - 1];\n          const lastLineWidth = this.safeGetTextWidth(lastLine);\n          currentLineSegments = [{\n            ...segment,\n            x: PDF_STYLES.MARGIN_LEFT,\n            text: lastLine\n          }];\n          currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n        } catch (error) {\n          console.warn('[PDF导出] 文本拆分失败，强制换行:', error);\n          // 如果拆分失败，直接渲染（可能会超出边界，但至少不会崩溃）\n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          if (segment.type !== 'latex-inline') {\n            segmentData.text = text;\n          }\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n        }\n        return;\n      }\n\n      // 检查是否需要换行\n      if (currentX + textWidth > PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT && currentLineSegments.length > 0) {\n        // 先检查是否需要分页\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n        // 渲染当前行\n        this.renderSegmentLine(currentLineSegments);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n        // 重置行状态\n        currentX = PDF_STYLES.MARGIN_LEFT;\n        currentLineSegments = [];\n\n        // 重新检查新行上这个 segment 是否超出边界\n        if (textWidth > maxWidth) {\n          // LaTeX公式不应被分割\n          if (segment.type === 'latex-inline') {\n            console.warn('[PDF导出] LaTeX公式过长（换行后仍超宽），保持完整渲染:', segment.text);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + textWidth;\n            return;\n          }\n\n          // 即使在新行，segment 仍然太长，需要拆分\n          try {\n            let splitLines = this.pdf.splitTextToSize(text, maxWidth);\n            // 应用中文标点避头尾规则\n            splitLines = applyCJKPunctuationRules(splitLines);\n            for (let i = 0; i < splitLines.length - 1; i++) {\n              this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n              const tempSegments = [{\n                ...segment,\n                x: PDF_STYLES.MARGIN_LEFT,\n                text: splitLines[i]\n              }];\n              this.renderSegmentLine(tempSegments);\n              this.currentY += PDF_STYLES.LINE_HEIGHT;\n            }\n            // 最后一行\n            const lastLine = splitLines[splitLines.length - 1];\n            const lastLineWidth = this.safeGetTextWidth(lastLine);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: lastLine\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n          } catch (error) {\n            console.warn('[PDF导出] 文本拆分失败:', error);\n            const segmentData = {\n              ...segment,\n              x: currentX\n            };\n            if (segment.type !== 'latex-inline') {\n              segmentData.text = text;\n            }\n            currentLineSegments.push(segmentData);\n            currentX += textWidth;\n          }\n          return;\n        }\n      }\n\n      // 添加到当前行\n      // 注意：对于latex-inline类型，保留原始的segment.text（不含$符号）\n      // 对于其他类型，使用清理后的text\n      const segmentData = {\n        ...segment,\n        x: currentX\n      };\n      // 只有非LaTeX类型才覆盖text字段\n      if (segment.type !== 'latex-inline') {\n        segmentData.text = text;\n      }\n      currentLineSegments.push(segmentData);\n      currentX += textWidth;\n    });\n\n    // 渲染最后一行\n    if (currentLineSegments.length > 0) {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      this.renderSegmentLine(currentLineSegments);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染一行 segment（支持行内 LaTeX）\n   */\n  renderSegmentLine(segments) {\n    segments.forEach(segment => {\n      this.applySegmentStyle(segment.type);\n\n      if (segment.type === 'latex-inline') {\n        try {\n          const renderer = this.getLatexRenderer();\n          renderer.renderInlineLaTeX(\n            segment.text,\n            segment.x,\n            this.currentY,\n            PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - segment.x\n          );\n        } catch (error) {\n          console.warn('[PDF导出] 行内LaTeX渲染失败，显示源码:', error);\n          this.pdf.text(segment.text, segment.x, this.currentY);\n        }\n      } else if (segment.type === 'link') {\n        this.pdf.textWithLink(segment.text, segment.x, this.currentY, {\n          url: segment.url || '#'\n        });\n        const textWidth = this.safeGetTextWidth(segment.text);\n        this.pdf.line(segment.x, this.currentY + 0.5, segment.x + textWidth, this.currentY + 0.5);\n      } else if (segment.type === 'code') {\n        const textWidth = this.safeGetTextWidth(segment.text);\n        const padding = 1;\n        this.pdf.setFillColor(245, 245, 245);\n        this.pdf.rect(segment.x - padding, this.currentY - 3, textWidth + padding * 2, 4, 'F');\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      } else {\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      }\n    });\n  }\n\n  /**\n   * 应用segment样式（包括LaTeX源码样式）\n   */\n  applySegmentStyle(type) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    switch (type) {\n      case 'latex-inline':\n        // LaTeX使用斜体字体（如果使用渲染器失败才会用到这个样式）\n        try {\n          this.pdf.setFont(this.chineseFontName, 'italic');\n        } catch (e) {\n          this.pdf.setFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n        this.pdf.setTextColor(50, 50, 50); // 深灰色\n        break;\n      case 'latex-display':\n        // Display LaTeX (handled separately in renderLatexDisplay)\n        break;\n      case 'bold':\n        console.log('[PDF导出] 应用粗体样式, 字体:', this.chineseFontName, '可用变体:', this.availableFontWeights);\n        // 使用粗体字体（如果可用，否则自动回退）\n        const boldSuccess = this.safeSetFont(this.chineseFontName, 'bold');\n        console.log('[PDF导出] safeSetFont 返回:', boldSuccess);\n        if (!boldSuccess) {\n          // 如果粗体字体不可用，使用明显的视觉区分\n          console.warn('[PDF导出] 粗体字体不可用，使用视觉回退方案: 深蓝色 RGB(20,20,150) + 字体大小', PDF_STYLES.FONT_SIZE_BODY + 1);\n          // 使用深蓝色 + 增大字体来明显区分粗体\n          this.pdf.setTextColor(20, 20, 150); // 深蓝色，非常明显\n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 1); // 增加1pt，更明显\n        } else {\n          console.log('[PDF导出] 使用字体粗体变体');\n        }\n        break;\n      case 'italic':\n        // 使用 light 字体表示斜体（中文字体通常没有真正的斜体）\n        const lightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!lightSuccess) {\n          // 如果没有 light，用颜色区分\n          this.pdf.setTextColor(70, 130, 180); // 蓝色表示强调\n        }\n        break;\n      case 'bold-italic':\n        // 粗斜体：尝试使用 bold，如果没有则用 normal + 颜色\n        const boldItalicSuccess = this.safeSetFont(this.chineseFontName, 'bolditalic');\n        if (!boldItalicSuccess) {\n          // 回退：尝试只用 bold\n          const boldOnlySuccess = this.safeSetFont(this.chineseFontName, 'bold');\n          if (!boldOnlySuccess) {\n            // bold 也不可用，使用深蓝色区分\n            this.pdf.setTextColor(30, 60, 120); // 深蓝色（粗体+斜体）\n            this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 0.5);\n          } else {\n            // bold 可用，添加颜色表示斜体\n            this.pdf.setTextColor(70, 130, 180); // 蓝色表示斜体\n          }\n        }\n        break;\n      case 'code':\n        this.pdf.setFont('courier', 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(220, 50, 50);\n        break;\n      case 'link':\n        // 使用 light 字体和蓝色表示链接\n        const linkLightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!linkLightSuccess) {\n          this.safeSetFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setTextColor(0, 102, 204); // 蓝色\n        break;\n      default:\n        this.safeSetFont(this.chineseFontName, 'normal');\n    }\n  }\n\n  /**\n   * 渲染thinking区块\n   */\n  renderThinking(thinking) {\n    this.renderSection('💭 Thinking', thinking, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染Artifact\n   */\n  renderArtifact(artifact) {\n    const title = `📄 Artifact: ${artifact.title || 'Untitled'}`;\n    const content = artifact.content || '';\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染工具调用\n   */\n  renderTool(tool) {\n    const title = `🔧 Tool: ${tool.name || 'Unknown'}`;\n    const content = `Input: ${JSON.stringify(tool.input, null, 2)}\\n\\nOutput: ${tool.output || 'N/A'}`;\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染引用\n   */\n  renderCitations(citations) {\n    const title = '📚 Citations';\n    const content = citations.map((cit, i) =>\n      `[${i + 1}] ${cit.title || cit.url || 'Unknown'}`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染附件\n   */\n  renderAttachments(attachments) {\n    const title = '📎 Attachments';\n    const content = attachments.map((att, i) =>\n      `[${i + 1}] ${att.file_name || att.name || 'file'} (${att.file_type || att.type || 'unknown'})`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 通用区块渲染(带背景)\n   */\n  renderSection(title, content, bgColor) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_H2 + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    \n    // 清理标题和内容\n    const cleanTitle = cleanText(title);\n    const cleanContent = cleanText(content);\n    \n    // 处理内容换行,带错误处理\n    let contentLines;\n    try {\n      contentLines = this.pdf.splitTextToSize(cleanContent, maxWidth - 4);\n    } catch (error) {\n      console.error('[PDF导出] 区块内容分割失败:', error);\n      contentLines = cleanContent.split('\\n');\n    }\n    \n    const bgHeight = PDF_STYLES.LINE_HEIGHT * (contentLines.length + 2);\n\n    // 绘制背景\n    this.pdf.setFillColor(...bgColor);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      bgHeight,\n      'F'\n    );\n\n    // 渲染标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H2);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    if (cleanTitle && cleanTitle.trim().length > 0) {\n      this.pdf.text(cleanTitle, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    }\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n\n    // 渲染内容\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    contentLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染目录（Table of Contents）带页码链接\n   */\n  renderTOCWithLinks(tocPage, messages) {\n    // 切换到目录页\n    this.pdf.setPage(tocPage);\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n\n    // 渲染目录标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H1);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.pdf.text('Table of Contents', PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 2;\n\n    // 绘制标题下方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.3);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      this.currentY\n    );\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // 渲染消息列表\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.manager.messageAnchors.forEach((anchor, idx) => {\n      const message = messages[idx];\n      if (!message) return;\n\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY * 2);\n\n      const messageNumber = `${anchor.index}.`;\n      const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n\n      // 获取消息预览（前50个字符）\n      let preview = anchor.title || '';\n      preview = cleanText(preview);\n      preview = preview.replace(/\\n/g, ' ').substring(0, 50);\n      if (preview.length >= 50) {\n        preview += '...';\n      }\n\n      // 添加分支标记\n      let branchMarker = '';\n      if (message.branchInfo?.isBranchPoint) {\n        branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      }\n\n      // 构建目录条目和页码\n      const entry = `${messageNumber} ${sender}${branchMarker}`;\n      const pageNum = `p.${anchor.page}`;\n\n      // 设置发送者颜色\n      const color = anchor.sender === 'human'\n        ? PDF_STYLES.COLOR_SENDER_HUMAN\n        : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n      this.pdf.setTextColor(...color);\n\n      // 计算页码位置（右对齐）\n      const pageNumWidth = this.safeGetTextWidth(pageNum);\n      const pageNumX = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageNumWidth;\n\n      // 渲染条目（作为链接）\n      const entryY = this.currentY;\n      this.pdf.textWithLink(entry, PDF_STYLES.MARGIN_LEFT + 5, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染页码（也作为链接）\n      this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n      this.pdf.textWithLink(pageNum, pageNumX, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染预览（如果有）\n      if (preview) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.text(preview, PDF_STYLES.MARGIN_LEFT + 10, this.currentY);\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n      }\n\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n  }\n\n  /**\n   * 渲染页脚\n   */\n  renderFooter(pageNumber, totalPages) {\n    const originalY = this.currentY;\n    const originalFontSize = this.pdf.internal.getFontSize();\n\n    // 设置页脚样式\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_FOOTER);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_FOOTER);\n\n    const footerY = PDF_STYLES.PAGE_HEIGHT - 10;\n\n    // 绘制页脚上方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.1);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT\n    );\n\n    // 左侧显示导出时间\n    const exportText = `Exported: ${this.manager.exportDate}`;\n    this.pdf.text(exportText, PDF_STYLES.MARGIN_LEFT, footerY);\n\n    // 右侧显示页码\n    const pageText = `${pageNumber} / ${totalPages}`;\n    const pageTextWidth = this.safeGetTextWidth(pageText);\n    this.pdf.text(pageText, PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageTextWidth, footerY);\n\n    // 恢复原始设置\n    this.pdf.setFontSize(originalFontSize);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY = originalY;\n  }\n}\n","// utils/export/pdfExportManager_new.js\n// PDF导出管理器 - 基于jsPDF实现纯文本PDF导出\n//\n// 使用 ARUDJingxihei 字体家族支持中文显示（Regular、Bold、Light 三种字重）\n// 支持 Markdown 渲染（标题、粗体、斜体、列表、引用等）\n// 支持 LaTeX 数学公式渲染（行内和块级）\nimport { jsPDF } from 'jspdf';\nimport { DateTimeUtils } from '../fileParser';\nimport { addChineseFontSupport } from './pdfFontHelper';\nimport { ContentRenderer, PDF_STYLES } from './pdfContentRenderers';\nimport * as textHelpers from './pdfTextHelpers';\n\n/**\n * PDF导出管理器类\n */\nexport class PDFExportManager {\n  constructor() {\n    this.pdf = null;\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n    this.config = {};\n    this.useChineseFont = false; // 是否成功加载了中文字体\n    this.chineseFontName = 'helvetica'; // 当前使用的字体名称\n    this.availableFontWeights = []; // 可用的字体变体 (normal, bold, light 等)\n    this.isSystemFont = false; // 是否使用系统字体\n    this.meta = null; // 保存元数据用于页脚\n    this.exportDate = null; // 导出时间\n    this.messageAnchors = []; // 保存每条消息的位置信息用于目录链接和书签\n    this.contentRenderer = null; // 内容渲染器实例\n    \n    // 绑定文本辅助方法到实例\n    this.cleanText = textHelpers.cleanText;\n    this.parseTextWithCodeBlocksAndLatex = textHelpers.parseTextWithCodeBlocksAndLatex;\n    this.parseInlineMarkdown = textHelpers.parseInlineMarkdown;\n    this.applyCJKPunctuationRules = textHelpers.applyCJKPunctuationRules;\n    this.parseCodeLineBold = textHelpers.parseCodeLineBold;\n  }\n\n  /**\n   * 安全地设置字体，如果字体变体不可用则自动回退\n   * @param {string} fontName - 字体名称\n   * @param {string} fontStyle - 字体样式 (normal, bold, light, italic, bolditalic)\n   * @returns {boolean} - 是否成功设置\n   */\n  safeSetFont(fontName, fontStyle = 'normal') {\n    return textHelpers.safeSetFont(this.pdf, fontName, fontStyle, this.availableFontWeights);\n  }\n\n  /**\n   * 安全地获取文本宽度，处理字体元数据缺失的情况\n   * @param {string} text - 要测量的文本\n   * @returns {number} - 文本宽度\n   */\n  safeGetTextWidth(text) {\n    return textHelpers.safeGetTextWidth(this.pdf, text, this.chineseFontName);\n  }\n\n  /**\n   * 安全地渲染文本，自动处理边界\n   * @param {string} text - 要渲染的文本\n   * @param {number} x - X 坐标\n   * @param {number} y - Y 坐标\n   * @param {number} maxWidth - 最大宽度（可选）\n   */\n  safeRenderText(text, x, y, maxWidth = null) {\n    return textHelpers.safeRenderText(this.pdf, text, x, y, maxWidth);\n  }\n\n  /**\n   * 主导出方法\n   * @param {Array} messages - 消息列表\n   * @param {Object} meta - 元数据(title, platform, created_at, updated_at)\n   * @param {Object} config - 导出配置\n   */\n  async exportToPDF(messages, meta, config = {}) {\n    console.log('[PDF导出] 开始导出', {\n      messageCount: messages.length,\n      config\n    });\n\n    // 保存元数据和导出时间\n    this.meta = meta;\n    this.exportDate = DateTimeUtils.formatDateTime(new Date());\n    this.messageAnchors = []; // 重置消息锚点\n\n    this.config = {\n      includeThinking: config.includeThinking ?? true,\n      includeArtifacts: config.includeArtifacts ?? true,\n      includeTimestamps: config.includeTimestamps ?? false,\n      includeTools: config.includeTools ?? true,\n      includeCitations: config.includeCitations ?? true,\n      highQuality: config.highQuality ?? false,\n      ...config\n    };\n\n    // 初始化PDF文档\n    this.pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4',\n      compress: true\n    });\n\n    // 尝试加载中文字体（异步加载可能需要时间）\n    try {\n      console.log('[PDF导出] 开始加载中文字体...');\n      console.log('[PDF导出] 调用 addChineseFontSupport(this.pdf)...');\n      const fontLoadResult = await addChineseFontSupport(this.pdf);\n      console.log('[PDF导出] addChineseFontSupport 返回结果:', fontLoadResult);\n\n      this.useChineseFont = fontLoadResult.success;\n      this.chineseFontName = fontLoadResult.fontName;\n      this.availableFontWeights = fontLoadResult.availableWeights || [];\n      this.isSystemFont = fontLoadResult.isSystemFont || false;\n\n      if (!this.useChineseFont) {\n        console.warn('[PDF导出] ⚠️ 中文字体加载失败，将使用默认字体（中文可能显示为方框）');\n        console.warn('[PDF导出] fontLoadResult详情:', JSON.stringify(fontLoadResult, null, 2));\n        if (fontLoadResult.systemFontAvailable) {\n          console.warn('[PDF导出] 提示：检测到系统有中文字体，但无法在浏览器环境中直接使用');\n          console.warn('[PDF导出] 建议：请确保项目 public/fonts/ 目录下有中文字体文件');\n        }\n      } else {\n        const fontType = this.isSystemFont ? '系统字体' : '项目字体';\n        console.log(`[PDF导出] ✅ 中文字体加载成功: ${this.chineseFontName} (${fontType})`);\n        console.log(`[PDF导出] 可用字体变体: ${this.availableFontWeights.join(', ')}`);\n        if (fontLoadResult.systemFontInfo) {\n          console.log(`[PDF导出] 系统字体信息: ${fontLoadResult.systemFontInfo.fontName}`);\n        }\n      }\n    } catch (error) {\n      console.error('[PDF导出] ❌ 字体加载异常:', error);\n      console.error('[PDF导出] 错误堆栈:', error.stack);\n      this.useChineseFont = false;\n      this.chineseFontName = 'helvetica';\n      this.availableFontWeights = [];\n      this.isSystemFont = false;\n    }\n\n    // 无论字体是否加载成功，都设置一个默认字体\n    this.pdf.setFont(this.chineseFontName);\n\n    // 创建内容渲染器实例\n    this.contentRenderer = new ContentRenderer(this);\n\n    // 渲染文档\n    this.contentRenderer.renderTitle(meta);\n    this.contentRenderer.renderMetadata(meta);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n\n    // 渲染消息（LaTeX显示为源码）\n    for (let i = 0; i < messages.length; i++) {\n      const message = messages[i];\n\n      // 分页策略：一轮对话（用户消息+AI回复）结束后再换页\n      // 只有当前是用户消息且不是第一条时才换页，这样一轮对话会在同一页或连续页面上\n      if (i > 0 && message.sender === 'human') {\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n      }\n\n      this.contentRenderer.renderMessage(message, i + 1);\n    }\n\n    // 生成目录（放在文档最后，避免页码混乱）\n    const hasTOC = messages.length > 1;\n    if (hasTOC) {\n      console.log('[PDF导出] 生成目录（位于文档末尾）...');\n      this.pdf.addPage();\n      const tocPageNumber = this.pdf.internal.getCurrentPageInfo().pageNumber;\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n      this.contentRenderer.renderTOCWithLinks(tocPageNumber, messages);\n    }\n\n    // 添加PDF书签\n    console.log('[PDF导出] 添加PDF书签...');\n    this.addBookmarks();\n\n    // 为所有页面添加页脚\n    console.log('[PDF导出] 添加页脚...');\n    this.addFooters();\n\n    // 生成文件名并保存\n    const fileName = this.generateFileName(meta);\n    this.pdf.save(fileName);\n\n    console.log('[PDF导出] 导出完成:', fileName);\n    return true;\n  }\n\n  /**\n   * 添加PDF书签（outline）\n   */\n  addBookmarks() {\n    if (this.messageAnchors.length === 0) return;\n\n    // jsPDF的outline功能\n    // 创建书签树结构\n    try {\n      this.messageAnchors.forEach((anchor) => {\n        const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n        const title = `${anchor.index}. ${sender}`;\n\n        // 使用jsPDF的outline API\n        // 注意：jsPDF的outline功能可能需要插件支持\n        if (this.pdf.outline) {\n          this.pdf.outline.add(null, title, { pageNumber: anchor.page });\n        }\n      });\n    } catch (error) {\n      console.warn('[PDF导出] 书签添加失败（可能不支持）:', error);\n    }\n  }\n\n  /**\n   * 为所有页面添加页脚\n   */\n  addFooters() {\n    const totalPages = this.pdf.internal.getNumberOfPages();\n\n    for (let i = 1; i <= totalPages; i++) {\n      this.pdf.setPage(i);\n      this.contentRenderer.renderFooter(i, totalPages);\n    }\n  }\n\n  /**\n   * 检查是否需要分页\n   */\n  checkPageBreak(requiredSpace = 20) {\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    if (this.currentY + requiredSpace > bottomLimit) {\n      this.pdf.addPage();\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n    }\n  }\n\n  /**\n   * 将代码行按页分组\n   * @param {Array} wrappedLines - 包装后的代码行\n   * @returns {Array} - 分组后的行 [{page, startY, lines: [...]}]\n   */\n  groupCodeLinesByPage(wrappedLines) {\n    const groups = [];\n    let currentGroup = null;\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    let simulatedY = this.currentY;\n    let simulatedPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    wrappedLines.forEach((line) => {\n      // 检查是否需要换页\n      if (simulatedY + PDF_STYLES.FONT_SIZE_CODE > bottomLimit) {\n        simulatedPage++;\n        simulatedY = PDF_STYLES.MARGIN_TOP;\n        currentGroup = null; // 开始新组\n      }\n\n      // 如果没有当前组或换页了，创建新组\n      if (!currentGroup || currentGroup.page !== simulatedPage) {\n        currentGroup = {\n          page: simulatedPage,\n          startY: simulatedY,\n          lines: []\n        };\n        groups.push(currentGroup);\n      }\n\n      // 添加行到当前组\n      currentGroup.lines.push(line);\n      simulatedY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    return groups;\n  }\n\n  /**\n   * 生成文件名\n   */\n  generateFileName(meta) {\n    const date = DateTimeUtils.getCurrentDate();\n    const cleanTitle = (meta.name || 'conversation').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n    return `${cleanTitle}_${date}.pdf`;\n  }\n\n  /**\n   * 获取平台前缀\n   */\n  getPlatformPrefix(platform) {\n    const platformLower = (platform || '').toLowerCase();\n\n    if (platformLower.includes('chatgpt')) return 'chatgpt';\n    if (platformLower.includes('gemini')) return 'gemini';\n    if (platformLower.includes('notebooklm')) return 'notebooklm';\n    if (platformLower.includes('aistudio')) return 'aistudio';\n    if (platformLower.includes('sillytavern')) return 'sillytavern';\n\n    return 'claude';\n  }\n}\n\n// 导出单例实例\nexport const pdfExportManager = new PDFExportManager();"],"names":["cleanText","text","cleaned","normalize","replace","ligatureMap","ligature","replacement","Object","entries","RegExp","quoteMap","from","to","ch","String","fromCharCode","charCodeAt","error","console","parseTextWithCodeBlocksAndLatex","parts","elements","codeBlockRegex","match","lastIndex","exec","language","trim","toLowerCase","content","log","push","start","index","end","length","type","latexDisplayRegex","latexBracketRegex","sort","a","b","filteredElements","forEach","element","some","existing","plainText","substring","parseInlineMarkdown","segments","matches","regex","pattern","source","isLatex","url","rawText","concat","filteredMatches","warn","lastEnd","segment","applyCJKPunctuationRules","lines","noLineStart","noLineEnd","result","prevLine","i","currentLine","test","punct","parseCodeLineBold","line","headingMatch","level","headingText","boldRegex","bold","heading","safeSetFont","pdf","fontName","fontStyle","arguments","undefined","availableFontWeights","includes","setFont","fallbackStyle","safeGetTextWidth","chineseFontName","font","getFont","metadata","Unicode","currentStyle","getTextWidth","fontSize","getFontSize","LATEX_UNICODE_MAP","SUPERSCRIPT_MAP","SUBSCRIPT_MAP","LaTeXRenderer","constructor","config","this","_objectSpread","color","useUnicode","renderInlineLaTeX","latex","x","y","maxWidth","simplified","simplifyLaTeX","hasComplexStructure","renderComplexLaTeX","setFontSize","setTextColor","e","width","renderDisplayLaTeX","centerX","textWidth","startX","setFillColor","rect","padding","height","convertToSuperscript","char","convertToSubscript","keys","command","split","map","join","isInline","parseComplexLaTeX","totalWidth","fracFontSize","numWidth","numerator","denWidth","denominator","Math","max","base","subSupFontSize","exponent","subscript","raw","currentX","maxHeight","hasFraction","fracWidth","renderFraction","sqrtWidth","renderSquareRoot","supWidth","renderSuperscript","subWidth","renderSubscript","fallbackText","fallbackWidth","remaining","fracRegex","fracMatch","beforeText","numOffset","denOffset","numX","setLineWidth","setDrawColor","denX","sqrtHeight","baseWidth","supFontSize","supText","subFontSize","subText","PDF_STYLES","FONT_SIZE_TITLE","FONT_SIZE_H1","FONT_SIZE_H2","FONT_SIZE_SENDER","FONT_SIZE_BODY","FONT_SIZE_CODE","FONT_SIZE_TIMESTAMP","FONT_SIZE_HEADER","FONT_SIZE_FOOTER","COLOR_SENDER_HUMAN","COLOR_SENDER_ASSISTANT","COLOR_TIMESTAMP","COLOR_CODE_BG","COLOR_SECTION_BG","COLOR_TEXT","COLOR_HEADER","COLOR_FOOTER","COLOR_BORDER","MARGIN_LEFT","MARGIN_RIGHT","MARGIN_TOP","MARGIN_BOTTOM","LINE_HEIGHT","SECTION_SPACING","MESSAGE_SPACING","FOOTER_HEIGHT","PAGE_WIDTH","PAGE_HEIGHT","ContentRenderer","manager","latexRenderer","currentY","value","safeRenderText","checkPageBreak","requiredSpace","renderTitle","meta","title","name","titleLines","splitTextToSize","cleanLine","renderMetadata","platform","created_at","updated_at","exportDate","renderMessage","message","_message$attachments","_message$artifacts","_message$tools","_message$citations","currentPage","internal","getCurrentPageInfo","pageNumber","messageAnchors","page","sender","display_text","renderSender","includeTimestamps","timestamp","renderTimestamp","thinking","includeThinking","renderThinking","renderBody","attachments","renderAttachments","artifacts","includeArtifacts","artifact","renderArtifact","tools","includeTools","tool","renderTool","citations","includeCitations","renderCitations","_message$branchInfo","senderLabel","label","finalLabel","branchInfo","isBranchPoint","childCount","cleanLabel","part","renderCodeBlock","renderLatexDisplay","renderMarkdownText","getLatexRenderer","renderLatexDisplayAsSource","roundedRect","renderPlainText","cleanedText","code","codeWidth","cleanCode","cleanLanguage","labelText","toUpperCase","labelWidth","codeLines","wrappedLines","lineNumber","wLine","idx","blockStartY","blockStartPage","firstPageHeight","min","_ref","currentPageBottom","addPage","remainingLines","newPageHeight","lineNumStr","padStart","safeLine","s","headingSizes","endPage","setPage","isFirst","isLast","boxStartY","boxEndY","renderMarkdownHeading","renderHorizontalRule","renderMarkdownQuote","renderMarkdownList","renderMarkdownInlineFormats","lineY","oldFontSize","l","quoteWidth","quoteX","startY","bullet","unorderedMatch","orderedMatch","bulletWidth","textX","originalMarginLeft","renderInlineSegments","currentLineSegments","applySegmentStyle","segmentData","maxSegmentWidth","splitLines","renderSegmentLine","lastLine","lastLineWidth","tempSegments","textWithLink","boldSuccess","renderSection","JSON","stringify","input","output","cit","att","file_name","file_type","bgColor","cleanTitle","cleanContent","contentLines","bgHeight","renderTOCWithLinks","tocPage","messages","anchor","_message$branchInfo2","messageNumber","preview","branchMarker","entry","pageNum","pageNumWidth","pageNumX","entryY","renderFooter","totalPages","originalY","originalFontSize","footerY","exportText","pageText","pageTextWidth","PDFExportManager","useChineseFont","isSystemFont","contentRenderer","textHelpers","truncated","exportToPDF","_config$includeThinki","_config$includeArtifa","_config$includeTimest","_config$includeTools","_config$includeCitati","_config$highQuality","messageCount","DateTimeUtils","formatDateTime","Date","highQuality","jsPDF","orientation","unit","format","compress","fontLoadResult","addChineseFontSupport","success","availableWeights","fontType","systemFontInfo","systemFontAvailable","stack","tocPageNumber","addBookmarks","addFooters","fileName","generateFileName","save","outline","add","getNumberOfPages","bottomLimit","groupCodeLinesByPage","groups","currentGroup","simulatedY","simulatedPage","date","getCurrentDate","getPlatformPrefix","platformLower"],"sourceRoot":""}