{"version":3,"file":"static/js/654.23abb5fa.chunk.js","mappings":"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","sources":["utils/export/pdfFontHelper.js","utils/export/pdfTextHelpers.js","utils/export/pdfLatexRenderer.js","utils/export/pdfContentRenderers.js","utils/export/pdfExportManager.js"],"sourcesContent":["// utils/export/pdfFontHelper.js\n// PDF中文字体支持 - 使用 ARUDJingxihei (阿如汉字黑体) 字体家族\n//\n// 当前实现：\n// - 使用 public/fonts/ARUDJingxihei-Regular.ttf (正常字重)\n// - 使用 public/fonts/ARUDJingxihei-Bold.ttf (粗体字重)\n// - 使用 public/fonts/ARUDJingxihei-Light.ttf (细体字重)\n// - 支持多字重变体，可正确渲染粗体标题和强调文本\n// - 包含完整的验证流程（Content-Type、TTF魔数、cmap表）\n\n/**\n * 验证字体是否包含必要的 Unicode cmap\n * @param {ArrayBuffer} arrayBuffer - 字体文件内容\n * @returns {boolean} - 是否包含 cmap\n */\nfunction hasUnicodeCmap(arrayBuffer) {\n  try {\n    const dataView = new DataView(arrayBuffer);\n    \n    // TTF 文件以特定的魔数开头\n    const version = dataView.getUint32(0, false);\n    // 0x00010000 或 'true' 或 'typ1' 或 'OTTO'\n    if (version !== 0x00010000 && version !== 0x74727565) {\n      console.warn('[PDF字体] 可能不是标准TTF格式');\n    }\n    \n    // 简单检查: 查找 'cmap' 表\n    const buffer = new Uint8Array(arrayBuffer);\n    const cmapSignature = [0x63, 0x6d, 0x61, 0x70]; // 'cmap'\n    \n    for (let i = 0; i < Math.min(buffer.length - 4, 1000); i++) {\n      if (buffer[i] === cmapSignature[0] &&\n          buffer[i+1] === cmapSignature[1] &&\n          buffer[i+2] === cmapSignature[2] &&\n          buffer[i+3] === cmapSignature[3]) {\n        console.log('[PDF字体] 找到 cmap 表');\n        return true;\n      }\n    }\n    \n    console.warn('[PDF字体] 未找到 cmap 表特征');\n    return false;\n  } catch (error) {\n    console.error('[PDF字体] cmap 检查失败:', error);\n    return false;\n  }\n}\n\n/**\n * 从项目资源加载字体文件并添加到PDF\n * @param {jsPDF} pdf - jsPDF实例\n * @param {string} fontPath - 字体文件路径 (相对于public目录)\n * @param {string} fontName - 字体名称\n * @param {string} fontStyle - 字体样式 (normal, bold, light 等)\n * @returns {Promise<boolean>} - 是否成功加载字体\n */\nasync function loadFontFromProject(pdf, fontPath, fontName = 'CustomFont', fontStyle = 'normal') {\n  try {\n    console.log(`[PDF字体] 正在加载字体: ${fontPath}`);\n\n    // 使用新的缓存系统加载字体数据\n    const { arrayBuffer, base64 } = await loadFontData(fontPath);\n\n    // 验证字体是否包含 cmap 表（仅在首次下载时警告）\n    if (!FontCache.has(fontPath)) {\n      const hasCmap = hasUnicodeCmap(arrayBuffer);\n      if (!hasCmap) {\n        console.warn(`[PDF字体] 警告: 字体可能缺少 Unicode cmap 表`);\n      }\n    }\n\n    // 添加字体到jsPDF\n    const fileName = fontPath.split('/').pop();\n\n    try {\n      pdf.addFileToVFS(fileName, base64);\n      pdf.addFont(fileName, fontName, fontStyle);\n      console.log(`[PDF字体] ✓ 字体注册成功: ${fontName}-${fontStyle}`);\n      return true;\n    } catch (addFontError) {\n      console.error(`[PDF字体] addFont 失败:`, addFontError.message);\n      console.error(`[PDF字体] 这通常意味着字体不兼容 jsPDF`);\n      return false;\n    }\n  } catch (error) {\n    console.error('[PDF字体] 字体加载失败:', error);\n    return false;\n  }\n}\n\n/**\n * 为PDF添加中文字体支持（多字重版本）\n * 尝试加载项目中的中文字体，支持 Regular、Light、Bold 三个字重\n *\n * @param {jsPDF} pdf - jsPDF实例\n * @returns {Promise<{success: boolean, fontName: string, availableWeights: string[]}>} - 加载结果和字体名称\n */\nexport async function addChineseFontSupport(pdf) {\n  console.log('[PDF字体] 开始加载 ARUDJingxihei 字体家族...');\n\n  // 定义字体配置 - 使用阿如汉字黑体\n  const fontConfigs = [\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Regular.ttf',\n      name: 'ARUDJingxihei',\n      style: 'normal',\n      weight: 400,\n      description: 'Regular (正常)'\n    },\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Bold.ttf',\n      name: 'ARUDJingxihei',\n      style: 'bold',\n      weight: 700,\n      description: 'Bold (粗体)'\n    },\n    {\n      path: '/lyra-exporter/fonts/ARUDJingxihei-Light.ttf',\n      name: 'ARUDJingxihei',\n      style: 'light',\n      weight: 300,\n      description: 'Light (细体)'\n    },\n  ];\n\n  let loadedCount = 0;\n  let fontName = 'helvetica';\n  const availableWeights = [];\n\n  for (const config of fontConfigs) {\n    try {\n      const success = await loadFontFromProject(\n        pdf,\n        config.path,\n        config.name,\n        config.style  // 传入样式参数\n      );\n      if (success) {\n        loadedCount++;\n        fontName = config.name;\n        availableWeights.push(config.style);\n        console.log(`[PDF字体] ✓ 加载成功: ${config.name}-${config.style} (${config.description})`);\n      }\n    } catch (error) {\n      console.warn(`[PDF字体] ✗ 跳过: ${config.path} - ${error.message}`);\n    }\n  }\n\n  if (loadedCount === 0) {\n    console.warn('[PDF字体] ✗ 未能加载任何 ARUDJingxihei 字体');\n    console.warn('[PDF字体] 将使用 helvetica 默认字体 (中文可能显示为方块)');\n    pdf.setFont('helvetica');\n    return { success: false, fontName: 'helvetica', availableWeights: [] };\n  }\n\n  console.log(`[PDF字体] ✓ 成功加载 ${loadedCount} 个字体变体: ${availableWeights.join(', ')}`);\n\n  // 设置默认字体为 normal\n  try {\n    pdf.setFont(fontName, 'normal');\n  } catch (error) {\n    console.warn('[PDF字体] ⚠ 设置默认字体失败，使用第一个可用字重');\n    pdf.setFont(fontName, availableWeights[0] || 'normal');\n  }\n\n  return { success: true, fontName, availableWeights };\n}\n\n// ==================== 字体预加载系统 ====================\n\n/**\n * 字体加载状态\n */\nconst FontLoadingState = {\n  isLoading: false,\n  isLoaded: false,\n  error: null\n};\n\n/**\n * 字体缓存（存储在内存中，避免重复下载）\n * 结构：{ [fontPath]: { arrayBuffer, base64, timestamp } }\n */\nconst FontCache = new Map();\n\n/**\n * 从缓存或网络加载字体文件\n * @param {string} fontPath - 字体路径\n * @returns {Promise<{arrayBuffer: ArrayBuffer, base64: string}>} - 字体数据\n */\nasync function loadFontData(fontPath) {\n  // 1. 检查内存缓存\n  if (FontCache.has(fontPath)) {\n    const cached = FontCache.get(fontPath);\n    console.log(`[PDF字体] ✓ 使用内存缓存: ${fontPath}`);\n    return { arrayBuffer: cached.arrayBuffer, base64: cached.base64 };\n  }\n\n  // 2. 检查 IndexedDB 缓存\n  try {\n    const dbCache = await loadFromIndexedDB(fontPath);\n    if (dbCache) {\n      console.log(`[PDF字体] ✓ 使用 IndexedDB 缓存: ${fontPath}`);\n      // 同步到内存缓存\n      FontCache.set(fontPath, {\n        arrayBuffer: dbCache.arrayBuffer,\n        base64: dbCache.base64,\n        timestamp: Date.now()\n      });\n      return dbCache;\n    }\n  } catch (error) {\n    console.warn(`[PDF字体] IndexedDB 读取失败: ${error.message}`);\n  }\n\n  // 3. 从网络下载\n  console.log(`[PDF字体] 从网络下载: ${fontPath}`);\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 10000); // 10秒超时\n\n  try {\n    // 使用浏览器缓存，移除 cacheBuster\n    const response = await fetch(fontPath, {\n      signal: controller.signal,\n      cache: 'force-cache', // 利用浏览器缓存\n    });\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const contentType = response.headers.get('content-type');\n    if (contentType && contentType.includes('text/html')) {\n      throw new Error('返回了HTML而不是字体文件');\n    }\n\n    const arrayBuffer = await response.arrayBuffer();\n    const fileSizeMB = (arrayBuffer.byteLength / 1024 / 1024).toFixed(2);\n    console.log(`[PDF字体] 下载完成: ${fileSizeMB} MB`);\n\n    // 验证TTF魔数\n    const dataView = new DataView(arrayBuffer);\n    const magic = dataView.getUint32(0, false);\n    if (magic !== 0x00010000 && magic !== 0x74727565) {\n      throw new Error(`无效的TTF文件，魔数: 0x${magic.toString(16)}`);\n    }\n\n    // 检查文件大小\n    if (arrayBuffer.byteLength < 500 * 1024) {\n      throw new Error(`字体文件异常小 (${fileSizeMB} MB)`);\n    }\n\n    // 转换为 base64\n    const bytes = new Uint8Array(arrayBuffer);\n    let binary = '';\n    const chunkSize = 8192;\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      const chunk = bytes.subarray(i, Math.min(i + chunkSize, bytes.length));\n      binary += String.fromCharCode.apply(null, chunk);\n    }\n    const base64 = btoa(binary);\n\n    const fontData = { arrayBuffer, base64 };\n\n    // 4. 缓存到内存\n    FontCache.set(fontPath, {\n      arrayBuffer,\n      base64,\n      timestamp: Date.now()\n    });\n\n    // 5. 缓存到 IndexedDB（异步，不阻塞）\n    saveToIndexedDB(fontPath, fontData).catch(err => {\n      console.warn(`[PDF字体] IndexedDB 保存失败: ${err.message}`);\n    });\n\n    return fontData;\n  } catch (fetchError) {\n    clearTimeout(timeoutId);\n    if (fetchError.name === 'AbortError') {\n      throw new Error('下载超时');\n    }\n    throw fetchError;\n  }\n}\n\n/**\n * 从 IndexedDB 加载字体\n * @param {string} fontPath - 字体路径\n * @returns {Promise<{arrayBuffer: ArrayBuffer, base64: string} | null>}\n */\nasync function loadFromIndexedDB(fontPath) {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open('LyraFontCache', 1);\n\n    request.onerror = () => reject(request.error);\n\n    request.onupgradeneeded = (event) => {\n      const db = event.target.result;\n      if (!db.objectStoreNames.contains('fonts')) {\n        db.createObjectStore('fonts', { keyPath: 'path' });\n      }\n    };\n\n    request.onsuccess = () => {\n      const db = request.result;\n      try {\n        const transaction = db.transaction(['fonts'], 'readonly');\n        const store = transaction.objectStore('fonts');\n        const getRequest = store.get(fontPath);\n\n        getRequest.onsuccess = () => {\n          const data = getRequest.result;\n          if (data && data.arrayBuffer && data.base64) {\n            resolve({ arrayBuffer: data.arrayBuffer, base64: data.base64 });\n          } else {\n            resolve(null);\n          }\n        };\n\n        getRequest.onerror = () => resolve(null);\n      } catch (error) {\n        resolve(null);\n      } finally {\n        db.close();\n      }\n    };\n  });\n}\n\n/**\n * 保存字体到 IndexedDB\n * @param {string} fontPath - 字体路径\n * @param {{arrayBuffer: ArrayBuffer, base64: string}} fontData - 字体数据\n * @returns {Promise<void>}\n */\nasync function saveToIndexedDB(fontPath, fontData) {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open('LyraFontCache', 1);\n\n    request.onerror = () => reject(request.error);\n\n    request.onupgradeneeded = (event) => {\n      const db = event.target.result;\n      if (!db.objectStoreNames.contains('fonts')) {\n        db.createObjectStore('fonts', { keyPath: 'path' });\n      }\n    };\n\n    request.onsuccess = () => {\n      const db = request.result;\n      try {\n        const transaction = db.transaction(['fonts'], 'readwrite');\n        const store = transaction.objectStore('fonts');\n\n        store.put({\n          path: fontPath,\n          arrayBuffer: fontData.arrayBuffer,\n          base64: fontData.base64,\n          timestamp: Date.now()\n        });\n\n        transaction.oncomplete = () => {\n          console.log(`[PDF字体] ✓ 已缓存到 IndexedDB: ${fontPath}`);\n          resolve();\n        };\n\n        transaction.onerror = () => reject(transaction.error);\n      } catch (error) {\n        reject(error);\n      } finally {\n        db.close();\n      }\n    };\n  });\n}\n\n/**\n * 检查 IndexedDB 中是否已有所有字体缓存\n * @param {string[]} fontPaths - 字体路径列表\n * @returns {Promise<boolean>} - 是否所有字体都已缓存\n */\nasync function checkCacheExists(fontPaths) {\n  try {\n    const checkPromises = fontPaths.map(async (path) => {\n      const cached = await loadFromIndexedDB(path);\n      return cached !== null;\n    });\n\n    const results = await Promise.all(checkPromises);\n    return results.every(r => r); // 所有字体都存在才返回 true\n  } catch (error) {\n    console.warn('[PDF字体] 缓存检查失败:', error.message);\n    return false;\n  }\n}\n\n/**\n * 预加载字体文件到缓存（内存 + IndexedDB）\n * @param {boolean} silent - 是否静默加载（不触发 isLoading 状态）\n * @returns {Promise<boolean>} - 是否成功加载\n */\nexport async function preloadFont(silent = false) {\n  if (FontLoadingState.isLoading || FontLoadingState.isLoaded) {\n    return FontLoadingState.isLoaded;\n  }\n\n  const fontPaths = [\n    '/lyra-exporter/fonts/ARUDJingxihei-Regular.ttf',\n    '/lyra-exporter/fonts/ARUDJingxihei-Bold.ttf',\n    '/lyra-exporter/fonts/ARUDJingxihei-Light.ttf'\n  ];\n\n  // 先检查缓存是否已存在\n  const cacheExists = await checkCacheExists(fontPaths);\n\n  if (cacheExists) {\n    console.log('[PDF字体预加载] ✓ 检测到本地缓存，静默加载...');\n    // 有缓存：静默加载到内存，不显示弹窗\n    try {\n      const loadPromises = fontPaths.map(path => loadFontData(path));\n      await Promise.all(loadPromises);\n      FontLoadingState.isLoaded = true;\n      console.log('[PDF字体预加载] ✓ 从本地缓存加载完成');\n      return true;\n    } catch (error) {\n      console.warn('[PDF字体预加载] 缓存加载失败，将重新下载:', error.message);\n      // 继续走下载流程\n    }\n  }\n\n  // 无缓存或缓存加载失败：需要下载，显示弹窗\n  if (!silent) {\n    FontLoadingState.isLoading = true;\n  }\n  FontLoadingState.error = null;\n\n  try {\n    console.log('[PDF字体预加载] 开始下载字体到缓存...');\n\n    const loadPromises = fontPaths.map(async (path) => {\n      try {\n        await loadFontData(path);\n        return true;\n      } catch (error) {\n        console.warn(`[PDF字体预加载] 加载失败: ${path}`, error.message);\n        return false;\n      }\n    });\n\n    const results = await Promise.all(loadPromises);\n    const successCount = results.filter(r => r).length;\n    FontLoadingState.isLoaded = successCount > 0;\n    FontLoadingState.isLoading = false;\n\n    console.log(`[PDF字体预加载] 完成，成功加载 ${successCount}/${fontPaths.length} 个字体`);\n\n    return FontLoadingState.isLoaded;\n  } catch (error) {\n    console.error('[PDF字体预加载] 预加载失败:', error);\n    FontLoadingState.error = error.message;\n    FontLoadingState.isLoading = false;\n    FontLoadingState.isLoaded = false;\n    return false;\n  }\n}\n\n/**\n * 获取字体加载状态\n * @returns {object} - 字体加载状态对象\n */\nexport function getFontStatus() {\n  return {\n    isLoading: FontLoadingState.isLoading,\n    isLoaded: FontLoadingState.isLoaded,\n    error: FontLoadingState.error\n  };\n}\n","// utils/export/pdfTextHelpers.js\n// PDF文本处理辅助函数 - 纯函数模块，处理文本清理、解析和格式化\n\n/**\n * 清理和标准化文本，防止编码问题\n * @param {string} text - 原始文本\n * @returns {string} - 清理后的文本\n */\nexport function cleanText(text) {\n  if (!text || typeof text !== 'string') {\n    return '';\n  }\n\n  try {\n    // 1. Unicode 标准化（NFC 模式）\n    let cleaned = text.normalize('NFC');\n\n    // 2. 移除控制字符和不可打印字符（保留换行符和制表符）\n    cleaned = cleaned.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F]/g, '');\n\n    // 3. 处理常见的Latin连字（ligatures），将其转换回普通字符组合\n    const ligatureMap = {\n      '\\uFB00': 'ff',    // ﬀ\n      '\\uFB01': 'fi',    // ﬁ\n      '\\uFB02': 'fl',    // ﬂ\n      '\\uFB03': 'ffi',   // ﬃ\n      '\\uFB04': 'ffl',   // ﬄ\n      '\\uFB05': 'st',    // ﬅ\n      '\\uFB06': 'st',    // ﬆ\n      '\\u00C6': 'AE',    // Æ\n      '\\u00E6': 'ae',    // æ\n      '\\u0152': 'OE',    // Œ\n      '\\u0153': 'oe',    // œ\n      '\\u00DF': 'ss',    // ß\n      '\\u1E9E': 'SS',    // ẞ\n    };\n\n    // 批量替换连字\n    for (const [ligature, replacement] of Object.entries(ligatureMap)) {\n      cleaned = cleaned.replace(new RegExp(ligature, 'g'), replacement);\n    }\n\n    // 4. 处理特殊Unicode字符（可能导致jsPDF问题）\n    // 移除零宽字符\n    cleaned = cleaned.replace(/[\\u200B-\\u200F\\u2060\\uFEFF]/g, '');\n\n    // 6. 标准化引号和标点符号（修复乱码问题）\n    // 将各种引号统一为标准ASCII引号或中文引号\n    const quoteMap = {\n      // 英文引号标准化\n      '\\u201C': '\"',  // \" (左双引号) -> \"\n      '\\u201D': '\"',  // \" (右双引号) -> \"\n      '\\u2018': \"'\",  // ' (左单引号) -> '\n      '\\u2019': \"'\",  // ' (右单引号) -> '\n      '\\u2033': '\"',  // ″ (双撇号) -> \"\n      '\\u2032': \"'\",  // ′ (单撇号) -> '\n\n      // 其他标点标准化\n      '\\u2014': '--', // — (em dash) -> --\n      '\\u2013': '-',  // – (en dash) -> -\n      '\\u2026': '...', // … (省略号) -> ...\n      '\\u2022': '·',  // • (项目符号) -> ·\n      '\\u00B7': '·',  // · (中点)\n\n      // 星号标准化\n      '\\u2217': '*',  // ∗ (星号运算符) -> *\n      '\\u2731': '*',  // ✱ (粗星号) -> *\n      '\\u2732': '*',  // ✲ (开放中心星号) -> *\n      '\\u2605': '*',  // ★ (黑色星号) -> *\n      '\\u2606': '*',  // ☆ (白色星号) -> *\n\n      // 加号标准化\n      '\\u2795': '+',  // ➕ (粗加号) -> +\n      '\\uFF0B': '+',  // ＋ (全角加号) -> +\n    };\n\n    // 批量替换\n    for (const [from, to] of Object.entries(quoteMap)) {\n      cleaned = cleaned.replace(new RegExp(from, 'g'), to);\n    }\n\n    // 7. 处理全角字符转半角（可选，根据需要）\n    // 全角数字和字母转半角\n    cleaned = cleaned.replace(/[\\uFF10-\\uFF19]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF21-\\uFF3A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n    cleaned = cleaned.replace(/[\\uFF41-\\uFF5A]/g, (ch) => {\n      return String.fromCharCode(ch.charCodeAt(0) - 0xFEE0);\n    });\n\n    // 全角空格转半角\n    cleaned = cleaned.replace(/\\u3000/g, ' ');\n\n    return cleaned;\n  } catch (error) {\n    console.error('[PDF导出] 文本清理失败:', error);\n    // 如果清理失败，返回简化处理的文本\n    return text.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\n  }\n}\n\n/**\n * 解析文本中的代码块和LaTeX块\n */\nexport function parseTextWithCodeBlocksAndLatex(text) {\n  const parts = [];\n  const elements = [];\n\n  // 提取所有代码块（允许语言标识符后有空格）\n  const codeBlockRegex = /```([^\\n]*?)\\s*\\n([\\s\\S]*?)```/g;\n  let match;\n  let lastIndex = 0;\n\n  while ((match = codeBlockRegex.exec(text)) !== null) {\n    const language = (match[1] || '').trim().toLowerCase(); // 清理并转小写\n    const content = match[2];\n\n    // 检测是否为LaTeX代码块\n    if (language === 'latex' || language === 'math') {\n      console.log('[解析] 检测到LaTeX代码块:', language);\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'latex-display',\n        content: content.trim()\n      });\n    } else {\n      // 普通代码块\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'code',\n        language: language,\n        content: content\n      });\n    }\n  }\n\n  // 提取LaTeX display math块 ($$...$$)\n  const latexDisplayRegex = /\\$\\$\\n?([\\s\\S]*?)\\n?\\$\\$/g;\n  while ((match = latexDisplayRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // 提取LaTeX display math块 (\\[...\\])\n  const latexBracketRegex = /\\\\\\[([\\s\\S]*?)\\\\\\]/g;\n  while ((match = latexBracketRegex.exec(text)) !== null) {\n    elements.push({\n      start: match.index,\n      end: match.index + match[0].length,\n      type: 'latex-display',\n      content: match[1].trim()\n    });\n  }\n\n  // 按位置排序所有元素\n  elements.sort((a, b) => a.start - b.start);\n\n  // 移除重叠的元素（保留先出现的）\n  const filteredElements = [];\n  elements.forEach(element => {\n    const overlaps = filteredElements.some(existing =>\n      (element.start >= existing.start && element.start < existing.end) ||\n      (element.end > existing.start && element.end <= existing.end) ||\n      (element.start <= existing.start && element.end >= existing.end)\n    );\n    if (!overlaps) {\n      filteredElements.push(element);\n    }\n  });\n\n  // 构建最终的parts数组\n  lastIndex = 0;\n  filteredElements.forEach(element => {\n    // 添加元素前的文本\n    if (element.start > lastIndex) {\n      const plainText = text.substring(lastIndex, element.start);\n      if (plainText.trim()) {\n        parts.push({ type: 'text', content: plainText });\n      }\n    }\n\n    // 添加元素本身\n    parts.push(element);\n    lastIndex = element.end;\n  });\n\n  // 添加最后的文本\n  if (lastIndex < text.length) {\n    const plainText = text.substring(lastIndex);\n    if (plainText.trim()) {\n      parts.push({ type: 'text', content: plainText });\n    }\n  }\n\n  // 如果没有特殊元素,返回整个文本\n  if (parts.length === 0) {\n    parts.push({ type: 'text', content: text });\n  }\n\n  return parts;\n}\n\n/**\n * 解析行内markdown格式和LaTeX\n * 返回格式化的文本片段数组\n */\nexport function parseInlineMarkdown(text) {\n  const segments = [];\n\n  // 正则表达式模式（按优先级）\n  // CRITICAL: LaTeX patterns MUST come first to protect LaTeX syntax from Markdown parsing\n  const patterns = [\n    { type: 'latex-inline', regex: /\\$([^\\$\\n]+?)\\$/g },  // LaTeX inline math $...$\n    { type: 'latex-inline', regex: /\\\\\\(([^)]*?)\\\\\\)/g }, // LaTeX inline math \\(...\\)\n    { type: 'code', regex: /`([^`]+)`/g },              // 行内代码\n    { type: 'bold-italic', regex: /\\*\\*\\*(.+?)\\*\\*\\*/g }, // 粗斜体\n    { type: 'bold-italic', regex: /___(.+?)___/g },     // 粗斜体\n    { type: 'bold', regex: /\\*\\*([^*]+?)\\*\\*/g },       // 粗体（改进：不匹配*字符）\n    { type: 'bold', regex: /__([^_]+?)__/g },           // 粗体（改进：不匹配_字符）\n    { type: 'italic', regex: /\\*([^*]+?)\\*/g },         // 斜体（改进：不匹配*字符）\n    { type: 'italic', regex: /_([^_]+?)_/g },           // 斜体（改进：不匹配_字符）\n    { type: 'link', regex: /\\[([^\\]]+)\\]\\(([^)]+)\\)/g } // 链接\n  ];\n\n  // 查找所有匹配\n  const matches = [];\n  patterns.forEach(pattern => {\n    let match;\n    const regex = new RegExp(pattern.regex.source, 'g');\n    while ((match = regex.exec(text)) !== null) {\n      // CRITICAL: Do NOT clean LaTeX text - preserve backslashes and special characters\n      const isLatex = pattern.type === 'latex-inline';\n      matches.push({\n        type: pattern.type,\n        start: match.index,\n        end: regex.lastIndex,\n        text: isLatex ? match[1] : cleanText(match[1]),  // 不清理LaTeX文本\n        url: match[2], // 仅用于链接\n        rawText: match[1] // 保留原始文本用于调试\n      });\n      // 调试：记录找到的格式\n      if (pattern.type === 'bold') {\n        console.log(`[PDF导出] 发现粗体文本 [${match.index}-${regex.lastIndex}]:`, match[1]);\n      } else if (pattern.type === 'latex-inline') {\n        console.log(`[PDF导出] 发现LaTeX inline [${match.index}-${regex.lastIndex}]:`, match[1]);\n      }\n    }\n  });\n\n  // 按位置排序\n  matches.sort((a, b) => a.start - b.start);\n\n  // 移除重叠的匹配（保留最外层）\n  const filteredMatches = [];\n  matches.forEach(match => {\n    const overlaps = filteredMatches.some(existing =>\n      (match.start >= existing.start && match.start < existing.end) ||\n      (match.end > existing.start && match.end <= existing.end)\n    );\n    if (!overlaps) {\n      filteredMatches.push(match);\n    } else if (match.type === 'bold') {\n      console.warn(`[PDF导出] ⚠ 粗体文本被过滤（重叠）[${match.start}-${match.end}]:`, match.rawText);\n    }\n  });\n\n  // 构建segments数组\n  let lastEnd = 0;\n  filteredMatches.forEach(match => {\n    // 添加普通文本\n    if (match.start > lastEnd) {\n      segments.push({\n        type: 'normal',\n        text: cleanText(text.substring(lastEnd, match.start))  // 清理普通文本\n      });\n    }\n\n    // 添加格式化文本\n    segments.push({\n      type: match.type,\n      text: match.text,  // 已在上面清理过\n      url: match.url\n    });\n\n    lastEnd = match.end;\n  });\n\n  // 添加剩余文本\n  if (lastEnd < text.length) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text.substring(lastEnd))  // 清理剩余文本\n    });\n  }\n\n  // 如果没有匹配，返回整个文本\n  if (segments.length === 0) {\n    segments.push({\n      type: 'normal',\n      text: cleanText(text)  // 清理整个文本\n    });\n  }\n\n  // 清理未闭合的Markdown标记（如单独的 ** 或 * ）\n  segments.forEach(segment => {\n    if (segment.type === 'normal' && segment.text) {\n      // 移除未闭合的粗体标记\n      segment.text = segment.text.replace(/\\*\\*(?!\\*)/g, '');  // 移除单独的 **\n      segment.text = segment.text.replace(/(?<!\\*)\\*\\*/g, '');  // 移除单独的 **\n      // 移除未闭合的斜体标记\n      segment.text = segment.text.replace(/(?<!\\*)\\*(?!\\*)/g, '');  // 移除单独的 *\n      // 移除未闭合的下划线标记\n      segment.text = segment.text.replace(/(?<!_)__(?!_)/g, '');  // 移除单独的 __\n      segment.text = segment.text.replace(/(?<!_)_(?!_)/g, '');  // 移除单独的 _\n    }\n  });\n\n  return segments;\n}\n\n/**\n * 应用中文标点避头尾规则\n * @param {string[]} lines - 换行后的文本行数组\n * @returns {string[]} - 调整后的文本行数组\n */\nexport function applyCJKPunctuationRules(lines) {\n  if (!lines || lines.length <= 1) return lines;\n\n  // 不能出现在行首的标点（避头）\n  const noLineStart = /^[。，、；：！？）》」』】\"',.;:!?)}\\]]/;\n  // 不能出现在行尾的标点（避尾）\n  const noLineEnd = /[（《「『【\"'(\\[{]$/;\n\n  const result = [];\n  let prevLine = lines[0];\n\n  for (let i = 1; i < lines.length; i++) {\n    const currentLine = lines[i];\n\n    // 检查当前行开头是否有不能在行首的标点\n    if (noLineStart.test(currentLine)) {\n      // 将标点移到上一行末尾\n      const punct = currentLine[0];\n      prevLine = prevLine + punct;\n      lines[i] = currentLine.substring(1);\n      continue;\n    }\n\n    // 检查上一行结尾是否有不能在行尾的标点\n    if (noLineEnd.test(prevLine)) {\n      // 将标点移到当前行开头\n      const punct = prevLine[prevLine.length - 1];\n      prevLine = prevLine.substring(0, prevLine.length - 1);\n      lines[i] = punct + currentLine;\n    }\n\n    result.push(prevLine);\n    prevLine = lines[i];\n  }\n\n  result.push(prevLine);\n  return result;\n}\n\n/**\n * 解析代码行中的格式标记（粗体、标题）\n * 返回 [{text: string, bold: boolean, heading: number}]\n */\nexport function parseCodeLineBold(line) {\n  const segments = [];\n\n  // 检查是否是标题行（### 开头）\n  const headingMatch = line.match(/^(#{1,6})\\s+(.+)$/);\n  if (headingMatch) {\n    const level = headingMatch[1].length; // 标题级别（1-6）\n    const headingText = headingMatch[2];\n\n    // 标题文本仍然可以包含粗体\n    const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n    let lastEnd = 0;\n    let match;\n\n    while ((match = boldRegex.exec(headingText)) !== null) {\n      if (match.index > lastEnd) {\n        segments.push({\n          text: headingText.substring(lastEnd, match.index),\n          bold: false,\n          heading: level\n        });\n      }\n      segments.push({\n        text: match[1],\n        bold: true,\n        heading: level\n      });\n      lastEnd = boldRegex.lastIndex;\n    }\n\n    if (lastEnd < headingText.length) {\n      segments.push({\n        text: headingText.substring(lastEnd),\n        bold: false,\n        heading: level\n      });\n    }\n\n    if (segments.length === 0) {\n      segments.push({\n        text: headingText,\n        bold: false,\n        heading: level\n      });\n    }\n\n    return segments;\n  }\n\n  // 不是标题，解析普通粗体\n  const boldRegex = /\\*\\*([^*]+?)\\*\\*/g;\n  let lastEnd = 0;\n  let match;\n\n  while ((match = boldRegex.exec(line)) !== null) {\n    // 添加普通文本\n    if (match.index > lastEnd) {\n      segments.push({\n        text: line.substring(lastEnd, match.index),\n        bold: false\n      });\n    }\n\n    // 添加粗体文本\n    segments.push({\n      text: match[1],\n      bold: true\n    });\n\n    lastEnd = boldRegex.lastIndex;\n  }\n\n  // 添加剩余文本\n  if (lastEnd < line.length) {\n    segments.push({\n      text: line.substring(lastEnd),\n      bold: false\n    });\n  }\n\n  // 如果没有匹配，返回整行\n  if (segments.length === 0) {\n    segments.push({\n      text: line,\n      bold: false\n    });\n  }\n\n  return segments;\n}\n\n/**\n * 安全地设置字体，如果字体变体不可用则自动回退\n * @param {Object} pdf - jsPDF实例\n * @param {string} fontName - 字体名称\n * @param {string} fontStyle - 字体样式\n * @param {Array} availableFontWeights - 可用字体变体列表\n * @returns {boolean} - 是否成功设置\n */\nexport function safeSetFont(pdf, fontName, fontStyle = 'normal', availableFontWeights = []) {\n  try {\n    // 如果请求的样式可用，直接使用\n    if (availableFontWeights.includes(fontStyle)) {\n      pdf.setFont(fontName, fontStyle);\n      return true;\n    }\n\n    // 字体变体不可用，进行智能回退\n    console.warn(`[PDF导出] 字体变体 ${fontStyle} 不可用，尝试回退...`);\n\n    // 回退策略\n    if (fontStyle === 'bold' || fontStyle === 'bolditalic') {\n      // 粗体：优先尝试 normal，如果没有则用第一个可用的\n      if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n        return false; // 返回 false 表示使用了回退\n      }\n    }\n\n    if (fontStyle === 'italic' || fontStyle === 'bolditalic') {\n      // 斜体：中文字体通常没有斜体，回退到 light 或 normal\n      if (availableFontWeights.includes('light')) {\n        pdf.setFont(fontName, 'light');\n        console.log(`[PDF导出] ✓ 斜体回退到 light 字体`);\n        return false;\n      } else if (availableFontWeights.includes('normal')) {\n        pdf.setFont(fontName, 'normal');\n        console.log(`[PDF导出] ✓ 斜体回退到 normal 字体`);\n        return false;\n      }\n    }\n\n    // 默认回退：使用第一个可用的字体变体\n    if (availableFontWeights.length > 0) {\n      const fallbackStyle = availableFontWeights[0];\n      pdf.setFont(fontName, fallbackStyle);\n      console.log(`[PDF导出] ✓ 回退到 ${fallbackStyle} 字体`);\n      return false;\n    }\n\n    // 最终回退：使用 normal\n    pdf.setFont(fontName, 'normal');\n    console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n    return false;\n  } catch (error) {\n    console.error(`[PDF导出] 设置字体失败:`, error);\n    // 最后的保险：使用默认字体\n    pdf.setFont(fontName || 'helvetica');\n    return false;\n  }\n}\n\n/**\n * 安全地获取文本宽度，处理字体元数据缺失的情况\n * @param {Object} pdf - jsPDF实例\n * @param {string} text - 要测量的文本\n * @param {string} chineseFontName - 中文字体名称\n * @returns {number} - 文本宽度\n */\nexport function safeGetTextWidth(pdf, text, chineseFontName = 'helvetica') {\n  if (!text || typeof text !== 'string') {\n    return 0;\n  }\n\n  try {\n    // 检查当前字体是否有 Unicode 元数据\n    const font = pdf.getFont();\n    if (!font.metadata || !font.metadata.Unicode) {\n      const currentStyle = font.fontStyle || 'normal';\n      console.warn(`[PDF导出] 当前字体 (${currentStyle}) 缺少 Unicode 元数据`);\n\n      // 只在非normal字体时回退\n      if (currentStyle !== 'normal') {\n        console.log('[PDF导出] 回退到 normal 字体');\n        safeSetFont(pdf, chineseFontName, 'normal');\n        // 重新尝试获取宽度\n        return pdf.getTextWidth(text);\n      } else {\n        // normal字体也有问题，使用近似值\n        console.warn('[PDF导出] normal 字体也缺少元数据，使用近似计算');\n        const fontSize = pdf.getFontSize();\n        return text.length * fontSize * 0.5;\n      }\n    }\n\n    return pdf.getTextWidth(text);\n  } catch (error) {\n    console.error('[PDF导出] getTextWidth 失败:', error);\n    // 如果失败，使用近似值：字符数 * 字体大小 * 0.5\n    const fontSize = pdf.getFontSize();\n    return text.length * fontSize * 0.5;\n  }\n}\n\n/**\n * 安全地渲染文本，自动处理边界\n * @param {Object} pdf - jsPDF实例\n * @param {string} text - 要渲染的文本\n * @param {number} x - X 坐标\n * @param {number} y - Y 坐标\n * @param {number} maxWidth - 最大宽度（可选）\n */\nexport function safeRenderText(pdf, text, x, y, maxWidth = null) {\n  if (!text || typeof text !== 'string') {\n    return;\n  }\n\n  const cleanedText = cleanText(text);\n  if (!cleanedText) {\n    return;\n  }\n\n  // 如果指定了 maxWidth，检查文本宽度\n  if (maxWidth) {\n    const textWidth = safeGetTextWidth(pdf, cleanedText);\n    if (textWidth > maxWidth) {\n      // 文本过长，进行截断并添加省略号\n      console.warn('[PDF导出] 文本过长，将被截断:', cleanedText.substring(0, 50));\n      // 尝试使用 splitTextToSize 拆分（只渲染第一行）\n      try {\n        const lines = pdf.splitTextToSize(cleanedText, maxWidth);\n        if (lines.length > 0) {\n          pdf.text(lines[0], x, y);\n        }\n      } catch (error) {\n        // 如果失败，尝试简单截断\n        let truncated = cleanedText;\n        while (safeGetTextWidth(pdf, truncated + '...') > maxWidth && truncated.length > 0) {\n          truncated = truncated.substring(0, truncated.length - 1);\n        }\n        pdf.text(truncated + '...', x, y);\n      }\n      return;\n    }\n  }\n\n  // 文本长度合适，直接渲染\n  pdf.text(cleanedText, x, y);\n}","// utils/export/pdfLatexRenderer.js\n// LaTeX数学公式渲染器 - 使用Unicode映射和自定义绘图实现非SVG渲染\n\nimport { cleanText } from './pdfTextHelpers';\n\n/**\n * LaTeX到Unicode的映射表\n */\nconst LATEX_UNICODE_MAP = {\n  // 希腊字母小写\n  'alpha': 'α', 'beta': 'β', 'gamma': 'γ', 'delta': 'δ',\n  'epsilon': 'ε', 'varepsilon': 'ε', 'zeta': 'ζ', 'eta': 'η',\n  'theta': 'θ', 'vartheta': 'ϑ', 'iota': 'ι', 'kappa': 'κ',\n  'lambda': 'λ', 'mu': 'μ', 'nu': 'ν', 'xi': 'ξ',\n  'pi': 'π', 'varpi': 'ϖ', 'rho': 'ρ', 'varrho': 'ϱ',\n  'sigma': 'σ', 'varsigma': 'ς', 'tau': 'τ', 'upsilon': 'υ',\n  'phi': 'φ', 'varphi': 'φ', 'chi': 'χ', 'psi': 'ψ', 'omega': 'ω',\n  \n  // 希腊字母大写\n  'Alpha': 'Α', 'Beta': 'Β', 'Gamma': 'Γ', 'Delta': 'Δ',\n  'Epsilon': 'Ε', 'Zeta': 'Ζ', 'Eta': 'Η', 'Theta': 'Θ',\n  'Iota': 'Ι', 'Kappa': 'Κ', 'Lambda': 'Λ', 'Mu': 'Μ',\n  'Nu': 'Ν', 'Xi': 'Ξ', 'Pi': 'Π', 'Rho': 'Ρ',\n  'Sigma': 'Σ', 'Tau': 'Τ', 'Upsilon': 'Υ', 'Phi': 'Φ',\n  'Chi': 'Χ', 'Psi': 'Ψ', 'Omega': 'Ω',\n  \n  // 数学运算符\n  'pm': '±', 'mp': '∓', 'times': '×', 'div': '÷',\n  'cdot': '·', 'ast': '∗', 'star': '⋆', 'circ': '∘',\n  'bullet': '•', 'oplus': '⊕', 'ominus': '⊖', 'otimes': '⊗',\n  'oslash': '⊘', 'odot': '⊙', 'dagger': '†', 'ddagger': '‡',\n  \n  // 关系符号\n  'leq': '≤', 'le': '≤', 'geq': '≥', 'ge': '≥',\n  'neq': '≠', 'ne': '≠', 'approx': '≈', 'equiv': '≡',\n  'sim': '∼', 'simeq': '≃', 'propto': '∝', 'perp': '⊥',\n  'parallel': '∥', 'subset': '⊂', 'supset': '⊃',\n  'subseteq': '⊆', 'supseteq': '⊇', 'in': '∈', 'notin': '∉',\n  \n  // 箭头\n  'leftarrow': '←', 'rightarrow': '→', 'uparrow': '↑', 'downarrow': '↓',\n  'leftrightarrow': '↔', 'updownarrow': '↕', 'Leftarrow': '⇐', 'Rightarrow': '⇒',\n  'Uparrow': '⇑', 'Downarrow': '⇓', 'Leftrightarrow': '⇔', 'Updownarrow': '⇕',\n  'mapsto': '↦', 'to': '→', 'gets': '←',\n  \n  // 其他符号\n  'infty': '∞', 'partial': '∂', 'nabla': '∇', 'forall': '∀',\n  'exists': '∃', 'nexists': '∄', 'emptyset': '∅', 'varnothing': '∅',\n  'complement': '∁', 'neg': '¬', 'wedge': '∧', 'vee': '∨',\n  'cap': '∩', 'cup': '∪', 'int': '∫', 'iint': '∬', 'iiint': '∭',\n  'oint': '∮', 'sum': '∑', 'prod': '∏', 'coprod': '∐',\n  'bigcap': '⋂', 'bigcup': '⋃', 'bigvee': '⋁', 'bigwedge': '⋀',\n  'bigoplus': '⨁', 'bigotimes': '⨂', 'bigodot': '⨀', 'biguplus': '⨄',\n  \n  // 括号和定界符\n  'langle': '⟨', 'rangle': '⟩', 'lfloor': '⌊', 'rfloor': '⌋',\n  'lceil': '⌈', 'rceil': '⌉', 'vert': '|', 'Vert': '‖',\n  \n  // 特殊字符\n  'dots': '…', 'cdots': '⋯', 'vdots': '⋮', 'ddots': '⋱',\n  'ldots': '…', 'therefore': '∴', 'because': '∵',\n  'angle': '∠', 'measuredangle': '∡', 'sphericalangle': '∢',\n  \n  // 其他\n  'prime': '′', 'backprime': '‵', 'degree': '°'\n};\n\n// 上标数字和字母映射\nconst SUPERSCRIPT_MAP = {\n  '0': '⁰', '1': '¹', '2': '²', '3': '³', '4': '⁴',\n  '5': '⁵', '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹',\n  '+': '⁺', '-': '⁻', '=': '⁼', '(': '⁽', ')': '⁾',\n  'n': 'ⁿ', 'i': 'ⁱ', 'a': 'ᵃ', 'b': 'ᵇ', 'c': 'ᶜ',\n  'd': 'ᵈ', 'e': 'ᵉ', 'f': 'ᶠ', 'g': 'ᵍ', 'h': 'ʰ',\n  'j': 'ʲ', 'k': 'ᵏ', 'l': 'ˡ', 'm': 'ᵐ', 'o': 'ᵒ',\n  'p': 'ᵖ', 'r': 'ʳ', 's': 'ˢ', 't': 'ᵗ', 'u': 'ᵘ',\n  'v': 'ᵛ', 'w': 'ʷ', 'x': 'ˣ', 'y': 'ʸ', 'z': 'ᶻ'\n};\n\n// 下标数字和字母映射\nconst SUBSCRIPT_MAP = {\n  '0': '₀', '1': '₁', '2': '₂', '3': '₃', '4': '₄',\n  '5': '₅', '6': '₆', '7': '₇', '8': '₈', '9': '₉',\n  '+': '₊', '-': '₋', '=': '₌', '(': '₍', ')': '₎',\n  'a': 'ₐ', 'e': 'ₑ', 'h': 'ₕ', 'i': 'ᵢ', 'j': 'ⱼ',\n  'k': 'ₖ', 'l': 'ₗ', 'm': 'ₘ', 'n': 'ₙ', 'o': 'ₒ',\n  'p': 'ₚ', 'r': 'ᵣ', 's': 'ₛ', 't': 'ₜ', 'u': 'ᵤ',\n  'v': 'ᵥ', 'x': 'ₓ'\n};\n\n/**\n * LaTeX渲染器类\n */\nexport class LaTeXRenderer {\n  constructor(pdf, config = {}) {\n    this.pdf = pdf;\n    this.config = {\n      fontSize: config.fontSize || 10,\n      color: config.color || [0, 0, 0],\n      useUnicode: config.useUnicode !== false, // 默认使用Unicode\n      ...config\n    };\n  }\n\n  /**\n   * 渲染行内LaTeX数学公式\n   * @param {string} latex - LaTeX源码（不包含$符号）\n   * @param {number} x - 起始X坐标\n   * @param {number} y - 基线Y坐标\n   * @param {number} maxWidth - 最大宽度\n   * @returns {number} - 渲染后的宽度\n   */\n  renderInlineLaTeX(latex, x, y, maxWidth) {\n    // 首先尝试简单的Unicode转换\n    const simplified = this.simplifyLaTeX(latex);\n    \n    // 检查是否包含复杂结构（分数、矩阵等）\n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, x, y, maxWidth, true);\n    }\n    \n    // 简单公式直接渲染为Unicode文本\n    this.pdf.setFontSize(this.config.fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // 设置斜体以区分数学文本\n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'italic');\n    } catch (e) {\n      // 如果没有斜体，保持原样\n    }\n    \n    this.pdf.text(simplified, x, y);\n    const width = this.pdf.getTextWidth(simplified);\n    \n    // 恢复正常字体\n    try {\n      this.pdf.setFont(this.pdf.getFont().fontName, 'normal');\n    } catch (e) {\n      // 忽略字体恢复错误\n    }\n    \n    return width;\n  }\n\n  /**\n   * 渲染块级LaTeX数学公式\n   * @param {string} latex - LaTeX源码\n   * @param {number} x - 起始X坐标\n   * @param {number} y - 起始Y坐标\n   * @param {number} maxWidth - 最大宽度\n   * @returns {Object} - {width, height} 渲染后的尺寸\n   */\n  renderDisplayLaTeX(latex, x, y, maxWidth) {\n    // 块级公式居中显示\n    const centerX = x + maxWidth / 2;\n    \n    // 检查是否包含复杂结构\n    if (this.hasComplexStructure(latex)) {\n      return this.renderComplexLaTeX(latex, centerX, y, maxWidth, false);\n    }\n    \n    // 简单公式\n    const simplified = this.simplifyLaTeX(latex);\n    const fontSize = this.config.fontSize * 1.2; // 块级公式稍大\n    \n    this.pdf.setFontSize(fontSize);\n    this.pdf.setTextColor(...this.config.color);\n    \n    // 计算文本宽度以居中\n    const textWidth = this.pdf.getTextWidth(simplified);\n    const startX = centerX - textWidth / 2;\n    \n    // 添加背景\n    const padding = 5;\n    this.pdf.setFillColor(250, 250, 250);\n    this.pdf.rect(startX - padding, y - fontSize * 0.8, textWidth + padding * 2, fontSize * 1.5, 'F');\n    \n    // 渲染文本\n    this.pdf.text(simplified, startX, y);\n    \n    return {\n      width: textWidth + padding * 2,\n      height: fontSize * 1.5\n    };\n  }\n\n  /**\n   * 简化LaTeX为Unicode字符\n   * @param {string} latex - LaTeX源码\n   * @returns {string} - 转换后的Unicode文本\n   */\n  simplifyLaTeX(latex) {\n    let result = latex;\n    \n    // 移除多余的空格\n    result = result.replace(/\\s+/g, ' ').trim();\n    \n    // 处理上标（简单情况）\n    result = result.replace(/\\^{([^}]+)}/g, (match, content) => {\n      return this.convertToSuperscript(content);\n    });\n    result = result.replace(/\\^(\\w)/g, (match, char) => {\n      return this.convertToSuperscript(char);\n    });\n    \n    // 处理下标（简单情况）\n    result = result.replace(/_{([^}]+)}/g, (match, content) => {\n      return this.convertToSubscript(content);\n    });\n    result = result.replace(/_(\\w)/g, (match, char) => {\n      return this.convertToSubscript(char);\n    });\n    \n    // 替换LaTeX命令为Unicode\n    Object.keys(LATEX_UNICODE_MAP).forEach(command => {\n      const pattern = new RegExp(`\\\\\\\\${command}(?![a-zA-Z])`, 'g');\n      result = result.replace(pattern, LATEX_UNICODE_MAP[command]);\n    });\n    \n    // 清理剩余的反斜杠\n    result = result.replace(/\\\\([a-zA-Z]+)/g, '$1');\n    result = result.replace(/\\\\(.)/g, '$1');\n    \n    // 清理花括号\n    result = result.replace(/[{}]/g, '');\n    \n    return result;\n  }\n\n  /**\n   * 转换为上标Unicode\n   */\n  convertToSuperscript(text) {\n    return text.split('').map(char => SUPERSCRIPT_MAP[char] || char).join('');\n  }\n\n  /**\n   * 转换为下标Unicode\n   */\n  convertToSubscript(text) {\n    return text.split('').map(char => SUBSCRIPT_MAP[char] || char).join('');\n  }\n\n  /**\n   * 检查是否包含复杂LaTeX结构\n   */\n  hasComplexStructure(latex) {\n    const complexPatterns = [\n      /\\\\frac\\{/,           // 分数\n      /\\\\sqrt[\\[\\{]/,       // 根号\n      /\\\\begin\\{/,          // 环境（如矩阵）\n      /\\\\left/,             // 大括号\n      /\\\\right/,            // 大括号\n      /\\\\sum/,              // 求和（需要特殊布局）\n      /\\\\int/,              // 积分（需要特殊布局）\n      /\\\\prod/,             // 乘积\n      /\\\\lim/,              // 极限\n      /\\\\mathbb/,           // 黑板粗体\n      /\\\\mathcal/,          // 花体\n      /\\\\boldsymbol/,       // 粗体符号\n      /\\\\overline/,         // 上划线\n      /\\\\underline/,        // 下划线\n      /\\\\vec/,              // 向量\n      /\\\\hat/,              // 帽子\n      /\\\\tilde/,            // 波浪号\n      /\\\\dot/,              // 点\n      /\\\\ddot/              // 双点\n    ];\n    \n    return complexPatterns.some(pattern => pattern.test(latex));\n  }\n\n  /**\n   * 渲染复杂LaTeX结构\n   */\n  renderComplexLaTeX(latex, x, y, maxWidth, isInline) {\n    const fontSize = isInline ? this.config.fontSize : this.config.fontSize * 1.2;\n    const elements = this.parseComplexLaTeX(latex);\n\n    // 第一步：计算总宽度\n    let totalWidth = 0;\n    this.pdf.setFontSize(fontSize);\n\n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          totalWidth += this.pdf.getTextWidth(element.content);\n          break;\n\n        case 'fraction':\n          // 估算分数宽度\n          const fracFontSize = fontSize * 0.75;\n          this.pdf.setFontSize(fracFontSize);\n          const numWidth = this.pdf.getTextWidth(element.numerator);\n          const denWidth = this.pdf.getTextWidth(element.denominator);\n          totalWidth += Math.max(numWidth, denWidth) + 4;\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        case 'sqrt':\n          totalWidth += this.pdf.getTextWidth(element.content) + 8;\n          break;\n\n        case 'superscript':\n        case 'subscript':\n          totalWidth += this.pdf.getTextWidth(element.base || '');\n          const subSupFontSize = fontSize * 0.7;\n          this.pdf.setFontSize(subSupFontSize);\n          totalWidth += this.pdf.getTextWidth(element.exponent || element.subscript || '');\n          this.pdf.setFontSize(fontSize);\n          break;\n\n        default:\n          totalWidth += this.pdf.getTextWidth(element.raw || '');\n      }\n    });\n\n    // 第二步：对于display math，从居中位置开始渲染\n    let currentX = isInline ? x : (x - totalWidth / 2);\n    let maxHeight = fontSize;\n    let hasFraction = false;  // 标记是否包含分数\n\n    // 第三步：渲染所有元素\n    elements.forEach(element => {\n      switch (element.type) {\n        case 'text':\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(element.content, currentX, y);\n          const textWidth = this.pdf.getTextWidth(element.content);\n          currentX += textWidth;\n          break;\n\n        case 'fraction':\n          const fracWidth = this.renderFraction(\n            element.numerator,\n            element.denominator,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += fracWidth;\n          hasFraction = true;\n          break;\n\n        case 'sqrt':\n          const sqrtWidth = this.renderSquareRoot(\n            element.content,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += sqrtWidth;\n          break;\n\n        case 'superscript':\n          const supWidth = this.renderSuperscript(\n            element.base,\n            element.exponent,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += supWidth;\n          break;\n\n        case 'subscript':\n          const subWidth = this.renderSubscript(\n            element.base,\n            element.subscript,\n            currentX,\n            y,\n            fontSize\n          );\n          currentX += subWidth;\n          break;\n\n        default:\n          // 未识别的类型，渲染为普通文本\n          const fallbackText = element.raw || '';\n          this.pdf.setFontSize(fontSize);\n          this.pdf.text(fallbackText, currentX, y);\n          const fallbackWidth = this.pdf.getTextWidth(fallbackText);\n          currentX += fallbackWidth;\n      }\n    });\n\n    // 根据是否包含分数计算实际高度\n    if (hasFraction) {\n      maxHeight = fontSize * 1.2;  // 分数需要更多垂直空间\n    } else {\n      maxHeight = fontSize;  // 普通公式紧凑间距\n    }\n\n    return isInline ? totalWidth : { width: totalWidth, height: maxHeight };\n  }\n\n  /**\n   * 解析复杂LaTeX为可渲染的元素\n   */\n  parseComplexLaTeX(latex) {\n    const elements = [];\n    let remaining = latex;\n    \n    // 简化解析：主要处理分数\n    const fracRegex = /\\\\frac\\{([^}]*)\\}\\{([^}]*)\\}/;\n    \n    while (remaining.length > 0) {\n      const fracMatch = remaining.match(fracRegex);\n      \n      if (fracMatch) {\n        // 添加分数前的文本\n        if (fracMatch.index > 0) {\n          const beforeText = remaining.substring(0, fracMatch.index);\n          const simplified = this.simplifyLaTeX(beforeText);\n          if (simplified) {\n            elements.push({ type: 'text', content: simplified });\n          }\n        }\n        \n        // 添加分数\n        elements.push({\n          type: 'fraction',\n          numerator: this.simplifyLaTeX(fracMatch[1]),\n          denominator: this.simplifyLaTeX(fracMatch[2]),\n          raw: fracMatch[0]\n        });\n        \n        remaining = remaining.substring(fracMatch.index + fracMatch[0].length);\n      } else {\n        // 没有更多分数，处理剩余文本\n        const simplified = this.simplifyLaTeX(remaining);\n        if (simplified) {\n          elements.push({ type: 'text', content: simplified });\n        }\n        break;\n      }\n    }\n    \n    return elements;\n  }\n\n  /**\n   * 渲染分数\n   */\n  renderFraction(numerator, denominator, x, y, fontSize) {\n    // 设置较小的字体用于分数\n    const fracFontSize = fontSize * 0.75;\n    this.pdf.setFontSize(fracFontSize);\n\n    const numWidth = this.pdf.getTextWidth(numerator);\n    const denWidth = this.pdf.getTextWidth(denominator);\n    const fracWidth = Math.max(numWidth, denWidth) + 4;\n\n    // 进一步减小间距：分子和分母紧贴分数线\n    const numOffset = fracFontSize * 0.17;  // 分子上移（距离分数线）\n    const denOffset = fracFontSize * 0.5;  // 分母下移（距离分数线）\n\n    // 渲染分子（在分数线上方，居中对齐）\n    const numX = x + (fracWidth - numWidth) / 2;\n    this.pdf.text(numerator, numX, y - numOffset);\n\n    // 绘制分数线\n    this.pdf.setLineWidth(0.3);\n    this.pdf.setDrawColor(0, 0, 0);\n    this.pdf.line(x, y, x + fracWidth, y);\n\n    // 渲染分母（在分数线下方，居中对齐）\n    const denX = x + (fracWidth - denWidth) / 2;\n    this.pdf.text(denominator, denX, y + denOffset);\n\n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n\n    return fracWidth;\n  }\n\n  /**\n   * 渲染平方根\n   */\n  renderSquareRoot(content, x, y, fontSize) {\n    const contentWidth = this.pdf.getTextWidth(content);\n    const sqrtWidth = contentWidth + 8;\n    const sqrtHeight = fontSize * 1.2;\n    \n    // 绘制根号符号\n    this.pdf.setLineWidth(0.3);\n    // 左侧勾\n    this.pdf.line(x, y - sqrtHeight / 3, x + 2, y);\n    // 斜线\n    this.pdf.line(x + 2, y, x + 4, y - sqrtHeight);\n    // 顶线\n    this.pdf.line(x + 4, y - sqrtHeight, x + sqrtWidth, y - sqrtHeight);\n    \n    // 渲染根号内的内容\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(content, x + 6, y);\n    \n    return sqrtWidth;\n  }\n\n  /**\n   * 渲染上标\n   */\n  renderSuperscript(base, exponent, x, y, fontSize) {\n    // 渲染基数\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // 渲染上标（使用更小的字体和向上偏移）\n    const supFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(supFontSize);\n    const supText = this.simplifyLaTeX(exponent);\n    this.pdf.text(supText, x + baseWidth, y - fontSize * 0.3);\n    const supWidth = this.pdf.getTextWidth(supText);\n    \n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + supWidth;\n  }\n\n  /**\n   * 渲染下标\n   */\n  renderSubscript(base, subscript, x, y, fontSize) {\n    // 渲染基数\n    this.pdf.setFontSize(fontSize);\n    this.pdf.text(base, x, y);\n    const baseWidth = this.pdf.getTextWidth(base);\n    \n    // 渲染下标（使用更小的字体和向下偏移）\n    const subFontSize = fontSize * 0.7;\n    this.pdf.setFontSize(subFontSize);\n    const subText = this.simplifyLaTeX(subscript);\n    this.pdf.text(subText, x + baseWidth, y + fontSize * 0.3);\n    const subWidth = this.pdf.getTextWidth(subText);\n    \n    // 恢复字体大小\n    this.pdf.setFontSize(fontSize);\n    \n    return baseWidth + subWidth;\n  }\n}\n\n// 导出默认实例化函数\nexport function createLaTeXRenderer(pdf, config) {\n  return new LaTeXRenderer(pdf, config);\n}\n","// PDF内容渲染器 - 负责所有内容的渲染工作\n\nimport { cleanText, parseInlineMarkdown, parseCodeLineBold, applyCJKPunctuationRules } from './pdfTextHelpers'\nimport { LaTeXRenderer } from './pdfLatexRenderer'\nexport const PDF_STYLES = {\n  // 字体大小\n  FONT_SIZE_TITLE: 20,\n  FONT_SIZE_H1: 16,\n  FONT_SIZE_H2: 14,\n  FONT_SIZE_SENDER: 12,\n  FONT_SIZE_BODY: 10,\n  FONT_SIZE_CODE: 9,\n  FONT_SIZE_TIMESTAMP: 8,\n  FONT_SIZE_HEADER: 8,\n  FONT_SIZE_FOOTER: 8,\n\n  // 颜色 (RGB)\n  COLOR_SENDER_HUMAN: [0, 102, 204],      // 蓝色\n  COLOR_SENDER_ASSISTANT: [102, 102, 102], // 灰色\n  COLOR_TIMESTAMP: [150, 150, 150],        // 浅灰\n  COLOR_CODE_BG: [245, 245, 245],          // 代码背景\n  COLOR_SECTION_BG: [250, 250, 250],       // 区块背景\n  COLOR_TEXT: [0, 0, 0],                   // 黑色文本\n  COLOR_HEADER: [100, 100, 100],           // 页眉颜色\n  COLOR_FOOTER: [150, 150, 150],           // 页脚颜色\n  COLOR_BORDER: [200, 200, 200],           // 边框颜色\n\n  // 间距\n  MARGIN_LEFT: 15,\n  MARGIN_RIGHT: 15,\n  MARGIN_TOP: 15,    // 顶部边距（移除页眉，增加空间利用率）\n  MARGIN_BOTTOM: 25, // 底部边距为页脚留空间\n  LINE_HEIGHT: 5,\n  SECTION_SPACING: 8,\n  MESSAGE_SPACING: 10,\n  FOOTER_HEIGHT: 15, // 页脚高度\n\n  // 页面\n  PAGE_WIDTH: 210, // A4 宽度(mm)\n  PAGE_HEIGHT: 297, // A4 高度(mm)\n};\n\n/**\n * 内容渲染器类\n */\nexport class ContentRenderer {\n  constructor(manager) {\n    this.manager = manager;\n    this.latexRenderer = null; // 延迟初始化\n  }\n\n  /**\n   * 获取PDF实例\n   */\n  get pdf() {\n    return this.manager.pdf;\n  }\n\n  /**\n   * 获取和设置当前Y位置\n   */\n  get currentY() {\n    return this.manager.currentY;\n  }\n\n  set currentY(value) {\n    this.manager.currentY = value;\n  }\n\n  /**\n   * 获取配置\n   */\n  get config() {\n    return this.manager.config;\n  }\n\n  /**\n   * 获取字体相关属性\n   */\n  get chineseFontName() {\n    return this.manager.chineseFontName;\n  }\n\n  get availableFontWeights() {\n    return this.manager.availableFontWeights;\n  }\n\n  /**\n   * 委托给manager的辅助方法\n   */\n  safeSetFont(fontName, fontStyle) {\n    return this.manager.safeSetFont(fontName, fontStyle);\n  }\n\n  safeGetTextWidth(text) {\n    return this.manager.safeGetTextWidth(text);\n  }\n\n  safeRenderText(text, x, y, maxWidth) {\n    return this.manager.safeRenderText(text, x, y, maxWidth);\n  }\n\n  checkPageBreak(requiredSpace) {\n    return this.manager.checkPageBreak(requiredSpace);\n  }\n\n\n  /**\n   * 渲染标题页\n   */\n  renderTitle(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TITLE);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const rawTitle = meta.name || 'Conversation';\n    const title = cleanText(rawTitle); // 清理标题文本\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 标题可能很长,需要自动换行\n    let titleLines;\n    try {\n      titleLines = this.pdf.splitTextToSize(title, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] 标题分割失败,使用原始标题:', error);\n      titleLines = [title];\n    }\n    \n    titleLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TITLE);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染元数据\n   */\n  renderMetadata(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n\n    const lines = [];\n\n    if (meta.platform) {\n      lines.push(`Platform: ${meta.platform}`);\n    }\n\n    if (meta.created_at) {\n      lines.push(`Created: ${meta.created_at}`);\n    }\n\n    if (meta.updated_at) {\n      lines.push(`Updated: ${meta.updated_at}`);\n    }\n\n    lines.push(`Exported: ${this.manager.exportDate}`);\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染单条消息（LaTeX显示为源码）\n   */\n  renderMessage(message, index) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_SENDER + PDF_STYLES.MESSAGE_SPACING);\n\n    // 记录消息位置用于目录链接和书签\n    const currentPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    const currentY = this.currentY;\n    this.manager.messageAnchors.push({\n      index,\n      page: currentPage,\n      y: currentY,\n      sender: message.sender,\n      title: message.display_text ? message.display_text.substring(0, 50) : ''\n    });\n\n    // 渲染发送者标签\n    this.renderSender(message, index);\n\n    // 渲染时间戳\n    if (this.config.includeTimestamps && message.timestamp) {\n      this.renderTimestamp(message.timestamp);\n    }\n\n    // 渲染thinking(前置)\n    if (message.thinking && this.config.includeThinking && message.sender !== 'human') {\n      this.renderThinking(message.thinking);\n    }\n\n    // 渲染正文（LaTeX显示为源码）\n    if (message.display_text) {\n      this.renderBody(message.display_text);\n    }\n\n    // 渲染附件\n    if (message.attachments?.length > 0 && message.sender === 'human') {\n      this.renderAttachments(message.attachments);\n    }\n\n    // 渲染Artifacts\n    if (message.artifacts?.length > 0 && this.config.includeArtifacts && message.sender !== 'human') {\n      message.artifacts.forEach(artifact => {\n        this.renderArtifact(artifact);\n      });\n    }\n\n    // 渲染工具调用\n    if (message.tools?.length > 0 && this.config.includeTools) {\n      message.tools.forEach(tool => {\n        this.renderTool(tool);\n      });\n    }\n\n    // 渲染引用\n    if (message.citations?.length > 0 && this.config.includeCitations) {\n      this.renderCitations(message.citations);\n    }\n\n    // 消息间距\n    this.currentY += PDF_STYLES.MESSAGE_SPACING;\n  }\n\n  /**\n   * 渲染发送者标签\n   */\n  renderSender(message, index) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_SENDER);\n\n    // 根据发送者设置颜色\n    const color = message.sender === 'human'\n      ? PDF_STYLES.COLOR_SENDER_HUMAN\n      : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n\n    this.pdf.setTextColor(...color);\n\n    // 构建发送者标签\n    const senderLabel = message.sender === 'human' ? 'Human' : 'Assistant';\n    const label = `${index}. ${senderLabel}`;\n\n    // 添加分支标记\n    let finalLabel = label;\n    if (message.branchInfo?.isBranchPoint) {\n      const branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      finalLabel = label + branchMarker;\n    }\n\n    // 清理并输出标签\n    const cleanLabel = cleanText(finalLabel);\n    if (cleanLabel && cleanLabel.trim().length > 0) {\n      this.pdf.text(cleanLabel, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    }\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n  }\n\n  /**\n   * 渲染时间戳\n   */\n  renderTimestamp(timestamp) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n    this.pdf.text(timestamp, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n  }\n\n  /**\n   * 渲染正文（LaTeX显示为源码）\n   */\n  renderBody(text) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 处理代码块和LaTeX块\n    const parts = this.manager.parseTextWithCodeBlocksAndLatex(text);\n\n    // 渲染所有部分\n    for (const part of parts) {\n      if (part.type === 'code') {\n        this.renderCodeBlock(part.content, part.language);\n      } else if (part.type === 'latex-display') {\n        this.renderLatexDisplay(part);\n      } else {\n        // 渲染普通文本，支持markdown格式（可能包含inline LaTeX源码）\n        this.renderMarkdownText(part.content, maxWidth);\n      }\n    }\n\n    // 减小正文结束后的间距\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.3;\n  }\n\n\n  /**\n   * 获取或创建LaTeX渲染器\n   */\n  getLatexRenderer() {\n    if (!this.latexRenderer) {\n      this.latexRenderer = new LaTeXRenderer(this.pdf, {\n        fontSize: PDF_STYLES.FONT_SIZE_BODY,\n        color: PDF_STYLES.COLOR_TEXT\n      });\n    }\n    return this.latexRenderer;\n  }\n\n  /**\n   * 渲染LaTeX display math（块级数学公式）- 使用新的渲染器\n   */\n  renderLatexDisplay(part) {\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY + 30);\n\n    try {\n      // 尝试使用LaTeX渲染器\n      const renderer = this.getLatexRenderer();\n      const result = renderer.renderDisplayLaTeX(\n        part.content,\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY + PDF_STYLES.FONT_SIZE_BODY,\n        maxWidth\n      );\n\n      // 更新Y位置 - 减小公式间距\n      this.currentY += result.height + PDF_STYLES.LINE_HEIGHT * 0.05;  // 大幅缩短间距\n    } catch (error) {\n      console.warn('[PDF导出] LaTeX渲染失败，回退到源码显示:', error);\n\n      // 回退：显示LaTeX源码\n      this.renderLatexDisplayAsSource(part, maxWidth);\n    }\n  }\n\n  /**\n   * 渲染LaTeX display math作为源码（备用方案）\n   */\n  renderLatexDisplayAsSource(part, maxWidth) {\n    // 绘制背景（浅蓝色调表示LaTeX）\n    this.pdf.setFillColor(240, 248, 255);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      'F'\n    );\n\n    // 绘制边框（蓝色）\n    this.pdf.setDrawColor(100, 150, 200);\n    this.pdf.setLineWidth(0.5);\n    this.pdf.roundedRect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      PDF_STYLES.LINE_HEIGHT * 3,\n      1.5,\n      1.5,\n      'S'\n    );\n\n    // 显示标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(70, 130, 180);\n    this.pdf.text('[LaTeX]', PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // 显示LaTeX源码\n    this.pdf.setFont('courier', 'normal');\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setTextColor(50, 50, 50);\n\n    const sourceLines = this.pdf.splitTextToSize(part.content, maxWidth - 4);\n    sourceLines.forEach(line => {\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 恢复样式\n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染纯文本(带自动换行)\n   */\n  renderPlainText(text, maxWidth) {\n    // 处理空文本\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 清理文本，防止编码问题\n    const cleanedText = cleanText(text);\n    \n    if (!cleanedText || cleanedText.trim().length === 0) {\n      console.warn('[PDF导出] 文本清理后为空，跳过');\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 使用 splitTextToSize 自动处理换行,支持Unicode字符\n    let lines;\n    try {\n      lines = this.pdf.splitTextToSize(cleanedText, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] splitTextToSize失败，使用简单换行:', error);\n      // 如果splitTextToSize失败,使用简单的换行逻辑\n      lines = cleanedText.split('\\n');\n    }\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      \n      // 再次清理单行文本（防止splitTextToSize引入问题）\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染代码块（支持跨页）- 简化版，逐行渲染\n   */\n  renderCodeBlock(code, language = '') {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_CODE + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    const lineNumberWidth = 8;\n    const codeWidth = maxWidth - lineNumberWidth - 8;\n    const padding = 3;\n\n    const cleanCode = cleanText(code);\n    const cleanLanguage = cleanText(language);\n\n    // 渲染语言标签\n    if (cleanLanguage) {\n      this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.setTextColor(100, 100, 100);\n      const labelText = cleanLanguage.toUpperCase();\n      const labelWidth = this.safeGetTextWidth(labelText) + 4;\n      this.pdf.setFillColor(220, 220, 220);\n      this.pdf.roundedRect(\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY - 3,\n        labelWidth,\n        5,\n        1,\n        1,\n        'F'\n      );\n      this.pdf.text(labelText, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 处理代码行\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setFont(this.chineseFontName);\n    const codeLines = cleanCode.split('\\n');\n    const wrappedLines = [];\n\n    codeLines.forEach(line => {\n      if (!line) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n      const cleanLine = cleanText(line);\n      if (!cleanLine) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n\n      try {\n        const wrapped = this.pdf.splitTextToSize(cleanLine, codeWidth);\n        wrapped.forEach((wLine, idx) => {\n          wrappedLines.push({\n            text: wLine,\n            lineNumber: idx === 0 ? wrappedLines.length + 1 : null\n          });\n        });\n      } catch (error) {\n        wrappedLines.push({ text: cleanLine, lineNumber: wrappedLines.length + 1 });\n      }\n    });\n\n    // 逐行渲染，遇到需要换页时自动换页\n    const blockStartY = this.currentY;\n    const blockStartPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    // 先绘制第一页的背景和边框起始部分\n    const firstPageHeight = Math.min(\n      wrappedLines.length * PDF_STYLES.LINE_HEIGHT + padding * 2,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n    );\n    this.pdf.setFillColor(248, 248, 248);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      blockStartY - padding,\n      maxWidth,\n      firstPageHeight,\n      'F'\n    );\n\n    this.currentY = blockStartY;\n\n    wrappedLines.forEach(({ text, lineNumber }, index) => {\n      // 检查是否需要换页\n      if (this.currentY + PDF_STYLES.FONT_SIZE_CODE > PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM) {\n        // 先绘制当前页的代码块底部边框\n        this.pdf.setDrawColor(200, 200, 200);\n        this.pdf.setLineWidth(0.3);\n        const currentPageBottom = this.currentY;\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT,\n          currentPageBottom\n        );\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          currentPageBottom\n        );\n\n        // 换页\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n        \n        // 在新页绘制代码块背景（连续样式）\n        const remainingLines = wrappedLines.length - index;\n        const newPageHeight = Math.min(\n          remainingLines * PDF_STYLES.LINE_HEIGHT + padding,\n          PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n        );\n        this.pdf.setFillColor(248, 248, 248);\n        this.pdf.rect(\n          PDF_STYLES.MARGIN_LEFT,\n          this.currentY - padding,\n          maxWidth,\n          newPageHeight,\n          'F'\n        );\n      }\n\n      // 渲染行号\n      if (lineNumber !== null) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE - 1);\n        this.pdf.setTextColor(150, 150, 150);\n        const lineNumStr = String(lineNumber).padStart(3, ' ');\n        this.pdf.text(lineNumStr, PDF_STYLES.MARGIN_LEFT + 1, this.currentY);\n      }\n\n      // 渲染代码文本（支持 **粗体** 和 ### 标题）\n      const safeLine = cleanText(text);\n      if (safeLine !== null && safeLine !== undefined) {\n        // 解析粗体和标题标记\n        const segments = parseCodeLineBold(safeLine);\n        const isHeading = segments.some(s => s.heading);\n\n        // 根据标题级别设置字号和颜色\n        if (isHeading) {\n          const level = segments[0].heading;\n          const headingSizes = [14, 13, 12, 11, 10, 10]; // H1-H6 字号\n          this.pdf.setFontSize(headingSizes[level - 1] || PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(20, 20, 20); // 深色\n        } else {\n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n          this.pdf.setTextColor(50, 50, 50);\n        }\n\n        let currentX = PDF_STYLES.MARGIN_LEFT + lineNumberWidth + 2;\n\n        segments.forEach(segment => {\n          // 标题或粗体使用bold字体\n          if ((segment.heading || segment.bold) && this.availableFontWeights.includes('bold')) {\n            this.pdf.setFont(this.chineseFontName, 'bold');\n          } else {\n            // 使用普通字体（保持中文支持）\n            this.pdf.setFont(this.chineseFontName, 'normal');\n          }\n\n          this.pdf.text(segment.text, currentX, this.currentY);\n          currentX += this.safeGetTextWidth(segment.text);\n        });\n\n        // 恢复默认字体和字号\n        this.pdf.setFont(this.chineseFontName, 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(50, 50, 50);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 绘制最后的边框和行号分隔线\n    const endPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    \n    // 如果跨页，需要在每一页绘制边框\n    for (let page = blockStartPage; page <= endPage; page++) {\n      this.pdf.setPage(page);\n      const isFirst = (page === blockStartPage);\n      const isLast = (page === endPage);\n      \n      let boxStartY, boxEndY;\n      if (isFirst && isLast) {\n        // 单页代码块\n        boxStartY = blockStartY - padding;\n        boxEndY = this.currentY + padding;\n      } else if (isFirst) {\n        // 第一页\n        boxStartY = blockStartY - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      } else if (isLast) {\n        // 最后一页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = this.currentY + padding;\n      } else {\n        // 中间页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      }\n      \n      // 绘制边框\n      this.pdf.setDrawColor(200, 200, 200);\n      this.pdf.setLineWidth(0.3);\n      if (isFirst && isLast) {\n        this.pdf.roundedRect(PDF_STYLES.MARGIN_LEFT, boxStartY, maxWidth, boxEndY - boxStartY, 1.5, 1.5, 'S');\n      } else {\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT, boxEndY);\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        if (isFirst) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY);\n        }\n        if (isLast) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxEndY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        }\n      }\n      \n      // 绘制行号分隔线\n      this.pdf.setDrawColor(220, 220, 220);\n      this.pdf.setLineWidth(0.2);\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxStartY,\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxEndY\n      );\n    }\n\n    // 确保回到最后一页\n    this.pdf.setPage(endPage);\n    \n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 解析markdown格式的文本并渲染（包括LaTeX源码）\n   */\n  renderMarkdownText(text, maxWidth) {\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    const cleanedText = cleanText(text);\n    if (!cleanedText || cleanedText.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 按行处理文本\n    const lines = cleanedText.split('\\n');\n\n    for (const line of lines) {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n      // 处理不同类型的行\n      if (line.trim() === '') {\n        // 空行\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      } else if (line.match(/^#{1,6}\\s/)) {\n        // 标题\n        this.renderMarkdownHeading(line, maxWidth);\n      } else if (line.match(/^(---|___|\\*\\*\\*)$/)) {\n        // 水平分隔线（---, ___, 或 ***）\n        this.renderHorizontalRule(maxWidth);\n      } else if (line.match(/^>\\s/)) {\n        // 引用\n        this.renderMarkdownQuote(line, maxWidth);\n      } else if (line.match(/^[-*+]\\s/) || line.match(/^\\d+\\.\\s/)) {\n        // 列表\n        this.renderMarkdownList(line, maxWidth);\n      } else {\n        // 普通文本（可能包含行内格式和LaTeX）\n        this.renderMarkdownInlineFormats(line, maxWidth);\n      }\n    }\n  }\n\n  /**\n   * 渲染水平分隔线\n   */\n  renderHorizontalRule(maxWidth) {\n    // 上方留白\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.8;\n\n    const lineY = this.currentY;\n\n    // 绘制水平线 - 使用更淡的颜色和更细的线条\n    this.pdf.setDrawColor(230, 230, 230);  // 浅灰色，不突兀\n    this.pdf.setLineWidth(0.2);  // 细线\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      lineY,\n      PDF_STYLES.MARGIN_LEFT + maxWidth,\n      lineY\n    );\n\n    // <hr/> 下方留白（给下面内容足够间隔）\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 4;\n  }\n\n  /**\n   * 渲染markdown标题\n   */\n  renderMarkdownHeading(line, maxWidth) {\n    const match = line.match(/^(#{1,6})\\s+(.+)$/);\n    if (!match) {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const level = match[1].length;\n    const text = match[2];\n\n    // 根据标题级别设置字体大小\n    const fontSize = PDF_STYLES.FONT_SIZE_BODY + (7 - level) * 2;\n    const oldFontSize = this.pdf.internal.getFontSize();\n\n    this.pdf.setFontSize(fontSize);\n    // 使用粗体字体（如果可用）\n    this.safeSetFont(this.chineseFontName, 'bold');\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, maxWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(fontSize);\n        const cleanLine = cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n      });\n    } catch (error) {\n      console.error('[PDF导出] 标题渲染失败:', error);\n      this.pdf.text(text, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 恢复字体\n    this.pdf.setFontSize(oldFontSize);\n    this.safeSetFont(this.chineseFontName, 'normal');\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.5; // 标题后额外间距\n  }\n\n  /**\n   * 渲染markdown引用\n   */\n  renderMarkdownQuote(line, maxWidth) {\n    const text = line.replace(/^>\\s*/, '');\n    const quoteWidth = maxWidth - 8;\n    const quoteX = PDF_STYLES.MARGIN_LEFT + 6;\n\n    // 绘制左侧竖线\n    this.pdf.setDrawColor(150, 150, 150);\n    this.pdf.setLineWidth(0.5);\n\n    const startY = this.currentY - 2;\n\n    // 渲染文本\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(100, 100, 100);\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, quoteWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n        const cleanLine = cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, quoteX, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      });\n\n      // 绘制引用线\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + 2,\n        startY,\n        PDF_STYLES.MARGIN_LEFT + 2,\n        this.currentY - 2\n      );\n    } catch (error) {\n      console.error('[PDF导出] 引用渲染失败:', error);\n      this.pdf.text(text, quoteX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复颜色\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染markdown列表（包括LaTeX源码）\n   */\n  renderMarkdownList(line, maxWidth) {\n    let bullet = '';\n    let text = '';\n\n    // 检测列表类型\n    const unorderedMatch = line.match(/^([-*+])\\s+(.+)$/);\n    const orderedMatch = line.match(/^(\\d+)\\.\\s+(.+)$/);\n\n    if (unorderedMatch) {\n      bullet = '•'; // 使用圆点作为项目符号\n      text = unorderedMatch[2];\n    } else if (orderedMatch) {\n      bullet = orderedMatch[1] + '.';\n      text = orderedMatch[2];\n    } else {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const bulletWidth = this.safeGetTextWidth(bullet + '  ');\n    const textWidth = maxWidth - bulletWidth;\n    const textX = PDF_STYLES.MARGIN_LEFT + bulletWidth;\n\n    // 渲染项目符号\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.text(bullet, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n\n    // 解析并渲染带格式的文本\n    try {\n      // 解析行内markdown格式（粗体、斜体、LaTeX等）\n      const segments = parseInlineMarkdown(text);\n\n      // 使用renderInlineSegments渲染，但需要调整左边距\n      const originalMarginLeft = PDF_STYLES.MARGIN_LEFT;\n      PDF_STYLES.MARGIN_LEFT = textX; // 临时调整左边距以对齐列表文本\n\n      this.renderInlineSegments(segments, textWidth);\n\n      PDF_STYLES.MARGIN_LEFT = originalMarginLeft; // 恢复原始边距\n    } catch (error) {\n      console.error('[PDF导出] 列表渲染失败:', error);\n      this.pdf.text(text, textX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n  }\n\n  /**\n   * 渲染包含行内格式的markdown文本（包括LaTeX源码）\n   */\n  renderMarkdownInlineFormats(line, maxWidth) {\n    if (!line || line.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 解析行内格式（包括LaTeX）\n    const segments = parseInlineMarkdown(line);\n\n    // 按行渲染segments（包括LaTeX）\n    this.renderInlineSegments(segments, maxWidth);\n  }\n\n  /**\n   * 渲染行内格式的文本片段（包括LaTeX源码）\n   */\n  renderInlineSegments(segments, maxWidth) {\n    let currentX = PDF_STYLES.MARGIN_LEFT;\n    let currentLineText = '';\n    let currentLineSegments = [];\n\n    segments.forEach((segment, idx) => {\n      // 对于LaTeX，需要先转换为Unicode来计算实际渲染宽度\n      let text;\n      let textWidth;\n\n      if (segment.type === 'latex-inline') {\n        // 使用LaTeX渲染器的simplifyLaTeX方法转换为Unicode\n        const renderer = this.getLatexRenderer();\n        text = renderer.simplifyLaTeX(segment.text);\n        // 计算转换后Unicode文本的宽度\n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      } else {\n        text = cleanText(segment.text || '');\n        if (!text) return;\n        // 设置样式并测量宽度\n        this.applySegmentStyle(segment.type);\n        textWidth = this.safeGetTextWidth(text);\n      }\n\n      const availableWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - currentX;\n\n      // 如果单个 segment 本身就超过可用宽度，需要拆分\n      if (textWidth > availableWidth && currentLineSegments.length === 0) {\n        // LaTeX公式不应被分割，直接渲染（即使超出边界）\n        if (segment.type === 'latex-inline') {\n          console.warn('[PDF导出] LaTeX公式过长，保持完整渲染:', segment.text);\n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n          return;\n        }\n\n        // 这是新行的第一个 segment，但它太长了\n        // 尝试使用 splitTextToSize 拆分\n        try {\n          const maxSegmentWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n          let splitLines = this.pdf.splitTextToSize(text, maxSegmentWidth);\n          // 应用中文标点避头尾规则\n          splitLines = applyCJKPunctuationRules(splitLines);\n\n          // 渲染除最后一行外的所有行\n          for (let i = 0; i < splitLines.length - 1; i++) {\n            this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: splitLines[i]\n            }];\n            this.renderSegmentLine(currentLineSegments);\n            this.currentY += PDF_STYLES.LINE_HEIGHT;\n          }\n\n          // 最后一行准备与后续 segment 合并\n          const lastLine = splitLines[splitLines.length - 1];\n          const lastLineWidth = this.safeGetTextWidth(lastLine);\n          currentLineSegments = [{\n            ...segment,\n            x: PDF_STYLES.MARGIN_LEFT,\n            text: lastLine\n          }];\n          currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n        } catch (error) {\n          console.warn('[PDF导出] 文本拆分失败，强制换行:', error);\n          // 如果拆分失败，直接渲染（可能会超出边界，但至少不会崩溃）\n          const segmentData = {\n            ...segment,\n            x: currentX\n          };\n          if (segment.type !== 'latex-inline') {\n            segmentData.text = text;\n          }\n          currentLineSegments.push(segmentData);\n          currentX += textWidth;\n        }\n        return;\n      }\n\n      // 检查是否需要换行\n      if (currentX + textWidth > PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT && currentLineSegments.length > 0) {\n        // 先检查是否需要分页\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n        // 渲染当前行\n        this.renderSegmentLine(currentLineSegments);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n        // 重置行状态\n        currentX = PDF_STYLES.MARGIN_LEFT;\n        currentLineSegments = [];\n\n        // 重新检查新行上这个 segment 是否超出边界\n        if (textWidth > maxWidth) {\n          // LaTeX公式不应被分割\n          if (segment.type === 'latex-inline') {\n            console.warn('[PDF导出] LaTeX公式过长（换行后仍超宽），保持完整渲染:', segment.text);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + textWidth;\n            return;\n          }\n\n          // 即使在新行，segment 仍然太长，需要拆分\n          try {\n            let splitLines = this.pdf.splitTextToSize(text, maxWidth);\n            // 应用中文标点避头尾规则\n            splitLines = applyCJKPunctuationRules(splitLines);\n            for (let i = 0; i < splitLines.length - 1; i++) {\n              this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n              const tempSegments = [{\n                ...segment,\n                x: PDF_STYLES.MARGIN_LEFT,\n                text: splitLines[i]\n              }];\n              this.renderSegmentLine(tempSegments);\n              this.currentY += PDF_STYLES.LINE_HEIGHT;\n            }\n            // 最后一行\n            const lastLine = splitLines[splitLines.length - 1];\n            const lastLineWidth = this.safeGetTextWidth(lastLine);\n            currentLineSegments = [{\n              ...segment,\n              x: PDF_STYLES.MARGIN_LEFT,\n              text: lastLine\n            }];\n            currentX = PDF_STYLES.MARGIN_LEFT + lastLineWidth;\n          } catch (error) {\n            console.warn('[PDF导出] 文本拆分失败:', error);\n            const segmentData = {\n              ...segment,\n              x: currentX\n            };\n            if (segment.type !== 'latex-inline') {\n              segmentData.text = text;\n            }\n            currentLineSegments.push(segmentData);\n            currentX += textWidth;\n          }\n          return;\n        }\n      }\n\n      // 添加到当前行\n      // 注意：对于latex-inline类型，保留原始的segment.text（不含$符号）\n      // 对于其他类型，使用清理后的text\n      const segmentData = {\n        ...segment,\n        x: currentX\n      };\n      // 只有非LaTeX类型才覆盖text字段\n      if (segment.type !== 'latex-inline') {\n        segmentData.text = text;\n      }\n      currentLineSegments.push(segmentData);\n      currentX += textWidth;\n    });\n\n    // 渲染最后一行\n    if (currentLineSegments.length > 0) {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      this.renderSegmentLine(currentLineSegments);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染一行 segment（支持行内 LaTeX）\n   */\n  renderSegmentLine(segments) {\n    segments.forEach(segment => {\n      this.applySegmentStyle(segment.type);\n\n      if (segment.type === 'latex-inline') {\n        try {\n          const renderer = this.getLatexRenderer();\n          renderer.renderInlineLaTeX(\n            segment.text,\n            segment.x,\n            this.currentY,\n            PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - segment.x\n          );\n        } catch (error) {\n          console.warn('[PDF导出] 行内LaTeX渲染失败，显示源码:', error);\n          this.pdf.text(segment.text, segment.x, this.currentY);\n        }\n      } else if (segment.type === 'link') {\n        this.pdf.textWithLink(segment.text, segment.x, this.currentY, {\n          url: segment.url || '#'\n        });\n        const textWidth = this.safeGetTextWidth(segment.text);\n        this.pdf.line(segment.x, this.currentY + 0.5, segment.x + textWidth, this.currentY + 0.5);\n      } else if (segment.type === 'code') {\n        const textWidth = this.safeGetTextWidth(segment.text);\n        const padding = 1;\n        this.pdf.setFillColor(245, 245, 245);\n        this.pdf.rect(segment.x - padding, this.currentY - 3, textWidth + padding * 2, 4, 'F');\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      } else {\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      }\n    });\n  }\n\n  /**\n   * 应用segment样式（包括LaTeX源码样式）\n   */\n  applySegmentStyle(type) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    switch (type) {\n      case 'latex-inline':\n        // LaTeX使用斜体字体（如果使用渲染器失败才会用到这个样式）\n        try {\n          this.pdf.setFont(this.chineseFontName, 'italic');\n        } catch (e) {\n          this.pdf.setFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n        this.pdf.setTextColor(50, 50, 50); // 深灰色\n        break;\n      case 'latex-display':\n        // Display LaTeX (handled separately in renderLatexDisplay)\n        break;\n      case 'bold':\n        console.log('[PDF导出] 应用粗体样式, 字体:', this.chineseFontName, '可用变体:', this.availableFontWeights);\n        // 使用粗体字体（如果可用，否则自动回退）\n        const boldSuccess = this.safeSetFont(this.chineseFontName, 'bold');\n        console.log('[PDF导出] safeSetFont 返回:', boldSuccess);\n        if (!boldSuccess) {\n          // 如果粗体字体不可用，使用明显的视觉区分\n          console.warn('[PDF导出] 粗体字体不可用，使用视觉回退方案: 深蓝色 RGB(20,20,150) + 字体大小', PDF_STYLES.FONT_SIZE_BODY + 1);\n          // 使用深蓝色 + 增大字体来明显区分粗体\n          this.pdf.setTextColor(20, 20, 150); // 深蓝色，非常明显\n          this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 1); // 增加1pt，更明显\n        } else {\n          console.log('[PDF导出] 使用字体粗体变体');\n        }\n        break;\n      case 'italic':\n        // 使用 light 字体表示斜体（中文字体通常没有真正的斜体）\n        const lightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!lightSuccess) {\n          // 如果没有 light，用颜色区分\n          this.pdf.setTextColor(70, 130, 180); // 蓝色表示强调\n        }\n        break;\n      case 'bold-italic':\n        // 粗斜体：尝试使用 bold，如果没有则用 normal + 颜色\n        const boldItalicSuccess = this.safeSetFont(this.chineseFontName, 'bolditalic');\n        if (!boldItalicSuccess) {\n          // 回退：尝试只用 bold\n          const boldOnlySuccess = this.safeSetFont(this.chineseFontName, 'bold');\n          if (!boldOnlySuccess) {\n            // bold 也不可用，使用深蓝色区分\n            this.pdf.setTextColor(30, 60, 120); // 深蓝色（粗体+斜体）\n            this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY + 0.5);\n          } else {\n            // bold 可用，添加颜色表示斜体\n            this.pdf.setTextColor(70, 130, 180); // 蓝色表示斜体\n          }\n        }\n        break;\n      case 'code':\n        this.pdf.setFont('courier', 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(220, 50, 50);\n        break;\n      case 'link':\n        // 使用 light 字体和蓝色表示链接\n        const linkLightSuccess = this.safeSetFont(this.chineseFontName, 'light');\n        if (!linkLightSuccess) {\n          this.safeSetFont(this.chineseFontName, 'normal');\n        }\n        this.pdf.setTextColor(0, 102, 204); // 蓝色\n        break;\n      default:\n        this.safeSetFont(this.chineseFontName, 'normal');\n    }\n  }\n\n  /**\n   * 渲染thinking区块\n   */\n  renderThinking(thinking) {\n    this.renderSection('💭 Thinking', thinking, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染Artifact\n   */\n  renderArtifact(artifact) {\n    const title = `📄 Artifact: ${artifact.title || 'Untitled'}`;\n    const content = artifact.content || '';\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染工具调用\n   */\n  renderTool(tool) {\n    const title = `🔧 Tool: ${tool.name || 'Unknown'}`;\n    const content = `Input: ${JSON.stringify(tool.input, null, 2)}\\n\\nOutput: ${tool.output || 'N/A'}`;\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染引用\n   */\n  renderCitations(citations) {\n    const title = '📚 Citations';\n    const content = citations.map((cit, i) =>\n      `[${i + 1}] ${cit.title || cit.url || 'Unknown'}`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染附件\n   */\n  renderAttachments(attachments) {\n    const title = '📎 Attachments';\n    const content = attachments.map((att, i) =>\n      `[${i + 1}] ${att.file_name || att.name || 'file'} (${att.file_type || att.type || 'unknown'})`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 通用区块渲染(带背景)\n   */\n  renderSection(title, content, bgColor) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_H2 + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    \n    // 清理标题和内容\n    const cleanTitle = cleanText(title);\n    const cleanContent = cleanText(content);\n    \n    // 处理内容换行,带错误处理\n    let contentLines;\n    try {\n      contentLines = this.pdf.splitTextToSize(cleanContent, maxWidth - 4);\n    } catch (error) {\n      console.error('[PDF导出] 区块内容分割失败:', error);\n      contentLines = cleanContent.split('\\n');\n    }\n    \n    const bgHeight = PDF_STYLES.LINE_HEIGHT * (contentLines.length + 2);\n\n    // 绘制背景\n    this.pdf.setFillColor(...bgColor);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      bgHeight,\n      'F'\n    );\n\n    // 渲染标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H2);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    if (cleanTitle && cleanTitle.trim().length > 0) {\n      this.pdf.text(cleanTitle, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    }\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n\n    // 渲染内容\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    contentLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      const cleanLine = cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染目录（Table of Contents）带页码链接\n   */\n  renderTOCWithLinks(tocPage, messages) {\n    // 切换到目录页\n    this.pdf.setPage(tocPage);\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n\n    // 渲染目录标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H1);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.pdf.text('Table of Contents', PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 2;\n\n    // 绘制标题下方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.3);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      this.currentY\n    );\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // 渲染消息列表\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.manager.messageAnchors.forEach((anchor, idx) => {\n      const message = messages[idx];\n      if (!message) return;\n\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY * 2);\n\n      const messageNumber = `${anchor.index}.`;\n      const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n\n      // 获取消息预览（前50个字符）\n      let preview = anchor.title || '';\n      preview = cleanText(preview);\n      preview = preview.replace(/\\n/g, ' ').substring(0, 50);\n      if (preview.length >= 50) {\n        preview += '...';\n      }\n\n      // 添加分支标记\n      let branchMarker = '';\n      if (message.branchInfo?.isBranchPoint) {\n        branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      }\n\n      // 构建目录条目和页码\n      const entry = `${messageNumber} ${sender}${branchMarker}`;\n      const pageNum = `p.${anchor.page}`;\n\n      // 设置发送者颜色\n      const color = anchor.sender === 'human'\n        ? PDF_STYLES.COLOR_SENDER_HUMAN\n        : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n      this.pdf.setTextColor(...color);\n\n      // 计算页码位置（右对齐）\n      const pageNumWidth = this.safeGetTextWidth(pageNum);\n      const pageNumX = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageNumWidth;\n\n      // 渲染条目（作为链接）\n      const entryY = this.currentY;\n      this.pdf.textWithLink(entry, PDF_STYLES.MARGIN_LEFT + 5, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染页码（也作为链接）\n      this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n      this.pdf.textWithLink(pageNum, pageNumX, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染预览（如果有）\n      if (preview) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.text(preview, PDF_STYLES.MARGIN_LEFT + 10, this.currentY);\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n      }\n\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n  }\n\n  /**\n   * 渲染页脚\n   */\n  renderFooter(pageNumber, totalPages) {\n    const originalY = this.currentY;\n    const originalFontSize = this.pdf.internal.getFontSize();\n\n    // 设置页脚样式\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_FOOTER);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_FOOTER);\n\n    const footerY = PDF_STYLES.PAGE_HEIGHT - 10;\n\n    // 绘制页脚上方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.1);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT\n    );\n\n    // 左侧显示导出时间\n    const exportText = `Exported: ${this.manager.exportDate}`;\n    this.pdf.text(exportText, PDF_STYLES.MARGIN_LEFT, footerY);\n\n    // 右侧显示页码\n    const pageText = `${pageNumber} / ${totalPages}`;\n    const pageTextWidth = this.safeGetTextWidth(pageText);\n    this.pdf.text(pageText, PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageTextWidth, footerY);\n\n    // 恢复原始设置\n    this.pdf.setFontSize(originalFontSize);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY = originalY;\n  }\n}\n","// utils/export/pdfExportManager_new.js\n// PDF导出管理器 - 基于jsPDF实现纯文本PDF导出\n//\n// 使用 ARUDJingxihei 字体家族支持中文显示（Regular、Bold、Light 三种字重）\n// 支持 Markdown 渲染（标题、粗体、斜体、列表、引用等）\n// 支持 LaTeX 数学公式渲染（行内和块级）\nimport { jsPDF } from 'jspdf';\nimport { DateTimeUtils } from '../fileParser';\nimport { addChineseFontSupport } from './pdfFontHelper';\nimport { ContentRenderer, PDF_STYLES } from './pdfContentRenderers';\nimport * as textHelpers from './pdfTextHelpers';\n\n/**\n * PDF导出管理器类\n */\nexport class PDFExportManager {\n  constructor() {\n    this.pdf = null;\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n    this.config = {};\n    this.useChineseFont = false; // 是否成功加载了中文字体\n    this.chineseFontName = 'helvetica'; // 当前使用的字体名称\n    this.availableFontWeights = []; // 可用的字体变体 (normal, bold, light 等)\n    this.isSystemFont = false; // 是否使用系统字体\n    this.meta = null; // 保存元数据用于页脚\n    this.exportDate = null; // 导出时间\n    this.messageAnchors = []; // 保存每条消息的位置信息用于目录链接和书签\n    this.contentRenderer = null; // 内容渲染器实例\n    \n    // 绑定文本辅助方法到实例\n    this.cleanText = textHelpers.cleanText;\n    this.parseTextWithCodeBlocksAndLatex = textHelpers.parseTextWithCodeBlocksAndLatex;\n    this.parseInlineMarkdown = textHelpers.parseInlineMarkdown;\n    this.applyCJKPunctuationRules = textHelpers.applyCJKPunctuationRules;\n    this.parseCodeLineBold = textHelpers.parseCodeLineBold;\n  }\n\n  /**\n   * 安全地设置字体，如果字体变体不可用则自动回退\n   * @param {string} fontName - 字体名称\n   * @param {string} fontStyle - 字体样式 (normal, bold, light, italic, bolditalic)\n   * @returns {boolean} - 是否成功设置\n   */\n  safeSetFont(fontName, fontStyle = 'normal') {\n    return textHelpers.safeSetFont(this.pdf, fontName, fontStyle, this.availableFontWeights);\n  }\n\n  /**\n   * 安全地获取文本宽度，处理字体元数据缺失的情况\n   * @param {string} text - 要测量的文本\n   * @returns {number} - 文本宽度\n   */\n  safeGetTextWidth(text) {\n    return textHelpers.safeGetTextWidth(this.pdf, text, this.chineseFontName);\n  }\n\n  /**\n   * 安全地渲染文本，自动处理边界\n   * @param {string} text - 要渲染的文本\n   * @param {number} x - X 坐标\n   * @param {number} y - Y 坐标\n   * @param {number} maxWidth - 最大宽度（可选）\n   */\n  safeRenderText(text, x, y, maxWidth = null) {\n    return textHelpers.safeRenderText(this.pdf, text, x, y, maxWidth);\n  }\n\n  /**\n   * 主导出方法\n   * @param {Array} messages - 消息列表\n   * @param {Object} meta - 元数据(title, platform, created_at, updated_at)\n   * @param {Object} config - 导出配置\n   */\n  async exportToPDF(messages, meta, config = {}) {\n    console.log('[PDF导出] 开始导出', {\n      messageCount: messages.length,\n      config\n    });\n\n    // 保存元数据和导出时间\n    this.meta = meta;\n    this.exportDate = DateTimeUtils.formatDateTime(new Date());\n    this.messageAnchors = []; // 重置消息锚点\n\n    this.config = {\n      includeThinking: config.includeThinking ?? true,\n      includeArtifacts: config.includeArtifacts ?? true,\n      includeTimestamps: config.includeTimestamps ?? false,\n      includeTools: config.includeTools ?? true,\n      includeCitations: config.includeCitations ?? true,\n      highQuality: config.highQuality ?? false,\n      ...config\n    };\n\n    // 初始化PDF文档\n    this.pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4',\n      compress: true\n    });\n\n    // 尝试加载中文字体（异步加载可能需要时间）\n    try {\n      console.log('[PDF导出] 开始加载中文字体...');\n      console.log('[PDF导出] 调用 addChineseFontSupport(this.pdf)...');\n      const fontLoadResult = await addChineseFontSupport(this.pdf);\n      console.log('[PDF导出] addChineseFontSupport 返回结果:', fontLoadResult);\n\n      this.useChineseFont = fontLoadResult.success;\n      this.chineseFontName = fontLoadResult.fontName;\n      this.availableFontWeights = fontLoadResult.availableWeights || [];\n      this.isSystemFont = fontLoadResult.isSystemFont || false;\n\n      if (!this.useChineseFont) {\n        console.warn('[PDF导出] ⚠️ 中文字体加载失败，将使用默认字体（中文可能显示为方框）');\n        console.warn('[PDF导出] fontLoadResult详情:', JSON.stringify(fontLoadResult, null, 2));\n        if (fontLoadResult.systemFontAvailable) {\n          console.warn('[PDF导出] 提示：检测到系统有中文字体，但无法在浏览器环境中直接使用');\n          console.warn('[PDF导出] 建议：请确保项目 public/fonts/ 目录下有中文字体文件');\n        }\n      } else {\n        const fontType = this.isSystemFont ? '系统字体' : '项目字体';\n        console.log(`[PDF导出] ✅ 中文字体加载成功: ${this.chineseFontName} (${fontType})`);\n        console.log(`[PDF导出] 可用字体变体: ${this.availableFontWeights.join(', ')}`);\n        if (fontLoadResult.systemFontInfo) {\n          console.log(`[PDF导出] 系统字体信息: ${fontLoadResult.systemFontInfo.fontName}`);\n        }\n      }\n    } catch (error) {\n      console.error('[PDF导出] ❌ 字体加载异常:', error);\n      console.error('[PDF导出] 错误堆栈:', error.stack);\n      this.useChineseFont = false;\n      this.chineseFontName = 'helvetica';\n      this.availableFontWeights = [];\n      this.isSystemFont = false;\n    }\n\n    // 无论字体是否加载成功，都设置一个默认字体\n    this.pdf.setFont(this.chineseFontName);\n\n    // 创建内容渲染器实例\n    this.contentRenderer = new ContentRenderer(this);\n\n    // 渲染文档\n    this.contentRenderer.renderTitle(meta);\n    this.contentRenderer.renderMetadata(meta);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n\n    // 渲染消息（LaTeX显示为源码）\n    for (let i = 0; i < messages.length; i++) {\n      const message = messages[i];\n\n      // 分页策略：一轮对话（用户消息+AI回复）结束后再换页\n      // 只有当前是用户消息且不是第一条时才换页，这样一轮对话会在同一页或连续页面上\n      if (i > 0 && message.sender === 'human') {\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n      }\n\n      this.contentRenderer.renderMessage(message, i + 1);\n    }\n\n    // 生成目录（放在文档最后，避免页码混乱）\n    const hasTOC = messages.length > 1;\n    if (hasTOC) {\n      console.log('[PDF导出] 生成目录（位于文档末尾）...');\n      this.pdf.addPage();\n      const tocPageNumber = this.pdf.internal.getCurrentPageInfo().pageNumber;\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n      this.contentRenderer.renderTOCWithLinks(tocPageNumber, messages);\n    }\n\n    // 添加PDF书签\n    console.log('[PDF导出] 添加PDF书签...');\n    this.addBookmarks();\n\n    // 为所有页面添加页脚\n    console.log('[PDF导出] 添加页脚...');\n    this.addFooters();\n\n    // 生成文件名并保存\n    const fileName = this.generateFileName(meta);\n    this.pdf.save(fileName);\n\n    console.log('[PDF导出] 导出完成:', fileName);\n    return true;\n  }\n\n  /**\n   * 添加PDF书签（outline）\n   */\n  addBookmarks() {\n    if (this.messageAnchors.length === 0) return;\n\n    // jsPDF的outline功能\n    // 创建书签树结构\n    try {\n      this.messageAnchors.forEach((anchor) => {\n        const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n        const title = `${anchor.index}. ${sender}`;\n\n        // 使用jsPDF的outline API\n        // 注意：jsPDF的outline功能可能需要插件支持\n        if (this.pdf.outline) {\n          this.pdf.outline.add(null, title, { pageNumber: anchor.page });\n        }\n      });\n    } catch (error) {\n      console.warn('[PDF导出] 书签添加失败（可能不支持）:', error);\n    }\n  }\n\n  /**\n   * 为所有页面添加页脚\n   */\n  addFooters() {\n    const totalPages = this.pdf.internal.getNumberOfPages();\n\n    for (let i = 1; i <= totalPages; i++) {\n      this.pdf.setPage(i);\n      this.contentRenderer.renderFooter(i, totalPages);\n    }\n  }\n\n  /**\n   * 检查是否需要分页\n   */\n  checkPageBreak(requiredSpace = 20) {\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    if (this.currentY + requiredSpace > bottomLimit) {\n      this.pdf.addPage();\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n    }\n  }\n\n  /**\n   * 将代码行按页分组\n   * @param {Array} wrappedLines - 包装后的代码行\n   * @returns {Array} - 分组后的行 [{page, startY, lines: [...]}]\n   */\n  groupCodeLinesByPage(wrappedLines) {\n    const groups = [];\n    let currentGroup = null;\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    let simulatedY = this.currentY;\n    let simulatedPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    wrappedLines.forEach((line) => {\n      // 检查是否需要换页\n      if (simulatedY + PDF_STYLES.FONT_SIZE_CODE > bottomLimit) {\n        simulatedPage++;\n        simulatedY = PDF_STYLES.MARGIN_TOP;\n        currentGroup = null; // 开始新组\n      }\n\n      // 如果没有当前组或换页了，创建新组\n      if (!currentGroup || currentGroup.page !== simulatedPage) {\n        currentGroup = {\n          page: simulatedPage,\n          startY: simulatedY,\n          lines: []\n        };\n        groups.push(currentGroup);\n      }\n\n      // 添加行到当前组\n      currentGroup.lines.push(line);\n      simulatedY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    return groups;\n  }\n\n  /**\n   * 生成文件名\n   */\n  generateFileName(meta) {\n    const date = DateTimeUtils.getCurrentDate();\n    const cleanTitle = (meta.name || 'conversation').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n    return `${cleanTitle}_${date}.pdf`;\n  }\n\n  /**\n   * 获取平台前缀\n   */\n  getPlatformPrefix(platform) {\n    const platformLower = (platform || '').toLowerCase();\n\n    if (platformLower.includes('chatgpt')) return 'chatgpt';\n    if (platformLower.includes('gemini')) return 'gemini';\n    if (platformLower.includes('notebooklm')) return 'notebooklm';\n    if (platformLower.includes('aistudio')) return 'aistudio';\n    if (platformLower.includes('sillytavern')) return 'sillytavern';\n\n    return 'claude';\n  }\n}\n\n// 导出单例实例\nexport const pdfExportManager = new PDFExportManager();"],"names":["async","loadFontFromProject","pdf","fontPath","fontName","arguments","length","undefined","fontStyle","console","log","concat","arrayBuffer","base64","loadFontData","FontCache","has","hasCmap","version","DataView","getUint32","warn","buffer","Uint8Array","cmapSignature","i","Math","min","error","hasUnicodeCmap","fileName","split","pop","addFileToVFS","addFont","addFontError","message","Map","cached","get","dbCache","loadFromIndexedDB","set","timestamp","Date","now","controller","AbortController","timeoutId","setTimeout","abort","response","fetch","signal","cache","clearTimeout","ok","Error","status","contentType","headers","includes","fileSizeMB","byteLength","toFixed","magic","toString","bytes","binary","chunkSize","chunk","subarray","String","fromCharCode","apply","btoa","fontData","Promise","resolve","reject","request","indexedDB","open","onerror","onupgradeneeded","event","db","target","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","transaction","objectStore","put","path","oncomplete","close","saveToIndexedDB","catch","err","fetchError","name","getRequest","data","cleanText","text","cleaned","normalize","replace","ligatureMap","ligature","replacement","Object","entries","RegExp","quoteMap","from","to","ch","charCodeAt","parseTextWithCodeBlocksAndLatex","parts","elements","codeBlockRegex","match","lastIndex","exec","language","trim","toLowerCase","content","push","start","index","end","type","latexDisplayRegex","latexBracketRegex","sort","a","b","filteredElements","forEach","element","some","existing","plainText","substring","parseInlineMarkdown","segments","matches","regex","pattern","source","isLatex","url","rawText","filteredMatches","lastEnd","segment","applyCJKPunctuationRules","lines","noLineStart","noLineEnd","prevLine","currentLine","test","punct","parseCodeLineBold","line","headingMatch","level","headingText","boldRegex","bold","heading","safeSetFont","availableFontWeights","setFont","fallbackStyle","safeGetTextWidth","chineseFontName","font","getFont","metadata","Unicode","currentStyle","getTextWidth","fontSize","getFontSize","LATEX_UNICODE_MAP","SUPERSCRIPT_MAP","SUBSCRIPT_MAP","LaTeXRenderer","constructor","config","this","_objectSpread","color","useUnicode","renderInlineLaTeX","latex","x","y","maxWidth","simplified","simplifyLaTeX","hasComplexStructure","renderComplexLaTeX","setFontSize","setTextColor","e","width","renderDisplayLaTeX","centerX","textWidth","startX","setFillColor","rect","padding","height","convertToSuperscript","char","convertToSubscript","keys","command","map","join","isInline","parseComplexLaTeX","totalWidth","fracFontSize","numWidth","numerator","denWidth","denominator","max","base","subSupFontSize","exponent","subscript","raw","currentX","maxHeight","hasFraction","fracWidth","renderFraction","sqrtWidth","renderSquareRoot","supWidth","renderSuperscript","subWidth","renderSubscript","fallbackText","fallbackWidth","remaining","fracRegex","fracMatch","beforeText","numOffset","denOffset","numX","setLineWidth","setDrawColor","denX","sqrtHeight","baseWidth","supFontSize","supText","subFontSize","subText","PDF_STYLES","FONT_SIZE_TITLE","FONT_SIZE_H1","FONT_SIZE_H2","FONT_SIZE_SENDER","FONT_SIZE_BODY","FONT_SIZE_CODE","FONT_SIZE_TIMESTAMP","FONT_SIZE_HEADER","FONT_SIZE_FOOTER","COLOR_SENDER_HUMAN","COLOR_SENDER_ASSISTANT","COLOR_TIMESTAMP","COLOR_CODE_BG","COLOR_SECTION_BG","COLOR_TEXT","COLOR_HEADER","COLOR_FOOTER","COLOR_BORDER","MARGIN_LEFT","MARGIN_RIGHT","MARGIN_TOP","MARGIN_BOTTOM","LINE_HEIGHT","SECTION_SPACING","MESSAGE_SPACING","FOOTER_HEIGHT","PAGE_WIDTH","PAGE_HEIGHT","ContentRenderer","manager","latexRenderer","currentY","value","safeRenderText","checkPageBreak","requiredSpace","renderTitle","meta","title","titleLines","splitTextToSize","cleanLine","renderMetadata","platform","created_at","updated_at","exportDate","renderMessage","_message$attachments","_message$artifacts","_message$tools","_message$citations","currentPage","internal","getCurrentPageInfo","pageNumber","messageAnchors","page","sender","display_text","renderSender","includeTimestamps","renderTimestamp","thinking","includeThinking","renderThinking","renderBody","attachments","renderAttachments","artifacts","includeArtifacts","artifact","renderArtifact","tools","includeTools","tool","renderTool","citations","includeCitations","renderCitations","_message$branchInfo","senderLabel","label","finalLabel","branchInfo","isBranchPoint","childCount","cleanLabel","part","renderCodeBlock","renderLatexDisplay","renderMarkdownText","getLatexRenderer","renderLatexDisplayAsSource","roundedRect","renderPlainText","cleanedText","code","codeWidth","cleanCode","cleanLanguage","labelText","toUpperCase","labelWidth","codeLines","wrappedLines","lineNumber","wLine","idx","blockStartY","blockStartPage","firstPageHeight","_ref","currentPageBottom","addPage","remainingLines","newPageHeight","lineNumStr","padStart","safeLine","s","headingSizes","endPage","setPage","isFirst","isLast","boxStartY","boxEndY","renderMarkdownHeading","renderHorizontalRule","renderMarkdownQuote","renderMarkdownList","renderMarkdownInlineFormats","lineY","oldFontSize","l","quoteWidth","quoteX","startY","bullet","unorderedMatch","orderedMatch","bulletWidth","textX","originalMarginLeft","renderInlineSegments","currentLineSegments","applySegmentStyle","segmentData","maxSegmentWidth","splitLines","renderSegmentLine","lastLine","lastLineWidth","tempSegments","textWithLink","boldSuccess","renderSection","JSON","stringify","input","output","cit","att","file_name","file_type","bgColor","cleanTitle","cleanContent","contentLines","bgHeight","renderTOCWithLinks","tocPage","messages","anchor","_message$branchInfo2","messageNumber","preview","branchMarker","entry","pageNum","pageNumWidth","pageNumX","entryY","renderFooter","totalPages","originalY","originalFontSize","footerY","exportText","pageText","pageTextWidth","PDFExportManager","useChineseFont","isSystemFont","contentRenderer","textHelpers","truncated","exportToPDF","_config$includeThinki","_config$includeArtifa","_config$includeTimest","_config$includeTools","_config$includeCitati","_config$highQuality","messageCount","DateTimeUtils","formatDateTime","highQuality","jsPDF","orientation","unit","format","compress","fontLoadResult","fontConfigs","style","weight","description","loadedCount","availableWeights","success","addChineseFontSupport","fontType","systemFontInfo","systemFontAvailable","stack","tocPageNumber","addBookmarks","addFooters","generateFileName","save","outline","add","getNumberOfPages","bottomLimit","groupCodeLinesByPage","groups","currentGroup","simulatedY","simulatedPage","date","getCurrentDate","getPlatformPrefix","platformLower"],"sourceRoot":""}