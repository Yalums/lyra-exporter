"use strict";(self.webpackChunklyra_exporter=self.webpackChunklyra_exporter||[]).push([[22],{22:(s,t,e)=>{e.d(t,{exportChatAsMarkdown:()=>u,saveTextFile:()=>h});const u=(s,t)=>{const{meta_info:e,chat_history:u}=s,h=[];if(t.exportObsidianMetadata&&(h.push("---"),h.push(`title: ${e.title||"\u5bf9\u8bdd\u8bb0\u5f55"}`),h.push(`date: ${(new Date).toISOString().split("T")[0]}`),t.obsidianProperties&&t.obsidianProperties.length>0&&t.obsidianProperties.forEach(s=>{const{name:t,value:e}=s;if(e.includes(",")&&!e.includes("[")){const s=e.split(",").map(s=>s.trim());h.push(`${t}:`),s.forEach(s=>{h.push(`  - ${s}`)})}else h.push(`${t}: ${e}`)}),t.obsidianTags&&t.obsidianTags.length>0&&(h.push("tags:"),t.obsidianTags.forEach(s=>{h.push(`  - ${s}`)})),h.push("---"),h.push("")),h.push(`# ${e.title||"\u5bf9\u8bdd\u8bb0\u5f55"}`),h.push(`*\u521b\u5efa\u65f6\u95f4: ${e.created_at||"\u672a\u77e5"}*`),h.push(`*\u5bfc\u51fa\u65f6\u95f4: ${(new Date).toLocaleString("zh-CN")}*`),t.exportMarkedOnly&&h.push("*\u5bfc\u51fa\u7c7b\u578b: \u4ec5\u5305\u542b\u5df2\u5b8c\u6210\u6807\u8bb0\u7684\u6d88\u606f*"),h.push(""),h.push("---"),h.push(""),!u||0===u.length)return h.push("*\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6d88\u606f*"),h.join("\n");let p=0;return u.forEach(s=>{var e;if(t.exportMarkedOnly&&(null===(e=t.markedItems)||void 0===e||!e.has(s.index)))return;p++;const u=s.sender_label,n=s.timestamp,i=s.index+1;let a="";s.is_branch_point?a=" \ud83d\udd00":s.branch_level>0&&(a=` \u21b3${s.branch_level}`),h.push(`## ${i}. ${u}${a}`),t.includeTimestamps&&h.push(`*${n}*`),h.push(""),s.display_text&&(h.push(s.display_text),h.push("")),s.thinking&&t.includeThinking&&(h.push("<details>"),h.push("<summary>\u601d\u8003\u8fc7\u7a0b</summary>"),h.push(""),h.push("```"),h.push(s.thinking),h.push("```"),h.push("</details>"),h.push("")),s.artifacts&&s.artifacts.length>0&&t.includeArtifacts&&s.artifacts.forEach(s=>{const t=s.id||"\u672a\u77e5",e=s.type||"\u672a\u77e5",u=s.title||"\u65e0\u6807\u9898";h.push("<details>"),h.push(`<summary>Artifact: ${u} (ID: ${t})</summary>`),h.push(""),h.push(`**\u7c7b\u578b**: \`${e}\``),h.push("");const p=s.command||"";if("create"===p){const t=s.content||"",e=s.language||"";e?(h.push(`**\u8bed\u8a00**: \`${e}\``),h.push(""),h.push("**\u5185\u5bb9**:"),h.push(`\`\`\`${e}`),h.push(t),h.push("```")):(h.push("**\u5185\u5bb9**:"),h.push("```"),h.push(t),h.push("```"))}else if("update"===p||"rewrite"===p){const t=s.old_str||"",e=s.new_str||"";h.push(`**\u64cd\u4f5c**: \`${p}\``),h.push(""),h.push("**\u539f\u59cb\u6587\u672c**:"),h.push("```"),h.push(t),h.push("```"),h.push(""),h.push("**\u65b0\u6587\u672c**:"),h.push("```"),h.push(e),h.push("```")}h.push("</details>"),h.push("")}),s.tools&&s.tools.length>0&&t.includeTools&&s.tools.forEach(s=>{const t=s.name;if(h.push("<details>"),h.push(`<summary>\u5de5\u5177: ${t}</summary>`),h.push(""),"web_search"===t&&s.query&&(h.push(`**\u641c\u7d22\u67e5\u8be2**: \`${s.query}\``),h.push("")),s.input&&"object"===typeof s.input){h.push("**\u8f93\u5165\u53c2\u6570**:"),h.push("```json");try{h.push(JSON.stringify(s.input,null,2))}catch(e){h.push(String(s.input))}h.push("```"),h.push("")}if(s.result&&(h.push("**\u7ed3\u679c**:"),s.result.is_error&&(h.push("> \u26a0\ufe0f \u5de5\u5177\u6267\u884c\u51fa\u9519"),h.push("")),"web_search"===t)){const t=s.result.content||[],e=Math.min(t.length,5);if(t.length>0){h.push("\u641c\u7d22\u7ed3\u679c:"),h.push("");for(let s=0;s<e;s++){const e=t[s];if(!e||"object"!==typeof e)continue;const u=e.title||"\u65e0\u6807\u9898",p=e.url||"#";h.push(`${s+1}. [${u}](${p})`)}t.length>e&&h.push(`*...\u8fd8\u6709 ${t.length-e} \u4e2a\u7ed3\u679c\u672a\u663e\u793a*`),h.push("")}}h.push("</details>"),h.push("")}),s.citations&&s.citations.length>0&&t.includeCitations&&(h.push("<details>"),h.push("<summary>\u5f15\u7528\u6765\u6e90</summary>"),h.push(""),h.push("| \u6807\u9898 | \u6765\u6e90 |"),h.push("| --- | --- |"),s.citations.forEach(s=>{const t=s.title||"\u672a\u77e5\u6765\u6e90",e=s.url||"#",u=e.includes("/")?e.split("/")[2]:"\u672a\u77e5\u7f51\u7ad9";h.push(`| [${t}](${e}) | ${u} |`)}),h.push("</details>"),h.push("")),h.push("---"),h.push("")}),t.exportMarkedOnly&&(h.push(""),h.push(`*\u5171\u5bfc\u51fa ${p} \u6761\u5df2\u5b8c\u6210\u7684\u6d88\u606f*`)),h.join("\n")},h=(s,t)=>{try{const e=new Blob([s],{type:"text/markdown"}),u=URL.createObjectURL(e),h=document.createElement("a");return h.href=u,h.download=t,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u),!0}catch(e){return console.error("\u4fdd\u5b58\u6587\u4ef6\u5931\u8d25:",e),alert("\u4fdd\u5b58\u6587\u4ef6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"),!1}}}}]);
//# sourceMappingURL=22.0a713db3.chunk.js.map