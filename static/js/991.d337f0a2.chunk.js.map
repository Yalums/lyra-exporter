{"version":3,"file":"static/js/991.d337f0a2.chunk.js","mappings":"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","sources":["utils/export/pdfFontHelper.js","utils/export/pdfExportManager.js"],"sourcesContent":["// utils/export/pdfFontHelper.js\n// PDF中文字体支持 - 使用 ARUDJingxihei (阿如汉字黑体) 字体家族\n//\n// 当前实现：\n// - 使用 public/fonts/ARUDJingxihei-Regular.ttf (正常字重)\n// - 使用 public/fonts/ARUDJingxihei-Bold.ttf (粗体字重)\n// - 使用 public/fonts/ARUDJingxihei-Light.ttf (细体字重)\n// - 支持多字重变体，可正确渲染粗体标题和强调文本\n// - 包含完整的验证流程（Content-Type、TTF魔数、cmap表）\n\n/**\n * 验证字体是否包含必要的 Unicode cmap\n * @param {ArrayBuffer} arrayBuffer - 字体文件内容\n * @returns {boolean} - 是否包含 cmap\n */\nfunction hasUnicodeCmap(arrayBuffer) {\n  try {\n    const dataView = new DataView(arrayBuffer);\n    \n    // TTF 文件以特定的魔数开头\n    const version = dataView.getUint32(0, false);\n    // 0x00010000 或 'true' 或 'typ1' 或 'OTTO'\n    if (version !== 0x00010000 && version !== 0x74727565) {\n      console.warn('[PDF字体] 可能不是标准TTF格式');\n    }\n    \n    // 简单检查: 查找 'cmap' 表\n    const buffer = new Uint8Array(arrayBuffer);\n    const cmapSignature = [0x63, 0x6d, 0x61, 0x70]; // 'cmap'\n    \n    for (let i = 0; i < Math.min(buffer.length - 4, 1000); i++) {\n      if (buffer[i] === cmapSignature[0] &&\n          buffer[i+1] === cmapSignature[1] &&\n          buffer[i+2] === cmapSignature[2] &&\n          buffer[i+3] === cmapSignature[3]) {\n        console.log('[PDF字体] 找到 cmap 表');\n        return true;\n      }\n    }\n    \n    console.warn('[PDF字体] 未找到 cmap 表特征');\n    return false;\n  } catch (error) {\n    console.error('[PDF字体] cmap 检查失败:', error);\n    return false;\n  }\n}\n\n/**\n * 从项目资源加载字体文件并添加到PDF\n * @param {jsPDF} pdf - jsPDF实例\n * @param {string} fontPath - 字体文件路径 (相对于public目录)\n * @param {string} fontName - 字体名称\n * @param {string} fontStyle - 字体样式 (normal, bold, light 等)\n * @returns {Promise<boolean>} - 是否成功加载字体\n */\nasync function loadFontFromProject(pdf, fontPath, fontName = 'CustomFont', fontStyle = 'normal') {\n  try {\n    console.log(`[PDF字体] 正在加载字体: ${fontPath}`);\n    \n    // 设置超时时间（5秒）\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 5000);\n    \n    try {\n      // 从 public 目录加载字体文件\n      // 添加时间戳参数破坏缓存\n      const cacheBuster = `?v=${Date.now()}`;\n      const response = await fetch(fontPath + cacheBuster, { \n        signal: controller.signal,\n        cache: 'no-store', // 禁用缓存\n        headers: {\n          'Cache-Control': 'no-cache'\n        }\n      });\n      clearTimeout(timeoutId);\n      \n      if (!response.ok) {\n        throw new Error(`加载字体失败: ${response.status}`);\n      }\n\n      // 检查 Content-Type，确保是字体文件而不是HTML错误页面\n      const contentType = response.headers.get('content-type');\n      console.log(`[PDF字体] Content-Type: ${contentType}`);\n\n      if (contentType && contentType.includes('text/html')) {\n        console.error(`[PDF字体] 返回了HTML页面而不是字体文件！`);\n        return false;\n      }\n\n      const arrayBuffer = await response.arrayBuffer();\n      const fileSizeKB = (arrayBuffer.byteLength / 1024).toFixed(2);\n      const fileSizeMB = (arrayBuffer.byteLength / 1024 / 1024).toFixed(2);\n\n      console.log(`[PDF字体] 字体文件大小: ${fileSizeMB} MB (${fileSizeKB} KB)`);\n\n      // 验证TTF魔数（文件头）\n      const dataView = new DataView(arrayBuffer);\n      const magic = dataView.getUint32(0, false);\n      // TTF文件应该以 0x00010000 或 0x74727565 ('true') 开头\n      if (magic !== 0x00010000 && magic !== 0x74727565) {\n        console.error(`[PDF字体] 文件不是有效的TTF字体！魔数: 0x${magic.toString(16)}`);\n        console.error(`[PDF字体] 这可能是一个HTML错误页面或其他非字体文件`);\n        return false;\n      }\n\n      // 检查文件是否太小\n      if (arrayBuffer.byteLength < 500 * 1024) {\n        console.error(`[PDF字体] 字体文件异常小 (仅 ${fileSizeKB} KB)！`);\n        console.error(`[PDF字体] 正常的中文字体应该至少 3MB`);\n        return false;\n      }\n      \n      // 验证字体是否包含 cmap 表\n      const hasCmap = hasUnicodeCmap(arrayBuffer);\n      if (!hasCmap) {\n        console.warn(`[PDF字体] 警告: 字体可能缺少 Unicode cmap 表`);\n        console.warn(`[PDF字体] 建议更换为 Noto Sans SC 或 Source Han Sans CN`);\n      }\n      \n      const bytes = new Uint8Array(arrayBuffer);\n      \n      // 转换为base64\n      let binary = '';\n      const len = bytes.byteLength;\n      // 批量处理以提高性能\n      const chunkSize = 8192;\n      for (let i = 0; i < len; i += chunkSize) {\n        const chunk = bytes.subarray(i, Math.min(i + chunkSize, len));\n        binary += String.fromCharCode.apply(null, chunk);\n      }\n      const base64 = btoa(binary);\n      \n      // 添加字体到jsPDF\n      const fileName = fontPath.split('/').pop();\n      \n      try {\n        pdf.addFileToVFS(fileName, base64);\n        // 添加字体时指定样式\n        pdf.addFont(fileName, fontName, fontStyle);\n\n        console.log(`[PDF字体] 字体加载成功: ${fontName}-${fontStyle}`);\n        return true;\n      } catch (addFontError) {\n        console.error(`[PDF字体] addFont 失败:`, addFontError.message);\n        console.error(`[PDF字体] 这通常意味着字体不兼容 jsPDF`);\n        console.error(`[PDF字体] 错误详情:`, addFontError);\n        return false;\n      }\n    } catch (fetchError) {\n      clearTimeout(timeoutId);\n      if (fetchError.name === 'AbortError') {\n        console.warn(`[PDF字体] 字体加载超时: ${fontPath}`);\n      } else {\n        console.warn(`[PDF字体] 获取字体文件失败: ${fetchError.message}`);\n      }\n      return false;\n    }\n  } catch (error) {\n    console.error('[PDF字体] 字体加载失败:', error);\n    return false;\n  }\n}\n\n/**\n * 为PDF添加中文字体支持（多字重版本）\n * 尝试加载项目中的中文字体，支持 Regular、Light、Bold 三个字重\n *\n * @param {jsPDF} pdf - jsPDF实例\n * @returns {Promise<{success: boolean, fontName: string, availableWeights: string[]}>} - 加载结果和字体名称\n */\nexport async function addChineseFontSupport(pdf) {\n  console.log('[PDF字体] 开始加载 ARUDJingxihei 字体家族...');\n\n  // 定义字体配置 - 使用阿如汉字黑体\n  const fontConfigs = [\n    {\n      path: '/fonts/ARUDJingxihei-Regular.ttf',\n      name: 'ARUDJingxihei',\n      style: 'normal',\n      weight: 400,\n      description: 'Regular (正常)'\n    },\n    {\n      path: '/fonts/ARUDJingxihei-Bold.ttf',\n      name: 'ARUDJingxihei',\n      style: 'bold',\n      weight: 700,\n      description: 'Bold (粗体)'\n    },\n    {\n      path: '/fonts/ARUDJingxihei-Light.ttf',\n      name: 'ARUDJingxihei',\n      style: 'light',\n      weight: 300,\n      description: 'Light (细体)'\n    },\n  ];\n\n  let loadedCount = 0;\n  let fontName = 'helvetica';\n  const availableWeights = [];\n\n  for (const config of fontConfigs) {\n    try {\n      const success = await loadFontFromProject(\n        pdf,\n        config.path,\n        config.name,\n        config.style  // 传入样式参数\n      );\n      if (success) {\n        loadedCount++;\n        fontName = config.name;\n        availableWeights.push(config.style);\n        console.log(`[PDF字体] ✓ 加载成功: ${config.name}-${config.style} (${config.description})`);\n      }\n    } catch (error) {\n      console.warn(`[PDF字体] ✗ 跳过: ${config.path} - ${error.message}`);\n    }\n  }\n\n  if (loadedCount === 0) {\n    console.warn('[PDF字体] ✗ 未能加载任何 ARUDJingxihei 字体');\n    console.warn('[PDF字体] 将使用 helvetica 默认字体 (中文可能显示为方块)');\n    pdf.setFont('helvetica');\n    return { success: false, fontName: 'helvetica', availableWeights: [] };\n  }\n\n  console.log(`[PDF字体] ✓ 成功加载 ${loadedCount} 个字体变体: ${availableWeights.join(', ')}`);\n\n  // 设置默认字体为 normal\n  try {\n    pdf.setFont(fontName, 'normal');\n  } catch (error) {\n    console.warn('[PDF字体] ⚠ 设置默认字体失败，使用第一个可用字重');\n    pdf.setFont(fontName, availableWeights[0] || 'normal');\n  }\n\n  return { success: true, fontName, availableWeights };\n}\n","// utils/export/pdfExportManager.js\n// PDF导出管理器 - 基于jsPDF实现纯文本PDF导出\n//\n// 使用 ARUDJingxihei 字体家族支持中文显示（Regular、Bold、Light 三种字重）\n// 支持 Markdown 渲染（标题、粗体、斜体、列表、引用等）和 LaTeX 公式显示\nimport { jsPDF } from 'jspdf';\nimport { DateTimeUtils } from '../fileParser';\nimport { addChineseFontSupport } from './pdfFontHelper';\n\n/**\n * PDF样式配置\n */\nconst PDF_STYLES = {\n  // 字体大小\n  FONT_SIZE_TITLE: 20,\n  FONT_SIZE_H1: 16,\n  FONT_SIZE_H2: 14,\n  FONT_SIZE_SENDER: 12,\n  FONT_SIZE_BODY: 10,\n  FONT_SIZE_CODE: 9,\n  FONT_SIZE_TIMESTAMP: 8,\n  FONT_SIZE_HEADER: 8,\n  FONT_SIZE_FOOTER: 8,\n\n  // 颜色 (RGB)\n  COLOR_SENDER_HUMAN: [0, 102, 204],      // 蓝色\n  COLOR_SENDER_ASSISTANT: [102, 102, 102], // 灰色\n  COLOR_TIMESTAMP: [150, 150, 150],        // 浅灰\n  COLOR_CODE_BG: [245, 245, 245],          // 代码背景\n  COLOR_SECTION_BG: [250, 250, 250],       // 区块背景\n  COLOR_TEXT: [0, 0, 0],                   // 黑色文本\n  COLOR_HEADER: [100, 100, 100],           // 页眉颜色\n  COLOR_FOOTER: [150, 150, 150],           // 页脚颜色\n  COLOR_BORDER: [200, 200, 200],           // 边框颜色\n\n  // 间距\n  MARGIN_LEFT: 15,\n  MARGIN_RIGHT: 15,\n  MARGIN_TOP: 15,    // 顶部边距（移除页眉，增加空间利用率）\n  MARGIN_BOTTOM: 25, // 底部边距为页脚留空间\n  LINE_HEIGHT: 5,\n  SECTION_SPACING: 8,\n  MESSAGE_SPACING: 10,\n  FOOTER_HEIGHT: 15, // 页脚高度\n\n  // 页面\n  PAGE_WIDTH: 210, // A4 宽度(mm)\n  PAGE_HEIGHT: 297, // A4 高度(mm)\n};\n\n/**\n * PDF导出管理器类\n */\nexport class PDFExportManager {\n  constructor() {\n    this.pdf = null;\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n    this.config = {};\n    this.useChineseFont = false; // 是否成功加载了中文字体\n    this.chineseFontName = 'helvetica'; // 当前使用的字体名称\n    this.availableFontWeights = []; // 可用的字体变体 (normal, bold, light 等)\n    this.meta = null; // 保存元数据用于页脚\n    this.exportDate = null; // 导出时间\n    this.messageAnchors = []; // 保存每条消息的位置信息用于目录链接和书签\n  }\n\n  /**\n   * 安全地设置字体，如果字体变体不可用则自动回退\n   * @param {string} fontName - 字体名称\n   * @param {string} fontStyle - 字体样式 (normal, bold, light, italic, bolditalic)\n   * @returns {boolean} - 是否成功设置\n   */\n  safeSetFont(fontName, fontStyle = 'normal') {\n    try {\n      // 如果请求的样式可用，直接使用\n      if (this.availableFontWeights.includes(fontStyle)) {\n        this.pdf.setFont(fontName, fontStyle);\n        return true;\n      }\n\n      // 字体变体不可用，进行智能回退\n      console.warn(`[PDF导出] 字体变体 ${fontStyle} 不可用，尝试回退...`);\n\n      // 回退策略\n      if (fontStyle === 'bold' || fontStyle === 'bolditalic') {\n        // 粗体：优先尝试 normal，如果没有则用第一个可用的\n        if (this.availableFontWeights.includes('normal')) {\n          this.pdf.setFont(fontName, 'normal');\n          console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n          return false; // 返回 false 表示使用了回退\n        }\n      }\n\n      if (fontStyle === 'italic' || fontStyle === 'bolditalic') {\n        // 斜体：中文字体通常没有斜体，回退到 light 或 normal\n        if (this.availableFontWeights.includes('light')) {\n          this.pdf.setFont(fontName, 'light');\n          console.log(`[PDF导出] ✓ 斜体回退到 light 字体`);\n          return false;\n        } else if (this.availableFontWeights.includes('normal')) {\n          this.pdf.setFont(fontName, 'normal');\n          console.log(`[PDF导出] ✓ 斜体回退到 normal 字体`);\n          return false;\n        }\n      }\n\n      // 默认回退：使用第一个可用的字体变体\n      if (this.availableFontWeights.length > 0) {\n        const fallbackStyle = this.availableFontWeights[0];\n        this.pdf.setFont(fontName, fallbackStyle);\n        console.log(`[PDF导出] ✓ 回退到 ${fallbackStyle} 字体`);\n        return false;\n      }\n\n      // 最终回退：使用 normal\n      this.pdf.setFont(fontName, 'normal');\n      console.log(`[PDF导出] ✓ 回退到 normal 字体`);\n      return false;\n    } catch (error) {\n      console.error(`[PDF导出] 设置字体失败:`, error);\n      // 最后的保险：使用默认字体\n      this.pdf.setFont(fontName || this.chineseFontName);\n      return false;\n    }\n  }\n\n  /**\n   * 清理和标准化文本，防止编码问题\n   * @param {string} text - 原始文本\n   * @returns {string} - 清理后的文本\n   */\n  cleanText(text) {\n    if (!text || typeof text !== 'string') {\n      return '';\n    }\n\n    try {\n      // 1. Unicode 标准化（NFC 模式）\n      let cleaned = text.normalize('NFC');\n      \n      // 2. 移除控制字符和不可打印字符（保留换行符和制表符）\n      cleaned = cleaned.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F]/g, '');\n      \n      // 3. 处理特殊Unicode字符（可能导致jsPDF问题）\n      // 移除零宽字符\n      cleaned = cleaned.replace(/[\\u200B-\\u200F\\u2060\\uFEFF]/g, '');\n      \n      // 4. 处理特殊的拉丁字符和符号（可能导致编码问题）\n      // 这些字符在PDF中可能显示不正确\n      cleaned = cleaned.replace(/[\\uE000-\\uF8FF]/g, ''); // 私人使用区\n      \n      return cleaned;\n    } catch (error) {\n      console.error('[PDF导出] 文本清理失败:', error);\n      // 如果清理失败，返回简化处理的文本\n      return text.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\n    }\n  }\n\n  /**\n   * 主导出方法\n   * @param {Array} messages - 消息列表\n   * @param {Object} meta - 元数据(title, platform, created_at, updated_at)\n   * @param {Object} config - 导出配置\n   */\n  async exportToPDF(messages, meta, config = {}) {\n    console.log('[PDF导出] 开始导出', {\n      messageCount: messages.length,\n      config\n    });\n\n    // 保存元数据和导出时间\n    this.meta = meta;\n    this.exportDate = DateTimeUtils.formatDateTime(new Date());\n    this.messageAnchors = []; // 重置消息锚点\n\n    this.config = {\n      includeThinking: config.includeThinking ?? true,\n      includeArtifacts: config.includeArtifacts ?? true,\n      includeTimestamps: config.includeTimestamps ?? false,\n      includeTools: config.includeTools ?? true,\n      includeCitations: config.includeCitations ?? true,\n      highQuality: config.highQuality ?? false,\n      ...config\n    };\n\n    // 初始化PDF文档\n    this.pdf = new jsPDF({\n      orientation: 'portrait',\n      unit: 'mm',\n      format: 'a4',\n      compress: true\n    });\n\n    // 尝试加载中文字体（异步加载可能需要时间）\n    try {\n      console.log('[PDF导出] 开始加载中文字体...');\n      const fontLoadResult = await addChineseFontSupport(this.pdf);\n      this.useChineseFont = fontLoadResult.success;\n      this.chineseFontName = fontLoadResult.fontName;\n      this.availableFontWeights = fontLoadResult.availableWeights || [];\n\n      if (!this.useChineseFont) {\n        console.warn('[PDF导出] 中文字体加载失败，将使用默认字体（中文可能显示为方框）');\n      } else {\n        console.log(`[PDF导出] 中文字体加载成功: ${this.chineseFontName}`);\n        console.log(`[PDF导出] 可用字体变体: ${this.availableFontWeights.join(', ')}`);\n      }\n    } catch (error) {\n      console.error('[PDF导出] 字体加载异常:', error);\n      this.useChineseFont = false;\n      this.chineseFontName = 'helvetica';\n      this.availableFontWeights = [];\n    }\n\n    // 无论字体是否加载成功，都设置一个默认字体\n    this.pdf.setFont(this.chineseFontName);\n\n    // 渲染文档\n    this.renderTitle(meta);\n    this.renderMetadata(meta);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n\n    // 如果有多于1条消息，预留目录页\n    const hasTOC = messages.length > 1;\n    let tocPageNumber = 0;\n    if (hasTOC) {\n      this.pdf.addPage();\n      tocPageNumber = this.pdf.internal.getCurrentPageInfo().pageNumber;\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n    }\n\n    // 渲染消息\n    for (let i = 0; i < messages.length; i++) {\n      // 如果有目录，第一条消息需要新开一页\n      if (hasTOC && i === 0) {\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n      }\n      this.renderMessage(messages[i], i + 1);\n    }\n\n    // 生成目录（带页码链接）\n    if (hasTOC) {\n      console.log('[PDF导出] 生成目录...');\n      this.renderTOCWithLinks(tocPageNumber, messages);\n    }\n\n    // 添加PDF书签\n    console.log('[PDF导出] 添加PDF书签...');\n    this.addBookmarks();\n\n    // 为所有页面添加页脚\n    console.log('[PDF导出] 添加页脚...');\n    this.addFooters();\n\n    // 生成文件名并保存\n    const fileName = this.generateFileName(meta);\n    this.pdf.save(fileName);\n\n    console.log('[PDF导出] 导出完成:', fileName);\n    return true;\n  }\n\n  /**\n   * 渲染标题页\n   */\n  renderTitle(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TITLE);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const rawTitle = meta.name || 'Conversation';\n    const title = this.cleanText(rawTitle); // 清理标题文本\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 标题可能很长,需要自动换行\n    // 注意: 如果字体加载失败,splitTextToSize可能会报错\n    let titleLines;\n    try {\n      titleLines = this.pdf.splitTextToSize(title, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] 标题分割失败,使用原始标题:', error);\n      // 如果splitTextToSize失败,直接使用原始标题\n      titleLines = [title];\n    }\n    \n    titleLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TITLE);\n      const cleanLine = this.cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染元数据\n   */\n  renderMetadata(meta) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n\n    const lines = [];\n\n    if (meta.platform) {\n      lines.push(`Platform: ${meta.platform}`);\n    }\n\n    if (meta.created_at) {\n      lines.push(`Created: ${meta.created_at}`);\n    }\n\n    if (meta.updated_at) {\n      lines.push(`Updated: ${meta.updated_at}`);\n    }\n\n    lines.push(`Exported: ${DateTimeUtils.formatDateTime(new Date())}`);\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.text(line, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染目录（Table of Contents）带页码链接\n   * @param {number} tocPage - 目录所在页码\n   * @param {Array} messages - 消息列表\n   */\n  renderTOCWithLinks(tocPage, messages) {\n    // 切换到目录页\n    this.pdf.setPage(tocPage);\n    this.currentY = PDF_STYLES.MARGIN_TOP;\n\n    // 渲染目录标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H1);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.pdf.text('Table of Contents', PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 2;\n\n    // 绘制标题下方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.3);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      this.currentY\n    );\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n\n    // 渲染消息列表\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    this.messageAnchors.forEach((anchor, idx) => {\n      const message = messages[idx];\n      if (!message) return;\n\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY * 2);\n\n      const messageNumber = `${anchor.index}.`;\n      const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n\n      // 获取消息预览（前50个字符）\n      let preview = anchor.title || '';\n      preview = this.cleanText(preview);\n      preview = preview.replace(/\\n/g, ' ').substring(0, 50);\n      if (preview.length >= 50) {\n        preview += '...';\n      }\n\n      // 添加分支标记\n      let branchMarker = '';\n      if (message.branchInfo?.isBranchPoint) {\n        branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      }\n\n      // 构建目录条目和页码\n      const entry = `${messageNumber} ${sender}${branchMarker}`;\n      const pageNum = `p.${anchor.page}`;\n\n      // 设置发送者颜色\n      const color = anchor.sender === 'human'\n        ? PDF_STYLES.COLOR_SENDER_HUMAN\n        : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n      this.pdf.setTextColor(...color);\n\n      // 计算页码位置（右对齐）\n      const pageNumWidth = this.pdf.getTextWidth(pageNum);\n      const pageNumX = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageNumWidth;\n\n      // 渲染条目（作为链接）\n      const entryY = this.currentY;\n      this.pdf.textWithLink(entry, PDF_STYLES.MARGIN_LEFT + 5, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染页码（也作为链接）\n      this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n      this.pdf.textWithLink(pageNum, pageNumX, entryY, {\n        pageNumber: anchor.page\n      });\n\n      // 渲染预览（如果有）\n      if (preview) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n        this.pdf.text(preview, PDF_STYLES.MARGIN_LEFT + 10, this.currentY);\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n      }\n\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.5;\n    });\n  }\n\n  /**\n   * 渲染单条消息\n   */\n  renderMessage(message, index) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_SENDER + PDF_STYLES.MESSAGE_SPACING);\n\n    // 记录消息位置用于目录链接和书签\n    const currentPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    const currentY = this.currentY;\n    this.messageAnchors.push({\n      index,\n      page: currentPage,\n      y: currentY,\n      sender: message.sender,\n      title: message.display_text ? message.display_text.substring(0, 50) : ''\n    });\n\n    // 渲染发送者标签\n    this.renderSender(message, index);\n\n    // 渲染时间戳\n    if (this.config.includeTimestamps && message.timestamp) {\n      this.renderTimestamp(message.timestamp);\n    }\n\n    // 渲染thinking(前置)\n    if (message.thinking && this.config.includeThinking && message.sender !== 'human') {\n      this.renderThinking(message.thinking);\n    }\n\n    // 渲染正文\n    if (message.display_text) {\n      this.renderBody(message.display_text);\n    }\n\n    // 渲染附件\n    if (message.attachments?.length > 0 && message.sender === 'human') {\n      this.renderAttachments(message.attachments);\n    }\n\n    // 渲染Artifacts\n    if (message.artifacts?.length > 0 && this.config.includeArtifacts && message.sender !== 'human') {\n      message.artifacts.forEach(artifact => {\n        this.renderArtifact(artifact);\n      });\n    }\n\n    // 渲染工具调用\n    if (message.tools?.length > 0 && this.config.includeTools) {\n      message.tools.forEach(tool => {\n        this.renderTool(tool);\n      });\n    }\n\n    // 渲染引用\n    if (message.citations?.length > 0 && this.config.includeCitations) {\n      this.renderCitations(message.citations);\n    }\n\n    // 消息间距\n    this.currentY += PDF_STYLES.MESSAGE_SPACING;\n  }\n\n  /**\n   * 渲染发送者标签\n   */\n  renderSender(message, index) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_SENDER);\n\n    // 根据发送者设置颜色\n    const color = message.sender === 'human'\n      ? PDF_STYLES.COLOR_SENDER_HUMAN\n      : PDF_STYLES.COLOR_SENDER_ASSISTANT;\n\n    this.pdf.setTextColor(...color);\n\n    // 构建发送者标签\n    const senderLabel = message.sender === 'human' ? 'Human' : 'Assistant';\n    const label = `${index}. ${senderLabel}`;\n\n    // 添加分支标记\n    let finalLabel = label;\n    if (message.branchInfo?.isBranchPoint) {\n      const branchMarker = ` [Branch ${message.branchInfo.childCount}]`;\n      finalLabel = label + branchMarker;\n    }\n\n    // 清理并输出标签\n    const cleanLabel = this.cleanText(finalLabel);\n    if (cleanLabel && cleanLabel.trim().length > 0) {\n      this.pdf.text(cleanLabel, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    }\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n  }\n\n  /**\n   * 渲染时间戳\n   */\n  renderTimestamp(timestamp) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TIMESTAMP);\n    this.pdf.text(timestamp, PDF_STYLES.MARGIN_LEFT, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n  }\n\n  /**\n   * 渲染正文\n   */\n  renderBody(text) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n\n    // 处理代码块和LaTeX公式\n    const parts = this.parseTextWithCodeBlocksAndLatex(text);\n\n    parts.forEach(part => {\n      if (part.type === 'code') {\n        this.renderCodeBlock(part.content, part.language);\n      } else if (part.type === 'latex-block') {\n        this.renderLatexBlock(part.content);\n      } else if (part.type === 'latex-inline') {\n        this.renderLatexInline(part.content, maxWidth);\n      } else {\n        // 渲染普通文本，支持markdown格式\n        this.renderMarkdownText(part.content, maxWidth);\n      }\n    });\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT;\n  }\n\n  /**\n   * 渲染纯文本(带自动换行)\n   */\n  renderPlainText(text, maxWidth) {\n    // 处理空文本\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 清理文本，防止编码问题\n    const cleanedText = this.cleanText(text);\n    \n    if (!cleanedText || cleanedText.trim().length === 0) {\n      console.warn('[PDF导出] 文本清理后为空，跳过');\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 使用 splitTextToSize 自动处理换行,支持Unicode字符\n    let lines;\n    try {\n      lines = this.pdf.splitTextToSize(cleanedText, maxWidth);\n    } catch (error) {\n      console.error('[PDF导出] splitTextToSize失败，使用简单换行:', error);\n      // 如果splitTextToSize失败,使用简单的换行逻辑\n      lines = cleanedText.split('\\n');\n    }\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      \n      // 再次清理单行文本（防止splitTextToSize引入问题）\n      const cleanLine = this.cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n  }\n\n  /**\n   * 渲染代码块（支持跨页）- 简化版，逐行渲染\n   */\n  renderCodeBlock(code, language = '') {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_CODE + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    const lineNumberWidth = 8;\n    const codeWidth = maxWidth - lineNumberWidth - 8;\n    const padding = 3;\n\n    const cleanCode = this.cleanText(code);\n    const cleanLanguage = this.cleanText(language);\n\n    // 渲染语言标签\n    if (cleanLanguage) {\n      this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n      this.pdf.setTextColor(100, 100, 100);\n      const labelText = cleanLanguage.toUpperCase();\n      const labelWidth = this.pdf.getTextWidth(labelText) + 4;\n      this.pdf.setFillColor(220, 220, 220);\n      this.pdf.roundedRect(\n        PDF_STYLES.MARGIN_LEFT,\n        this.currentY - 3,\n        labelWidth,\n        5,\n        1,\n        1,\n        'F'\n      );\n      this.pdf.text(labelText, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 处理代码行\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n    this.pdf.setFont(this.chineseFontName);\n    const codeLines = cleanCode.split('\\n');\n    const wrappedLines = [];\n\n    codeLines.forEach(line => {\n      if (!line) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n      const cleanLine = this.cleanText(line);\n      if (!cleanLine) {\n        wrappedLines.push({ text: '', lineNumber: wrappedLines.length + 1 });\n        return;\n      }\n\n      try {\n        const wrapped = this.pdf.splitTextToSize(cleanLine, codeWidth);\n        wrapped.forEach((wLine, idx) => {\n          wrappedLines.push({\n            text: wLine,\n            lineNumber: idx === 0 ? wrappedLines.length + 1 : null\n          });\n        });\n      } catch (error) {\n        wrappedLines.push({ text: cleanLine, lineNumber: wrappedLines.length + 1 });\n      }\n    });\n\n    // 逐行渲染，遇到需要换页时自动换页\n    const blockStartY = this.currentY;\n    const blockStartPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    let isFirstLine = true;\n\n    // 先绘制第一页的背景和边框起始部分\n    const firstPageHeight = Math.min(\n      wrappedLines.length * PDF_STYLES.LINE_HEIGHT + padding * 2,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n    );\n    this.pdf.setFillColor(248, 248, 248);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      blockStartY - padding,\n      maxWidth,\n      firstPageHeight,\n      'F'\n    );\n\n    this.currentY = blockStartY;\n\n    wrappedLines.forEach(({ text, lineNumber }, index) => {\n      // 检查是否需要换页\n      if (this.currentY + PDF_STYLES.FONT_SIZE_CODE > PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM) {\n        // 先绘制当前页的代码块底部边框\n        this.pdf.setDrawColor(200, 200, 200);\n        this.pdf.setLineWidth(0.3);\n        const currentPageBottom = this.currentY;\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT,\n          currentPageBottom\n        );\n        this.pdf.line(\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          blockStartY - padding,\n          PDF_STYLES.MARGIN_LEFT + maxWidth,\n          currentPageBottom\n        );\n\n        // 换页\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n        \n        // 在新页绘制代码块背景（连续样式）\n        const remainingLines = wrappedLines.length - index;\n        const newPageHeight = Math.min(\n          remainingLines * PDF_STYLES.LINE_HEIGHT + padding,\n          PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n        );\n        this.pdf.setFillColor(248, 248, 248);\n        this.pdf.rect(\n          PDF_STYLES.MARGIN_LEFT,\n          this.currentY - padding,\n          maxWidth,\n          newPageHeight,\n          'F'\n        );\n        \n        isFirstLine = false;\n      }\n\n      // 渲染行号\n      if (lineNumber !== null) {\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE - 1);\n        this.pdf.setTextColor(150, 150, 150);\n        const lineNumStr = String(lineNumber).padStart(3, ' ');\n        this.pdf.text(lineNumStr, PDF_STYLES.MARGIN_LEFT + 1, this.currentY);\n      }\n\n      // 渲染代码文本\n      this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n      this.pdf.setTextColor(50, 50, 50);\n      const safeLine = this.cleanText(text);\n      if (safeLine !== null && safeLine !== undefined) {\n        this.pdf.text(safeLine, PDF_STYLES.MARGIN_LEFT + lineNumberWidth + 2, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 绘制最后的边框和行号分隔线\n    const endPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n    \n    // 如果跨页，需要在每一页绘制边框\n    for (let page = blockStartPage; page <= endPage; page++) {\n      this.pdf.setPage(page);\n      const isFirst = (page === blockStartPage);\n      const isLast = (page === endPage);\n      \n      let boxStartY, boxEndY;\n      if (isFirst && isLast) {\n        // 单页代码块\n        boxStartY = blockStartY - padding;\n        boxEndY = this.currentY + padding;\n      } else if (isFirst) {\n        // 第一页\n        boxStartY = blockStartY - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      } else if (isLast) {\n        // 最后一页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = this.currentY + padding;\n      } else {\n        // 中间页\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      }\n      \n      // 绘制边框\n      this.pdf.setDrawColor(200, 200, 200);\n      this.pdf.setLineWidth(0.3);\n      if (isFirst && isLast) {\n        this.pdf.roundedRect(PDF_STYLES.MARGIN_LEFT, boxStartY, maxWidth, boxEndY - boxStartY, 1.5, 1.5, 'S');\n      } else {\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT, boxEndY);\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        if (isFirst) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY);\n        }\n        if (isLast) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxEndY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        }\n      }\n      \n      // 绘制行号分隔线\n      this.pdf.setDrawColor(220, 220, 220);\n      this.pdf.setLineWidth(0.2);\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxStartY,\n        PDF_STYLES.MARGIN_LEFT + lineNumberWidth,\n        boxEndY\n      );\n    }\n\n    // 确保回到最后一页\n    this.pdf.setPage(endPage);\n    \n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 将代码行按页分组\n   * @param {Array} wrappedLines - 包装后的代码行\n   * @returns {Array} - 分组后的行 [{page, startY, lines: [...]}]\n   */\n  groupCodeLinesByPage(wrappedLines) {\n    const groups = [];\n    let currentGroup = null;\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    let simulatedY = this.currentY;\n    let simulatedPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    wrappedLines.forEach((line) => {\n      // 检查是否需要换页\n      if (simulatedY + PDF_STYLES.FONT_SIZE_CODE > bottomLimit) {\n        simulatedPage++;\n        simulatedY = PDF_STYLES.MARGIN_TOP;\n        currentGroup = null; // 开始新组\n      }\n\n      // 如果没有当前组或换页了，创建新组\n      if (!currentGroup || currentGroup.page !== simulatedPage) {\n        currentGroup = {\n          page: simulatedPage,\n          startY: simulatedY,\n          lines: []\n        };\n        groups.push(currentGroup);\n      }\n\n      // 添加行到当前组\n      currentGroup.lines.push(line);\n      simulatedY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    return groups;\n  }\n\n  /**\n   * 渲染块级LaTeX公式（支持跨页）- 简化版\n   * @param {string} latex - LaTeX公式内容\n   */\n  renderLatexBlock(latex) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    const padding = 3;\n\n    // 清理并转换LaTeX符号\n    const cleanLatex = this.cleanText(latex);\n    const renderedLatex = this.convertLatexToUnicode(cleanLatex);\n\n    // 渲染\"Math\"标签\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_TIMESTAMP);\n    this.pdf.setTextColor(70, 130, 180);\n    const labelText = 'MATH';\n    const labelWidth = this.pdf.getTextWidth(labelText) + 4;\n    this.pdf.setFillColor(230, 240, 250);\n    this.pdf.roundedRect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      labelWidth,\n      5,\n      1,\n      1,\n      'F'\n    );\n    this.pdf.text(labelText, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n\n    // 处理公式文本\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setFont(this.chineseFontName);\n\n    let formulaLines;\n    try {\n      formulaLines = this.pdf.splitTextToSize(renderedLatex, maxWidth - 8);\n    } catch (error) {\n      formulaLines = renderedLatex.split('\\n');\n    }\n\n    // 逐行渲染\n    const blockStartY = this.currentY;\n    const blockStartPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    // 绘制第一页的背景\n    const firstPageHeight = Math.min(\n      formulaLines.length * PDF_STYLES.LINE_HEIGHT + padding * 2,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n    );\n    this.pdf.setFillColor(245, 250, 255);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      blockStartY - padding,\n      maxWidth,\n      firstPageHeight,\n      'F'\n    );\n\n    this.currentY = blockStartY;\n\n    formulaLines.forEach((line, index) => {\n      // 检查是否需要换页\n      if (this.currentY + PDF_STYLES.FONT_SIZE_BODY > PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM) {\n        // 换页\n        this.pdf.addPage();\n        this.currentY = PDF_STYLES.MARGIN_TOP;\n\n        // 在新页绘制背景\n        const remainingLines = formulaLines.length - index;\n        const newPageHeight = Math.min(\n          remainingLines * PDF_STYLES.LINE_HEIGHT + padding,\n          PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM - this.currentY\n        );\n        this.pdf.setFillColor(245, 250, 255);\n        this.pdf.rect(\n          PDF_STYLES.MARGIN_LEFT,\n          this.currentY - padding,\n          maxWidth,\n          newPageHeight,\n          'F'\n        );\n      }\n\n      // 渲染公式文本\n      this.pdf.setTextColor(30, 60, 120);\n      const safeLine = this.cleanText(line);\n      if (safeLine && safeLine.trim().length > 0) {\n        this.pdf.text(safeLine, PDF_STYLES.MARGIN_LEFT + 4, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    // 绘制边框\n    const endPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    for (let page = blockStartPage; page <= endPage; page++) {\n      this.pdf.setPage(page);\n      const isFirst = (page === blockStartPage);\n      const isLast = (page === endPage);\n\n      let boxStartY, boxEndY;\n      if (isFirst && isLast) {\n        boxStartY = blockStartY - padding;\n        boxEndY = this.currentY + padding;\n      } else if (isFirst) {\n        boxStartY = blockStartY - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      } else if (isLast) {\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = this.currentY + padding;\n      } else {\n        boxStartY = PDF_STYLES.MARGIN_TOP - padding;\n        boxEndY = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n      }\n\n      // 绘制边框\n      this.pdf.setDrawColor(180, 210, 240);\n      this.pdf.setLineWidth(0.4);\n      if (isFirst && isLast) {\n        this.pdf.roundedRect(PDF_STYLES.MARGIN_LEFT, boxStartY, maxWidth, boxEndY - boxStartY, 1.5, 1.5, 'S');\n      } else {\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT, boxEndY);\n        this.pdf.line(PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        if (isFirst) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxStartY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxStartY);\n        }\n        if (isLast) {\n          this.pdf.line(PDF_STYLES.MARGIN_LEFT, boxEndY, PDF_STYLES.MARGIN_LEFT + maxWidth, boxEndY);\n        }\n      }\n    }\n\n    // 确保回到最后一页\n    this.pdf.setPage(endPage);\n\n    // 恢复默认样式\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 将LaTeX行按页分组\n   * @param {Array} lines - LaTeX公式行\n   * @returns {Array} - 分组后的行 [{page, startY, lines: [...]}]\n   */\n  groupLatexLinesByPage(lines) {\n    const groups = [];\n    let currentGroup = null;\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    let simulatedY = this.currentY;\n    let simulatedPage = this.pdf.internal.getCurrentPageInfo().pageNumber;\n\n    lines.forEach((line) => {\n      // 检查是否需要换页\n      if (simulatedY + PDF_STYLES.FONT_SIZE_BODY > bottomLimit) {\n        simulatedPage++;\n        simulatedY = PDF_STYLES.MARGIN_TOP;\n        currentGroup = null; // 开始新组\n      }\n\n      // 如果没有当前组或换页了，创建新组\n      if (!currentGroup || currentGroup.page !== simulatedPage) {\n        currentGroup = {\n          page: simulatedPage,\n          startY: simulatedY,\n          lines: []\n        };\n        groups.push(currentGroup);\n      }\n\n      // 添加行到当前组\n      currentGroup.lines.push(line);\n      simulatedY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    return groups;\n  }\n\n  /**\n   * 渲染行内LaTeX公式\n   * @param {string} latex - LaTeX公式内容\n   * @param {number} maxWidth - 最大宽度\n   */\n  renderLatexInline(latex, maxWidth) {\n    const cleanLatex = this.cleanText(latex);\n\n    // 转换LaTeX符号为Unicode\n    const renderedLatex = this.convertLatexToUnicode(cleanLatex);\n\n    // 设置行内公式样式\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n\n    // 添加前缀和后缀标记\n    const formulaText = `⟨${renderedLatex}⟩`;\n\n    // 使用特殊颜色标识数学公式\n    this.pdf.setTextColor(70, 130, 180); // 蓝色\n\n    try {\n      const lines = this.pdf.splitTextToSize(formulaText, maxWidth);\n      lines.forEach(line => {\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n        const safeLine = this.cleanText(line);\n        if (safeLine && safeLine.trim().length > 0) {\n          this.pdf.text(safeLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      });\n    } catch (error) {\n      this.pdf.text(formulaText, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复默认颜色\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染thinking区块\n   */\n  renderThinking(thinking) {\n    this.renderSection('💭 Thinking', thinking, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染Artifact\n   */\n  renderArtifact(artifact) {\n    const title = `📄 Artifact: ${artifact.title || 'Untitled'}`;\n    const content = artifact.content || '';\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染工具调用\n   */\n  renderTool(tool) {\n    const title = `🔧 Tool: ${tool.name || 'Unknown'}`;\n    const content = `Input: ${JSON.stringify(tool.input, null, 2)}\\n\\nOutput: ${tool.output || 'N/A'}`;\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染引用\n   */\n  renderCitations(citations) {\n    const title = '📚 Citations';\n    const content = citations.map((cit, i) =>\n      `[${i + 1}] ${cit.title || cit.url || 'Unknown'}`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 渲染附件\n   */\n  renderAttachments(attachments) {\n    const title = '📎 Attachments';\n    const content = attachments.map((att, i) =>\n      `[${i + 1}] ${att.file_name || att.name || 'file'} (${att.file_type || att.type || 'unknown'})`\n    ).join('\\n');\n    this.renderSection(title, content, PDF_STYLES.COLOR_SECTION_BG);\n  }\n\n  /**\n   * 通用区块渲染(带背景)\n   */\n  renderSection(title, content, bgColor) {\n    this.checkPageBreak(PDF_STYLES.FONT_SIZE_H2 + PDF_STYLES.SECTION_SPACING * 2);\n\n    const maxWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_LEFT - PDF_STYLES.MARGIN_RIGHT;\n    \n    // 清理标题和内容\n    const cleanTitle = this.cleanText(title);\n    const cleanContent = this.cleanText(content);\n    \n    // 处理内容换行,带错误处理\n    let contentLines;\n    try {\n      contentLines = this.pdf.splitTextToSize(cleanContent, maxWidth - 4);\n    } catch (error) {\n      console.error('[PDF导出] 区块内容分割失败:', error);\n      contentLines = cleanContent.split('\\n');\n    }\n    \n    const bgHeight = PDF_STYLES.LINE_HEIGHT * (contentLines.length + 2);\n\n    // 绘制背景\n    this.pdf.setFillColor(...bgColor);\n    this.pdf.rect(\n      PDF_STYLES.MARGIN_LEFT,\n      this.currentY - 3,\n      maxWidth,\n      bgHeight,\n      'F'\n    );\n\n    // 渲染标题\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_H2);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    if (cleanTitle && cleanTitle.trim().length > 0) {\n      this.pdf.text(cleanTitle, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n    }\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n\n    // 渲染内容\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    contentLines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n      const cleanLine = this.cleanText(line);\n      if (cleanLine && cleanLine.trim().length > 0) {\n        this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n      }\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    });\n\n    this.currentY += PDF_STYLES.SECTION_SPACING;\n  }\n\n  /**\n   * 渲染页脚\n   * @param {number} pageNumber - 当前页码\n   * @param {number} totalPages - 总页数\n   */\n  renderFooter(pageNumber, totalPages) {\n    const originalY = this.currentY;\n    const originalFontSize = this.pdf.internal.getFontSize();\n\n    // 设置页脚样式\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_FOOTER);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_FOOTER);\n\n    const footerY = PDF_STYLES.PAGE_HEIGHT - 10;\n\n    // 绘制页脚上方的分隔线\n    this.pdf.setDrawColor(...PDF_STYLES.COLOR_BORDER);\n    this.pdf.setLineWidth(0.1);\n    this.pdf.line(\n      PDF_STYLES.MARGIN_LEFT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT,\n      PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT,\n      PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.FOOTER_HEIGHT\n    );\n\n    // 左侧显示导出时间\n    const exportText = `Exported: ${this.exportDate}`;\n    this.pdf.text(exportText, PDF_STYLES.MARGIN_LEFT, footerY);\n\n    // 右侧显示页码\n    const pageText = `${pageNumber} / ${totalPages}`;\n    const pageTextWidth = this.pdf.getTextWidth(pageText);\n    this.pdf.text(pageText, PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT - pageTextWidth, footerY);\n\n    // 恢复原始设置\n    this.pdf.setFontSize(originalFontSize);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n    this.currentY = originalY;\n  }\n\n  /**\n   * 添加PDF书签（outline）\n   */\n  addBookmarks() {\n    if (this.messageAnchors.length === 0) return;\n\n    // jsPDF的outline功能\n    // 创建书签树结构\n    try {\n      this.messageAnchors.forEach((anchor) => {\n        const sender = anchor.sender === 'human' ? 'Human' : 'Assistant';\n        const title = `${anchor.index}. ${sender}`;\n\n        // 使用jsPDF的outline API\n        // 注意：jsPDF的outline功能可能需要插件支持\n        if (this.pdf.outline) {\n          this.pdf.outline.add(null, title, { pageNumber: anchor.page });\n        }\n      });\n    } catch (error) {\n      console.warn('[PDF导出] 书签添加失败（可能不支持）:', error);\n    }\n  }\n\n  /**\n   * 为所有页面添加页脚\n   */\n  addFooters() {\n    const totalPages = this.pdf.internal.getNumberOfPages();\n\n    for (let i = 1; i <= totalPages; i++) {\n      this.pdf.setPage(i);\n      this.renderFooter(i, totalPages);\n    }\n  }\n\n  /**\n   * 检查是否需要分页\n   */\n  checkPageBreak(requiredSpace = 20) {\n    const bottomLimit = PDF_STYLES.PAGE_HEIGHT - PDF_STYLES.MARGIN_BOTTOM;\n\n    if (this.currentY + requiredSpace > bottomLimit) {\n      this.pdf.addPage();\n      this.currentY = PDF_STYLES.MARGIN_TOP;\n    }\n  }\n\n  /**\n   * 解析文本中的代码块和LaTeX公式\n   * 优先级：代码块 > LaTeX块级公式 > LaTeX行内公式\n   */\n  parseTextWithCodeBlocksAndLatex(text) {\n    const parts = [];\n    const elements = [];\n\n    // 1. 首先提取所有代码块\n    const codeBlockRegex = /```(\\w*)\\n([\\s\\S]*?)```/g;\n    let match;\n    let lastIndex = 0;\n\n    while ((match = codeBlockRegex.exec(text)) !== null) {\n      elements.push({\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'code',\n        language: match[1] || '',\n        content: match[2]\n      });\n    }\n\n    // 2. 提取块级LaTeX公式（$$...$$）\n    const latexBlockRegex = /\\$\\$([\\s\\S]*?)\\$\\$/g;\n    while ((match = latexBlockRegex.exec(text)) !== null) {\n      // 检查是否与代码块重叠\n      const overlaps = elements.some(el =>\n        (match.index >= el.start && match.index < el.end) ||\n        (match.index + match[0].length > el.start && match.index + match[0].length <= el.end)\n      );\n      if (!overlaps) {\n        elements.push({\n          start: match.index,\n          end: match.index + match[0].length,\n          type: 'latex-block',\n          content: match[1].trim()\n        });\n      }\n    }\n\n    // 3. 提取行内LaTeX公式（$...$，但不是$$）\n    const latexInlineRegex = /(?<!\\$)\\$(?!\\$)((?:\\\\.|[^$\\\\])+?)\\$(?!\\$)/g;\n    while ((match = latexInlineRegex.exec(text)) !== null) {\n      // 检查是否与已有元素重叠\n      const overlaps = elements.some(el =>\n        (match.index >= el.start && match.index < el.end) ||\n        (match.index + match[0].length > el.start && match.index + match[0].length <= el.end)\n      );\n      if (!overlaps) {\n        elements.push({\n          start: match.index,\n          end: match.index + match[0].length,\n          type: 'latex-inline',\n          content: match[1].trim()\n        });\n      }\n    }\n\n    // 4. 按位置排序所有元素\n    elements.sort((a, b) => a.start - b.start);\n\n    // 5. 构建最终的parts数组\n    lastIndex = 0;\n    elements.forEach(element => {\n      // 添加元素前的文本\n      if (element.start > lastIndex) {\n        const plainText = text.substring(lastIndex, element.start);\n        if (plainText.trim()) {\n          parts.push({ type: 'text', content: plainText });\n        }\n      }\n\n      // 添加元素本身\n      parts.push(element);\n      lastIndex = element.end;\n    });\n\n    // 添加最后的文本\n    if (lastIndex < text.length) {\n      const plainText = text.substring(lastIndex);\n      if (plainText.trim()) {\n        parts.push({ type: 'text', content: plainText });\n      }\n    }\n\n    // 如果没有特殊元素,返回整个文本\n    if (parts.length === 0) {\n      parts.push({ type: 'text', content: text });\n    }\n\n    return parts;\n  }\n\n  /**\n   * 解析文本中的代码块（旧方法，保留以兼容）\n   */\n  parseTextWithCodeBlocks(text) {\n    return this.parseTextWithCodeBlocksAndLatex(text);\n  }\n\n  /**\n   * 解析markdown格式的文本并渲染\n   * 支持：粗体、斜体、行内代码、链接、列表、引用等\n   */\n  renderMarkdownText(text, maxWidth) {\n    if (!text || text.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    const cleanedText = this.cleanText(text);\n    if (!cleanedText || cleanedText.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 按行处理文本\n    const lines = cleanedText.split('\\n');\n\n    lines.forEach(line => {\n      this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n      // 处理不同类型的行\n      if (line.trim() === '') {\n        // 空行\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      } else if (line.match(/^#{1,6}\\s/)) {\n        // 标题\n        this.renderMarkdownHeading(line, maxWidth);\n      } else if (line.match(/^>\\s/)) {\n        // 引用\n        this.renderMarkdownQuote(line, maxWidth);\n      } else if (line.match(/^[-*+]\\s/) || line.match(/^\\d+\\.\\s/)) {\n        // 列表\n        this.renderMarkdownList(line, maxWidth);\n      } else {\n        // 普通文本（可能包含行内格式）\n        this.renderMarkdownInlineFormats(line, maxWidth);\n      }\n    });\n  }\n\n  /**\n   * 渲染markdown标题\n   */\n  renderMarkdownHeading(line, maxWidth) {\n    const match = line.match(/^(#{1,6})\\s+(.+)$/);\n    if (!match) {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const level = match[1].length;\n    const text = match[2];\n\n    // 根据标题级别设置字体大小\n    const fontSize = PDF_STYLES.FONT_SIZE_BODY + (7 - level) * 2;\n    const oldFontSize = this.pdf.internal.getFontSize();\n\n    this.pdf.setFontSize(fontSize);\n    // 使用粗体字体（如果可用）\n    this.safeSetFont(this.chineseFontName, 'bold');\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, maxWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(fontSize);\n        const cleanLine = this.cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n      });\n    } catch (error) {\n      console.error('[PDF导出] 标题渲染失败:', error);\n      this.pdf.text(text, PDF_STYLES.MARGIN_LEFT, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT * 1.2;\n    }\n\n    // 恢复字体\n    this.pdf.setFontSize(oldFontSize);\n    this.safeSetFont(this.chineseFontName, 'normal');\n\n    this.currentY += PDF_STYLES.LINE_HEIGHT * 0.5; // 标题后额外间距\n  }\n\n  /**\n   * 渲染markdown引用\n   */\n  renderMarkdownQuote(line, maxWidth) {\n    const text = line.replace(/^>\\s*/, '');\n    const quoteWidth = maxWidth - 8;\n    const quoteX = PDF_STYLES.MARGIN_LEFT + 6;\n\n    // 绘制左侧竖线\n    this.pdf.setDrawColor(150, 150, 150);\n    this.pdf.setLineWidth(0.5);\n\n    const startY = this.currentY - 2;\n\n    // 渲染文本\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(100, 100, 100);\n\n    try {\n      const lines = this.pdf.splitTextToSize(text, quoteWidth);\n      lines.forEach(l => {\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n        const cleanLine = this.cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, quoteX, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      });\n\n      // 绘制引用线\n      this.pdf.line(\n        PDF_STYLES.MARGIN_LEFT + 2,\n        startY,\n        PDF_STYLES.MARGIN_LEFT + 2,\n        this.currentY - 2\n      );\n    } catch (error) {\n      console.error('[PDF导出] 引用渲染失败:', error);\n      this.pdf.text(text, quoteX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复颜色\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染markdown列表\n   */\n  renderMarkdownList(line, maxWidth) {\n    let bullet = '';\n    let text = '';\n\n    // 检测列表类型\n    const unorderedMatch = line.match(/^([-*+])\\s+(.+)$/);\n    const orderedMatch = line.match(/^(\\d+)\\.\\s+(.+)$/);\n\n    if (unorderedMatch) {\n      bullet = '•'; // 使用圆点作为项目符号\n      text = unorderedMatch[2];\n    } else if (orderedMatch) {\n      bullet = orderedMatch[1] + '.';\n      text = orderedMatch[2];\n    } else {\n      this.renderPlainText(line, maxWidth);\n      return;\n    }\n\n    const bulletWidth = this.pdf.getTextWidth(bullet + '  ');\n    const textWidth = maxWidth - bulletWidth;\n    const textX = PDF_STYLES.MARGIN_LEFT + bulletWidth;\n\n    // 渲染项目符号\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.text(bullet, PDF_STYLES.MARGIN_LEFT + 2, this.currentY);\n\n    // 渲染文本\n    try {\n      const lines = this.pdf.splitTextToSize(text, textWidth);\n      lines.forEach((l, idx) => {\n        if (idx > 0) {\n          this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n        }\n        const cleanLine = this.cleanText(l);\n        if (cleanLine && cleanLine.trim().length > 0) {\n          this.pdf.text(cleanLine, textX, this.currentY);\n        }\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n      });\n    } catch (error) {\n      console.error('[PDF导出] 列表渲染失败:', error);\n      this.pdf.text(text, textX, this.currentY);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n  }\n\n  /**\n   * 渲染包含行内格式的markdown文本\n   * 支持：**粗体**、*斜体*、`代码`、[链接](url)\n   */\n  renderMarkdownInlineFormats(line, maxWidth) {\n    if (!line || line.trim().length === 0) {\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n      return;\n    }\n\n    // 解析行内格式\n    const segments = this.parseInlineMarkdown(line);\n\n    // 按行渲染segments\n    this.renderInlineSegments(segments, maxWidth);\n  }\n\n  /**\n   * 解析行内markdown格式\n   * 返回格式化的文本片段数组\n   */\n  parseInlineMarkdown(text) {\n    const segments = [];\n\n    // 正则表达式模式（按优先级，长的在前）\n    // 重要：先匹配长模式(如***)，再匹配短模式(如**)\n    const patterns = [\n      { type: 'code', regex: /`([^`]+)`/g },                    // 行内代码\n      { type: 'bold-italic', regex: /\\*\\*\\*([^*]+?)\\*\\*\\*/g }, // 粗斜体 (*** 优先于 **)\n      { type: 'bold-italic', regex: /___([^_]+?)___/g },       // 粗斜体 (___ 优先于 __)\n      { type: 'bold', regex: /\\*\\*([^*]+?)\\*\\*/g },            // 粗体 (** 不匹配单个*)\n      { type: 'bold', regex: /__([^_]+?)__/g },                // 粗体 (__ 不匹配单个_)\n      { type: 'italic', regex: /\\*([^*]+?)\\*/g },              // 斜体 (* 不匹配**)\n      { type: 'italic', regex: /_([^_]+?)_/g },                // 斜体 (_ 不匹配__)\n      { type: 'link', regex: /\\[([^\\]]+)\\]\\(([^)]+)\\)/g }      // 链接\n    ];\n\n    // 查找所有匹配\n    const matches = [];\n    patterns.forEach(pattern => {\n      let match;\n      const regex = new RegExp(pattern.regex.source, 'g');\n      while ((match = regex.exec(text)) !== null) {\n        matches.push({\n          type: pattern.type,\n          start: match.index,\n          end: regex.lastIndex,\n          text: match[1],\n          url: match[2], // 仅用于链接\n          fullMatch: match[0] // 保存完整匹配用于调试\n        });\n      }\n    });\n\n    // 按位置排序，位置相同时按长度排序（长的优先）\n    matches.sort((a, b) => {\n      if (a.start !== b.start) return a.start - b.start;\n      return (b.end - b.start) - (a.end - a.start); // 长的在前\n    });\n\n    // 移除重叠的匹配（保留更长/更早的）\n    const filteredMatches = [];\n    matches.forEach(match => {\n      const overlaps = filteredMatches.some(existing =>\n        // 检查任何形式的重叠\n        (match.start >= existing.start && match.start < existing.end) ||\n        (match.end > existing.start && match.end <= existing.end) ||\n        (match.start <= existing.start && match.end >= existing.end)\n      );\n      if (!overlaps) {\n        filteredMatches.push(match);\n      }\n    });\n\n    // 如果有调试需求，可以取消注释以下日志\n    // console.log('[PDF导出] 解析markdown:', { text, matches, filteredMatches });\n\n    // 构建segments数组\n    let lastEnd = 0;\n    filteredMatches.forEach(match => {\n      // 添加普通文本\n      if (match.start > lastEnd) {\n        const normalText = text.substring(lastEnd, match.start);\n        if (normalText) {\n          segments.push({\n            type: 'normal',\n            text: normalText\n          });\n        }\n      }\n\n      // 添加格式化文本\n      segments.push({\n        type: match.type,\n        text: match.text,\n        url: match.url\n      });\n\n      lastEnd = match.end;\n    });\n\n    // 添加剩余文本\n    if (lastEnd < text.length) {\n      const remainingText = text.substring(lastEnd);\n      if (remainingText) {\n        segments.push({\n          type: 'normal',\n          text: remainingText\n        });\n      }\n    }\n\n    // 如果没有匹配，返回整个文本\n    if (segments.length === 0) {\n      segments.push({\n        type: 'normal',\n        text: text\n      });\n    }\n\n    return segments;\n  }\n\n  /**\n   * 渲染行内格式的文本片段\n   */\n  renderInlineSegments(segments, maxWidth) {\n    let currentX = PDF_STYLES.MARGIN_LEFT;\n    let currentLineSegments = [];\n    const availableWidth = PDF_STYLES.PAGE_WIDTH - PDF_STYLES.MARGIN_RIGHT;\n\n    segments.forEach((segment, idx) => {\n      const text = this.cleanText(segment.text || '');\n      if (!text) return;\n\n      // 设置样式并测量宽度\n      this.applySegmentStyle(segment.type);\n      const textWidth = this.pdf.getTextWidth(text);\n\n      // 检查segment是否需要拆分（太长无法在一行显示）\n      const remainingWidth = availableWidth - currentX;\n\n      if (textWidth > remainingWidth) {\n        // 如果当前行已有内容，先渲染当前行\n        if (currentLineSegments.length > 0) {\n          this.renderSegmentLine(currentLineSegments);\n          this.currentY += PDF_STYLES.LINE_HEIGHT;\n          this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n          currentX = PDF_STYLES.MARGIN_LEFT;\n          currentLineSegments = [];\n        }\n\n        // 如果segment本身比整行还宽，需要拆分\n        const lineWidth = availableWidth - PDF_STYLES.MARGIN_LEFT;\n        if (textWidth > lineWidth) {\n          // 拆分文本\n          try {\n            const splitLines = this.pdf.splitTextToSize(text, lineWidth);\n            splitLines.forEach((line, lineIdx) => {\n              const cleanLine = this.cleanText(line);\n              if (!cleanLine) return;\n\n              // 渲染每一行\n              this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n              this.applySegmentStyle(segment.type);\n\n              if (segment.type === 'code') {\n                const lineWidth = this.pdf.getTextWidth(cleanLine);\n                const padding = 1;\n                this.pdf.setFillColor(245, 245, 245);\n                this.pdf.rect(PDF_STYLES.MARGIN_LEFT - padding, this.currentY - 3, lineWidth + padding * 2, 4, 'F');\n                this.pdf.setTextColor(220, 50, 50);\n              }\n\n              this.pdf.text(cleanLine, PDF_STYLES.MARGIN_LEFT, this.currentY);\n              this.currentY += PDF_STYLES.LINE_HEIGHT;\n            });\n            currentX = PDF_STYLES.MARGIN_LEFT;\n            return; // 处理下一个segment\n          } catch (error) {\n            console.error('[PDF导出] 文本拆分失败:', error);\n            // 如果拆分失败，直接渲染（可能会溢出，但至少显示内容）\n          }\n        }\n      }\n\n      // 检查是否需要换行\n      if (currentX + textWidth > availableWidth && currentLineSegments.length > 0) {\n        // 渲染当前行\n        this.renderSegmentLine(currentLineSegments);\n        this.currentY += PDF_STYLES.LINE_HEIGHT;\n        this.checkPageBreak(PDF_STYLES.FONT_SIZE_BODY);\n\n        // 重置行状态\n        currentX = PDF_STYLES.MARGIN_LEFT;\n        currentLineSegments = [];\n      }\n\n      // 添加到当前行\n      currentLineSegments.push({\n        ...segment,\n        x: currentX,\n        text: text\n      });\n      currentX += textWidth;\n    });\n\n    // 渲染最后一行\n    if (currentLineSegments.length > 0) {\n      this.renderSegmentLine(currentLineSegments);\n      this.currentY += PDF_STYLES.LINE_HEIGHT;\n    }\n\n    // 恢复默认样式\n    this.pdf.setFont(this.chineseFontName, 'normal');\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n  }\n\n  /**\n   * 渲染一行segment\n   */\n  renderSegmentLine(segments) {\n    segments.forEach(segment => {\n      this.applySegmentStyle(segment.type);\n\n      if (segment.type === 'link') {\n        // 渲染链接（添加下划线）\n        this.pdf.textWithLink(segment.text, segment.x, this.currentY, {\n          url: segment.url || '#'\n        });\n        // 绘制下划线\n        const textWidth = this.pdf.getTextWidth(segment.text);\n        this.pdf.line(segment.x, this.currentY + 0.5, segment.x + textWidth, this.currentY + 0.5);\n      } else if (segment.type === 'code') {\n        // 渲染行内代码（添加背景色）\n        const textWidth = this.pdf.getTextWidth(segment.text);\n        const padding = 1;\n        this.pdf.setFillColor(245, 245, 245);\n        this.pdf.rect(segment.x - padding, this.currentY - 3, textWidth + padding * 2, 4, 'F');\n        this.pdf.setTextColor(220, 50, 50);\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      } else {\n        // 普通文本\n        this.pdf.text(segment.text, segment.x, this.currentY);\n      }\n    });\n  }\n\n  /**\n   * 应用segment样式\n   */\n  applySegmentStyle(type) {\n    this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_BODY);\n    this.pdf.setTextColor(...PDF_STYLES.COLOR_TEXT);\n\n    switch (type) {\n      case 'bold':\n        // 使用粗体字体（如果可用，否则自动回退）\n        this.safeSetFont(this.chineseFontName, 'bold');\n        break;\n      case 'italic':\n        // 使用斜体字体（如果可用，否则回退到 light 或 normal）\n        // 同时设置颜色以区分\n        const italicSuccess = this.safeSetFont(this.chineseFontName, 'italic');\n        if (!italicSuccess) {\n          // 如果没有斜体，用颜色区分\n          this.pdf.setTextColor(70, 130, 180); // 蓝色表示强调\n        }\n        break;\n      case 'bold-italic':\n        // 粗斜体：尝试使用 bold，如果没有则用 normal + 颜色\n        const boldItalicSuccess = this.safeSetFont(this.chineseFontName, 'bolditalic');\n        if (!boldItalicSuccess) {\n          // 回退：使用 bold（如果有）+ 颜色\n          this.safeSetFont(this.chineseFontName, 'bold');\n          this.pdf.setTextColor(70, 130, 180); // 蓝色表示斜体\n        }\n        break;\n      case 'code':\n        this.pdf.setFont('courier', 'normal');\n        this.pdf.setFontSize(PDF_STYLES.FONT_SIZE_CODE);\n        this.pdf.setTextColor(220, 50, 50);\n        break;\n      case 'link':\n        this.safeSetFont(this.chineseFontName, 'normal');\n        this.pdf.setTextColor(0, 102, 204); // 蓝色\n        break;\n      default:\n        this.safeSetFont(this.chineseFontName, 'normal');\n    }\n  }\n\n  /**\n   * 将LaTeX命令转换为Unicode数学符号\n   * 这使得PDF中的数学公式更易读\n   */\n  convertLatexToUnicode(latex) {\n    if (!latex) return '';\n\n    let result = latex;\n\n    // 希腊字母\n    const greekLetters = {\n      '\\\\alpha': 'α', '\\\\Alpha': 'Α',\n      '\\\\beta': 'β', '\\\\Beta': 'Β',\n      '\\\\gamma': 'γ', '\\\\Gamma': 'Γ',\n      '\\\\delta': 'δ', '\\\\Delta': 'Δ',\n      '\\\\epsilon': 'ε', '\\\\Epsilon': 'Ε',\n      '\\\\varepsilon': 'ε',\n      '\\\\zeta': 'ζ', '\\\\Zeta': 'Ζ',\n      '\\\\eta': 'η', '\\\\Eta': 'Η',\n      '\\\\theta': 'θ', '\\\\Theta': 'Θ',\n      '\\\\vartheta': 'ϑ',\n      '\\\\iota': 'ι', '\\\\Iota': 'Ι',\n      '\\\\kappa': 'κ', '\\\\Kappa': 'Κ',\n      '\\\\lambda': 'λ', '\\\\Lambda': 'Λ',\n      '\\\\mu': 'μ', '\\\\Mu': 'Μ',\n      '\\\\nu': 'ν', '\\\\Nu': 'Ν',\n      '\\\\xi': 'ξ', '\\\\Xi': 'Ξ',\n      '\\\\omicron': 'ο', '\\\\Omicron': 'Ο',\n      '\\\\pi': 'π', '\\\\Pi': 'Π',\n      '\\\\rho': 'ρ', '\\\\Rho': 'Ρ',\n      '\\\\sigma': 'σ', '\\\\Sigma': 'Σ',\n      '\\\\tau': 'τ', '\\\\Tau': 'Τ',\n      '\\\\upsilon': 'υ', '\\\\Upsilon': 'Υ',\n      '\\\\phi': 'φ', '\\\\Phi': 'Φ',\n      '\\\\varphi': 'ϕ',\n      '\\\\chi': 'χ', '\\\\Chi': 'Χ',\n      '\\\\psi': 'ψ', '\\\\Psi': 'Ψ',\n      '\\\\omega': 'ω', '\\\\Omega': 'Ω'\n    };\n\n    // 数学运算符和符号\n    const mathSymbols = {\n      // 关系符号\n      '\\\\leq': '≤', '\\\\le': '≤',\n      '\\\\geq': '≥', '\\\\ge': '≥',\n      '\\\\neq': '≠', '\\\\ne': '≠',\n      '\\\\approx': '≈',\n      '\\\\equiv': '≡',\n      '\\\\sim': '∼',\n      '\\\\simeq': '≃',\n      '\\\\cong': '≅',\n      '\\\\propto': '∝',\n      '\\\\ll': '≪',\n      '\\\\gg': '≫',\n      '\\\\subset': '⊂',\n      '\\\\supset': '⊃',\n      '\\\\subseteq': '⊆',\n      '\\\\supseteq': '⊇',\n      '\\\\in': '∈',\n      '\\\\notin': '∉',\n      '\\\\ni': '∋',\n      '\\\\emptyset': '∅',\n\n      // 箭头\n      '\\\\rightarrow': '→', '\\\\to': '→',\n      '\\\\leftarrow': '←',\n      '\\\\leftrightarrow': '↔',\n      '\\\\Rightarrow': '⇒',\n      '\\\\Leftarrow': '⇐',\n      '\\\\Leftrightarrow': '⇔',\n      '\\\\uparrow': '↑',\n      '\\\\downarrow': '↓',\n      '\\\\mapsto': '↦',\n\n      // 运算符\n      '\\\\times': '×',\n      '\\\\div': '÷',\n      '\\\\pm': '±',\n      '\\\\mp': '∓',\n      '\\\\cdot': '·',\n      '\\\\ast': '∗',\n      '\\\\star': '⋆',\n      '\\\\circ': '∘',\n      '\\\\bullet': '•',\n      '\\\\oplus': '⊕',\n      '\\\\ominus': '⊖',\n      '\\\\otimes': '⊗',\n      '\\\\odot': '⊙',\n      '\\\\oslash': '⊘',\n      '\\\\cup': '∪',\n      '\\\\cap': '∩',\n      '\\\\vee': '∨',\n      '\\\\wedge': '∧',\n\n      // 微积分\n      '\\\\partial': '∂',\n      '\\\\nabla': '∇',\n      '\\\\infty': '∞',\n      '\\\\int': '∫',\n      '\\\\iint': '∬',\n      '\\\\iiint': '∭',\n      '\\\\oint': '∮',\n      '\\\\sum': '∑',\n      '\\\\prod': '∏',\n      '\\\\coprod': '∐',\n\n      // 逻辑符号\n      '\\\\forall': '∀',\n      '\\\\exists': '∃',\n      '\\\\nexists': '∄',\n      '\\\\neg': '¬',\n      '\\\\lnot': '¬',\n      '\\\\land': '∧',\n      '\\\\lor': '∨',\n      '\\\\implies': '⇒',\n      '\\\\iff': '⇔',\n\n      // 其他符号\n      '\\\\angle': '∠',\n      '\\\\degree': '°',\n      '\\\\prime': '′',\n      '\\\\dprime': '″',\n      '\\\\infty': '∞',\n      '\\\\aleph': 'ℵ',\n      '\\\\hbar': 'ℏ',\n      '\\\\ell': 'ℓ',\n      '\\\\wp': '℘',\n      '\\\\Re': 'ℜ',\n      '\\\\Im': 'ℑ',\n      '\\\\bot': '⊥',\n      '\\\\top': '⊤',\n      '\\\\perp': '⊥',\n      '\\\\parallel': '∥',\n      '\\\\triangle': '△',\n      '\\\\square': '□',\n      '\\\\checkmark': '✓',\n\n      // 特殊函数和文本\n      '\\\\dots': '…',\n      '\\\\ldots': '…',\n      '\\\\cdots': '⋯',\n      '\\\\vdots': '⋮',\n      '\\\\ddots': '⋱',\n\n      // 括号（虽然通常不需要转换，但有些特殊情况）\n      '\\\\langle': '⟨',\n      '\\\\rangle': '⟩',\n      '\\\\lfloor': '⌊',\n      '\\\\rfloor': '⌋',\n      '\\\\lceil': '⌈',\n      '\\\\rceil': '⌉',\n    };\n\n    // 上下标简化处理\n    // 将 ^{...} 和 _{...} 简化为 ^(...) 和 _(...) 以便阅读\n    result = result.replace(/\\^{([^}]+)}/g, '^($1)');\n    result = result.replace(/_{([^}]+)}/g, '_($1)');\n\n    // 分数简化\n    result = result.replace(/\\\\frac{([^}]+)}{([^}]+)}/g, '($1)/($2)');\n\n    // 平方根\n    result = result.replace(/\\\\sqrt{([^}]+)}/g, '√($1)');\n    result = result.replace(/\\\\sqrt\\[(\\d+)\\]{([^}]+)}/g, '[$1]√($2)');\n\n    // 替换希腊字母\n    Object.keys(greekLetters).forEach(latex => {\n      const regex = new RegExp(latex.replace(/\\\\/g, '\\\\\\\\'), 'g');\n      result = result.replace(regex, greekLetters[latex]);\n    });\n\n    // 替换数学符号\n    Object.keys(mathSymbols).forEach(latex => {\n      const regex = new RegExp(latex.replace(/\\\\/g, '\\\\\\\\'), 'g');\n      result = result.replace(regex, mathSymbols[latex]);\n    });\n\n    // 移除常见的LaTeX命令（保留内容）\n    result = result.replace(/\\\\text{([^}]+)}/g, '$1');\n    result = result.replace(/\\\\mathrm{([^}]+)}/g, '$1');\n    result = result.replace(/\\\\mathbf{([^}]+)}/g, '$1');\n    result = result.replace(/\\\\mathit{([^}]+)}/g, '$1');\n    result = result.replace(/\\\\mathcal{([^}]+)}/g, '$1');\n    result = result.replace(/\\\\mathbb{([^}]+)}/g, '$1');\n\n    // 移除对齐和换行命令\n    result = result.replace(/\\\\\\\\(?:\\[[^\\]]*\\])?/g, '\\n');\n    result = result.replace(/&/g, ' ');\n\n    // 移除空格命令\n    result = result.replace(/\\\\,/g, ' ');\n    result = result.replace(/\\\\;/g, ' ');\n    result = result.replace(/\\\\quad/g, '  ');\n    result = result.replace(/\\\\qquad/g, '    ');\n    result = result.replace(/\\\\ /g, ' ');\n\n    // 移除多余的花括号\n    result = result.replace(/{([^{}]+)}/g, '$1');\n\n    // 清理多余空格\n    result = result.replace(/\\s+/g, ' ').trim();\n\n    return result;\n  }\n\n  /**\n   * 生成文件名\n   */\n  generateFileName(meta) {\n    const date = DateTimeUtils.getCurrentDate();\n    const cleanTitle = (meta.name || 'conversation').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n    return `${cleanTitle}_${date}.pdf`;\n  }\n\n  /**\n   * 获取平台前缀\n   */\n  getPlatformPrefix(platform) {\n    const platformLower = (platform || '').toLowerCase();\n\n    if (platformLower.includes('chatgpt')) return 'chatgpt';\n    if (platformLower.includes('gemini')) return 'gemini';\n    if (platformLower.includes('notebooklm')) return 'notebooklm';\n    if (platformLower.includes('aistudio')) return 'aistudio';\n    if (platformLower.includes('sillytavern')) return 'sillytavern';\n\n    return 'claude';\n  }\n}\n\n// 导出单例实例\nexport const pdfExportManager = new PDFExportManager();\n"],"names":["async","loadFontFromProject","pdf","fontPath","fontName","arguments","length","undefined","fontStyle","console","log","concat","controller","AbortController","timeoutId","setTimeout","abort","cacheBuster","Date","now","response","fetch","signal","cache","headers","clearTimeout","ok","Error","status","contentType","get","includes","error","arrayBuffer","fileSizeKB","byteLength","toFixed","fileSizeMB","magic","DataView","getUint32","toString","hasCmap","version","warn","buffer","Uint8Array","cmapSignature","i","Math","min","hasUnicodeCmap","bytes","binary","len","chunkSize","chunk","subarray","String","fromCharCode","apply","base64","btoa","fileName","split","pop","addFileToVFS","addFont","addFontError","message","fetchError","name","PDF_STYLES","FONT_SIZE_TITLE","FONT_SIZE_H1","FONT_SIZE_H2","FONT_SIZE_SENDER","FONT_SIZE_BODY","FONT_SIZE_CODE","FONT_SIZE_TIMESTAMP","FONT_SIZE_HEADER","FONT_SIZE_FOOTER","COLOR_SENDER_HUMAN","COLOR_SENDER_ASSISTANT","COLOR_TIMESTAMP","COLOR_CODE_BG","COLOR_SECTION_BG","COLOR_TEXT","COLOR_HEADER","COLOR_FOOTER","COLOR_BORDER","MARGIN_LEFT","MARGIN_RIGHT","MARGIN_TOP","MARGIN_BOTTOM","LINE_HEIGHT","SECTION_SPACING","MESSAGE_SPACING","FOOTER_HEIGHT","PAGE_WIDTH","PAGE_HEIGHT","PDFExportManager","constructor","this","currentY","config","useChineseFont","chineseFontName","availableFontWeights","meta","exportDate","messageAnchors","safeSetFont","setFont","fallbackStyle","cleanText","text","cleaned","normalize","replace","exportToPDF","messages","_config$includeThinki","_config$includeArtifa","_config$includeTimest","_config$includeTools","_config$includeCitati","_config$highQuality","messageCount","DateTimeUtils","formatDateTime","_objectSpread","includeThinking","includeArtifacts","includeTimestamps","includeTools","includeCitations","highQuality","jsPDF","orientation","unit","format","compress","fontLoadResult","fontConfigs","path","style","weight","description","loadedCount","availableWeights","push","success","join","addChineseFontSupport","renderTitle","renderMetadata","hasTOC","tocPageNumber","addPage","internal","getCurrentPageInfo","pageNumber","renderMessage","renderTOCWithLinks","addBookmarks","addFooters","generateFileName","save","setFontSize","setTextColor","rawTitle","title","maxWidth","titleLines","splitTextToSize","forEach","line","checkPageBreak","cleanLine","trim","lines","platform","created_at","updated_at","tocPage","setPage","setDrawColor","setLineWidth","anchor","idx","_message$branchInfo","messageNumber","index","sender","preview","substring","branchMarker","branchInfo","isBranchPoint","childCount","entry","pageNum","page","color","pageNumWidth","getTextWidth","pageNumX","entryY","textWithLink","_message$attachments","_message$artifacts","_message$tools","_message$citations","currentPage","y","display_text","renderSender","timestamp","renderTimestamp","thinking","renderThinking","renderBody","attachments","renderAttachments","artifacts","artifact","renderArtifact","tools","tool","renderTool","citations","renderCitations","_message$branchInfo2","senderLabel","label","finalLabel","cleanLabel","parseTextWithCodeBlocksAndLatex","part","type","renderCodeBlock","content","language","renderLatexBlock","renderLatexInline","renderMarkdownText","renderPlainText","cleanedText","code","codeWidth","cleanCode","cleanLanguage","labelText","toUpperCase","labelWidth","setFillColor","roundedRect","codeLines","wrappedLines","lineNumber","wLine","blockStartY","blockStartPage","isFirstLine","firstPageHeight","padding","rect","_ref","currentPageBottom","remainingLines","newPageHeight","lineNumStr","padStart","safeLine","endPage","isFirst","isLast","boxStartY","boxEndY","groupCodeLinesByPage","groups","currentGroup","bottomLimit","simulatedY","simulatedPage","startY","latex","cleanLatex","renderedLatex","convertLatexToUnicode","formulaLines","groupLatexLinesByPage","formulaText","renderSection","JSON","stringify","input","output","map","cit","url","att","file_name","file_type","bgColor","cleanTitle","cleanContent","contentLines","bgHeight","renderFooter","totalPages","originalY","originalFontSize","getFontSize","footerY","exportText","pageText","pageTextWidth","outline","add","getNumberOfPages","requiredSpace","parts","elements","codeBlockRegex","match","lastIndex","exec","start","end","latexBlockRegex","some","el","latexInlineRegex","sort","a","b","element","plainText","parseTextWithCodeBlocks","renderMarkdownHeading","renderMarkdownQuote","renderMarkdownList","renderMarkdownInlineFormats","level","fontSize","oldFontSize","l","quoteWidth","quoteX","bullet","unorderedMatch","orderedMatch","bulletWidth","textWidth","textX","segments","parseInlineMarkdown","renderInlineSegments","matches","regex","pattern","RegExp","source","fullMatch","filteredMatches","existing","lastEnd","normalText","remainingText","currentX","currentLineSegments","availableWidth","segment","applySegmentStyle","renderSegmentLine","lineWidth","lineIdx","x","result","greekLetters","mathSymbols","Object","keys","date","getCurrentDate","getPlatformPrefix","platformLower","toLowerCase"],"sourceRoot":""}