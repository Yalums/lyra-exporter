{"version":3,"file":"static/js/843.c3431e18.chunk.js","mappings":"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","sources":["utils/exportManager.js"],"sourcesContent":["// utils/exportManager.js\n// é‡æ„åçš„å¯¼å‡ºç®¡ç†æ¨¡å—\n\nimport { DateTimeUtils, StorageUtils } from './commonUtils';\nimport { generateFileCardUuid } from './uuidManager';\n\n/**\n * å¯¼å‡ºé…ç½®\n */\nexport const ExportConfig = {\n  DEFAULT: {\n    includeThinking: true,\n    includeTools: true,\n    includeArtifacts: true,\n    includeCitations: true,\n    includeTimestamps: false,\n    exportObsidianMetadata: false,\n    exportMarkedOnly: false,\n    excludeDeleted: true,\n    includeCompleted: false,\n    includeImportant: false,\n    obsidianProperties: [],\n    obsidianTags: []\n  }\n};\n\n/**\n * Markdownç”Ÿæˆå™¨ç±»\n */\nexport class MarkdownGenerator {\n  constructor(config = {}) {\n    this.config = { ...ExportConfig.DEFAULT, ...config };\n  }\n\n  /**\n   * ç”Ÿæˆå®Œæ•´çš„Markdownæ–‡æ¡£\n   */\n  generate(processedData) {\n    const sections = [\n      this.generateMetadata(processedData),\n      this.generateHeader(processedData),\n      this.generateMessages(processedData),\n      this.generateFooter(processedData)\n    ];\n\n    return sections.filter(Boolean).join('\\n');\n  }\n\n  /**\n   * ç”ŸæˆYAMLå‰ç½®å…ƒæ•°æ®\n   */\n  generateMetadata(processedData) {\n    if (!this.config.exportObsidianMetadata) return '';\n\n    const lines = [\n      '---',\n      `title: ${processedData.meta_info?.title || 'å¯¹è¯è®°å½•'}`,\n      `date: ${DateTimeUtils.getCurrentDate()}`,\n      `export_time: ${DateTimeUtils.formatDateTime(new Date())}`\n    ];\n\n    // æ·»åŠ è‡ªå®šä¹‰å±æ€§\n    if (this.config.obsidianProperties?.length > 0) {\n      this.config.obsidianProperties.forEach(prop => {\n        if (prop.value.includes(',')) {\n          const values = prop.value.split(',').map(v => v.trim());\n          lines.push(`${prop.name}:`);\n          values.forEach(v => lines.push(`  - ${v}`));\n        } else {\n          lines.push(`${prop.name}: ${prop.value}`);\n        }\n      });\n    }\n\n    // æ·»åŠ æ ‡ç­¾\n    if (this.config.obsidianTags?.length > 0) {\n      lines.push('tags:');\n      this.config.obsidianTags.forEach(tag => lines.push(`  - ${tag}`));\n    }\n\n    lines.push('---', '');\n    return lines.join('\\n');\n  }\n\n  /**\n   * ç”Ÿæˆæ–‡æ¡£å¤´éƒ¨\n   */\n  generateHeader(processedData) {\n    const { meta_info = {} } = processedData;\n    const lines = [\n      `# ${meta_info.title || 'å¯¹è¯è®°å½•'}`,\n      `*åˆ›å»ºæ—¶é—´: ${meta_info.created_at || 'æœªçŸ¥'}*`,\n      `*å¯¼å‡ºæ—¶é—´: ${DateTimeUtils.formatDateTime(new Date())}*`\n    ];\n\n    // å¦‚æœæœ‰ç­›é€‰æ¡ä»¶ï¼Œæ·»åŠ è¯´æ˜\n    const hasFiltering = this.config.excludeDeleted || this.config.includeCompleted || this.config.includeImportant;\n    if (hasFiltering) {\n      const filterDesc = this.getFilterDescription();\n      if (filterDesc) {\n        lines.push(`*ç­›é€‰æ¡ä»¶: ${filterDesc}*`);\n      }\n    }\n\n    lines.push('', '---', '');\n    return lines.join('\\n');\n  }\n\n  /**\n   * ç”Ÿæˆæ¶ˆæ¯å†…å®¹\n   */\n  generateMessages(processedData) {\n    const { chat_history = [] } = processedData;\n    const filteredMessages = this.filterMessages(chat_history);\n\n    if (filteredMessages.length === 0) {\n      return '*æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯*\\n';\n    }\n\n    return filteredMessages\n      .map((msg, index) => this.formatMessage(msg, index + 1))\n      .join('\\n---\\n\\n');\n  }\n\n  /**\n   * ç”Ÿæˆæ–‡æ¡£å°¾éƒ¨\n   */\n  generateFooter(processedData) {\n    const { chat_history = [] } = processedData;\n    const filteredMessages = this.filterMessages(chat_history);\n    const originalCount = chat_history.length;\n    \n    if (filteredMessages.length < originalCount) {\n      return `\\n*æ ¹æ®ç­›é€‰æ¡ä»¶ï¼Œä» ${originalCount} æ¡æ¶ˆæ¯ä¸­å¯¼å‡ºäº† ${filteredMessages.length} æ¡æ¶ˆæ¯*`;\n    }\n    \n    return '';\n  }\n\n  /**\n   * è¿‡æ»¤æ¶ˆæ¯\n   */\n  filterMessages(messages) {\n    let filtered = [...messages];\n    \n    // è·å–æ ‡è®°æ•°æ®\n    const marks = this.config.marks || { completed: new Set(), important: new Set(), deleted: new Set() };\n\n    // æ’é™¤å·²åˆ é™¤çš„æ¶ˆæ¯\n    if (this.config.excludeDeleted) {\n      filtered = filtered.filter(msg => !marks.deleted.has(msg.index));\n    }\n\n    // ä»…åŒ…å«å·²å®Œæˆçš„æ¶ˆæ¯\n    if (this.config.includeCompleted && !this.config.includeImportant) {\n      filtered = filtered.filter(msg => marks.completed.has(msg.index));\n    }\n    \n    // ä»…åŒ…å«é‡è¦çš„æ¶ˆæ¯\n    if (this.config.includeImportant && !this.config.includeCompleted) {\n      filtered = filtered.filter(msg => marks.important.has(msg.index));\n    }\n    \n    // åŒæ—¶åŒ…å«å·²å®Œæˆå’Œé‡è¦çš„æ¶ˆæ¯\n    if (this.config.includeCompleted && this.config.includeImportant) {\n      filtered = filtered.filter(msg => \n        marks.completed.has(msg.index) && marks.important.has(msg.index)\n      );\n    }\n\n    return filtered;\n  }\n\n\n\n  /**\n  * æ ¼å¼åŒ–å•æ¡æ¶ˆæ¯\n  */\n  formatMessage(msg, index) {\n  const lines = [];\n\n  // æ ‡é¢˜ - ä½¿ç”¨é…ç½®çš„æ ¼å¼\n  const branchMarker = this.getBranchMarker(msg);\n  const title = this.formatMessageTitle(msg, index, branchMarker);\n    lines.push(title);\n\n  // æ—¶é—´æˆ³\n  if (this.config.includeTimestamps && msg.timestamp) {\n    lines.push(`*${msg.timestamp}*`);\n    }\n\n    lines.push('');\n\n  // æ­£æ–‡\n  if (msg.display_text) {\n    lines.push(msg.display_text, '');\n    }\n\n    // æ€è€ƒè¿‡ç¨‹\n    if (msg.thinking && this.config.includeThinking) {\n      lines.push(this.formatThinking(msg.thinking));\n    }\n\n    // Artifacts\n    if (msg.artifacts?.length > 0 && this.config.includeArtifacts) {\n      msg.artifacts.forEach(artifact => {\n        lines.push(this.formatArtifact(artifact));\n      });\n    }\n\n    // å·¥å…·ä½¿ç”¨\n    if (msg.tools?.length > 0 && this.config.includeTools) {\n      msg.tools.forEach(tool => {\n        lines.push(this.formatTool(tool));\n      });\n    }\n\n    // å¼•ç”¨\n    if (msg.citations?.length > 0 && this.config.includeCitations) {\n      lines.push(this.formatCitations(msg.citations));\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * æ ¼å¼åŒ–æ€è€ƒè¿‡ç¨‹\n   */\n  formatThinking(thinking) {\n    return [\n      '<details>',\n      '<summary>ğŸ’­ æ€è€ƒè¿‡ç¨‹</summary>',\n      '',\n      '```',\n      thinking,\n      '```',\n      '</details>',\n      ''\n    ].join('\\n');\n  }\n\n  /**\n   * æ ¼å¼åŒ–Artifact\n   */\n  formatArtifact(artifact) {\n    const lines = [\n      '<details>',\n      `<summary>ğŸ”§ Artifact: ${artifact.title || 'æ— æ ‡é¢˜'}</summary>`,\n      '',\n      `**ç±»å‹**: \\`${artifact.type || 'æœªçŸ¥'}\\``,\n      ''\n    ];\n\n    if (artifact.command === 'create' && artifact.content) {\n      if (artifact.language) {\n        lines.push(`**è¯­è¨€**: \\`${artifact.language}\\``);\n      }\n      lines.push('', '**å†…å®¹**:');\n      lines.push(`\\`\\`\\`${artifact.language || ''}`);\n      lines.push(artifact.content);\n      lines.push('```');\n    }\n\n    lines.push('</details>', '');\n    return lines.join('\\n');\n  }\n\n  /**\n   * æ ¼å¼åŒ–å·¥å…·ä½¿ç”¨\n   */\n  formatTool(tool) {\n    const lines = [\n      '<details>',\n      `<summary>ğŸ” å·¥å…·: ${tool.name}</summary>`,\n      ''\n    ];\n\n    if (tool.query) {\n      lines.push(`**æœç´¢æŸ¥è¯¢**: \\`${tool.query}\\``, '');\n    }\n\n    if (tool.result?.content && tool.name === 'web_search') {\n      lines.push('**æœç´¢ç»“æœ**:', '');\n      tool.result.content.slice(0, 5).forEach((item, i) => {\n        lines.push(`${i + 1}. [${item.title || 'æ— æ ‡é¢˜'}](${item.url || '#'})`);\n      });\n    }\n\n    lines.push('</details>', '');\n    return lines.join('\\n');\n  }\n\n  /**\n   * æ ¼å¼åŒ–å¼•ç”¨\n   */\n  formatCitations(citations) {\n    const lines = [\n      '<details>',\n      '<summary>ğŸ“ å¼•ç”¨æ¥æº</summary>',\n      '',\n      '| æ ‡é¢˜ | æ¥æº |',\n      '| --- | --- |'\n    ];\n\n    citations.forEach(citation => {\n      const title = citation.title || 'æœªçŸ¥æ¥æº';\n      const url = citation.url || '#';\n      const source = url.includes('/') ? url.split('/')[2] : 'æœªçŸ¥ç½‘ç«™';\n      lines.push(`| [${title}](${url}) | ${source} |`);\n    });\n\n    lines.push('</details>', '');\n    return lines.join('\\n');\n  }\n\n  /**\n   * è·å–åˆ†æ”¯æ ‡è®°\n   */\n  getBranchMarker(msg) {\n    if (msg.is_branch_point) return ' ğŸ”€';\n    if (msg.branch_level > 0) return ` â†³${msg.branch_level}`;\n    return '';\n  }\n\n  /**\n   * æ ¼å¼åŒ–æ¶ˆæ¯æ ‡é¢˜\n   */\n  formatMessageTitle(msg, index, branchMarker) {\n    let title = '';\n    \n    // æ ‡é¢˜å‰ç¼€ (#)\n    if (this.config.includeHeaderPrefix) {\n      title += '#'.repeat(this.config.headerLevel || 2) + ' ';\n    }\n    \n    // åºå·\n    if (this.config.includeNumbering) {\n      const numberFormat = this.config.numberingFormat || 'numeric';\n      if (numberFormat === 'numeric') {\n        title += `${index}. `;\n      } else if (numberFormat === 'letter') {\n        title += `${this.toExcelColumn(index)}. `;\n      } else if (numberFormat === 'roman') {\n        title += `${this.toRoman(index)}. `;\n      }\n    }\n    \n    // å‘é€è€…æ ‡ç­¾\n    const senderLabel = this.getSenderLabel(msg);\n    title += senderLabel + branchMarker;\n    \n    return title;\n  }\n  \n  /**\n   * è·å–å‘é€è€…æ ‡ç­¾\n   */\n  getSenderLabel(msg) {\n    const isHuman = msg.sender === 'human' || msg.sender_label === 'äººç±»' || msg.sender_label === 'Human';\n    \n    if (this.config.humanLabel && this.config.assistantLabel) {\n      return isHuman ? this.config.humanLabel : this.config.assistantLabel;\n    }\n    \n    return msg.sender_label || (isHuman ? 'äººç±»' : 'Claude');\n  }\n  \n  /**\n   * è½¬æ¢ä¸ºExcelé£æ ¼çš„å­—æ¯åºå·\n   */\n  toExcelColumn(num) {\n    let result = '';\n    while (num > 0) {\n      num--; // è°ƒæ•´ä¸º0åŸºç¡€\n      result = String.fromCharCode(65 + (num % 26)) + result;\n      num = Math.floor(num / 26);\n    }\n    return result;\n  }\n  \n  /**\n   * è½¬æ¢ä¸ºç½—é©¬æ•°å­—\n   */\n  toRoman(num) {\n    if (num <= 0 || num >= 4000) return num.toString(); // ç½—é©¬æ•°å­—é™åˆ¶\n    \n    const values = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];\n    const symbols = ['M', 'CM', 'D', 'CD', 'C', 'XC', 'L', 'XL', 'X', 'IX', 'V', 'IV', 'I'];\n    let result = '';\n    \n    for (let i = 0; i < values.length; i++) {\n      while (num >= values[i]) {\n        result += symbols[i];\n        num -= values[i];\n      }\n    }\n    \n    return result;\n  }\n\n  /**\n   * è·å–ç­›é€‰æè¿°\n   */\n  getFilterDescription() {\n    const filters = [];\n    \n    if (this.config.excludeDeleted) {\n      filters.push('æ’é™¤å·²åˆ é™¤');\n    }\n    \n    if (this.config.includeCompleted && this.config.includeImportant) {\n      filters.push('ä»…å·²å®Œæˆä¸”é‡è¦çš„æ¶ˆæ¯');\n    } else if (this.config.includeCompleted) {\n      filters.push('ä»…å·²å®Œæˆçš„æ¶ˆæ¯');\n    } else if (this.config.includeImportant) {\n      filters.push('ä»…é‡è¦çš„æ¶ˆæ¯');\n    }\n    \n    return filters.join('ï¼Œ');\n  }\n}\n\n/**\n * æ–‡ä»¶å¯¼å‡ºå™¨ç±»\n */\nexport class FileExporter {\n  /**\n   * ä¿å­˜æ–‡æœ¬åˆ°æ–‡ä»¶\n   */\n  static saveTextFile(text, fileName) {\n    try {\n      const blob = new Blob([text], { type: 'text/markdown;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      \n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      \n      return true;\n    } catch (error) {\n      console.error('ä¿å­˜æ–‡ä»¶å¤±è´¥:', error);\n      alert('ä¿å­˜æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•');\n      return false;\n    }\n  }\n\n  /**\n   * å¯¼å‡ºå•ä¸ªæ–‡ä»¶\n   */\n  static async exportSingleFile(data, config = {}) {\n    const generator = new MarkdownGenerator(config);\n    const markdown = generator.generate(data);\n    const fileName = this.generateFileName(data, 'single');\n    \n    return this.saveTextFile(markdown, fileName);\n  }\n\n  /**\n   * å¯¼å‡ºå¤šä¸ªæ–‡ä»¶\n   */\n  static async exportMultipleFiles(dataList, config = {}) {\n    const sections = dataList.map((data, index) => {\n      // å¯¹äºå¤šæ–‡ä»¶å¯¼å‡ºï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦å•ç‹¬å¤„ç†marks\n      // è¿™é‡Œæš‚æ—¶ä½¿ç”¨ç©ºçš„marksï¼Œå› ä¸ºå¤šæ–‡ä»¶å¯¼å‡ºçš„markså¤„ç†æ¯”è¾ƒå¤æ‚\n      const fileConfig = {\n        ...config,\n        marks: { completed: new Set(), important: new Set(), deleted: new Set() }\n      };\n      \n      const generator = new MarkdownGenerator(fileConfig);\n      return generator.generate(data);\n    });\n    \n    const combined = sections.join('\\n\\n---\\n---\\n\\n');\n    const fileName = this.generateFileName(null, 'multiple');\n    \n    return this.saveTextFile(combined, fileName);\n  }\n\n  /**\n   * ç”Ÿæˆæ–‡ä»¶å\n   */\n  static generateFileName(data, type = 'single') {\n    const date = DateTimeUtils.getCurrentDate();\n    \n    if (type === 'single' && data?.meta_info?.title) {\n      const title = data.meta_info.title.replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n      return `${title}_${date}.md`;\n    }\n    \n    return `export_${date}.md`;\n  }\n}\n\n/**\n * ä¸»å¯¼å‡ºå‡½æ•°\n */\nexport async function exportData(options) {\n  const {\n    scope = 'current',\n    data = null,\n    dataList = [],\n    config = {}\n  } = options;\n\n  try {\n    switch (scope) {\n      case 'current':\n        if (!data) throw new Error('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');\n        return FileExporter.exportSingleFile(data, config);\n        \n      case 'multiple':\n        if (dataList.length === 0) throw new Error('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');\n        return FileExporter.exportMultipleFiles(dataList, config);\n        \n      default:\n        throw new Error(`æœªçŸ¥çš„å¯¼å‡ºèŒƒå›´: ${scope}`);\n    }\n  } catch (error) {\n    console.error('å¯¼å‡ºå¤±è´¥:', error);\n    alert(`å¯¼å‡ºå¤±è´¥: ${error.message}`);\n    return false;\n  }\n}\n"],"names":["ExportConfig","includeThinking","includeTools","includeArtifacts","includeCitations","includeTimestamps","exportObsidianMetadata","exportMarkedOnly","excludeDeleted","includeCompleted","includeImportant","obsidianProperties","obsidianTags","MarkdownGenerator","constructor","config","arguments","length","undefined","this","_objectSpread","generate","processedData","generateMetadata","generateHeader","generateMessages","generateFooter","filter","Boolean","join","_processedData$meta_i","_this$config$obsidian","_this$config$obsidian2","lines","concat","meta_info","title","DateTimeUtils","getCurrentDate","formatDateTime","Date","forEach","prop","value","includes","values","split","map","v","trim","push","name","tag","created_at","filterDesc","getFilterDescription","chat_history","filteredMessages","filterMessages","msg","index","formatMessage","originalCount","messages","filtered","marks","completed","Set","important","deleted","has","_msg$artifacts","_msg$tools","_msg$citations","branchMarker","getBranchMarker","formatMessageTitle","timestamp","display_text","thinking","formatThinking","artifacts","artifact","formatArtifact","tools","tool","formatTool","citations","formatCitations","type","command","content","language","_tool$result","query","result","slice","item","i","url","citation","source","is_branch_point","branch_level","includeHeaderPrefix","repeat","headerLevel","includeNumbering","numberFormat","numberingFormat","toExcelColumn","toRoman","getSenderLabel","isHuman","sender","sender_label","humanLabel","assistantLabel","num","String","fromCharCode","Math","floor","toString","symbols","filters","FileExporter","saveTextFile","text","fileName","blob","Blob","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","error","console","alert","exportSingleFile","data","markdown","generateFileName","exportMultipleFiles","dataList","combined","fileConfig","_data$meta_info","date","replace","async","exportData","options","scope","Error","message"],"sourceRoot":""}